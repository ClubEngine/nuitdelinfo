// Three.js - http://github.com/mrdoob/three.js
'use strict';(function(b,a){"function"===typeof define&&define.amd?define(a):b.THREE=a()})(this,function(){var b=b||{REVISION:"50dev"};self.console||(self.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}});self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array);(function(){for(var a=0,d=["ms","moz","webkit","o"],b=0;b<d.length&&!window.requestAnimationFrame;++b){window.requestAnimationFrame=window[d[b]+"RequestAnimationFrame"];window.cancelAnimationFrame=
window[d[b]+"CancelAnimationFrame"]||window[d[b]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(d){var b=Date.now(),c=Math.max(0,16-(b-a)),h=window.setTimeout(function(){d(b+c)},c);a=b+c;return h};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(a){clearTimeout(a)}})();b.Clock=function(a){this.autoStart=a!==void 0?a:true;this.elapsedTime=this.oldTime=this.startTime=0;this.running=false};b.Clock.prototype.start=function(){this.oldTime=
this.startTime=Date.now();this.running=true};b.Clock.prototype.stop=function(){this.getElapsedTime();this.running=false};b.Clock.prototype.getElapsedTime=function(){return this.elapsedTime=this.elapsedTime+this.getDelta()};b.Clock.prototype.getDelta=function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var d=Date.now(),a=0.0010*(d-this.oldTime);this.oldTime=d;this.elapsedTime=this.elapsedTime+a}return a};b.Color=function(a){a!==void 0&&this.setHex(a);return this};b.Color.prototype=
{constructor:b.Color,r:1,g:1,b:1,copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},convertGammaToLinear:function(){var a=this.r,d=this.g,b=this.b;this.r=a*a;this.g=d*d;this.b=b*b;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);
return this},setRGB:function(a,d,b){this.r=a;this.g=d;this.b=b;return this},setHSV:function(a,d,b){var e,f,g;if(b===0)this.r=this.g=this.b=0;else{e=Math.floor(a*6);f=a*6-e;a=b*(1-d);g=b*(1-d*f);d=b*(1-d*(1-f));switch(e){case 1:this.r=g;this.g=b;this.b=a;break;case 2:this.r=a;this.g=b;this.b=d;break;case 3:this.r=a;this.g=g;this.b=b;break;case 4:this.r=d;this.g=a;this.b=b;break;case 5:this.r=b;this.g=a;this.b=g;break;case 6:case 0:this.r=b;this.g=d;this.b=a}}return this},setHex:function(a){a=Math.floor(a);
this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},lerpSelf:function(a,d){this.r=this.r+(a.r-this.r)*d;this.g=this.g+(a.g-this.g)*d;this.b=this.b+(a.b-this.b)*d;return this},getHex:function(){return Math.floor(this.r*255)<<16^Math.floor(this.g*255)<<8^Math.floor(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new b.Color).setRGB(this.r,this.g,this.b)}};b.Vector2=
function(a,d){this.x=a||0;this.y=d||0};b.Vector2.prototype={constructor:b.Vector2,set:function(a,d){this.x=a;this.y=d;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,d){this.x=a.x+d.x;this.y=a.y+d.y;return this},addSelf:function(a){this.x=this.x+a.x;this.y=this.y+a.y;return this},sub:function(a,d){this.x=a.x-d.x;this.y=a.y-d.y;return this},subSelf:function(a){this.x=this.x-a.x;this.y=this.y-a.y;return this},multiplyScalar:function(a){this.x=this.x*a;this.y=this.y*a;
return this},divideScalar:function(a){if(a){this.x=this.x/a;this.y=this.y/a}else this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var d=this.x-a.x,a=this.y-a.y;
return d*d+a*a},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,d){this.x=this.x+(a.x-this.x)*d;this.y=this.y+(a.y-this.y)*d;return this},equals:function(a){return a.x===this.x&&a.y===this.y},isZero:function(){return this.lengthSq()<1.0E-4},clone:function(){return new b.Vector2(this.x,this.y)}};b.Vector3=function(a,d,b){this.x=a||0;this.y=d||0;this.z=b||0};b.Vector3.prototype={constructor:b.Vector3,set:function(a,d,b){this.x=a;this.y=d;this.z=b;return this},setX:function(a){this.x=
a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,d){this.x=a.x+d.x;this.y=a.y+d.y;this.z=a.z+d.z;return this},addSelf:function(a){this.x=this.x+a.x;this.y=this.y+a.y;this.z=this.z+a.z;return this},addScalar:function(a){this.x=this.x+a;this.y=this.y+a;this.z=this.z+a;return this},sub:function(a,d){this.x=a.x-d.x;this.y=a.y-d.y;this.z=a.z-d.z;return this},subSelf:function(a){this.x=
this.x-a.x;this.y=this.y-a.y;this.z=this.z-a.z;return this},multiply:function(a,d){this.x=a.x*d.x;this.y=a.y*d.y;this.z=a.z*d.z;return this},multiplySelf:function(a){this.x=this.x*a.x;this.y=this.y*a.y;this.z=this.z*a.z;return this},multiplyScalar:function(a){this.x=this.x*a;this.y=this.y*a;this.z=this.z*a;return this},divideSelf:function(a){this.x=this.x/a.x;this.y=this.y/a.y;this.z=this.z/a.z;return this},divideScalar:function(a){if(a){this.x=this.x/a;this.y=this.y/a;this.z=this.z/a}else this.z=
this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,d){this.x=
this.x+(a.x-this.x)*d;this.y=this.y+(a.y-this.y)*d;this.z=this.z+(a.z-this.z)*d;return this},cross:function(a,d){this.x=a.y*d.z-a.z*d.y;this.y=a.z*d.x-a.x*d.z;this.z=a.x*d.y-a.y*d.x;return this},crossSelf:function(a){var d=this.x,b=this.y,e=this.z;this.x=b*a.z-e*a.y;this.y=e*a.x-d*a.z;this.z=d*a.y-b*a.x;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return(new b.Vector3).sub(this,a).lengthSq()},getPositionFromMatrix:function(a){this.x=
a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setEulerFromRotationMatrix:function(a,d){function b(a){return Math.min(Math.max(a,-1),1)}var e=a.elements,f=e[0],g=e[4],h=e[8],i=e[1],j=e[5],l=e[9],m=e[2],p=e[6],e=e[10];switch(d||"XYZ"){case "YXZ":this.x=Math.asin(-b(l));if(Math.abs(l)<0.99999){this.y=Math.atan2(h,e);this.z=Math.atan2(i,j)}else{this.y=Math.atan2(-m,f);this.z=0}break;case "ZXY":this.x=Math.asin(b(p));if(Math.abs(p)<0.99999){this.y=Math.atan2(-m,e);this.z=Math.atan2(-g,
j)}else{this.y=0;this.z=Math.atan2(h,f)}break;case "ZYX":this.y=Math.asin(-b(m));if(Math.abs(m)<0.99999){this.x=Math.atan2(p,e);this.z=Math.atan2(i,f)}else{this.x=0;this.z=Math.atan2(-g,j)}break;case "YZX":this.z=Math.asin(b(i));if(Math.abs(i)<0.99999){this.x=Math.atan2(-l,j);this.y=Math.atan2(-m,f)}else{this.x=0;this.y=Math.atan2(m,e)}break;case "XZY":this.z=Math.asin(-b(g));if(Math.abs(g)<0.99999){this.x=Math.atan2(p,j);this.y=Math.atan2(h,f)}else{this.x=Math.atan2(-h,e);this.y=0}break;default:this.y=
Math.asin(b(h));if(Math.abs(h)<0.99999){this.x=Math.atan2(-l,e);this.z=Math.atan2(-g,f)}else{this.x=Math.atan2(i,j);this.z=0}}return this},setEulerFromQuaternion:function(a,d){function b(a){return Math.min(Math.max(a,-1),1)}var e=a.x*a.x,f=a.y*a.y,g=a.z*a.z,h=a.w*a.w;switch(d){case "YXZ":this.x=Math.asin(b(2*(a.x*a.w-a.y*a.z)));this.y=Math.atan2(2*(a.x*a.z+a.y*a.w),h-e-f+g);this.z=Math.atan2(2*(a.x*a.y+a.z*a.w),h-e+f-g);break;case "ZXY":this.x=Math.asin(b(2*(a.x*a.w+a.y*a.z)));this.y=Math.atan2(2*
(a.y*a.w-a.z*a.x),h-e-f+g);this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),h-e+f-g);break;case "ZYX":this.x=Math.atan2(2*(a.x*a.w+a.z*a.y),h-e-f+g);this.y=Math.asin(b(2*(a.y*a.w-a.x*a.z)));this.z=Math.atan2(2*(a.x*a.y+a.z*a.w),h+e-f-g);break;case "YZX":this.x=Math.atan2(2*(a.x*a.w-a.z*a.y),h-e+f-g);this.y=Math.atan2(2*(a.y*a.w-a.x*a.z),h+e-f-g);this.z=Math.asin(b(2*(a.x*a.y+a.z*a.w)));break;case "XZY":this.x=Math.atan2(2*(a.x*a.w+a.y*a.z),h-e+f-g);this.y=Math.atan2(2*(a.x*a.z+a.y*a.w),h+e-f-g);this.z=Math.asin(b(2*
(a.z*a.w-a.x*a.y)));break;default:this.x=Math.atan2(2*(a.x*a.w-a.y*a.z),h-e-f+g);this.y=Math.asin(b(2*(a.x*a.z+a.y*a.w)));this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),h+e-f-g)}return this},getScaleFromMatrix:function(a){var d=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),b=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=d;this.y=b;this.z=a;return this},equals:function(a){return a.x===this.x&&a.y===this.y&&
a.z===this.z},isZero:function(){return this.lengthSq()<1.0E-4},clone:function(){return new b.Vector3(this.x,this.y,this.z)}};b.Vector4=function(a,d,b,e){this.x=a||0;this.y=d||0;this.z=b||0;this.w=e!==void 0?e:1};b.Vector4.prototype={constructor:b.Vector4,set:function(a,d,b,e){this.x=a;this.y=d;this.z=b;this.w=e;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w!==void 0?a.w:1;return this},add:function(a,d){this.x=a.x+d.x;this.y=a.y+d.y;this.z=a.z+d.z;this.w=a.w+d.w;return this},
addSelf:function(a){this.x=this.x+a.x;this.y=this.y+a.y;this.z=this.z+a.z;this.w=this.w+a.w;return this},sub:function(a,d){this.x=a.x-d.x;this.y=a.y-d.y;this.z=a.z-d.z;this.w=a.w-d.w;return this},subSelf:function(a){this.x=this.x-a.x;this.y=this.y-a.y;this.z=this.z-a.z;this.w=this.w-a.w;return this},multiplyScalar:function(a){this.x=this.x*a;this.y=this.y*a;this.z=this.z*a;this.w=this.w*a;return this},divideScalar:function(a){if(a){this.x=this.x/a;this.y=this.y/a;this.z=this.z/a;this.w=this.w/a}else{this.z=
this.y=this.x=0;this.w=1}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,d){this.x=this.x+(a.x-this.x)*d;this.y=this.y+(a.y-this.y)*d;this.z=this.z+(a.z-this.z)*d;this.w=this.w+
(a.w-this.w)*d;return this},clone:function(){return new b.Vector4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var d=Math.sqrt(1-a.w*a.w);if(d<1.0E-4){this.x=1;this.z=this.y=0}else{this.x=a.x/d;this.y=a.y/d;this.z=a.z/d}return this},setAxisAngleFromRotationMatrix:function(a){var d,b,e,a=a.elements,f=a[0];e=a[4];var g=a[8],h=a[1],i=a[5],j=a[9];b=a[2];d=a[6];var l=a[10];if(Math.abs(e-h)<0.01&&Math.abs(g-b)<0.01&&Math.abs(j-d)<0.01){if(Math.abs(e+h)<0.1&&
Math.abs(g+b)<0.1&&Math.abs(j+d)<0.1&&Math.abs(f+i+l-3)<0.1){this.set(1,0,0,0);return this}a=Math.PI;f=(f+1)/2;i=(i+1)/2;l=(l+1)/2;e=(e+h)/4;g=(g+b)/4;j=(j+d)/4;if(f>i&&f>l)if(f<0.01){d=0;e=b=0.707106781}else{d=Math.sqrt(f);b=e/d;e=g/d}else if(i>l)if(i<0.01){d=0.707106781;b=0;e=0.707106781}else{b=Math.sqrt(i);d=e/b;e=j/b}else if(l<0.01){b=d=0.707106781;e=0}else{e=Math.sqrt(l);d=g/e;b=j/e}this.set(d,b,e,a);return this}a=Math.sqrt((d-j)*(d-j)+(g-b)*(g-b)+(h-e)*(h-e));Math.abs(a)<0.0010&&(a=1);this.x=
(d-j)/a;this.y=(g-b)/a;this.z=(h-e)/a;this.w=Math.acos((f+i+l-1)/2);return this}};b.EventTarget=function(){var a={};this.addEventListener=function(d,b){a[d]===void 0&&(a[d]=[]);a[d].indexOf(b)===-1&&a[d].push(b)};this.dispatchEvent=function(d){for(var b in a[d.type])a[d.type][b](d)};this.removeEventListener=function(d,b){var e=a[d].indexOf(b);e!==-1&&a[d].splice(e,1)}};b.Frustum=function(){this.planes=[new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4]};b.Frustum.prototype.setFromMatrix=
function(a){var d,b=this.planes,e=a.elements,a=e[0];d=e[1];var f=e[2],g=e[3],h=e[4],i=e[5],j=e[6],l=e[7],m=e[8],p=e[9],n=e[10],q=e[11],s=e[12],o=e[13],r=e[14],e=e[15];b[0].set(g-a,l-h,q-m,e-s);b[1].set(g+a,l+h,q+m,e+s);b[2].set(g+d,l+i,q+p,e+o);b[3].set(g-d,l-i,q-p,e-o);b[4].set(g-f,l-j,q-n,e-r);b[5].set(g+f,l+j,q+n,e+r);for(a=0;a<6;a++){d=b[a];d.divideScalar(Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z))}};b.Frustum.prototype.contains=function(a){for(var d=this.planes,b=a.matrixWorld,e=b.elements,b=-a.geometry.boundingSphere.radius*
b.getMaxScaleOnAxis(),f=0;f<6;f++){a=d[f].x*e[12]+d[f].y*e[13]+d[f].z*e[14]+d[f].w;if(a<=b)return false}return true};b.Frustum.__v1=new b.Vector3;b.Ray=function(a,d,c,e){this.origin=a||new b.Vector3;this.direction=d||new b.Vector3;this.near=c||0;this.far=e||Infinity;var f=new b.Vector3,g=new b.Vector3,h=new b.Vector3,i=new b.Vector3,j=new b.Vector3,l=new b.Vector3,m=new b.Vector3,p=new b.Vector3,n=new b.Vector3,q=function(a,d){return a.distance-d.distance},s=new b.Vector3,o=new b.Vector3,r=new b.Vector3,
u,v,x,t=function(a,d,b){s.sub(b,a);u=s.dot(d);v=o.add(a,r.copy(d).multiplyScalar(u));return x=b.distanceTo(v)},y,G,D,B,w,I,J,O,S=function(a,d,b,c){s.sub(c,d);o.sub(b,d);r.sub(a,d);y=s.dot(s);G=s.dot(o);D=s.dot(r);B=o.dot(o);w=o.dot(r);I=1/(y*B-G*G);J=(B*D-G*w)*I;O=(y*w-G*D)*I;return J>=0&&O>=0&&J+O<1},Z=1.0E-4;this.setPrecision=function(a){Z=a};this.intersectObject=function(a,d){var c,e=[];if(d===true)for(var k=0,o=a.children.length;k<o;k++)Array.prototype.push.apply(e,this.intersectObject(a.children[k],
d));if(a instanceof b.Particle){x=t(this.origin,this.direction,a.matrixWorld.getPosition());if(x>a.scale.x)return[];c={distance:x,point:a.position,face:null,object:a};e.push(c)}else if(a instanceof b.Mesh){k=b.Frustum.__v1.set(a.matrixWorld.getColumnX().length(),a.matrixWorld.getColumnY().length(),a.matrixWorld.getColumnZ().length());k=a.geometry.boundingSphere.radius*Math.max(k.x,Math.max(k.y,k.z));x=t(this.origin,this.direction,a.matrixWorld.getPosition());if(x>k)return e;var s,r,u=a.geometry,v=
u.vertices,w;a.matrixRotationWorld.extractRotation(a.matrixWorld);k=0;for(o=u.faces.length;k<o;k++){c=u.faces[k];j.copy(this.origin);l.copy(this.direction);w=a.matrixWorld;m=w.multiplyVector3(m.copy(c.centroid)).subSelf(j);p=a.matrixRotationWorld.multiplyVector3(p.copy(c.normal));s=l.dot(p);if(!(Math.abs(s)<Z)){r=p.dot(m)/s;if(!(r<0)&&(a.doubleSided||(a.flipSided?s>0:s<0))){n.add(j,l.multiplyScalar(r));x=j.distanceTo(n);if(!(x<this.near)&&!(x>this.far))if(c instanceof b.Face3){f=w.multiplyVector3(f.copy(v[c.a]));
g=w.multiplyVector3(g.copy(v[c.b]));h=w.multiplyVector3(h.copy(v[c.c]));if(S(n,f,g,h)){c={distance:x,point:n.clone(),face:c,object:a};e.push(c)}}else if(c instanceof b.Face4){f=w.multiplyVector3(f.copy(v[c.a]));g=w.multiplyVector3(g.copy(v[c.b]));h=w.multiplyVector3(h.copy(v[c.c]));i=w.multiplyVector3(i.copy(v[c.d]));if(S(n,f,g,i)||S(n,g,h,i)){c={distance:x,point:n.clone(),face:c,object:a};e.push(c)}}}}}}e.sort(q);return e};this.intersectObjects=function(a,d){for(var b=[],c=0,e=a.length;c<e;c++)Array.prototype.push.apply(b,
this.intersectObject(a[c],d));b.sort(q);return b}};b.Rectangle=function(){function a(){g=e-d;h=f-b}var d,b,e,f,g,h,i=true;this.getX=function(){return d};this.getY=function(){return b};this.getWidth=function(){return g};this.getHeight=function(){return h};this.getLeft=function(){return d};this.getTop=function(){return b};this.getRight=function(){return e};this.getBottom=function(){return f};this.set=function(g,h,m,p){i=false;d=g;b=h;e=m;f=p;a()};this.addPoint=function(g,h){if(i){i=false;d=g;b=h;e=
g;f=h}else{d=d<g?d:g;b=b<h?b:h;e=e>g?e:g;f=f>h?f:h}a()};this.add3Points=function(g,h,m,p,n,q){if(i){i=false;d=g<m?g<n?g:n:m<n?m:n;b=h<p?h<q?h:q:p<q?p:q;e=g>m?g>n?g:n:m>n?m:n;f=h>p?h>q?h:q:p>q?p:q}else{d=g<m?g<n?g<d?g:d:n<d?n:d:m<n?m<d?m:d:n<d?n:d;b=h<p?h<q?h<b?h:b:q<b?q:b:p<q?p<b?p:b:q<b?q:b;e=g>m?g>n?g>e?g:e:n>e?n:e:m>n?m>e?m:e:n>e?n:e;f=h>p?h>q?h>f?h:f:q>f?q:f:p>q?p>f?p:f:q>f?q:f}a()};this.addRectangle=function(g){if(i){i=false;d=g.getLeft();b=g.getTop();e=g.getRight();f=g.getBottom()}else{d=d<
g.getLeft()?d:g.getLeft();b=b<g.getTop()?b:g.getTop();e=e>g.getRight()?e:g.getRight();f=f>g.getBottom()?f:g.getBottom()}a()};this.inflate=function(g){d=d-g;b=b-g;e=e+g;f=f+g;a()};this.minSelf=function(g){d=d>g.getLeft()?d:g.getLeft();b=b>g.getTop()?b:g.getTop();e=e<g.getRight()?e:g.getRight();f=f<g.getBottom()?f:g.getBottom();a()};this.intersects=function(a){return e<a.getLeft()||d>a.getRight()||f<a.getTop()||b>a.getBottom()?false:true};this.empty=function(){i=true;f=e=b=d=0;a()};this.isEmpty=function(){return i}};
b.Math={clamp:function(a,d,b){return a<d?d:a>b?b:a},clampBottom:function(a,d){return a<d?d:a},mapLinear:function(a,d,b,e,f){return e+(a-d)*(f-e)/(b-d)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,d){return a+Math.floor(Math.random()*(d-a+1))},randFloat:function(a,d){return a+Math.random()*(d-a)},randFloatSpread:function(a){return a*(0.5-Math.random())},sign:function(a){return a<0?-1:a>0?1:0}};b.Matrix3=function(){this.elements=new Float32Array(9)};b.Matrix3.prototype=
{constructor:b.Matrix3,getInverse:function(a){var d=a.elements,a=d[10]*d[5]-d[6]*d[9],b=-d[10]*d[1]+d[2]*d[9],e=d[6]*d[1]-d[2]*d[5],f=-d[10]*d[4]+d[6]*d[8],g=d[10]*d[0]-d[2]*d[8],h=-d[6]*d[0]+d[2]*d[4],i=d[9]*d[4]-d[5]*d[8],j=-d[9]*d[0]+d[1]*d[8],l=d[5]*d[0]-d[1]*d[4],d=d[0]*a+d[1]*f+d[2]*i;d===0&&console.warn("Matrix3.getInverse(): determinant == 0");var d=1/d,m=this.elements;m[0]=d*a;m[1]=d*b;m[2]=d*e;m[3]=d*f;m[4]=d*g;m[5]=d*h;m[6]=d*i;m[7]=d*j;m[8]=d*l;return this},transpose:function(){var a,
d=this.elements;a=d[1];d[1]=d[3];d[3]=a;a=d[2];d[2]=d[6];d[6]=a;a=d[5];d[5]=d[7];d[7]=a;return this},transposeIntoArray:function(a){var d=this.m;a[0]=d[0];a[1]=d[3];a[2]=d[6];a[3]=d[1];a[4]=d[4];a[5]=d[7];a[6]=d[2];a[7]=d[5];a[8]=d[8];return this}};b.Matrix4=function(a,d,b,e,f,g,h,i,j,l,m,p,n,q,s,o){this.elements=new Float32Array(16);this.set(a!==void 0?a:1,d||0,b||0,e||0,f||0,g!==void 0?g:1,h||0,i||0,j||0,l||0,m!==void 0?m:1,p||0,n||0,q||0,s||0,o!==void 0?o:1)};b.Matrix4.prototype={constructor:b.Matrix4,
set:function(a,d,b,e,f,g,h,i,j,l,m,p,n,q,s,o){var r=this.elements;r[0]=a;r[4]=d;r[8]=b;r[12]=e;r[1]=f;r[5]=g;r[9]=h;r[13]=i;r[2]=j;r[6]=l;r[10]=m;r[14]=p;r[3]=n;r[7]=q;r[11]=s;r[15]=o;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]);return this},lookAt:function(a,d,c){var e=this.elements,f=b.Matrix4.__v1,g=b.Matrix4.__v2,h=b.Matrix4.__v3;
h.sub(a,d).normalize();if(h.length()===0)h.z=1;f.cross(c,h).normalize();if(f.length()===0){h.x=h.x+1.0E-4;f.cross(c,h).normalize()}g.cross(h,f);e[0]=f.x;e[4]=g.x;e[8]=h.x;e[1]=f.y;e[5]=g.y;e[9]=h.y;e[2]=f.z;e[6]=g.z;e[10]=h.z;return this},multiply:function(a,d){var b=a.elements,e=d.elements,f=this.elements,g=b[0],h=b[4],i=b[8],j=b[12],l=b[1],m=b[5],p=b[9],n=b[13],q=b[2],s=b[6],o=b[10],r=b[14],u=b[3],v=b[7],x=b[11],b=b[15],t=e[0],y=e[4],G=e[8],D=e[12],B=e[1],w=e[5],I=e[9],J=e[13],O=e[2],S=e[6],Z=e[10],
C=e[14],H=e[3],R=e[7],E=e[11],e=e[15];f[0]=g*t+h*B+i*O+j*H;f[4]=g*y+h*w+i*S+j*R;f[8]=g*G+h*I+i*Z+j*E;f[12]=g*D+h*J+i*C+j*e;f[1]=l*t+m*B+p*O+n*H;f[5]=l*y+m*w+p*S+n*R;f[9]=l*G+m*I+p*Z+n*E;f[13]=l*D+m*J+p*C+n*e;f[2]=q*t+s*B+o*O+r*H;f[6]=q*y+s*w+o*S+r*R;f[10]=q*G+s*I+o*Z+r*E;f[14]=q*D+s*J+o*C+r*e;f[3]=u*t+v*B+x*O+b*H;f[7]=u*y+v*w+x*S+b*R;f[11]=u*G+v*I+x*Z+b*E;f[15]=u*D+v*J+x*C+b*e;return this},multiplySelf:function(a){return this.multiply(this,a)},multiplyToArray:function(a,b,c){var e=this.elements;this.multiply(a,
b);c[0]=e[0];c[1]=e[1];c[2]=e[2];c[3]=e[3];c[4]=e[4];c[5]=e[5];c[6]=e[6];c[7]=e[7];c[8]=e[8];c[9]=e[9];c[10]=e[10];c[11]=e[11];c[12]=e[12];c[13]=e[13];c[14]=e[14];c[15]=e[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]=b[0]*a;b[4]=b[4]*a;b[8]=b[8]*a;b[12]=b[12]*a;b[1]=b[1]*a;b[5]=b[5]*a;b[9]=b[9]*a;b[13]=b[13]*a;b[2]=b[2]*a;b[6]=b[6]*a;b[10]=b[10]*a;b[14]=b[14]*a;b[3]=b[3]*a;b[7]=b[7]*a;b[11]=b[11]*a;b[15]=b[15]*a;return this},multiplyVector3:function(a){var b=this.elements,c=
a.x,e=a.y,f=a.z,g=1/(b[3]*c+b[7]*e+b[11]*f+b[15]);a.x=(b[0]*c+b[4]*e+b[8]*f+b[12])*g;a.y=(b[1]*c+b[5]*e+b[9]*f+b[13])*g;a.z=(b[2]*c+b[6]*e+b[10]*f+b[14])*g;return a},multiplyVector4:function(a){var b=this.elements,c=a.x,e=a.y,f=a.z,g=a.w;a.x=b[0]*c+b[4]*e+b[8]*f+b[12]*g;a.y=b[1]*c+b[5]*e+b[9]*f+b[13]*g;a.z=b[2]*c+b[6]*e+b[10]*f+b[14]*g;a.w=b[3]*c+b[7]*e+b[11]*f+b[15]*g;return a},rotateAxis:function(a){var b=this.elements,c=a.x,e=a.y,f=a.z;a.x=c*b[0]+e*b[4]+f*b[8];a.y=c*b[1]+e*b[5]+f*b[9];a.z=c*b[2]+
e*b[6]+f*b[10];a.normalize();return a},crossVector:function(a){var d=this.elements,c=new b.Vector4;c.x=d[0]*a.x+d[4]*a.y+d[8]*a.z+d[12]*a.w;c.y=d[1]*a.x+d[5]*a.y+d[9]*a.z+d[13]*a.w;c.z=d[2]*a.x+d[6]*a.y+d[10]*a.z+d[14]*a.w;c.w=a.w?d[3]*a.x+d[7]*a.y+d[11]*a.z+d[15]*a.w:1;return c},determinant:function(){var a=this.elements,b=a[0],c=a[4],e=a[8],f=a[12],g=a[1],h=a[5],i=a[9],j=a[13],l=a[2],m=a[6],p=a[10],n=a[14],q=a[3],s=a[7],o=a[11],a=a[15];return f*i*m*q-e*j*m*q-f*h*p*q+c*j*p*q+e*h*n*q-c*i*n*q-f*i*
l*s+e*j*l*s+f*g*p*s-b*j*p*s-e*g*n*s+b*i*n*s+f*h*l*o-c*j*l*o-f*g*m*o+b*j*m*o+c*g*n*o-b*h*n*o-e*h*l*a+c*i*l*a+e*g*m*a-b*i*m*a-c*g*p*a+b*h*p*a},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=
b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=this.elements;return b.Matrix4.__v1.set(a[12],a[13],a[14])},setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=
a.z;return this},getColumnX:function(){var a=this.elements;return b.Matrix4.__v1.set(a[0],a[1],a[2])},getColumnY:function(){var a=this.elements;return b.Matrix4.__v1.set(a[4],a[5],a[6])},getColumnZ:function(){var a=this.elements;return b.Matrix4.__v1.set(a[8],a[9],a[10])},getInverse:function(a){var b=this.elements,c=a.elements,e=c[0],f=c[4],g=c[8],h=c[12],i=c[1],j=c[5],l=c[9],m=c[13],p=c[2],n=c[6],q=c[10],s=c[14],o=c[3],r=c[7],u=c[11],c=c[15];b[0]=l*s*r-m*q*r+m*n*u-j*s*u-l*n*c+j*q*c;b[4]=h*q*r-g*
s*r-h*n*u+f*s*u+g*n*c-f*q*c;b[8]=g*m*r-h*l*r+h*j*u-f*m*u-g*j*c+f*l*c;b[12]=h*l*n-g*m*n-h*j*q+f*m*q+g*j*s-f*l*s;b[1]=m*q*o-l*s*o-m*p*u+i*s*u+l*p*c-i*q*c;b[5]=g*s*o-h*q*o+h*p*u-e*s*u-g*p*c+e*q*c;b[9]=h*l*o-g*m*o-h*i*u+e*m*u+g*i*c-e*l*c;b[13]=g*m*p-h*l*p+h*i*q-e*m*q-g*i*s+e*l*s;b[2]=j*s*o-m*n*o+m*p*r-i*s*r-j*p*c+i*n*c;b[6]=h*n*o-f*s*o-h*p*r+e*s*r+f*p*c-e*n*c;b[10]=f*m*o-h*j*o+h*i*r-e*m*r-f*i*c+e*j*c;b[14]=h*j*p-f*m*p-h*i*n+e*m*n+f*i*s-e*j*s;b[3]=l*n*o-j*q*o-l*p*r+i*q*r+j*p*u-i*n*u;b[7]=f*q*o-g*n*o+g*
p*r-e*q*r-f*p*u+e*n*u;b[11]=g*j*o-f*l*o-g*i*r+e*l*r+f*i*u-e*j*u;b[15]=f*l*p-g*j*p+g*i*n-e*l*n-f*i*q+e*j*q;this.multiplyScalar(1/a.determinant());return this},setRotationFromEuler:function(a,b){var c=this.elements,e=a.x,f=a.y,g=a.z,h=Math.cos(e),e=Math.sin(e),i=Math.cos(f),f=Math.sin(f),j=Math.cos(g),g=Math.sin(g);switch(b){case "YXZ":var l=i*j,m=i*g,p=f*j,n=f*g;c[0]=l+n*e;c[4]=p*e-m;c[8]=h*f;c[1]=h*g;c[5]=h*j;c[9]=-e;c[2]=m*e-p;c[6]=n+l*e;c[10]=h*i;break;case "ZXY":l=i*j;m=i*g;p=f*j;n=f*g;c[0]=l-
n*e;c[4]=-h*g;c[8]=p+m*e;c[1]=m+p*e;c[5]=h*j;c[9]=n-l*e;c[2]=-h*f;c[6]=e;c[10]=h*i;break;case "ZYX":l=h*j;m=h*g;p=e*j;n=e*g;c[0]=i*j;c[4]=p*f-m;c[8]=l*f+n;c[1]=i*g;c[5]=n*f+l;c[9]=m*f-p;c[2]=-f;c[6]=e*i;c[10]=h*i;break;case "YZX":l=h*i;m=h*f;p=e*i;n=e*f;c[0]=i*j;c[4]=n-l*g;c[8]=p*g+m;c[1]=g;c[5]=h*j;c[9]=-e*j;c[2]=-f*j;c[6]=m*g+p;c[10]=l-n*g;break;case "XZY":l=h*i;m=h*f;p=e*i;n=e*f;c[0]=i*j;c[4]=-g;c[8]=f*j;c[1]=l*g+n;c[5]=h*j;c[9]=m*g-p;c[2]=p*g-m;c[6]=e*j;c[10]=n*g+l;break;default:l=h*j;m=h*g;p=
e*j;n=e*g;c[0]=i*j;c[4]=-i*g;c[8]=f;c[1]=m+p*f;c[5]=l-n*f;c[9]=-e*i;c[2]=n-l*f;c[6]=p+m*f;c[10]=h*i}return this},setRotationFromQuaternion:function(a){var b=this.elements,c=a.x,e=a.y,f=a.z,g=a.w,h=c+c,i=e+e,j=f+f,a=c*h,l=c*i,c=c*j,m=e*i,e=e*j,f=f*j,h=g*h,i=g*i,g=g*j;b[0]=1-(m+f);b[4]=l-g;b[8]=c+i;b[1]=l+g;b[5]=1-(a+f);b[9]=e-h;b[2]=c-i;b[6]=e+h;b[10]=1-(a+m);return this},compose:function(a,d,c){var e=this.elements,f=b.Matrix4.__m1,g=b.Matrix4.__m2;f.identity();f.setRotationFromQuaternion(d);g.makeScale(c.x,
c.y,c.z);this.multiply(f,g);e[12]=a.x;e[13]=a.y;e[14]=a.z;return this},decompose:function(a,d,c){var e=this.elements,f=b.Matrix4.__v1,g=b.Matrix4.__v2,h=b.Matrix4.__v3;f.set(e[0],e[1],e[2]);g.set(e[4],e[5],e[6]);h.set(e[8],e[9],e[10]);a=a instanceof b.Vector3?a:new b.Vector3;d=d instanceof b.Quaternion?d:new b.Quaternion;c=c instanceof b.Vector3?c:new b.Vector3;c.x=f.length();c.y=g.length();c.z=h.length();a.x=e[12];a.y=e[13];a.z=e[14];e=b.Matrix4.__m1;e.copy(this);e.elements[0]=e.elements[0]/c.x;
e.elements[1]=e.elements[1]/c.x;e.elements[2]=e.elements[2]/c.x;e.elements[4]=e.elements[4]/c.y;e.elements[5]=e.elements[5]/c.y;e.elements[6]=e.elements[6]/c.y;e.elements[8]=e.elements[8]/c.z;e.elements[9]=e.elements[9]/c.z;e.elements[10]=e.elements[10]/c.z;d.setFromRotationMatrix(e);return[a,d,c]},extractPosition:function(a){var b=this.elements,a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractRotation:function(a){var d=this.elements,a=a.elements,c=b.Matrix4.__v1,e=1/c.set(a[0],
a[1],a[2]).length(),f=1/c.set(a[4],a[5],a[6]).length(),c=1/c.set(a[8],a[9],a[10]).length();d[0]=a[0]*e;d[1]=a[1]*e;d[2]=a[2]*e;d[4]=a[4]*f;d[5]=a[5]*f;d[6]=a[6]*f;d[8]=a[8]*c;d[9]=a[9]*c;d[10]=a[10]*c;return this},translate:function(a){var b=this.elements,c=a.x,e=a.y,a=a.z;b[12]=b[0]*c+b[4]*e+b[8]*a+b[12];b[13]=b[1]*c+b[5]*e+b[9]*a+b[13];b[14]=b[2]*c+b[6]*e+b[10]*a+b[14];b[15]=b[3]*c+b[7]*e+b[11]*a+b[15];return this},rotateX:function(a){var b=this.elements,c=b[4],e=b[5],f=b[6],g=b[7],h=b[8],i=b[9],
j=b[10],l=b[11],m=Math.cos(a),a=Math.sin(a);b[4]=m*c+a*h;b[5]=m*e+a*i;b[6]=m*f+a*j;b[7]=m*g+a*l;b[8]=m*h-a*c;b[9]=m*i-a*e;b[10]=m*j-a*f;b[11]=m*l-a*g;return this},rotateY:function(a){var b=this.elements,c=b[0],e=b[1],f=b[2],g=b[3],h=b[8],i=b[9],j=b[10],l=b[11],m=Math.cos(a),a=Math.sin(a);b[0]=m*c-a*h;b[1]=m*e-a*i;b[2]=m*f-a*j;b[3]=m*g-a*l;b[8]=m*h+a*c;b[9]=m*i+a*e;b[10]=m*j+a*f;b[11]=m*l+a*g;return this},rotateZ:function(a){var b=this.elements,c=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],l=b[7],
m=Math.cos(a),a=Math.sin(a);b[0]=m*c+a*h;b[1]=m*e+a*i;b[2]=m*f+a*j;b[3]=m*g+a*l;b[4]=m*h-a*c;b[5]=m*i-a*e;b[6]=m*j-a*f;b[7]=m*l-a*g;return this},rotateByAxis:function(a,b){var c=this.elements;if(a.x===1&&a.y===0&&a.z===0)return this.rotateX(b);if(a.x===0&&a.y===1&&a.z===0)return this.rotateY(b);if(a.x===0&&a.y===0&&a.z===1)return this.rotateZ(b);var e=a.x,f=a.y,g=a.z,h=Math.sqrt(e*e+f*f+g*g),e=e/h,f=f/h,g=g/h,h=e*e,i=f*f,j=g*g,l=Math.cos(b),m=Math.sin(b),p=1-l,n=e*f*p,q=e*g*p,p=f*g*p,e=e*m,s=f*m,
m=g*m,g=h+(1-h)*l,h=n+m,f=q-s,n=n-m,i=i+(1-i)*l,m=p+e,q=q+s,p=p-e,j=j+(1-j)*l,l=c[0],e=c[1],s=c[2],o=c[3],r=c[4],u=c[5],v=c[6],x=c[7],t=c[8],y=c[9],G=c[10],D=c[11];c[0]=g*l+h*r+f*t;c[1]=g*e+h*u+f*y;c[2]=g*s+h*v+f*G;c[3]=g*o+h*x+f*D;c[4]=n*l+i*r+m*t;c[5]=n*e+i*u+m*y;c[6]=n*s+i*v+m*G;c[7]=n*o+i*x+m*D;c[8]=q*l+p*r+j*t;c[9]=q*e+p*u+j*y;c[10]=q*s+p*v+j*G;c[11]=q*o+p*x+j*D;return this},scale:function(a){var b=this.elements,c=a.x,e=a.y,a=a.z;b[0]=b[0]*c;b[4]=b[4]*e;b[8]=b[8]*a;b[1]=b[1]*c;b[5]=b[5]*e;b[9]=
b[9]*a;b[2]=b[2]*c;b[6]=b[6]*e;b[10]=b[10]*a;b[3]=b[3]*c;b[7]=b[7]*e;b[11]=b[11]*a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a),a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=
Math.cos(a),a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a),a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),e=Math.sin(b),f=1-c,g=a.x,h=a.y,i=a.z,j=f*g,l=f*h;this.set(j*g+c,j*h-e*i,j*i+e*h,0,j*h+e*i,l*h+c,l*i-e*g,0,j*i-e*h,l*i+e*g,f*i*i+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},makeFrustum:function(a,
b,c,e,f,g){var h=this.elements;h[0]=2*f/(b-a);h[4]=0;h[8]=(b+a)/(b-a);h[12]=0;h[1]=0;h[5]=2*f/(e-c);h[9]=(e+c)/(e-c);h[13]=0;h[2]=0;h[6]=0;h[10]=-(g+f)/(g-f);h[14]=-2*g*f/(g-f);h[3]=0;h[7]=0;h[11]=-1;h[15]=0;return this},makePerspective:function(a,b,c,e){var a=c*Math.tan(a*Math.PI/360),f=-a;return this.makeFrustum(f*b,a*b,f,a,c,e)},makeOrthographic:function(a,b,c,e,f,g){var h=this.elements,i=b-a,j=c-e,l=g-f;h[0]=2/i;h[4]=0;h[8]=0;h[12]=-((b+a)/i);h[1]=0;h[5]=2/j;h[9]=0;h[13]=-((c+e)/j);h[2]=0;h[6]=
0;h[10]=-2/l;h[14]=-((g+f)/l);h[3]=0;h[7]=0;h[11]=0;h[15]=1;return this},clone:function(){var a=this.elements;return new b.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}};b.Matrix4.__v1=new b.Vector3;b.Matrix4.__v2=new b.Vector3;b.Matrix4.__v3=new b.Vector3;b.Matrix4.__m1=new b.Matrix4;b.Matrix4.__m2=new b.Matrix4;b.Object3D=function(){this.id=b.Object3DCount++;this.name="";this.parent=void 0;this.children=[];this.up=new b.Vector3(0,1,0);this.position=
new b.Vector3;this.rotation=new b.Vector3;this.eulerOrder="XYZ";this.scale=new b.Vector3(1,1,1);this.flipSided=this.doubleSided=false;this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new b.Matrix4;this.matrixWorld=new b.Matrix4;this.matrixRotationWorld=new b.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=true;this.quaternion=new b.Quaternion;this.useQuaternion=false;this.boundRadius=0;this.boundRadiusScale=1;this.visible=true;this.receiveShadow=this.castShadow=false;this.frustumCulled=
true;this._vector=new b.Vector3};b.Object3D.prototype={constructor:b.Object3D,applyMatrix:function(a){this.matrix.multiply(a,this.matrix);this.scale.getScaleFromMatrix(this.matrix);this.rotation.setEulerFromRotationMatrix((new b.Matrix4).extractRotation(this.matrix),this.eulerOrder);this.position.getPositionFromMatrix(this.matrix)},translate:function(a,b){this.matrix.rotateAxis(b);this.position.addSelf(b.multiplyScalar(a))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,
this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},lookAt:function(a){this.matrix.lookAt(a,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},add:function(a){if(a===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(a instanceof b.Object3D){a.parent!==void 0&&a.parent.remove(a);a.parent=this;this.children.push(a);for(var d=this;d.parent!==void 0;)d=
d.parent;d!==void 0&&d instanceof b.Scene&&d.__addObject(a)}},remove:function(a){var d=this.children.indexOf(a);if(d!==-1){a.parent=void 0;this.children.splice(d,1);for(d=this;d.parent!==void 0;)d=d.parent;d!==void 0&&d instanceof b.Scene&&d.__removeObject(a)}},getChildByName:function(a,b){var c,e,f;c=0;for(e=this.children.length;c<e;c++){f=this.children[c];if(f.name===a)return f;if(b){f=f.getChildByName(a,b);if(f!==void 0)return f}}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,
this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false;a=true}for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},worldToLocal:function(a){return b.Object3D.__m1.getInverse(this.matrixWorld).multiplyVector3(a)},localToWorld:function(a){return this.matrixWorld.multiplyVector3(a)}};b.Object3D.__m1=new b.Matrix4;b.Object3DCount=0;b.Projector=function(){function a(){var a=h[g]=h[g]||new b.RenderableObject;g++;return a}function d(){var a=l[j]=l[j]||
new b.RenderableVertex;j++;return a}function c(a,b){return b.z-a.z}function e(a,b){var d=0,c=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;if(e>=0&&f>=0&&g>=0&&h>=0)return true;if(e<0&&f<0||g<0&&h<0)return false;e<0?d=Math.max(d,e/(e-f)):f<0&&(c=Math.min(c,e/(e-f)));g<0?d=Math.max(d,g/(g-h)):h<0&&(c=Math.min(c,g/(g-h)));if(c<d)return false;a.lerpSelf(b,d);b.lerpSelf(a,1-c);return true}var f,g,h=[],i,j,l=[],m,p,n=[],q,s=[],o,r,u=[],v,x,t=[],y={objects:[],sprites:[],lights:[],elements:[]},G=new b.Vector3,
D=new b.Vector4,B=new b.Matrix4,w=new b.Matrix4,I=new b.Frustum,J=new b.Vector4,O=new b.Vector4;this.projectVector=function(a,b){b.matrixWorldInverse.getInverse(b.matrixWorld);B.multiply(b.projectionMatrix,b.matrixWorldInverse);B.multiplyVector3(a);return a};this.unprojectVector=function(a,b){b.projectionMatrixInverse.getInverse(b.projectionMatrix);B.multiply(b.matrixWorld,b.projectionMatrixInverse);B.multiplyVector3(a);return a};this.pickingRay=function(a,d){var c;a.z=-1;c=new b.Vector3(a.x,a.y,
1);this.unprojectVector(a,d);this.unprojectVector(c,d);c.subSelf(a).normalize();return new b.Ray(a,c)};this.projectGraph=function(d,e){g=0;y.objects.length=0;y.sprites.length=0;y.lights.length=0;var h=function(d){if(d.visible!==false){if((d instanceof b.Mesh||d instanceof b.Line)&&(d.frustumCulled===false||I.contains(d))){G.copy(d.matrixWorld.getPosition());B.multiplyVector3(G);f=a();f.object=d;f.z=G.z;y.objects.push(f)}else if(d instanceof b.Sprite||d instanceof b.Particle){G.copy(d.matrixWorld.getPosition());
B.multiplyVector3(G);f=a();f.object=d;f.z=G.z;y.sprites.push(f)}else d instanceof b.Light&&y.lights.push(d);for(var c=0,e=d.children.length;c<e;c++)h(d.children[c])}};h(d);e&&y.objects.sort(c);return y};this.projectScene=function(a,f,g){var h=f.near,G=f.far,E=false,k,Q,N,T,ba,L,da,ga,P,$,aa,Y,ia,Ta,Ma;x=r=q=p=0;y.elements.length=0;if(f.parent===void 0){console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it...");a.add(f)}a.updateMatrixWorld();f.matrixWorldInverse.getInverse(f.matrixWorld);
B.multiply(f.projectionMatrix,f.matrixWorldInverse);I.setFromMatrix(B);y=this.projectGraph(a,false);a=0;for(k=y.objects.length;a<k;a++){P=y.objects[a].object;$=P.matrixWorld;j=0;if(P instanceof b.Mesh){aa=P.geometry;Y=P.geometry.materials;T=aa.vertices;ia=aa.faces;Ta=aa.faceVertexUvs;aa=P.matrixRotationWorld.extractRotation($);Q=0;for(N=T.length;Q<N;Q++){i=d();i.positionWorld.copy(T[Q]);$.multiplyVector3(i.positionWorld);i.positionScreen.copy(i.positionWorld);B.multiplyVector4(i.positionScreen);i.positionScreen.x=
i.positionScreen.x/i.positionScreen.w;i.positionScreen.y=i.positionScreen.y/i.positionScreen.w;i.visible=i.positionScreen.z>h&&i.positionScreen.z<G}T=0;for(Q=ia.length;T<Q;T++){N=ia[T];if(N instanceof b.Face3){ba=l[N.a];L=l[N.b];da=l[N.c];if(ba.visible&&L.visible&&da.visible){E=(da.positionScreen.x-ba.positionScreen.x)*(L.positionScreen.y-ba.positionScreen.y)-(da.positionScreen.y-ba.positionScreen.y)*(L.positionScreen.x-ba.positionScreen.x)<0;if(P.doubleSided||E!=P.flipSided){ga=n[p]=n[p]||new b.RenderableFace3;
p++;m=ga;m.v1.copy(ba);m.v2.copy(L);m.v3.copy(da)}else continue}else continue}else if(N instanceof b.Face4){ba=l[N.a];L=l[N.b];da=l[N.c];ga=l[N.d];if(ba.visible&&L.visible&&da.visible&&ga.visible){E=(ga.positionScreen.x-ba.positionScreen.x)*(L.positionScreen.y-ba.positionScreen.y)-(ga.positionScreen.y-ba.positionScreen.y)*(L.positionScreen.x-ba.positionScreen.x)<0||(L.positionScreen.x-da.positionScreen.x)*(ga.positionScreen.y-da.positionScreen.y)-(L.positionScreen.y-da.positionScreen.y)*(ga.positionScreen.x-
da.positionScreen.x)<0;if(P.doubleSided||E!=P.flipSided){Ma=s[q]=s[q]||new b.RenderableFace4;q++;m=Ma;m.v1.copy(ba);m.v2.copy(L);m.v3.copy(da);m.v4.copy(ga)}else continue}else continue}m.normalWorld.copy(N.normal);!E&&(P.flipSided||P.doubleSided)&&m.normalWorld.negate();aa.multiplyVector3(m.normalWorld);m.centroidWorld.copy(N.centroid);$.multiplyVector3(m.centroidWorld);m.centroidScreen.copy(m.centroidWorld);B.multiplyVector3(m.centroidScreen);da=N.vertexNormals;ba=0;for(L=da.length;ba<L;ba++){ga=
m.vertexNormalsWorld[ba];ga.copy(da[ba]);!E&&(P.flipSided||P.doubleSided)&&ga.negate();aa.multiplyVector3(ga)}ba=0;for(L=Ta.length;ba<L;ba++)if(Ma=Ta[ba][T]){da=0;for(ga=Ma.length;da<ga;da++)m.uvs[ba][da]=Ma[da]}m.material=P.material;m.faceMaterial=N.materialIndex!==null?Y[N.materialIndex]:null;m.z=m.centroidScreen.z;y.elements.push(m)}}else if(P instanceof b.Line){w.multiply(B,$);T=P.geometry.vertices;ba=d();ba.positionScreen.copy(T[0]);w.multiplyVector4(ba.positionScreen);$=P.type===b.LinePieces?
2:1;Q=1;for(N=T.length;Q<N;Q++){ba=d();ba.positionScreen.copy(T[Q]);w.multiplyVector4(ba.positionScreen);if(!((Q+1)%$>0)){L=l[j-2];J.copy(ba.positionScreen);O.copy(L.positionScreen);if(e(J,O)){J.multiplyScalar(1/J.w);O.multiplyScalar(1/O.w);Y=u[r]=u[r]||new b.RenderableLine;r++;o=Y;o.v1.positionScreen.copy(J);o.v2.positionScreen.copy(O);o.z=Math.max(J.z,O.z);o.material=P.material;y.elements.push(o)}}}}}a=0;for(k=y.sprites.length;a<k;a++){P=y.sprites[a].object;$=P.matrixWorld;if(P instanceof b.Particle){D.set($.elements[12],
$.elements[13],$.elements[14],1);B.multiplyVector4(D);D.z=D.z/D.w;if(D.z>0&&D.z<1){h=t[x]=t[x]||new b.RenderableParticle;x++;v=h;v.x=D.x/D.w;v.y=D.y/D.w;v.z=D.z;v.rotation=P.rotation.z;v.scale.x=P.scale.x*Math.abs(v.x-(D.x+f.projectionMatrix.elements[0])/(D.w+f.projectionMatrix.elements[12]));v.scale.y=P.scale.y*Math.abs(v.y-(D.y+f.projectionMatrix.elements[5])/(D.w+f.projectionMatrix.elements[13]));v.material=P.material;y.elements.push(v)}}}g&&y.elements.sort(c);return y}};b.Quaternion=function(a,
b,c,e){this.x=a||0;this.y=b||0;this.z=c||0;this.w=e!==void 0?e:1};b.Quaternion.prototype={constructor:b.Quaternion,set:function(a,b,c,e){this.x=a;this.y=b;this.z=c;this.w=e;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},setFromEuler:function(a,b){var c=b||"XYZ",e=Math.cos(a.x/2),f=Math.cos(a.y/2),g=Math.cos(a.z/2),h=Math.sin(a.x/2),i=Math.sin(a.y/2),j=Math.sin(a.z/2);switch(c){case "YXZ":this.x=h*f*g+e*i*j;this.y=e*i*g-h*f*j;this.z=e*f*j-h*i*g;this.w=e*f*g+
h*i*j;break;case "ZXY":this.x=h*f*g-e*i*j;this.y=e*i*g+h*f*j;this.z=e*f*j+h*i*g;this.w=e*f*g-h*i*j;break;case "ZYX":this.x=h*f*g-e*i*j;this.y=e*i*g+h*f*j;this.z=e*f*j-h*i*g;this.w=e*f*g+h*i*j;break;case "YZX":this.x=h*f*g+e*i*j;this.y=e*i*g+h*f*j;this.z=e*f*j-h*i*g;this.w=e*f*g-h*i*j;break;case "XZY":this.x=h*f*g-e*i*j;this.y=e*i*g-h*f*j;this.z=e*f*j+h*i*g;this.w=e*f*g+h*i*j;break;default:this.x=h*f*g+e*i*j;this.y=e*i*g-h*f*j;this.z=e*f*j+h*i*g;this.w=e*f*g-h*i*j}return this},setFromAxisAngle:function(a,
b){var c=b/2,e=Math.sin(c);this.x=a.x*e;this.y=a.y*e;this.z=a.z*e;this.w=Math.cos(c);return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0],a=b[4],e=b[8],f=b[1],g=b[5],h=b[9],i=b[2],j=b[6],b=b[10],l=c+g+b;if(l>0){c=0.5/Math.sqrt(l+1);this.w=0.25/c;this.x=(j-h)*c;this.y=(e-i)*c;this.z=(f-a)*c}else if(c>g&&c>b){c=2*Math.sqrt(1+c-g-b);this.w=(j-h)/c;this.x=0.25*c;this.y=(a+f)/c;this.z=(e+i)/c}else if(g>b){c=2*Math.sqrt(1+g-c-b);this.w=(e-i)/c;this.x=(a+f)/c;this.y=0.25*c;this.z=(h+j)/
c}else{c=2*Math.sqrt(1+b-c-g);this.w=(f-a)/c;this.x=(e+i)/c;this.y=(h+j)/c;this.z=0.25*c}return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x=this.x*-1;this.y=this.y*-1;this.z=this.z*-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(a===0)this.w=this.z=
this.y=this.x=0;else{a=1/a;this.x=this.x*a;this.y=this.y*a;this.z=this.z*a;this.w=this.w*a}return this},multiply:function(a,b){this.x=a.x*b.w+a.y*b.z-a.z*b.y+a.w*b.x;this.y=-a.x*b.z+a.y*b.w+a.z*b.x+a.w*b.y;this.z=a.x*b.y-a.y*b.x+a.z*b.w+a.w*b.z;this.w=-a.x*b.x-a.y*b.y-a.z*b.z+a.w*b.w;return this},multiplySelf:function(a){var b=this.x,c=this.y,e=this.z,f=this.w,g=a.x,h=a.y,i=a.z,a=a.w;this.x=b*a+f*g+c*i-e*h;this.y=c*a+f*h+e*g-b*i;this.z=e*a+f*i+b*h-c*g;this.w=f*a-b*g-c*h-e*i;return this},multiplyVector3:function(a,
b){b||(b=a);var c=a.x,e=a.y,f=a.z,g=this.x,h=this.y,i=this.z,j=this.w,l=j*c+h*f-i*e,m=j*e+i*c-g*f,p=j*f+g*e-h*c,c=-g*c-h*e-i*f;b.x=l*j+c*-g+m*-i-p*-h;b.y=m*j+c*-h+p*-g-l*-i;b.z=p*j+c*-i+l*-h-m*-g;return b},slerpSelf:function(a,b){var c=this.x,e=this.y,f=this.z,g=this.w,h=g*a.w+c*a.x+e*a.y+f*a.z;if(h<0){this.w=-a.w;this.x=-a.x;this.y=-a.y;this.z=-a.z;h=-h}else this.copy(a);if(h>=1){this.w=g;this.x=c;this.y=e;this.z=f;return this}var i=Math.acos(h),j=Math.sqrt(1-h*h);if(Math.abs(j)<0.0010){this.w=0.5*
(g+this.w);this.x=0.5*(c+this.x);this.y=0.5*(e+this.y);this.z=0.5*(f+this.z);return this}h=Math.sin((1-b)*i)/j;i=Math.sin(b*i)/j;this.w=g*h+this.w*i;this.x=c*h+this.x*i;this.y=e*h+this.y*i;this.z=f*h+this.z*i;return this},clone:function(){return new b.Quaternion(this.x,this.y,this.z,this.w)}};b.Quaternion.slerp=function(a,b,c,e){var f=a.w*b.w+a.x*b.x+a.y*b.y+a.z*b.z;if(f<0){c.w=-b.w;c.x=-b.x;c.y=-b.y;c.z=-b.z;f=-f}else c.copy(b);if(Math.abs(f)>=1){c.w=a.w;c.x=a.x;c.y=a.y;c.z=a.z;return c}var b=Math.acos(f),
g=Math.sqrt(1-f*f);if(Math.abs(g)<0.0010){c.w=0.5*(a.w+c.w);c.x=0.5*(a.x+c.x);c.y=0.5*(a.y+c.y);c.z=0.5*(a.z+c.z);return c}f=Math.sin((1-e)*b)/g;e=Math.sin(e*b)/g;c.w=a.w*f+c.w*e;c.x=a.x*f+c.x*e;c.y=a.y*f+c.y*e;c.z=a.z*f+c.z*e;return c};b.Vertex=function(){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")};b.Face3=function(a,d,c,e,f,g){this.a=a;this.b=d;this.c=c;this.normal=e instanceof b.Vector3?e:new b.Vector3;this.vertexNormals=e instanceof Array?e:[];this.color=f instanceof
b.Color?f:new b.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materialIndex=g;this.centroid=new b.Vector3};b.Face3.prototype={constructor:b.Face3,clone:function(){var a=new b.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.centroid.copy(this.centroid);a.materialIndex=this.materialIndex;var d,c;d=0;for(c=this.vertexNormals.length;d<c;d++)a.vertexNormals[d]=this.vertexNormals[d].clone();d=0;for(c=this.vertexColors.length;d<c;d++)a.vertexColors[d]=
this.vertexColors[d].clone();d=0;for(c=this.vertexTangents.length;d<c;d++)a.vertexTangents[d]=this.vertexTangents[d].clone();return a}};b.Face4=function(a,d,c,e,f,g,h){this.a=a;this.b=d;this.c=c;this.d=e;this.normal=f instanceof b.Vector3?f:new b.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=g instanceof b.Color?g:new b.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materialIndex=h;this.centroid=new b.Vector3};b.Face4.prototype={constructor:b.Face4,clone:function(){var a=
new b.Face4(this.a,this.b,this.c,this.d);a.normal.copy(this.normal);a.color.copy(this.color);a.centroid.copy(this.centroid);a.materialIndex=this.materialIndex;var d,c;d=0;for(c=this.vertexNormals.length;d<c;d++)a.vertexNormals[d]=this.vertexNormals[d].clone();d=0;for(c=this.vertexColors.length;d<c;d++)a.vertexColors[d]=this.vertexColors[d].clone();d=0;for(c=this.vertexTangents.length;d<c;d++)a.vertexTangents[d]=this.vertexTangents[d].clone();return a}};b.UV=function(a,b){this.u=a||0;this.v=b||0};
b.UV.prototype={constructor:b.UV,set:function(a,b){this.u=a;this.v=b;return this},copy:function(a){this.u=a.u;this.v=a.v;return this},lerpSelf:function(a,b){this.u=this.u+(a.u-this.u)*b;this.v=this.v+(a.v-this.v)*b;return this},clone:function(){return new b.UV(this.u,this.v)}};b.Geometry=function(){this.id=b.GeometryCount++;this.name="";this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=
[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=false};b.Geometry.prototype={constructor:b.Geometry,applyMatrix:function(a){var d=new b.Matrix4;d.extractRotation(a);for(var c=0,e=this.vertices.length;c<e;c++)a.multiplyVector3(this.vertices[c]);c=0;for(e=this.faces.length;c<e;c++){var f=this.faces[c];d.multiplyVector3(f.normal);for(var g=0,h=f.vertexNormals.length;g<h;g++)d.multiplyVector3(f.vertexNormals[g]);a.multiplyVector3(f.centroid)}},
computeCentroids:function(){var a,d,c;a=0;for(d=this.faces.length;a<d;a++){c=this.faces[a];c.centroid.set(0,0,0);if(c instanceof b.Face3){c.centroid.addSelf(this.vertices[c.a]);c.centroid.addSelf(this.vertices[c.b]);c.centroid.addSelf(this.vertices[c.c]);c.centroid.divideScalar(3)}else if(c instanceof b.Face4){c.centroid.addSelf(this.vertices[c.a]);c.centroid.addSelf(this.vertices[c.b]);c.centroid.addSelf(this.vertices[c.c]);c.centroid.addSelf(this.vertices[c.d]);c.centroid.divideScalar(4)}}},computeFaceNormals:function(){var a,
d,c,e,f,g,h=new b.Vector3,i=new b.Vector3;a=0;for(d=this.faces.length;a<d;a++){c=this.faces[a];e=this.vertices[c.a];f=this.vertices[c.b];g=this.vertices[c.c];h.sub(g,f);i.sub(e,f);h.crossSelf(i);h.isZero()||h.normalize();c.normal.copy(h)}},computeVertexNormals:function(){var a,d,c,e;if(this.__tmpVertices===void 0){e=this.__tmpVertices=Array(this.vertices.length);a=0;for(d=this.vertices.length;a<d;a++)e[a]=new b.Vector3;a=0;for(d=this.faces.length;a<d;a++){c=this.faces[a];if(c instanceof b.Face3)c.vertexNormals=
[new b.Vector3,new b.Vector3,new b.Vector3];else if(c instanceof b.Face4)c.vertexNormals=[new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3]}}else{e=this.__tmpVertices;a=0;for(d=this.vertices.length;a<d;a++)e[a].set(0,0,0)}a=0;for(d=this.faces.length;a<d;a++){c=this.faces[a];if(c instanceof b.Face3){e[c.a].addSelf(c.normal);e[c.b].addSelf(c.normal);e[c.c].addSelf(c.normal)}else if(c instanceof b.Face4){e[c.a].addSelf(c.normal);e[c.b].addSelf(c.normal);e[c.c].addSelf(c.normal);e[c.d].addSelf(c.normal)}}a=
0;for(d=this.vertices.length;a<d;a++)e[a].normalize();a=0;for(d=this.faces.length;a<d;a++){c=this.faces[a];if(c instanceof b.Face3){c.vertexNormals[0].copy(e[c.a]);c.vertexNormals[1].copy(e[c.b]);c.vertexNormals[2].copy(e[c.c])}else if(c instanceof b.Face4){c.vertexNormals[0].copy(e[c.a]);c.vertexNormals[1].copy(e[c.b]);c.vertexNormals[2].copy(e[c.c]);c.vertexNormals[3].copy(e[c.d])}}},computeMorphNormals:function(){var a,d,c,e,f;c=0;for(e=this.faces.length;c<e;c++){f=this.faces[c];f.__originalFaceNormal?
f.__originalFaceNormal.copy(f.normal):f.__originalFaceNormal=f.normal.clone();if(!f.__originalVertexNormals)f.__originalVertexNormals=[];a=0;for(d=f.vertexNormals.length;a<d;a++)f.__originalVertexNormals[a]?f.__originalVertexNormals[a].copy(f.vertexNormals[a]):f.__originalVertexNormals[a]=f.vertexNormals[a].clone()}var g=new b.Geometry;g.faces=this.faces;a=0;for(d=this.morphTargets.length;a<d;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=
[];var h=this.morphNormals[a].faceNormals,i=this.morphNormals[a].vertexNormals,j,l;c=0;for(e=this.faces.length;c<e;c++){f=this.faces[c];j=new b.Vector3;l=f instanceof b.Face3?{a:new b.Vector3,b:new b.Vector3,c:new b.Vector3}:{a:new b.Vector3,b:new b.Vector3,c:new b.Vector3,d:new b.Vector3};h.push(j);i.push(l)}}h=this.morphNormals[a];g.vertices=this.morphTargets[a].vertices;g.computeFaceNormals();g.computeVertexNormals();c=0;for(e=this.faces.length;c<e;c++){f=this.faces[c];j=h.faceNormals[c];l=h.vertexNormals[c];
j.copy(f.normal);if(f instanceof b.Face3){l.a.copy(f.vertexNormals[0]);l.b.copy(f.vertexNormals[1]);l.c.copy(f.vertexNormals[2])}else{l.a.copy(f.vertexNormals[0]);l.b.copy(f.vertexNormals[1]);l.c.copy(f.vertexNormals[2]);l.d.copy(f.vertexNormals[3])}}}c=0;for(e=this.faces.length;c<e;c++){f=this.faces[c];f.normal=f.__originalFaceNormal;f.vertexNormals=f.__originalVertexNormals}},computeTangents:function(){function a(a,b,d,c,e,f,g){i=a.vertices[b];j=a.vertices[d];l=a.vertices[c];m=h[e];p=h[f];n=h[g];
q=j.x-i.x;s=l.x-i.x;o=j.y-i.y;r=l.y-i.y;u=j.z-i.z;v=l.z-i.z;x=p.u-m.u;t=n.u-m.u;y=p.v-m.v;G=n.v-m.v;D=1/(x*G-t*y);J.set((G*q-y*s)*D,(G*o-y*r)*D,(G*u-y*v)*D);O.set((x*s-t*q)*D,(x*r-t*o)*D,(x*v-t*u)*D);w[b].addSelf(J);w[d].addSelf(J);w[c].addSelf(J);I[b].addSelf(O);I[d].addSelf(O);I[c].addSelf(O)}var d,c,e,f,g,h,i,j,l,m,p,n,q,s,o,r,u,v,x,t,y,G,D,B,w=[],I=[],J=new b.Vector3,O=new b.Vector3,S=new b.Vector3,Z=new b.Vector3,C=new b.Vector3;d=0;for(c=this.vertices.length;d<c;d++){w[d]=new b.Vector3;I[d]=
new b.Vector3}d=0;for(c=this.faces.length;d<c;d++){g=this.faces[d];h=this.faceVertexUvs[0][d];if(g instanceof b.Face3)a(this,g.a,g.b,g.c,0,1,2);else if(g instanceof b.Face4){a(this,g.a,g.b,g.d,0,1,3);a(this,g.b,g.c,g.d,1,2,3)}}var H=["a","b","c","d"];d=0;for(c=this.faces.length;d<c;d++){g=this.faces[d];for(e=0;e<g.vertexNormals.length;e++){C.copy(g.vertexNormals[e]);f=g[H[e]];B=w[f];S.copy(B);S.subSelf(C.multiplyScalar(C.dot(B))).normalize();Z.cross(g.vertexNormals[e],B);f=Z.dot(I[f]);f=f<0?-1:1;
g.vertexTangents[e]=new b.Vector4(S.x,S.y,S.z,f)}}this.hasTangents=true},computeBoundingBox:function(){if(!this.boundingBox)this.boundingBox={min:new b.Vector3,max:new b.Vector3};if(this.vertices.length>0){var a;a=this.vertices[0];this.boundingBox.min.copy(a);this.boundingBox.max.copy(a);for(var d=this.boundingBox.min,c=this.boundingBox.max,e=1,f=this.vertices.length;e<f;e++){a=this.vertices[e];if(a.x<d.x)d.x=a.x;else if(a.x>c.x)c.x=a.x;if(a.y<d.y)d.y=a.y;else if(a.y>c.y)c.y=a.y;if(a.z<d.z)d.z=a.z;
else if(a.z>c.z)c.z=a.z}}else{this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}},computeBoundingSphere:function(a){if(!this.boundingSphere)this.boundingSphere={radius:0};for(var b=0,c=a||1,e=0,f=this.vertices.length;e<f;e=e+c){if(e>f)break;a=this.vertices[e].length();a>b&&(b=a)}this.boundingSphere.radius=b},mergeVertices:function(){var a={},d=[],c=[],e,f=Math.pow(10,4),g,h,i;g=0;for(h=this.vertices.length;g<h;g++){e=this.vertices[g];e=[Math.round(e.x*f),Math.round(e.y*f),Math.round(e.z*
f)].join("_");if(a[e]===void 0){a[e]=g;d.push(this.vertices[g]);c[g]=d.length-1}else c[g]=c[a[e]]}g=0;for(h=this.faces.length;g<h;g++){f=this.faces[g];if(f instanceof b.Face3){f.a=c[f.a];f.b=c[f.b];f.c=c[f.c]}else if(f instanceof b.Face4){f.a=c[f.a];f.b=c[f.b];f.c=c[f.c];f.d=c[f.d];e=[f.a,f.b,f.c,f.d];for(a=3;a>0;a--)if(e.indexOf(f["abcd"[a]])!=a){e.splice(a,1);this.faces[g]=new b.Face3(e[0],e[1],e[2]);f=0;for(e=this.faceVertexUvs.length;f<e;f++)(i=this.faceVertexUvs[f][g])&&i.splice(a,1);break}}}c=
this.vertices.length-d.length;this.vertices=d;return c}};b.GeometryCount=0;b.Spline=function(a){function d(a,b,d,c,e,f,g){a=(d-a)*0.5;c=(c-b)*0.5;return(2*(b-d)+a+c)*g+(-3*(b-d)-2*a-c)*f+a*e+b}this.points=a;var c=[],e={x:0,y:0,z:0},f,g,h,i,j,l,m,p,n;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){f=(this.points.length-1)*a;g=Math.floor(f);h=f-g;c[0]=g===0?g:g-1;c[1]=g;c[2]=g>this.points.length-2?this.points.length-
1:g+1;c[3]=g>this.points.length-3?this.points.length-1:g+2;l=this.points[c[0]];m=this.points[c[1]];p=this.points[c[2]];n=this.points[c[3]];i=h*h;j=h*i;e.x=d(l.x,m.x,p.x,n.x,h,i,j);e.y=d(l.y,m.y,p.y,n.y,h,i,j);e.z=d(l.z,m.z,p.z,n.z,h,i,j);return e};this.getControlPointsArray=function(){var a,b,d=this.points.length,c=[];for(a=0;a<d;a++){b=this.points[a];c[a]=[b.x,b.y,b.z]}return c};this.getLength=function(a){var d,c,e,f=d=d=0,g=new b.Vector3,h=new b.Vector3,i=[],j=0;i[0]=0;a||(a=100);c=this.points.length*
a;g.copy(this.points[0]);for(a=1;a<c;a++){d=a/c;e=this.getPoint(d);h.copy(e);j=j+h.distanceTo(g);g.copy(e);d=(this.points.length-1)*d;d=Math.floor(d);if(d!=f){i[d]=j;f=d}}i[i.length]=j;return{chunks:i,total:j}};this.reparametrizeByArcLength=function(a){var d,c,e,f,g,h,i=[],j=new b.Vector3,l=this.getLength();i.push(j.copy(this.points[0]).clone());for(d=1;d<this.points.length;d++){c=l.chunks[d]-l.chunks[d-1];h=Math.ceil(a*c/l.total);f=(d-1)/(this.points.length-1);g=d/(this.points.length-1);for(c=1;c<
h-1;c++){e=f+c*(1/h)*(g-f);e=this.getPoint(e);i.push(j.copy(e).clone())}i.push(j.copy(this.points[d]).clone())}this.points=i}};b.Camera=function(){b.Object3D.call(this);this.matrixWorldInverse=new b.Matrix4;this.projectionMatrix=new b.Matrix4;this.projectionMatrixInverse=new b.Matrix4};b.Camera.prototype=Object.create(b.Object3D.prototype);b.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up);this.rotationAutoUpdate&&this.rotation.setEulerFromRotationMatrix(this.matrix,
this.eulerOrder)};b.OrthographicCamera=function(a,d,c,e,f,g){b.Camera.call(this);this.left=a;this.right=d;this.top=c;this.bottom=e;this.near=f!==void 0?f:0.1;this.far=g!==void 0?g:2E3;this.updateProjectionMatrix()};b.OrthographicCamera.prototype=Object.create(b.Camera.prototype);b.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)};b.PerspectiveCamera=function(a,d,c,e){b.Camera.call(this);
this.fov=a!==void 0?a:50;this.aspect=d!==void 0?d:1;this.near=c!==void 0?c:0.1;this.far=e!==void 0?e:2E3;this.updateProjectionMatrix()};b.PerspectiveCamera.prototype=Object.create(b.Camera.prototype);b.PerspectiveCamera.prototype.setLens=function(a,b){this.fov=2*Math.atan((b!==void 0?b:24)/(a*2))*(180/Math.PI);this.updateProjectionMatrix()};b.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,e,f,g){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=e;this.width=f;this.height=g;this.updateProjectionMatrix()};
b.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight,b=Math.tan(this.fov*Math.PI/360)*this.near,c=-b,e=a*c,a=Math.abs(a*b-e),c=Math.abs(b-c);this.projectionMatrix.makeFrustum(e+this.x*a/this.fullWidth,e+(this.x+this.width)*a/this.fullWidth,b-(this.y+this.height)*c/this.fullHeight,b-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)};b.Light=function(a){b.Object3D.call(this);
this.color=new b.Color(a)};b.Light.prototype=Object.create(b.Object3D.prototype);b.AmbientLight=function(a){b.Light.call(this,a)};b.AmbientLight.prototype=Object.create(b.Light.prototype);b.DirectionalLight=function(a,d,c){b.Light.call(this,a);this.position=new b.Vector3(0,1,0);this.target=new b.Object3D;this.intensity=d!==void 0?d:1;this.distance=c!==void 0?c:0;this.onlyShadow=this.castShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5E3;this.shadowCameraLeft=-500;this.shadowCameraTop=
this.shadowCameraRight=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCascade=false;this.shadowCascadeOffset=new b.Vector3(0,0,-1E3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,0.99,0.998];this.shadowCascadeFarZ=[0.99,0.998,1];this.shadowCascadeArray=[];this.shadowMatrix=
this.shadowCamera=this.shadowMapSize=this.shadowMap=null};b.DirectionalLight.prototype=Object.create(b.Light.prototype);b.PointLight=function(a,d,c){b.Light.call(this,a);this.position=new b.Vector3(0,0,0);this.intensity=d!==void 0?d:1;this.distance=c!==void 0?c:0};b.PointLight.prototype=Object.create(b.Light.prototype);b.SpotLight=function(a,d,c,e,f){b.Light.call(this,a);this.position=new b.Vector3(0,1,0);this.target=new b.Object3D;this.intensity=d!==void 0?d:1;this.distance=c!==void 0?c:0;this.angle=
e!==void 0?e:Math.PI/2;this.exponent=f!==void 0?f:10;this.onlyShadow=this.castShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5E3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};b.SpotLight.prototype=Object.create(b.Light.prototype);b.Loader=function(a){this.statusDomElement=(this.showStatus=a)?b.Loader.prototype.addStatusElement():
null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};b.Loader.prototype={constructor:b.Loader,crossOrigin:"anonymous",addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1E3;a.innerHTML=
"Loading ...";return a},updateProgress:function(a){var b="Loaded ",b=a.total?b+((100*a.loaded/a.total).toFixed(0)+"%"):b+((a.loaded/1E3).toFixed(2)+" KB");this.statusDomElement.innerHTML=b},extractUrlBase:function(a){a=a.split("/");a.pop();return(a.length<1?".":a.join("/"))+"/"},initMaterials:function(a,d,c){a.materials=[];for(var e=0;e<d.length;++e)a.materials[e]=b.Loader.prototype.createMaterial(d[e],c)},hasNormals:function(a){var d,c,e=a.materials.length;for(c=0;c<e;c++){d=a.materials[c];if(d instanceof
b.ShaderMaterial)return true}return false},createMaterial:function(a,d){function c(a){a=Math.log(a)/Math.LN2;return Math.floor(a)==a}function e(a){a=Math.log(a)/Math.LN2;return Math.pow(2,Math.round(a))}function f(a,b){var d=new Image;d.onload=function(){if(!c(this.width)||!c(this.height)){var b=e(this.width),d=e(this.height);a.image.width=b;a.image.height=d;a.image.getContext("2d").drawImage(this,0,0,b,d)}else a.image=this;a.needsUpdate=true};d.crossOrigin=i.crossOrigin;d.src=b}function g(a,c,e,
g,h,i){var j=document.createElement("canvas");a[c]=new b.Texture(j);a[c].sourceFile=e;if(g){a[c].repeat.set(g[0],g[1]);if(g[0]!=1)a[c].wrapS=b.RepeatWrapping;if(g[1]!=1)a[c].wrapT=b.RepeatWrapping}h&&a[c].offset.set(h[0],h[1]);if(i){g={repeat:b.RepeatWrapping,mirror:b.MirroredRepeatWrapping};if(g[i[0]]!==void 0)a[c].wrapS=g[i[0]];if(g[i[1]]!==void 0)a[c].wrapT=g[i[1]]}f(a[c],d+"/"+e)}function h(a){return(a[0]*255<<16)+(a[1]*255<<8)+a[2]*255}var i=this,j="MeshLambertMaterial",l={color:15658734,opacity:1,
map:null,lightMap:null,normalMap:null,wireframe:a.wireframe};if(a.shading){var m=a.shading.toLowerCase();m==="phong"?j="MeshPhongMaterial":m==="basic"&&(j="MeshBasicMaterial")}if(a.blending!==void 0&&b[a.blending]!==void 0)l.blending=b[a.blending];if(a.transparent!==void 0||a.opacity<1)l.transparent=a.transparent;if(a.depthTest!==void 0)l.depthTest=a.depthTest;if(a.depthWrite!==void 0)l.depthWrite=a.depthWrite;if(a.vertexColors!==void 0)if(a.vertexColors=="face")l.vertexColors=b.FaceColors;else if(a.vertexColors)l.vertexColors=
b.VertexColors;if(a.colorDiffuse)l.color=h(a.colorDiffuse);else if(a.DbgColor)l.color=a.DbgColor;if(a.colorSpecular)l.specular=h(a.colorSpecular);if(a.colorAmbient)l.ambient=h(a.colorAmbient);if(a.transparency)l.opacity=a.transparency;if(a.specularCoef)l.shininess=a.specularCoef;a.mapDiffuse&&d&&g(l,"map",a.mapDiffuse,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap);a.mapLight&&d&&g(l,"lightMap",a.mapLight,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap);a.mapNormal&&d&&g(l,"normalMap",a.mapNormal,
a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap);a.mapSpecular&&d&&g(l,"specularMap",a.mapSpecular,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap);if(a.mapNormal){j=b.ShaderUtils.lib.normal;m=b.UniformsUtils.clone(j.uniforms);m.tNormal.texture=l.normalMap;if(a.mapNormalFactor)m.uNormalScale.value=a.mapNormalFactor;if(l.map){m.tDiffuse.texture=l.map;m.enableDiffuse.value=true}if(l.specularMap){m.tSpecular.texture=l.specularMap;m.enableSpecular.value=true}if(l.lightMap){m.tAO.texture=
l.lightMap;m.enableAO.value=true}m.uDiffuseColor.value.setHex(l.color);m.uSpecularColor.value.setHex(l.specular);m.uAmbientColor.value.setHex(l.ambient);m.uShininess.value=l.shininess;if(l.opacity!==void 0)m.uOpacity.value=l.opacity;l=new b.ShaderMaterial({fragmentShader:j.fragmentShader,vertexShader:j.vertexShader,uniforms:m,lights:true,fog:true})}else l=new b[j](l);if(a.DbgName!==void 0)l.name=a.DbgName;return l}};b.BinaryLoader=function(a){b.Loader.call(this,a)};b.BinaryLoader.prototype=Object.create(b.Loader.prototype);
b.BinaryLoader.prototype.load=function(a,d,c,e){var c=c?c:this.extractUrlBase(a),e=e?e:this.extractUrlBase(a),f=this.showProgress?b.Loader.prototype.updateProgress:null;this.onLoadStart();this.loadAjaxJSON(this,a,d,c,e,f)};b.BinaryLoader.prototype.loadAjaxJSON=function(a,b,c,e,f,g){var h=new XMLHttpRequest;h.onreadystatechange=function(){if(h.readyState==4)if(h.status==200||h.status==0){var i=JSON.parse(h.responseText);a.loadAjaxBuffers(i,c,f,e,g)}else console.error("THREE.BinaryLoader: Couldn't load ["+
b+"] ["+h.status+"]")};h.open("GET",b,true);h.overrideMimeType&&h.overrideMimeType("text/plain; charset=x-user-defined");h.setRequestHeader("Content-Type","text/plain");h.send(null)};b.BinaryLoader.prototype.loadAjaxBuffers=function(a,d,c,e,f){var g=new XMLHttpRequest,h=c+"/"+a.buffers,i=0;g.onreadystatechange=function(){if(g.readyState==4)g.status==200||g.status==0?b.BinaryLoader.prototype.createBinModel(g.response,d,e,a.materials):console.error("THREE.BinaryLoader: Couldn't load ["+h+"] ["+g.status+
"]");else if(g.readyState==3){if(f){i==0&&(i=g.getResponseHeader("Content-Length"));f({total:i,loaded:g.responseText.length})}}else g.readyState==2&&(i=g.getResponseHeader("Content-Length"))};g.open("GET",h,true);g.responseType="arraybuffer";g.send(null)};b.BinaryLoader.prototype.createBinModel=function(a,d,c,e){var f=function(d){var c,f,j,l,m,p,n,q,s,o,r,u,v,x,t;function y(a){return a%4?4-a%4:0}function G(a,b){return(new Uint8Array(a,b,1))[0]}function D(a,b){return(new Uint32Array(a,b,1))[0]}function B(d,
c){var e,f,g,h,i,k,j,l,m=new Uint32Array(a,c,3*d);for(e=0;e<d;e++){f=m[e*3];g=m[e*3+1];h=m[e*3+2];i=R[f*2];f=R[f*2+1];k=R[g*2];j=R[g*2+1];g=R[h*2];l=R[h*2+1];h=Z.faceVertexUvs[0];var n=[];n.push(new b.UV(i,f));n.push(new b.UV(k,j));n.push(new b.UV(g,l));h.push(n)}}function w(d,c){var e,f,g,h,i,k,j,l,m,n,o=new Uint32Array(a,c,4*d);for(e=0;e<d;e++){f=o[e*4];g=o[e*4+1];h=o[e*4+2];i=o[e*4+3];k=R[f*2];f=R[f*2+1];j=R[g*2];m=R[g*2+1];l=R[h*2];n=R[h*2+1];h=R[i*2];g=R[i*2+1];i=Z.faceVertexUvs[0];var p=[];
p.push(new b.UV(k,f));p.push(new b.UV(j,m));p.push(new b.UV(l,n));p.push(new b.UV(h,g));i.push(p)}}function I(d,c,e){for(var f,g,h,i,c=new Uint32Array(a,c,3*d),k=new Uint16Array(a,e,d),e=0;e<d;e++){f=c[e*3];g=c[e*3+1];h=c[e*3+2];i=k[e];Z.faces.push(new b.Face3(f,g,h,null,null,i))}}function J(d,c,e){for(var f,g,h,i,k,c=new Uint32Array(a,c,4*d),j=new Uint16Array(a,e,d),e=0;e<d;e++){f=c[e*4];g=c[e*4+1];h=c[e*4+2];i=c[e*4+3];k=j[e];Z.faces.push(new b.Face4(f,g,h,i,null,null,k))}}function O(d,c,e,f){for(var g,
h,i,k,j,l,m,c=new Uint32Array(a,c,3*d),e=new Uint32Array(a,e,3*d),n=new Uint16Array(a,f,d),f=0;f<d;f++){g=c[f*3];h=c[f*3+1];i=c[f*3+2];j=e[f*3];l=e[f*3+1];m=e[f*3+2];k=n[f];var o=H[l*3],p=H[l*3+1];l=H[l*3+2];var q=H[m*3],s=H[m*3+1];m=H[m*3+2];Z.faces.push(new b.Face3(g,h,i,[new b.Vector3(H[j*3],H[j*3+1],H[j*3+2]),new b.Vector3(o,p,l),new b.Vector3(q,s,m)],null,k))}}function S(d,c,e,f){for(var g,h,i,k,j,l,m,n,o,c=new Uint32Array(a,c,4*d),e=new Uint32Array(a,e,4*d),p=new Uint16Array(a,f,d),f=0;f<d;f++){g=
c[f*4];h=c[f*4+1];i=c[f*4+2];k=c[f*4+3];l=e[f*4];m=e[f*4+1];n=e[f*4+2];o=e[f*4+3];j=p[f];var q=H[m*3],s=H[m*3+1];m=H[m*3+2];var r=H[n*3],u=H[n*3+1];n=H[n*3+2];var t=H[o*3],v=H[o*3+1];o=H[o*3+2];Z.faces.push(new b.Face4(g,h,i,k,[new b.Vector3(H[l*3],H[l*3+1],H[l*3+2]),new b.Vector3(q,s,m),new b.Vector3(r,u,n),new b.Vector3(t,v,o)],null,j))}}var Z=this,C=0,H=[],R=[],E,k,Q;b.Geometry.call(this);b.Loader.prototype.initMaterials(Z,e,d);(function(a,b,d){for(var a=new Uint8Array(a,b,d),c="",e=0;e<d;e++)c=
c+String.fromCharCode(a[b+e]);return c})(a,C,12);c=G(a,C+12);G(a,C+13);G(a,C+14);G(a,C+15);f=G(a,C+16);j=G(a,C+17);l=G(a,C+18);m=G(a,C+19);p=D(a,C+20);n=D(a,C+20+4);q=D(a,C+20+8);d=D(a,C+20+12);s=D(a,C+20+16);o=D(a,C+20+20);r=D(a,C+20+24);u=D(a,C+20+28);v=D(a,C+20+32);x=D(a,C+20+36);t=D(a,C+20+40);C=C+c;c=f*3+m;Q=f*4+m;E=d*c;k=s*(c+j*3);f=o*(c+l*3);m=r*(c+j*3+l*3);c=u*Q;j=v*(Q+j*4);l=x*(Q+l*4);C=C+function(d){var d=new Float32Array(a,d,p*3),c,e,f,g;for(c=0;c<p;c++){e=d[c*3];f=d[c*3+1];g=d[c*3+2];
Z.vertices.push(new b.Vector3(e,f,g))}return p*3*Float32Array.BYTES_PER_ELEMENT}(C);C=C+function(b){if(n){var b=new Int8Array(a,b,n*3),d,c,e,f;for(d=0;d<n;d++){c=b[d*3];e=b[d*3+1];f=b[d*3+2];H.push(c/127,e/127,f/127)}}return n*3*Int8Array.BYTES_PER_ELEMENT}(C);C=C+y(n*3);C=C+function(b){if(q){var b=new Float32Array(a,b,q*2),d,c,e;for(d=0;d<q;d++){c=b[d*2];e=b[d*2+1];R.push(c,e)}}return q*2*Float32Array.BYTES_PER_ELEMENT}(C);E=C+E+y(d*2);k=E+k+y(s*2);f=k+f+y(o*2);m=f+m+y(r*2);c=m+c+y(u*2);j=c+j+y(v*
2);l=j+l+y(x*2);(function(a){if(o){var b=a+o*Uint32Array.BYTES_PER_ELEMENT*3;I(o,a,b+o*Uint32Array.BYTES_PER_ELEMENT*3);B(o,b)}})(k);(function(a){if(r){var b=a+r*Uint32Array.BYTES_PER_ELEMENT*3,d=b+r*Uint32Array.BYTES_PER_ELEMENT*3;O(r,a,b,d+r*Uint32Array.BYTES_PER_ELEMENT*3);B(r,d)}})(f);(function(a){if(x){var b=a+x*Uint32Array.BYTES_PER_ELEMENT*4;J(x,a,b+x*Uint32Array.BYTES_PER_ELEMENT*4);w(x,b)}})(j);(function(a){if(t){var b=a+t*Uint32Array.BYTES_PER_ELEMENT*4,d=b+t*Uint32Array.BYTES_PER_ELEMENT*
4;S(t,a,b,d+t*Uint32Array.BYTES_PER_ELEMENT*4);w(t,d)}})(l);d&&I(d,C,C+d*Uint32Array.BYTES_PER_ELEMENT*3);(function(a){if(s){var b=a+s*Uint32Array.BYTES_PER_ELEMENT*3;O(s,a,b,b+s*Uint32Array.BYTES_PER_ELEMENT*3)}})(E);u&&J(u,m,m+u*Uint32Array.BYTES_PER_ELEMENT*4);(function(a){if(v){var b=a+v*Uint32Array.BYTES_PER_ELEMENT*4;S(v,a,b,b+v*Uint32Array.BYTES_PER_ELEMENT*4)}})(c);this.computeCentroids();this.computeFaceNormals();b.Loader.prototype.hasNormals(this)&&this.computeTangents()};f.prototype=Object.create(b.Geometry.prototype);
d(new f(c))};b.ImageLoader=function(){b.EventTarget.call(this);this.crossOrigin=null};b.ImageLoader.prototype={constructor:b.ImageLoader,load:function(a){var b=this,c=new Image;c.addEventListener("load",function(){b.dispatchEvent({type:"load",content:c})},false);c.addEventListener("error",function(){b.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);if(b.crossOrigin)c.crossOrigin=b.crossOrigin;c.src=a}};b.JSONLoader=function(a){b.Loader.call(this,a)};b.JSONLoader.prototype=
Object.create(b.Loader.prototype);b.JSONLoader.prototype.load=function(a,b,c){c=c?c:this.extractUrlBase(a);this.onLoadStart();this.loadAjaxJSON(this,a,b,c)};b.JSONLoader.prototype.loadAjaxJSON=function(a,b,c,e,f){var g=new XMLHttpRequest,h=0;g.onreadystatechange=function(){if(g.readyState===g.DONE)if(g.status===200||g.status===0){if(g.responseText){var i=JSON.parse(g.responseText);a.createModel(i,c,e)}else console.warn("THREE.JSONLoader: ["+b+"] seems to be unreachable or file there is empty");a.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+
b+"] ["+g.status+"]");else if(g.readyState===g.LOADING){if(f){h===0&&(h=g.getResponseHeader("Content-Length"));f({total:h,loaded:g.responseText.length})}}else g.readyState===g.HEADERS_RECEIVED&&(h=g.getResponseHeader("Content-Length"))};g.open("GET",b,true);g.overrideMimeType&&g.overrideMimeType("text/plain; charset=x-user-defined");g.setRequestHeader("Content-Type","text/plain");g.send(null)};b.JSONLoader.prototype.createModel=function(a,d,c){var e=new b.Geometry,f=a.scale!==void 0?1/a.scale:1;this.initMaterials(e,
a.materials,c);(function(d){var c,f,j,l,m,p,n,q,s,o,r,u,v,x,t=a.faces;p=a.vertices;var y=a.normals,G=a.colors,D=0;for(c=0;c<a.uvs.length;c++)a.uvs[c].length&&D++;for(c=0;c<D;c++){e.faceUvs[c]=[];e.faceVertexUvs[c]=[]}l=0;for(m=p.length;l<m;){n=new b.Vector3;n.x=p[l++]*d;n.y=p[l++]*d;n.z=p[l++]*d;e.vertices.push(n)}l=0;for(m=t.length;l<m;){d=t[l++];p=d&1;j=d&2;c=d&4;f=d&8;q=d&16;n=d&32;o=d&64;d=d&128;if(p){r=new b.Face4;r.a=t[l++];r.b=t[l++];r.c=t[l++];r.d=t[l++];p=4}else{r=new b.Face3;r.a=t[l++];
r.b=t[l++];r.c=t[l++];p=3}if(j){j=t[l++];r.materialIndex=j}j=e.faces.length;if(c)for(c=0;c<D;c++){u=a.uvs[c];s=t[l++];x=u[s*2];s=u[s*2+1];e.faceUvs[c][j]=new b.UV(x,s)}if(f)for(c=0;c<D;c++){u=a.uvs[c];v=[];for(f=0;f<p;f++){s=t[l++];x=u[s*2];s=u[s*2+1];v[f]=new b.UV(x,s)}e.faceVertexUvs[c][j]=v}if(q){q=t[l++]*3;f=new b.Vector3;f.x=y[q++];f.y=y[q++];f.z=y[q];r.normal=f}if(n)for(c=0;c<p;c++){q=t[l++]*3;f=new b.Vector3;f.x=y[q++];f.y=y[q++];f.z=y[q];r.vertexNormals.push(f)}if(o){n=t[l++];n=new b.Color(G[n]);
r.color=n}if(d)for(c=0;c<p;c++){n=t[l++];n=new b.Color(G[n]);r.vertexColors.push(n)}e.faces.push(r)}})(f);(function(){var d,c,f,j;if(a.skinWeights){d=0;for(c=a.skinWeights.length;d<c;d=d+2){f=a.skinWeights[d];j=a.skinWeights[d+1];e.skinWeights.push(new b.Vector4(f,j,0,0))}}if(a.skinIndices){d=0;for(c=a.skinIndices.length;d<c;d=d+2){f=a.skinIndices[d];j=a.skinIndices[d+1];e.skinIndices.push(new b.Vector4(f,j,0,0))}}e.bones=a.bones;e.animation=a.animation})();(function(d){if(a.morphTargets!==void 0){var c,
f,j,l,m,p;c=0;for(f=a.morphTargets.length;c<f;c++){e.morphTargets[c]={};e.morphTargets[c].name=a.morphTargets[c].name;e.morphTargets[c].vertices=[];m=e.morphTargets[c].vertices;p=a.morphTargets[c].vertices;j=0;for(l=p.length;j<l;j=j+3){var n=new b.Vector3;n.x=p[j]*d;n.y=p[j+1]*d;n.z=p[j+2]*d;m.push(n)}}}if(a.morphColors!==void 0){c=0;for(f=a.morphColors.length;c<f;c++){e.morphColors[c]={};e.morphColors[c].name=a.morphColors[c].name;e.morphColors[c].colors=[];l=e.morphColors[c].colors;m=a.morphColors[c].colors;
d=0;for(j=m.length;d<j;d=d+3){p=new b.Color(16755200);p.setRGB(m[d],m[d+1],m[d+2]);l.push(p)}}}})(f);e.computeCentroids();e.computeFaceNormals();this.hasNormals(e)&&e.computeTangents();d(e)};b.GeometryLoader=function(){b.EventTarget.call(this);this.path=this.crossOrigin=null};b.GeometryLoader.prototype={constructor:b.GeometryLoader,load:function(a){var d=this,c=null;if(d.path===null){var e=a.split("/");e.pop();d.path=e.length<1?".":e.join("/")}e=new XMLHttpRequest;e.addEventListener("load",function(b){b.target.responseText?
c=d.parse(JSON.parse(b.target.responseText),f):d.dispatchEvent({type:"error",message:"Invalid file ["+a+"]"})},false);e.addEventListener("error",function(){d.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);e.open("GET",a,true);e.send(null);var f=new b.LoadingMonitor;f.addEventListener("load",function(){d.dispatchEvent({type:"load",content:c})});f.add(e)},parse:function(a,d){var c=this,e=new b.Geometry,f=a.scale!==void 0?1/a.scale:1;if(a.materials){e.materials=[];for(var g=
0;g<a.materials.length;++g){var h=a.materials[g],i=function(a){a=Math.log(a)/Math.LN2;return Math.floor(a)==a},j=function(a){a=Math.log(a)/Math.LN2;return Math.pow(2,Math.round(a))},l=function(a,e,f,g,h,l){a[e]=new b.Texture;a[e].sourceFile=f;if(g){a[e].repeat.set(g[0],g[1]);if(g[0]!=1)a[e].wrapS=b.RepeatWrapping;if(g[1]!=1)a[e].wrapT=b.RepeatWrapping}h&&a[e].offset.set(h[0],h[1]);if(l){g={repeat:b.RepeatWrapping,mirror:b.MirroredRepeatWrapping};if(g[l[0]]!==void 0)a[e].wrapS=g[l[0]];if(g[l[1]]!==
void 0)a[e].wrapT=g[l[1]]}var m=a[e],a=new b.ImageLoader;a.addEventListener("load",function(a){a=a.content;if(!i(a.width)||!i(a.height)){var b=j(a.width),d=j(a.height);m.image=document.createElement("canvas");m.image.width=b;m.image.height=d;m.image.getContext("2d").drawImage(a,0,0,b,d)}else m.image=a;m.needsUpdate=true});a.crossOrigin=c.crossOrigin;a.load(c.path+"/"+f);d&&d.add(a)},m=function(a){return(a[0]*255<<16)+(a[1]*255<<8)+a[2]*255},p="MeshLambertMaterial",n={color:15658734,opacity:1,map:null,
lightMap:null,normalMap:null,wireframe:h.wireframe};if(h.shading){var q=h.shading.toLowerCase();q==="phong"?p="MeshPhongMaterial":q==="basic"&&(p="MeshBasicMaterial")}if(h.blending!==void 0&&b[h.blending]!==void 0)n.blending=b[h.blending];if(h.transparent!==void 0||h.opacity<1)n.transparent=h.transparent;if(h.depthTest!==void 0)n.depthTest=h.depthTest;if(h.depthWrite!==void 0)n.depthWrite=h.depthWrite;if(h.vertexColors!==void 0)if(h.vertexColors=="face")n.vertexColors=b.FaceColors;else if(h.vertexColors)n.vertexColors=
b.VertexColors;if(h.colorDiffuse)n.color=m(h.colorDiffuse);else if(h.DbgColor)n.color=h.DbgColor;if(h.colorSpecular)n.specular=m(h.colorSpecular);if(h.colorAmbient)n.ambient=m(h.colorAmbient);if(h.transparency)n.opacity=h.transparency;if(h.specularCoef)n.shininess=h.specularCoef;h.mapDiffuse&&l(n,"map",h.mapDiffuse,h.mapDiffuseRepeat,h.mapDiffuseOffset,h.mapDiffuseWrap);h.mapLight&&l(n,"lightMap",h.mapLight,h.mapLightRepeat,h.mapLightOffset,h.mapLightWrap);h.mapNormal&&l(n,"normalMap",h.mapNormal,
h.mapNormalRepeat,h.mapNormalOffset,h.mapNormalWrap);h.mapSpecular&&l(n,"specularMap",h.mapSpecular,h.mapSpecularRepeat,h.mapSpecularOffset,h.mapSpecularWrap);if(h.mapNormal){l=b.ShaderUtils.lib.normal;m=b.UniformsUtils.clone(l.uniforms);m.tNormal.texture=n.normalMap;if(h.mapNormalFactor)m.uNormalScale.value=h.mapNormalFactor;if(n.map){m.tDiffuse.texture=n.map;m.enableDiffuse.value=true}if(n.specularMap){m.tSpecular.texture=n.specularMap;m.enableSpecular.value=true}if(n.lightMap){m.tAO.texture=n.lightMap;
m.enableAO.value=true}m.uDiffuseColor.value.setHex(n.color);m.uSpecularColor.value.setHex(n.specular);m.uAmbientColor.value.setHex(n.ambient);m.uShininess.value=n.shininess;if(n.opacity!==void 0)m.uOpacity.value=n.opacity;n=new b.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:m,lights:true,fog:true})}else n=new b[p](n);if(h.DbgName!==void 0)n.name=h.DbgName;e.materials[g]=n}}var h=a.faces,s=a.vertices,n=a.normals,l=a.colors,m=0;if(a.uvs)for(g=0;g<a.uvs.length;g++)a.uvs[g].length&&
m++;for(g=0;g<m;g++){e.faceUvs[g]=[];e.faceVertexUvs[g]=[]}p=0;for(q=s.length;p<q;){var o=new b.Vector3;o.x=s[p++]*f;o.y=s[p++]*f;o.z=s[p++]*f;e.vertices.push(o)}p=0;for(q=h.length;p<q;){var r=h[p++],u=r&2,g=r&4,v=r&8,x=r&16,s=r&32,t=r&64,o=r&128;if(r&1){r=new b.Face4;r.a=h[p++];r.b=h[p++];r.c=h[p++];r.d=h[p++];var y=4}else{r=new b.Face3;r.a=h[p++];r.b=h[p++];r.c=h[p++];y=3}if(u){u=h[p++];r.materialIndex=u}var G=e.faces.length;if(g)for(g=0;g<m;g++){var D=a.uvs[g],u=h[p++],B=D[u*2],u=D[u*2+1];e.faceUvs[g][G]=
new b.UV(B,u)}if(v)for(g=0;g<m;g++){for(var D=a.uvs[g],v=[],w=0;w<y;w++){u=h[p++];B=D[u*2];u=D[u*2+1];v[w]=new b.UV(B,u)}e.faceVertexUvs[g][G]=v}if(x){x=h[p++]*3;u=new b.Vector3;u.x=n[x++];u.y=n[x++];u.z=n[x];r.normal=u}if(s)for(g=0;g<y;g++){x=h[p++]*3;u=new b.Vector3;u.x=n[x++];u.y=n[x++];u.z=n[x];r.vertexNormals.push(u)}if(t){s=h[p++];r.color=new b.Color(l[s])}if(o)for(g=0;g<y;g++){s=h[p++];r.vertexColors.push(new b.Color(l[s]))}e.faces.push(r)}if(a.skinWeights){g=0;for(h=a.skinWeights.length;g<
h;g=g+2)e.skinWeights.push(new b.Vector4(a.skinWeights[g],a.skinWeights[g+1],0,0))}if(a.skinIndices){g=0;for(h=a.skinIndices.length;g<h;g=g+2){n=0;e.skinIndices.push(new b.Vector4(a.skinIndices[g],a.skinIndices[g+1],n,0))}}e.bones=a.bones;e.animation=a.animation;if(a.morphTargets){g=0;for(h=a.morphTargets.length;g<h;g++){e.morphTargets[g]={};e.morphTargets[g].name=a.morphTargets[g].name;e.morphTargets[g].vertices=[];n=e.morphTargets[g].vertices;l=a.morphTargets[g].vertices;u=0;for(m=l.length;u<m;u=
u+3){o=new b.Vector3;o.x=l[u]*f;o.y=l[u+1]*f;o.z=l[u+2]*f;n.push(o)}}}if(a.morphColors){g=0;for(h=a.morphColors.length;g<h;g++){e.morphColors[g]={};e.morphColors[g].name=a.morphColors[g].name;e.morphColors[g].colors=[];f=e.morphColors[g].colors;l=a.morphColors[g].colors;n=0;for(m=l.length;n<m;n=n+3){p=new b.Color(16755200);p.setRGB(l[n],l[n+1],l[n+2]);f.push(p)}}}e.computeCentroids();e.computeFaceNormals();return e}};b.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};
this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};b.SceneLoader.prototype.constructor=b.SceneLoader;b.SceneLoader.prototype.load=function(a,b){var c=this,e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===4)if(e.status===200||e.status===0){var f=JSON.parse(e.responseText);c.createScene(f,b,a)}else console.error("THREE.SceneLoader: Couldn't load ["+a+"] ["+e.status+"]")};e.open("GET",a,true);e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined");
e.setRequestHeader("Content-Type","text/plain");e.send(null)};b.SceneLoader.prototype.createScene=function(a,d,c){function e(a,b){return b=="relativeToHTML"?a:l+"/"+a}function f(){var a;for(n in C.objects)if(!N.objects[n]){u=C.objects[n];if(u.geometry!==void 0){if(J=N.geometries[u.geometry]){a=false;O=N.materials[u.materials[0]];(a=O instanceof b.ShaderMaterial)&&J.computeTangents();y=u.position;G=u.rotation;D=u.quaternion;B=u.scale;v=u.matrix;D=0;u.materials.length==0&&(O=new b.MeshFaceMaterial);
u.materials.length>1&&(O=new b.MeshFaceMaterial);a=new b.Mesh(J,O);a.name=n;if(v){a.matrixAutoUpdate=false;a.matrix.set(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15])}else{a.position.set(y[0],y[1],y[2]);if(D){a.quaternion.set(D[0],D[1],D[2],D[3]);a.useQuaternion=true}else a.rotation.set(G[0],G[1],G[2]);a.scale.set(B[0],B[1],B[2])}a.visible=u.visible;a.doubleSided=u.doubleSided;a.castShadow=u.castShadow;a.receiveShadow=u.receiveShadow;N.scene.add(a);N.objects[n]=
a}}else{y=u.position;G=u.rotation;D=u.quaternion;B=u.scale;D=0;a=new b.Object3D;a.name=n;a.position.set(y[0],y[1],y[2]);if(D){a.quaternion.set(D[0],D[1],D[2],D[3]);a.useQuaternion=true}else a.rotation.set(G[0],G[1],G[2]);a.scale.set(B[0],B[1],B[2]);a.visible=u.visible!==void 0?u.visible:false;N.scene.add(a);N.objects[n]=a;N.empties[n]=a}}}function g(a){return function(b){N.geometries[a]=b;f();R=R-1;j.onLoadComplete();i()}}function h(a){return function(b){N.geometries[a]=b}}function i(){j.callbackProgress({totalModels:k,
totalTextures:Q,loadedModels:k-R,loadedTextures:Q-E},N);j.onLoadProgress();R===0&&E===0&&d(N)}var j=this,l=b.Loader.prototype.extractUrlBase(c),m,p,n,q,s,o,r,u,v,x,t,y,G,D,B,w,I,J,O,S,Z,C,H,R,E,k,Q,N;C=a;c=new b.BinaryLoader;H=new b.JSONLoader;E=R=0;N={scene:new b.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}};if(C.transform){a=C.transform.position;x=C.transform.rotation;w=C.transform.scale;a&&N.scene.position.set(a[0],a[1],a[2]);x&&N.scene.rotation.set(x[0],
x[1],x[2]);w&&N.scene.scale.set(w[0],w[1],w[2]);if(a||x||w){N.scene.updateMatrix();N.scene.updateMatrixWorld()}}a=function(a){return function(){E=E-a;i();j.onLoadComplete()}};for(s in C.cameras){w=C.cameras[s];w.type==="perspective"?S=new b.PerspectiveCamera(w.fov,w.aspect,w.near,w.far):w.type==="ortho"&&(S=new b.OrthographicCamera(w.left,w.right,w.top,w.bottom,w.near,w.far));y=w.position;x=w.target;w=w.up;S.position.set(y[0],y[1],y[2]);S.target=new b.Vector3(x[0],x[1],x[2]);w&&S.up.set(w[0],w[1],
w[2]);N.cameras[s]=S}for(q in C.lights){x=C.lights[q];s=x.color!==void 0?x.color:16777215;S=x.intensity!==void 0?x.intensity:1;if(x.type==="directional"){y=x.direction;t=new b.DirectionalLight(s,S);t.position.set(y[0],y[1],y[2]);t.position.normalize()}else if(x.type==="point"){y=x.position;t=x.distance;t=new b.PointLight(s,S,t);t.position.set(y[0],y[1],y[2])}else x.type==="ambient"&&(t=new b.AmbientLight(s));N.scene.add(t);N.lights[q]=t}for(o in C.fogs){q=C.fogs[o];q.type==="linear"?Z=new b.Fog(0,
q.near,q.far):q.type==="exp2"&&(Z=new b.FogExp2(0,q.density));w=q.color;Z.color.setRGB(w[0],w[1],w[2]);N.fogs[o]=Z}if(N.cameras&&C.defaults.camera)N.currentCamera=N.cameras[C.defaults.camera];if(N.fogs&&C.defaults.fog)N.scene.fog=N.fogs[C.defaults.fog];w=C.defaults.bgcolor;N.bgColor=new b.Color;N.bgColor.setRGB(w[0],w[1],w[2]);N.bgColorAlpha=C.defaults.bgalpha;for(m in C.geometries){o=C.geometries[m];if(o.type=="bin_mesh"||o.type=="ascii_mesh"){R=R+1;j.onLoadStart()}}k=R;for(m in C.geometries){o=
C.geometries[m];if(o.type==="cube"){J=new b.CubeGeometry(o.width,o.height,o.depth,o.segmentsWidth,o.segmentsHeight,o.segmentsDepth,null,o.flipped,o.sides);N.geometries[m]=J}else if(o.type==="plane"){J=new b.PlaneGeometry(o.width,o.height,o.segmentsWidth,o.segmentsHeight);N.geometries[m]=J}else if(o.type==="sphere"){J=new b.SphereGeometry(o.radius,o.segmentsWidth,o.segmentsHeight);N.geometries[m]=J}else if(o.type==="cylinder"){J=new b.CylinderGeometry(o.topRad,o.botRad,o.height,o.radSegs,o.heightSegs);
N.geometries[m]=J}else if(o.type==="torus"){J=new b.TorusGeometry(o.radius,o.tube,o.segmentsR,o.segmentsT);N.geometries[m]=J}else if(o.type==="icosahedron"){J=new b.IcosahedronGeometry(o.radius,o.subdivisions);N.geometries[m]=J}else if(o.type==="bin_mesh")c.load(e(o.url,C.urlBaseType),g(m));else if(o.type==="ascii_mesh")H.load(e(o.url,C.urlBaseType),g(m));else if(o.type==="embedded_mesh"){o=C.embeds[o.id];o.metadata=C.metadata;o&&H.createModel(o,h(m),"")}}for(r in C.textures){m=C.textures[r];if(m.url instanceof
Array){E=E+m.url.length;for(o=0;o<m.url.length;o++)j.onLoadStart()}else{E=E+1;j.onLoadStart()}}Q=E;for(r in C.textures){m=C.textures[r];if(m.mapping!==void 0&&b[m.mapping]!==void 0)m.mapping=new b[m.mapping];if(m.url instanceof Array){o=m.url.length;Z=[];for(c=0;c<o;c++)Z[c]=e(m.url[c],C.urlBaseType);o=b.ImageUtils.loadTextureCube(Z,m.mapping,a(o))}else{o=b.ImageUtils.loadTexture(e(m.url,C.urlBaseType),m.mapping,a(1));if(b[m.minFilter]!==void 0)o.minFilter=b[m.minFilter];if(b[m.magFilter]!==void 0)o.magFilter=
b[m.magFilter];if(m.repeat){o.repeat.set(m.repeat[0],m.repeat[1]);if(m.repeat[0]!==1)o.wrapS=b.RepeatWrapping;if(m.repeat[1]!==1)o.wrapT=b.RepeatWrapping}m.offset&&o.offset.set(m.offset[0],m.offset[1]);if(m.wrap){Z={repeat:b.RepeatWrapping,mirror:b.MirroredRepeatWrapping};if(Z[m.wrap[0]]!==void 0)o.wrapS=Z[m.wrap[0]];if(Z[m.wrap[1]]!==void 0)o.wrapT=Z[m.wrap[1]]}}N.textures[r]=o}for(p in C.materials){v=C.materials[p];for(I in v.parameters)if(I==="envMap"||I==="map"||I==="lightMap")v.parameters[I]=
N.textures[v.parameters[I]];else if(I==="shading")v.parameters[I]=v.parameters[I]=="flat"?b.FlatShading:b.SmoothShading;else if(I==="blending")v.parameters[I]=v.parameters[I]in b?b[v.parameters[I]]:b.NormalBlending;else if(I==="combine")v.parameters[I]=v.parameters[I]=="MixOperation"?b.MixOperation:b.MultiplyOperation;else if(I==="vertexColors")if(v.parameters[I]=="face")v.parameters[I]=b.FaceColors;else if(v.parameters[I])v.parameters[I]=b.VertexColors;if(v.parameters.opacity!==void 0&&v.parameters.opacity<
1)v.parameters.transparent=true;if(v.parameters.normalMap){r=b.ShaderUtils.lib.normal;a=b.UniformsUtils.clone(r.uniforms);m=v.parameters.color;o=v.parameters.specular;Z=v.parameters.ambient;c=v.parameters.shininess;a.tNormal.texture=N.textures[v.parameters.normalMap];if(v.parameters.normalMapFactor)a.uNormalScale.value=v.parameters.normalMapFactor;if(v.parameters.map){a.tDiffuse.texture=v.parameters.map;a.enableDiffuse.value=true}if(v.parameters.lightMap){a.tAO.texture=v.parameters.lightMap;a.enableAO.value=
true}if(v.parameters.specularMap){a.tSpecular.texture=N.textures[v.parameters.specularMap];a.enableSpecular.value=true}a.uDiffuseColor.value.setHex(m);a.uSpecularColor.value.setHex(o);a.uAmbientColor.value.setHex(Z);a.uShininess.value=c;if(v.parameters.opacity)a.uOpacity.value=v.parameters.opacity;O=new b.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:a,lights:true,fog:true})}else O=new b[v.type](v.parameters);N.materials[p]=O}f();j.callbackSync(N);i()};b.TextureLoader=
function(){b.EventTarget.call(this);this.crossOrigin=null};b.TextureLoader.prototype={constructor:b.TextureLoader,load:function(a){var d=this,c=new Image;c.addEventListener("load",function(){var a=new b.Texture(c);a.needsUpdate=true;d.dispatchEvent({type:"load",content:a})},false);c.addEventListener("error",function(){d.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);if(d.crossOrigin)c.crossOrigin=d.crossOrigin;c.src=a}};b.Material=function(a){a=a||{};this.id=b.MaterialCount++;
this.name="";this.opacity=a.opacity!==void 0?a.opacity:1;this.transparent=a.transparent!==void 0?a.transparent:false;this.blending=a.blending!==void 0?a.blending:b.NormalBlending;this.blendSrc=a.blendSrc!==void 0?a.blendSrc:b.SrcAlphaFactor;this.blendDst=a.blendDst!==void 0?a.blendDst:b.OneMinusSrcAlphaFactor;this.blendEquation=a.blendEquation!==void 0?a.blendEquation:b.AddEquation;this.depthTest=a.depthTest!==void 0?a.depthTest:true;this.depthWrite=a.depthWrite!==void 0?a.depthWrite:true;this.polygonOffset=
a.polygonOffset!==void 0?a.polygonOffset:false;this.polygonOffsetFactor=a.polygonOffsetFactor!==void 0?a.polygonOffsetFactor:0;this.polygonOffsetUnits=a.polygonOffsetUnits!==void 0?a.polygonOffsetUnits:0;this.alphaTest=a.alphaTest!==void 0?a.alphaTest:0;this.overdraw=a.overdraw!==void 0?a.overdraw:false;this.needsUpdate=this.visible=true};b.MaterialCount=0;b.NoShading=0;b.FlatShading=1;b.SmoothShading=2;b.NoColors=0;b.FaceColors=1;b.VertexColors=2;b.NoBlending=0;b.NormalBlending=1;b.AdditiveBlending=
2;b.SubtractiveBlending=3;b.MultiplyBlending=4;b.AdditiveAlphaBlending=5;b.CustomBlending=6;b.AddEquation=100;b.SubtractEquation=101;b.ReverseSubtractEquation=102;b.ZeroFactor=200;b.OneFactor=201;b.SrcColorFactor=202;b.OneMinusSrcColorFactor=203;b.SrcAlphaFactor=204;b.OneMinusSrcAlphaFactor=205;b.DstAlphaFactor=206;b.OneMinusDstAlphaFactor=207;b.DstColorFactor=208;b.OneMinusDstColorFactor=209;b.SrcAlphaSaturateFactor=210;b.LineBasicMaterial=function(a){b.Material.call(this,a);a=a||{};this.color=a.color!==
void 0?new b.Color(a.color):new b.Color(16777215);this.linewidth=a.linewidth!==void 0?a.linewidth:1;this.linecap=a.linecap!==void 0?a.linecap:"round";this.linejoin=a.linejoin!==void 0?a.linejoin:"round";this.vertexColors=a.vertexColors?a.vertexColors:false;this.fog=a.fog!==void 0?a.fog:true};b.LineBasicMaterial.prototype=Object.create(b.Material.prototype);b.MeshBasicMaterial=function(a){b.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new b.Color(a.color):new b.Color(16777215);this.map=
a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:b.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:true;this.shading=a.shading!==void 0?a.shading:b.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==
void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:b.NoColors;this.skinning=a.skinning!==void 0?a.skinning:false;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:false};b.MeshBasicMaterial.prototype=Object.create(b.Material.prototype);b.MeshLambertMaterial=function(a){b.Material.call(this,a);a=a||{};
this.color=a.color!==void 0?new b.Color(a.color):new b.Color(16777215);this.ambient=a.ambient!==void 0?new b.Color(a.ambient):new b.Color(16777215);this.emissive=a.emissive!==void 0?new b.Color(a.emissive):new b.Color(0);this.wrapAround=a.wrapAround!==void 0?a.wrapAround:false;this.wrapRGB=new b.Vector3(1,1,1);this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:b.MultiplyOperation;
this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:true;this.shading=a.shading!==void 0?a.shading:b.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:
"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:b.NoColors;this.skinning=a.skinning!==void 0?a.skinning:false;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:false;this.morphNormals=a.morphNormals!==void 0?a.morphNormals:false};b.MeshLambertMaterial.prototype=Object.create(b.Material.prototype);b.MeshPhongMaterial=function(a){b.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new b.Color(a.color):new b.Color(16777215);this.ambient=a.ambient!==void 0?new b.Color(a.ambient):
new b.Color(16777215);this.emissive=a.emissive!==void 0?new b.Color(a.emissive):new b.Color(0);this.specular=a.specular!==void 0?new b.Color(a.specular):new b.Color(1118481);this.shininess=a.shininess!==void 0?a.shininess:30;this.metal=a.metal!==void 0?a.metal:false;this.perPixel=a.perPixel!==void 0?a.perPixel:false;this.wrapAround=a.wrapAround!==void 0?a.wrapAround:false;this.wrapRGB=new b.Vector3(1,1,1);this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=
a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:b.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:true;this.shading=a.shading!==void 0?a.shading:b.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:
"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:b.NoColors;this.skinning=a.skinning!==void 0?a.skinning:false;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:false;this.morphNormals=a.morphNormals!==void 0?a.morphNormals:false};b.MeshPhongMaterial.prototype=Object.create(b.Material.prototype);b.MeshDepthMaterial=function(a){b.Material.call(this,a);a=a||{};this.shading=a.shading!==void 0?a.shading:
b.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1};b.MeshDepthMaterial.prototype=Object.create(b.Material.prototype);b.MeshNormalMaterial=function(a){b.Material.call(this,a);a=a||{};this.shading=a.shading?a.shading:b.FlatShading;this.wireframe=a.wireframe?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth?a.wireframeLinewidth:1};b.MeshNormalMaterial.prototype=Object.create(b.Material.prototype);
b.MeshFaceMaterial=function(){};b.ParticleBasicMaterial=function(a){b.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new b.Color(a.color):new b.Color(16777215);this.map=a.map!==void 0?a.map:null;this.size=a.size!==void 0?a.size:1;this.sizeAttenuation=a.sizeAttenuation!==void 0?a.sizeAttenuation:true;this.vertexColors=a.vertexColors!==void 0?a.vertexColors:false;this.fog=a.fog!==void 0?a.fog:true};b.ParticleBasicMaterial.prototype=Object.create(b.Material.prototype);b.ParticleCanvasMaterial=
function(a){b.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new b.Color(a.color):new b.Color(16777215);this.program=a.program!==void 0?a.program:function(){}};b.ParticleCanvasMaterial.prototype=Object.create(b.Material.prototype);b.ParticleDOMMaterial=function(a){b.Material.call(this);this.domElement=a};b.ShaderMaterial=function(a){b.Material.call(this,a);a=a||{};this.fragmentShader=a.fragmentShader!==void 0?a.fragmentShader:"void main() {}";this.vertexShader=a.vertexShader!==void 0?a.vertexShader:
"void main() {}";this.uniforms=a.uniforms!==void 0?a.uniforms:{};this.attributes=a.attributes;this.shading=a.shading!==void 0?a.shading:b.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.fog=a.fog!==void 0?a.fog:false;this.lights=a.lights!==void 0?a.lights:false;this.vertexColors=a.vertexColors!==void 0?a.vertexColors:b.NoColors;this.skinning=a.skinning!==void 0?a.skinning:false;this.morphTargets=
a.morphTargets!==void 0?a.morphTargets:false;this.morphNormals=a.morphNormals!==void 0?a.morphNormals:false};b.ShaderMaterial.prototype=Object.create(b.Material.prototype);b.Texture=function(a,d,c,e,f,g,h,i){this.id=b.TextureCount++;this.image=a;this.mapping=d!==void 0?d:new b.UVMapping;this.wrapS=c!==void 0?c:b.ClampToEdgeWrapping;this.wrapT=e!==void 0?e:b.ClampToEdgeWrapping;this.magFilter=f!==void 0?f:b.LinearFilter;this.minFilter=g!==void 0?g:b.LinearMipMapLinearFilter;this.format=h!==void 0?
h:b.RGBAFormat;this.type=i!==void 0?i:b.UnsignedByteType;this.offset=new b.Vector2(0,0);this.repeat=new b.Vector2(1,1);this.generateMipmaps=true;this.needsUpdate=this.premultiplyAlpha=false;this.onUpdate=null};b.Texture.prototype={constructor:b.Texture,clone:function(){var a=new b.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter,this.format,this.type);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a}};b.TextureCount=0;b.MultiplyOperation=0;b.MixOperation=
1;b.UVMapping=function(){};b.CubeReflectionMapping=function(){};b.CubeRefractionMapping=function(){};b.SphericalReflectionMapping=function(){};b.SphericalRefractionMapping=function(){};b.RepeatWrapping=0;b.ClampToEdgeWrapping=1;b.MirroredRepeatWrapping=2;b.NearestFilter=3;b.NearestMipMapNearestFilter=4;b.NearestMipMapLinearFilter=5;b.LinearFilter=6;b.LinearMipMapNearestFilter=7;b.LinearMipMapLinearFilter=8;b.UnsignedByteType=9;b.ByteType=10;b.ShortType=11;b.UnsignedShortType=12;b.IntType=13;b.UnsignedIntType=
14;b.FloatType=15;b.UnsignedShort4444Type=16;b.UnsignedShort5551Type=17;b.UnsignedShort565Type=18;b.AlphaFormat=19;b.RGBFormat=20;b.RGBAFormat=21;b.LuminanceFormat=22;b.LuminanceAlphaFormat=23;b.DataTexture=function(a,d,c,e,f,g,h,i,j,l){b.Texture.call(this,null,g,h,i,j,l,e,f);this.image={data:a,width:d,height:c}};b.DataTexture.prototype=Object.create(b.Texture.prototype);b.DataTexture.prototype.clone=function(){var a=new b.DataTexture(this.image.data,this.image.width,this.image.height,this.format,
this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a};b.Particle=function(a){b.Object3D.call(this);this.material=a};b.Particle.prototype=Object.create(b.Object3D.prototype);b.ParticleSystem=function(a,d){b.Object3D.call(this);this.geometry=a;this.material=d!==void 0?d:new b.ParticleBasicMaterial({color:Math.random()*16777215});this.sortParticles=false;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();
this.boundRadius=a.boundingSphere.radius}this.frustumCulled=false};b.ParticleSystem.prototype=Object.create(b.Object3D.prototype);b.Line=function(a,d,c){b.Object3D.call(this);this.geometry=a;this.material=d!==void 0?d:new b.LineBasicMaterial({color:Math.random()*16777215});this.type=c!==void 0?c:b.LineStrip;this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())};b.LineStrip=0;b.LinePieces=1;b.Line.prototype=Object.create(b.Object3D.prototype);b.Mesh=function(a,d){b.Object3D.call(this);
this.geometry=a;this.material=d!==void 0?d:new b.MeshBasicMaterial({color:Math.random()*16777215,wireframe:true});if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=a.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0;c<this.geometry.morphTargets.length;c++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[c].name]=
c}}}};b.Mesh.prototype=Object.create(b.Object3D.prototype);b.Mesh.prototype.getMorphTargetIndexByName=function(a){if(this.morphTargetDictionary[a]!==void 0)return this.morphTargetDictionary[a];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};b.Bone=function(a){b.Object3D.call(this);this.skin=a;this.skinMatrix=new b.Matrix4};b.Bone.prototype=Object.create(b.Object3D.prototype);b.Bone.prototype.update=function(a,b){this.matrixAutoUpdate&&
(b=b|this.updateMatrix());if(b||this.matrixWorldNeedsUpdate){a?this.skinMatrix.multiply(a,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=false;b=true}var c,e=this.children.length;for(c=0;c<e;c++)this.children[c].update(this.skinMatrix,b)};b.SkinnedMesh=function(a,d){b.Mesh.call(this,a,d);this.identityMatrix=new b.Matrix4;this.bones=[];this.boneMatrices=[];var c,e,f,g,h,i;if(this.geometry.bones!==void 0){for(c=0;c<this.geometry.bones.length;c++){f=this.geometry.bones[c];
g=f.pos;h=f.rotq;i=f.scl;e=this.addBone();e.name=f.name;e.position.set(g[0],g[1],g[2]);e.quaternion.set(h[0],h[1],h[2],h[3]);e.useQuaternion=true;i!==void 0?e.scale.set(i[0],i[1],i[2]):e.scale.set(1,1,1)}for(c=0;c<this.bones.length;c++){f=this.geometry.bones[c];e=this.bones[c];f.parent===-1?this.add(e):this.bones[f.parent].add(e)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};b.SkinnedMesh.prototype=Object.create(b.Mesh.prototype);b.SkinnedMesh.prototype.addBone=function(a){a===
void 0&&(a=new b.Bone(this));this.bones.push(a);return a};b.SkinnedMesh.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false}for(var a=0,d=this.children.length;a<d;a++){var c=this.children[a];c instanceof b.Bone?c.update(this.identityMatrix,false):c.updateMatrixWorld(true)}for(var d=this.bones.length,
c=this.bones,e=this.boneMatrices,a=0;a<d;a++)c[a].skinMatrix.flattenToArrayOffset(e,a*16)};b.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(true);for(var a,d=[],c=0;c<this.bones.length;c++){a=this.bones[c];var e=new b.Matrix4;e.getInverse(a.skinMatrix);d.push(e);a.skinMatrix.flattenToArrayOffset(this.boneMatrices,c*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];for(a=0;a<this.geometry.skinIndices.length;a++){var c=this.geometry.vertices[a],
f=this.geometry.skinIndices[a].x,g=this.geometry.skinIndices[a].y,e=new b.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesA.push(d[f].multiplyVector3(e));e=new b.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesB.push(d[g].multiplyVector3(e));if(this.geometry.skinWeights[a].x+this.geometry.skinWeights[a].y!==1){c=(1-(this.geometry.skinWeights[a].x+this.geometry.skinWeights[a].y))*0.5;this.geometry.skinWeights[a].x=this.geometry.skinWeights[a].x+c;this.geometry.skinWeights[a].y=this.geometry.skinWeights[a].y+
c}}}};b.MorphAnimMesh=function(a,d){b.Mesh.call(this,a,d);this.duration=1E3;this.mirroredLoop=false;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};b.MorphAnimMesh.prototype=Object.create(b.Mesh.prototype);b.MorphAnimMesh.prototype.setFrameRange=function(a,b){this.startKeyframe=a;this.endKeyframe=b;this.length=this.endKeyframe-this.startKeyframe+1};b.MorphAnimMesh.prototype.setDirectionForward=
function(){this.direction=1;this.directionBackwards=false};b.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};b.MorphAnimMesh.prototype.parseAnimations=function(){var a=this.geometry;if(!a.animations)a.animations={};for(var b,c=a.animations,e=/([a-z]+)(\d+)/,f=0,g=a.morphTargets.length;f<g;f++){var h=a.morphTargets[f].name.match(e);if(h&&h.length>1){h=h[1];c[h]||(c[h]={start:Infinity,end:-Infinity});var i=c[h];if(f<i.start)i.start=f;if(f>i.end)i.end=
f;b||(b=h)}}a.firstAnimation=b};b.MorphAnimMesh.prototype.setAnimationLabel=function(a,b,c){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[a]={start:b,end:c}};b.MorphAnimMesh.prototype.playAnimation=function(a,b){var c=this.geometry.animations[a];if(c){this.setFrameRange(c.start,c.end);this.duration=1E3*((c.end-c.start)/b);this.time=0}else console.warn("animation["+a+"] undefined")};b.MorphAnimMesh.prototype.updateAnimation=function(a){var d=this.duration/this.length;
this.time=this.time+this.direction*a;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction=this.direction*-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time=this.time+this.duration}a=this.startKeyframe+b.Math.clamp(Math.floor(this.time/d),0,this.length-1);if(a!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=
0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[a]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=a}d=this.time%d/d;this.directionBackwards&&(d=1-d);this.morphTargetInfluences[this.currentKeyframe]=d;this.morphTargetInfluences[this.lastKeyframe]=1-d};b.Ribbon=function(a,d){b.Object3D.call(this);this.geometry=a;this.material=d};b.Ribbon.prototype=Object.create(b.Object3D.prototype);b.LOD=function(){b.Object3D.call(this);this.LODs=[]};b.LOD.prototype=Object.create(b.Object3D.prototype);
b.LOD.prototype.addLevel=function(a,b){b===void 0&&(b=0);for(var b=Math.abs(b),c=0;c<this.LODs.length;c++)if(b<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:b,object3D:a});this.add(a)};b.LOD.prototype.update=function(a){if(this.LODs.length>1){a.matrixWorldInverse.getInverse(a.matrixWorld);a=a.matrixWorldInverse;a=-(a.elements[2]*this.matrixWorld.elements[12]+a.elements[6]*this.matrixWorld.elements[13]+a.elements[10]*this.matrixWorld.elements[14]+a.elements[14]);this.LODs[0].object3D.visible=
true;for(var b=1;b<this.LODs.length;b++)if(a>=this.LODs[b].visibleAtDistance){this.LODs[b-1].object3D.visible=false;this.LODs[b].object3D.visible=true}else break;for(;b<this.LODs.length;b++)this.LODs[b].object3D.visible=false}};b.Sprite=function(a){b.Object3D.call(this);this.color=a.color!==void 0?new b.Color(a.color):new b.Color(16777215);this.map=a.map!==void 0?a.map:new b.Texture;this.blending=a.blending!==void 0?a.blending:b.NormalBlending;this.blendSrc=a.blendSrc!==void 0?a.blendSrc:b.SrcAlphaFactor;
this.blendDst=a.blendDst!==void 0?a.blendDst:b.OneMinusSrcAlphaFactor;this.blendEquation=a.blendEquation!==void 0?a.blendEquation:b.AddEquation;this.useScreenCoordinates=a.useScreenCoordinates!==void 0?a.useScreenCoordinates:true;this.mergeWith3D=a.mergeWith3D!==void 0?a.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=a.affectedByDistance!==void 0?a.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=a.scaleByViewport!==void 0?a.scaleByViewport:!this.affectedByDistance;
this.alignment=a.alignment instanceof b.Vector2?a.alignment:b.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new b.Vector2(0,0);this.uvScale=new b.Vector2(1,1)};b.Sprite.prototype=Object.create(b.Object3D.prototype);b.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);
this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=true};b.SpriteAlignment={};b.SpriteAlignment.topLeft=new b.Vector2(1,-1);b.SpriteAlignment.topCenter=new b.Vector2(0,-1);b.SpriteAlignment.topRight=new b.Vector2(-1,-1);b.SpriteAlignment.centerLeft=new b.Vector2(1,0);b.SpriteAlignment.center=new b.Vector2(0,0);b.SpriteAlignment.centerRight=new b.Vector2(-1,0);b.SpriteAlignment.bottomLeft=new b.Vector2(1,1);b.SpriteAlignment.bottomCenter=new b.Vector2(0,1);b.SpriteAlignment.bottomRight=
new b.Vector2(-1,1);b.Scene=function(){b.Object3D.call(this);this.overrideMaterial=this.fog=null;this.matrixAutoUpdate=false;this.__objects=[];this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};b.Scene.prototype=Object.create(b.Object3D.prototype);b.Scene.prototype.__addObject=function(a){if(a instanceof b.Light)this.__lights.indexOf(a)===-1&&this.__lights.push(a);else if(!(a instanceof b.Camera||a instanceof b.Bone)&&this.__objects.indexOf(a)===-1){this.__objects.push(a);this.__objectsAdded.push(a);
var d=this.__objectsRemoved.indexOf(a);d!==-1&&this.__objectsRemoved.splice(d,1)}for(d=0;d<a.children.length;d++)this.__addObject(a.children[d])};b.Scene.prototype.__removeObject=function(a){if(a instanceof b.Light){var d=this.__lights.indexOf(a);d!==-1&&this.__lights.splice(d,1)}else if(!(a instanceof b.Camera)){d=this.__objects.indexOf(a);if(d!==-1){this.__objects.splice(d,1);this.__objectsRemoved.push(a);d=this.__objectsAdded.indexOf(a);d!==-1&&this.__objectsAdded.splice(d,1)}}for(d=0;d<a.children.length;d++)this.__removeObject(a.children[d])};
b.Fog=function(a,d,c){this.color=new b.Color(a);this.near=d!==void 0?d:1;this.far=c!==void 0?c:1E3};b.FogExp2=function(a,d){this.color=new b.Color(a);this.density=d!==void 0?d:2.5E-4};b.CanvasRenderer=function(a){function d(a){if(v!=a)o.globalAlpha=v=a}function c(a){if(x!=a){switch(a){case b.NormalBlending:o.globalCompositeOperation="source-over";break;case b.AdditiveBlending:o.globalCompositeOperation="lighter";break;case b.SubtractiveBlending:o.globalCompositeOperation="darker"}x=a}}function e(a){if(t!=
a)o.strokeStyle=t=a}function f(a){if(y!=a)o.fillStyle=y=a}console.log("THREE.CanvasRenderer",b.REVISION);var a=a||{},g=this,h,i,j,l=new b.Projector,m=a.canvas!==void 0?a.canvas:document.createElement("canvas"),p,n,q,s,o=m.getContext("2d"),r=new b.Color(0),u=0,v=1,x=0,t=null,y=null,G=null,D=null,B=null,w,I,J,O,S=new b.RenderableVertex,Z=new b.RenderableVertex,C,H,R,E,k,Q,N,T,ba,L,da,ga,P=new b.Color,$=new b.Color,aa=new b.Color,Y=new b.Color,ia=new b.Color,Ta=[],Ma=[],Oa,pa,Ua,fb,gb,$a,Mb,nb,kb,ob,
bb=new b.Rectangle,Ca=new b.Rectangle,za=new b.Rectangle,hb=false,xa=new b.Color,Pa=new b.Color,Ea=new b.Color,ma=new b.Vector3,pb,ab,bc,Sa,qc,Cc,a=16;pb=document.createElement("canvas");pb.width=pb.height=2;ab=pb.getContext("2d");ab.fillStyle="rgba(0,0,0,1)";ab.fillRect(0,0,2,2);bc=ab.getImageData(0,0,2,2);Sa=bc.data;qc=document.createElement("canvas");qc.width=qc.height=a;Cc=qc.getContext("2d");Cc.translate(-a/2,-a/2);Cc.scale(a,a);a--;this.domElement=m;this.sortElements=this.sortObjects=this.autoClear=
true;this.info={render:{vertices:0,faces:0}};this.setSize=function(a,b){p=a;n=b;q=Math.floor(p/2);s=Math.floor(n/2);m.width=p;m.height=n;bb.set(-q,-s,q,s);Ca.set(-q,-s,q,s);v=1;x=0;B=D=G=y=t=null};this.setClearColor=function(a,b){r.copy(a);u=b!==void 0?b:1;Ca.set(-q,-s,q,s)};this.setClearColorHex=function(a,b){r.setHex(a);u=b!==void 0?b:1;Ca.set(-q,-s,q,s)};this.clear=function(){o.setTransform(1,0,0,-1,q,s);if(!Ca.isEmpty()){Ca.minSelf(bb);Ca.inflate(2);u<1&&o.clearRect(Math.floor(Ca.getX()),Math.floor(Ca.getY()),
Math.floor(Ca.getWidth()),Math.floor(Ca.getHeight()));if(u>0){c(b.NormalBlending);d(1);f("rgba("+Math.floor(r.r*255)+","+Math.floor(r.g*255)+","+Math.floor(r.b*255)+","+u+")");o.fillRect(Math.floor(Ca.getX()),Math.floor(Ca.getY()),Math.floor(Ca.getWidth()),Math.floor(Ca.getHeight()))}Ca.empty()}};this.render=function(a,m){function n(a){var d,c,e,f;xa.setRGB(0,0,0);Pa.setRGB(0,0,0);Ea.setRGB(0,0,0);d=0;for(c=a.length;d<c;d++){e=a[d];f=e.color;if(e instanceof b.AmbientLight){xa.r=xa.r+f.r;xa.g=xa.g+
f.g;xa.b=xa.b+f.b}else if(e instanceof b.DirectionalLight){Pa.r=Pa.r+f.r;Pa.g=Pa.g+f.g;Pa.b=Pa.b+f.b}else if(e instanceof b.PointLight){Ea.r=Ea.r+f.r;Ea.g=Ea.g+f.g;Ea.b=Ea.b+f.b}}}function p(a,d,c,e){var f,g,h,i,k,j;f=0;for(g=a.length;f<g;f++){h=a[f];i=h.color;if(h instanceof b.DirectionalLight){k=h.matrixWorld.getPosition();j=c.dot(k);if(!(j<=0)){j=j*h.intensity;e.r=e.r+i.r*j;e.g=e.g+i.g*j;e.b=e.b+i.b*j}}else if(h instanceof b.PointLight){k=h.matrixWorld.getPosition();j=c.dot(ma.sub(k,d).normalize());
if(!(j<=0)){j=j*(h.distance==0?1:1-Math.min(d.distanceTo(k)/h.distance,1));if(j!=0){j=j*h.intensity;e.r=e.r+i.r*j;e.g=e.g+i.g*j;e.b=e.b+i.b*j}}}}}function r(a,g,h){d(h.opacity);c(h.blending);var i,k,j,m,l,n;if(h instanceof b.ParticleBasicMaterial){if(h.map){m=h.map.image;l=m.width>>1;n=m.height>>1;h=g.scale.x*q;j=g.scale.y*s;i=h*l;k=j*n;za.set(a.x-i,a.y-k,a.x+i,a.y+k);if(bb.intersects(za)){o.save();o.translate(a.x,a.y);o.rotate(-g.rotation);o.scale(h,-j);o.translate(-l,-n);o.drawImage(m,0,0);o.restore()}}}else if(h instanceof
b.ParticleCanvasMaterial){i=g.scale.x*q;k=g.scale.y*s;za.set(a.x-i,a.y-k,a.x+i,a.y+k);if(bb.intersects(za)){e(h.color.getContextStyle());f(h.color.getContextStyle());o.save();o.translate(a.x,a.y);o.rotate(-g.rotation);o.scale(i,k);h.program(o);o.restore()}}}function u(a,f,g,h){d(h.opacity);c(h.blending);o.beginPath();o.moveTo(a.positionScreen.x,a.positionScreen.y);o.lineTo(f.positionScreen.x,f.positionScreen.y);o.closePath();if(h instanceof b.LineBasicMaterial){a=h.linewidth;if(G!=a)o.lineWidth=G=
a;a=h.linecap;if(D!=a)o.lineCap=D=a;a=h.linejoin;if(B!=a)o.lineJoin=B=a;e(h.color.getContextStyle());o.stroke();za.inflate(h.linewidth*2)}}function t(a,e,f,h,i,l,n,o){g.info.render.vertices=g.info.render.vertices+3;g.info.render.faces++;d(o.opacity);c(o.blending);C=a.positionScreen.x;H=a.positionScreen.y;R=e.positionScreen.x;E=e.positionScreen.y;k=f.positionScreen.x;Q=f.positionScreen.y;x(C,H,R,E,k,Q);if(o instanceof b.MeshBasicMaterial)if(o.map){if(o.map.mapping instanceof b.UVMapping){fb=n.uvs[0];
ad(C,H,R,E,k,Q,fb[h].u,fb[h].v,fb[i].u,fb[i].v,fb[l].u,fb[l].v,o.map)}}else if(o.envMap){if(o.envMap.mapping instanceof b.SphericalReflectionMapping){a=m.matrixWorldInverse;ma.copy(n.vertexNormalsWorld[h]);gb=(ma.x*a.elements[0]+ma.y*a.elements[4]+ma.z*a.elements[8])*0.5+0.5;$a=-(ma.x*a.elements[1]+ma.y*a.elements[5]+ma.z*a.elements[9])*0.5+0.5;ma.copy(n.vertexNormalsWorld[i]);Mb=(ma.x*a.elements[0]+ma.y*a.elements[4]+ma.z*a.elements[8])*0.5+0.5;nb=-(ma.x*a.elements[1]+ma.y*a.elements[5]+ma.z*a.elements[9])*
0.5+0.5;ma.copy(n.vertexNormalsWorld[l]);kb=(ma.x*a.elements[0]+ma.y*a.elements[4]+ma.z*a.elements[8])*0.5+0.5;ob=-(ma.x*a.elements[1]+ma.y*a.elements[5]+ma.z*a.elements[9])*0.5+0.5;ad(C,H,R,E,k,Q,gb,$a,Mb,nb,kb,ob,o.envMap)}}else o.wireframe?Nb(o.color,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):Gb(o.color);else if(o instanceof b.MeshLambertMaterial)if(hb)if(!o.wireframe&&o.shading==b.SmoothShading&&n.vertexNormalsWorld.length==3){$.r=aa.r=Y.r=xa.r;$.g=aa.g=Y.g=xa.g;$.b=aa.b=Y.b=
xa.b;p(j,n.v1.positionWorld,n.vertexNormalsWorld[0],$);p(j,n.v2.positionWorld,n.vertexNormalsWorld[1],aa);p(j,n.v3.positionWorld,n.vertexNormalsWorld[2],Y);$.r=Math.max(0,Math.min(o.color.r*$.r,1));$.g=Math.max(0,Math.min(o.color.g*$.g,1));$.b=Math.max(0,Math.min(o.color.b*$.b,1));aa.r=Math.max(0,Math.min(o.color.r*aa.r,1));aa.g=Math.max(0,Math.min(o.color.g*aa.g,1));aa.b=Math.max(0,Math.min(o.color.b*aa.b,1));Y.r=Math.max(0,Math.min(o.color.r*Y.r,1));Y.g=Math.max(0,Math.min(o.color.g*Y.g,1));Y.b=
Math.max(0,Math.min(o.color.b*Y.b,1));ia.r=(aa.r+Y.r)*0.5;ia.g=(aa.g+Y.g)*0.5;ia.b=(aa.b+Y.b)*0.5;Ua=Dc($,aa,Y,ia);ic(C,H,R,E,k,Q,0,0,1,0,0,1,Ua)}else{P.r=xa.r;P.g=xa.g;P.b=xa.b;p(j,n.centroidWorld,n.normalWorld,P);P.r=Math.max(0,Math.min(o.color.r*P.r,1));P.g=Math.max(0,Math.min(o.color.g*P.g,1));P.b=Math.max(0,Math.min(o.color.b*P.b,1));o.wireframe?Nb(P,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):Gb(P)}else o.wireframe?Nb(o.color,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):
Gb(o.color);else if(o instanceof b.MeshDepthMaterial){Oa=m.near;pa=m.far;$.r=$.g=$.b=1-cc(a.positionScreen.z,Oa,pa);aa.r=aa.g=aa.b=1-cc(e.positionScreen.z,Oa,pa);Y.r=Y.g=Y.b=1-cc(f.positionScreen.z,Oa,pa);ia.r=(aa.r+Y.r)*0.5;ia.g=(aa.g+Y.g)*0.5;ia.b=(aa.b+Y.b)*0.5;Ua=Dc($,aa,Y,ia);ic(C,H,R,E,k,Q,0,0,1,0,0,1,Ua)}else if(o instanceof b.MeshNormalMaterial){P.r=jc(n.normalWorld.x);P.g=jc(n.normalWorld.y);P.b=jc(n.normalWorld.z);o.wireframe?Nb(P,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):
Gb(P)}}function v(a,e,f,h,i,l,n,o,q){g.info.render.vertices=g.info.render.vertices+4;g.info.render.faces++;d(o.opacity);c(o.blending);if(o.map||o.envMap){t(a,e,h,0,1,3,n,o,q);t(i,f,l,1,2,3,n,o,q)}else{C=a.positionScreen.x;H=a.positionScreen.y;R=e.positionScreen.x;E=e.positionScreen.y;k=f.positionScreen.x;Q=f.positionScreen.y;N=h.positionScreen.x;T=h.positionScreen.y;ba=i.positionScreen.x;L=i.positionScreen.y;da=l.positionScreen.x;ga=l.positionScreen.y;if(o instanceof b.MeshBasicMaterial){y(C,H,R,
E,k,Q,N,T);o.wireframe?Nb(o.color,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):Gb(o.color)}else if(o instanceof b.MeshLambertMaterial)if(hb)if(!o.wireframe&&o.shading==b.SmoothShading&&n.vertexNormalsWorld.length==4){$.r=aa.r=Y.r=ia.r=xa.r;$.g=aa.g=Y.g=ia.g=xa.g;$.b=aa.b=Y.b=ia.b=xa.b;p(j,n.v1.positionWorld,n.vertexNormalsWorld[0],$);p(j,n.v2.positionWorld,n.vertexNormalsWorld[1],aa);p(j,n.v4.positionWorld,n.vertexNormalsWorld[3],Y);p(j,n.v3.positionWorld,n.vertexNormalsWorld[2],ia);
$.r=Math.max(0,Math.min(o.color.r*$.r,1));$.g=Math.max(0,Math.min(o.color.g*$.g,1));$.b=Math.max(0,Math.min(o.color.b*$.b,1));aa.r=Math.max(0,Math.min(o.color.r*aa.r,1));aa.g=Math.max(0,Math.min(o.color.g*aa.g,1));aa.b=Math.max(0,Math.min(o.color.b*aa.b,1));Y.r=Math.max(0,Math.min(o.color.r*Y.r,1));Y.g=Math.max(0,Math.min(o.color.g*Y.g,1));Y.b=Math.max(0,Math.min(o.color.b*Y.b,1));ia.r=Math.max(0,Math.min(o.color.r*ia.r,1));ia.g=Math.max(0,Math.min(o.color.g*ia.g,1));ia.b=Math.max(0,Math.min(o.color.b*
ia.b,1));Ua=Dc($,aa,Y,ia);x(C,H,R,E,N,T);ic(C,H,R,E,N,T,0,0,1,0,0,1,Ua);x(ba,L,k,Q,da,ga);ic(ba,L,k,Q,da,ga,1,0,1,1,0,1,Ua)}else{P.r=xa.r;P.g=xa.g;P.b=xa.b;p(j,n.centroidWorld,n.normalWorld,P);P.r=Math.max(0,Math.min(o.color.r*P.r,1));P.g=Math.max(0,Math.min(o.color.g*P.g,1));P.b=Math.max(0,Math.min(o.color.b*P.b,1));y(C,H,R,E,k,Q,N,T);o.wireframe?Nb(P,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):Gb(P)}else{y(C,H,R,E,k,Q,N,T);o.wireframe?Nb(o.color,o.wireframeLinewidth,o.wireframeLinecap,
o.wireframeLinejoin):Gb(o.color)}else if(o instanceof b.MeshNormalMaterial){P.r=jc(n.normalWorld.x);P.g=jc(n.normalWorld.y);P.b=jc(n.normalWorld.z);y(C,H,R,E,k,Q,N,T);o.wireframe?Nb(P,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):Gb(P)}else if(o instanceof b.MeshDepthMaterial){Oa=m.near;pa=m.far;$.r=$.g=$.b=1-cc(a.positionScreen.z,Oa,pa);aa.r=aa.g=aa.b=1-cc(e.positionScreen.z,Oa,pa);Y.r=Y.g=Y.b=1-cc(h.positionScreen.z,Oa,pa);ia.r=ia.g=ia.b=1-cc(f.positionScreen.z,Oa,pa);Ua=Dc($,aa,
Y,ia);x(C,H,R,E,N,T);ic(C,H,R,E,N,T,0,0,1,0,0,1,Ua);x(ba,L,k,Q,da,ga);ic(ba,L,k,Q,da,ga,1,0,1,1,0,1,Ua)}}}function x(a,b,d,c,e,f){o.beginPath();o.moveTo(a,b);o.lineTo(d,c);o.lineTo(e,f);o.lineTo(a,b)}function y(a,b,d,c,e,f,g,h){o.beginPath();o.moveTo(a,b);o.lineTo(d,c);o.lineTo(e,f);o.lineTo(g,h);o.lineTo(a,b)}function Nb(a,b,d,c){if(G!=b)o.lineWidth=G=b;if(D!=d)o.lineCap=D=d;if(B!=c)o.lineJoin=B=c;e(a.getContextStyle());o.stroke();za.inflate(b*2)}function Gb(a){f(a.getContextStyle());o.fill()}function ad(a,
d,c,e,g,h,i,k,j,l,m,n,p){if(!(p.image===void 0||p.image.width===0)){if(p.needsUpdate===true||Ta[p.id]===void 0){var q=p.wrapS==b.RepeatWrapping,s=p.wrapT==b.RepeatWrapping;Ta[p.id]=o.createPattern(p.image,q&&s?"repeat":q&&!s?"repeat-x":!q&&s?"repeat-y":"no-repeat");p.needsUpdate=false}f(Ta[p.id]);var q=p.offset.x/p.repeat.x,s=p.offset.y/p.repeat.y,Sa=p.image.width*p.repeat.x,r=p.image.height*p.repeat.y,i=(i+q)*Sa,k=(k+s)*r,c=c-a,e=e-d,g=g-a,h=h-d,j=(j+q)*Sa-i,l=(l+s)*r-k,m=(m+q)*Sa-i,n=(n+s)*r-k,
q=j*n-m*l;if(q==0){if(Ma[p.id]===void 0){d=document.createElement("canvas");d.width=p.image.width;d.height=p.image.height;d=d.getContext("2d");d.drawImage(p.image,0,0);Ma[p.id]=d.getImageData(0,0,p.image.width,p.image.height).data}d=Ma[p.id];i=(Math.floor(i)+Math.floor(k)*p.image.width)*4;P.setRGB(d[i]/255,d[i+1]/255,d[i+2]/255);Gb(P)}else{q=1/q;p=(n*c-l*g)*q;l=(n*e-l*h)*q;c=(j*g-m*c)*q;e=(j*h-m*e)*q;a=a-p*i-c*k;i=d-l*i-e*k;o.save();o.transform(p,l,c,e,a,i);o.fill();o.restore()}}}function ic(a,b,
d,c,e,f,g,h,i,k,j,l,m){var n,p;n=m.width-1;p=m.height-1;g=g*n;h=h*p;d=d-a;c=c-b;e=e-a;f=f-b;i=i*n-g;k=k*p-h;j=j*n-g;l=l*p-h;p=1/(i*l-j*k);n=(l*d-k*e)*p;k=(l*c-k*f)*p;d=(i*e-j*d)*p;c=(i*f-j*c)*p;a=a-n*g-d*h;b=b-k*g-c*h;o.save();o.transform(n,k,d,c,a,b);o.clip();o.drawImage(m,0,0);o.restore()}function Dc(a,b,d,c){var e=~~(a.r*255),f=~~(a.g*255),a=~~(a.b*255),g=~~(b.r*255),h=~~(b.g*255),b=~~(b.b*255),i=~~(d.r*255),k=~~(d.g*255),d=~~(d.b*255),j=~~(c.r*255),l=~~(c.g*255),c=~~(c.b*255);Sa[0]=e<0?0:e>255?
255:e;Sa[1]=f<0?0:f>255?255:f;Sa[2]=a<0?0:a>255?255:a;Sa[4]=g<0?0:g>255?255:g;Sa[5]=h<0?0:h>255?255:h;Sa[6]=b<0?0:b>255?255:b;Sa[8]=i<0?0:i>255?255:i;Sa[9]=k<0?0:k>255?255:k;Sa[10]=d<0?0:d>255?255:d;Sa[12]=j<0?0:j>255?255:j;Sa[13]=l<0?0:l>255?255:l;Sa[14]=c<0?0:c>255?255:c;ab.putImageData(bc,0,0);Cc.drawImage(pb,0,0);return qc}function cc(a,b,d){a=(a-b)/(d-b);return a*a*(3-2*a)}function jc(a){a=(a+1)*0.5;return a<0?0:a>1?1:a}function Ob(a,b){var d=b.x-a.x,c=b.y-a.y,e=d*d+c*c;if(e!=0){e=1/Math.sqrt(e);
d=d*e;c=c*e;b.x=b.x+d;b.y=b.y+c;a.x=a.x-d;a.y=a.y-c}}var Ec,bd,Ka,ib;this.autoClear?this.clear():o.setTransform(1,0,0,-1,q,s);g.info.render.vertices=0;g.info.render.faces=0;h=l.projectScene(a,m,this.sortElements);i=h.elements;j=h.lights;(hb=j.length>0)&&n(j);Ec=0;for(bd=i.length;Ec<bd;Ec++){Ka=i[Ec];ib=Ka.material;ib=ib instanceof b.MeshFaceMaterial?Ka.faceMaterial:ib;if(!(ib===void 0||ib.visible===false)){za.empty();if(Ka instanceof b.RenderableParticle){w=Ka;w.x=w.x*q;w.y=w.y*s;r(w,Ka,ib,a)}else if(Ka instanceof
b.RenderableLine){w=Ka.v1;I=Ka.v2;w.positionScreen.x=w.positionScreen.x*q;w.positionScreen.y=w.positionScreen.y*s;I.positionScreen.x=I.positionScreen.x*q;I.positionScreen.y=I.positionScreen.y*s;za.addPoint(w.positionScreen.x,w.positionScreen.y);za.addPoint(I.positionScreen.x,I.positionScreen.y);bb.intersects(za)&&u(w,I,Ka,ib,a)}else if(Ka instanceof b.RenderableFace3){w=Ka.v1;I=Ka.v2;J=Ka.v3;w.positionScreen.x=w.positionScreen.x*q;w.positionScreen.y=w.positionScreen.y*s;I.positionScreen.x=I.positionScreen.x*
q;I.positionScreen.y=I.positionScreen.y*s;J.positionScreen.x=J.positionScreen.x*q;J.positionScreen.y=J.positionScreen.y*s;if(ib.overdraw){Ob(w.positionScreen,I.positionScreen);Ob(I.positionScreen,J.positionScreen);Ob(J.positionScreen,w.positionScreen)}za.add3Points(w.positionScreen.x,w.positionScreen.y,I.positionScreen.x,I.positionScreen.y,J.positionScreen.x,J.positionScreen.y);bb.intersects(za)&&t(w,I,J,0,1,2,Ka,ib,a)}else if(Ka instanceof b.RenderableFace4){w=Ka.v1;I=Ka.v2;J=Ka.v3;O=Ka.v4;w.positionScreen.x=
w.positionScreen.x*q;w.positionScreen.y=w.positionScreen.y*s;I.positionScreen.x=I.positionScreen.x*q;I.positionScreen.y=I.positionScreen.y*s;J.positionScreen.x=J.positionScreen.x*q;J.positionScreen.y=J.positionScreen.y*s;O.positionScreen.x=O.positionScreen.x*q;O.positionScreen.y=O.positionScreen.y*s;S.positionScreen.copy(I.positionScreen);Z.positionScreen.copy(O.positionScreen);if(ib.overdraw){Ob(w.positionScreen,I.positionScreen);Ob(I.positionScreen,O.positionScreen);Ob(O.positionScreen,w.positionScreen);
Ob(J.positionScreen,S.positionScreen);Ob(J.positionScreen,Z.positionScreen)}za.addPoint(w.positionScreen.x,w.positionScreen.y);za.addPoint(I.positionScreen.x,I.positionScreen.y);za.addPoint(J.positionScreen.x,J.positionScreen.y);za.addPoint(O.positionScreen.x,O.positionScreen.y);bb.intersects(za)&&v(w,I,J,O,S,Z,Ka,ib,a)}Ca.addRectangle(za)}}o.setTransform(1,0,0,1,0,0)}};b.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",
fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",
envmap_fragment:"#ifdef USE_ENVMAP\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",
envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",
map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",
lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",
lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",
lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvWorldPosition = mPosition.xyz;\n#endif",
lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",
lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * modelViewMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\nvec3 transformedNormal = normalMatrix * morphedNormal;\n#else\nvec3 transformedNormal = normalMatrix * normal;\n#endif",
shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n#ifdef USE_MORPHTARGETS\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( morphed, 1.0 );\n#else\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n#endif\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",
linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"};b.UniformsUtils={merge:function(a){var b,c,e,f={};for(b=0;b<a.length;b++){e=this.clone(a[b]);for(c in e)f[c]=e[c]}return f},clone:function(a){var d,c,e,f={};for(d in a){f[d]={};for(c in a[d]){e=a[d][c];f[d][c]=e instanceof b.Color||e instanceof b.Vector2||e instanceof b.Vector3||e instanceof b.Vector4||e instanceof b.Matrix4||e instanceof b.Texture?e.clone():e instanceof Array?e.slice():e}}return f}};
b.UniformsLib={common:{diffuse:{type:"c",value:new b.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new b.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new b.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",
value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new b.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new b.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",
value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};b.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},
normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.fog,b.UniformsLib.shadowmap]),vertexShader:[b.ShaderChunk.map_pars_vertex,
b.ShaderChunk.lightmap_pars_vertex,b.ShaderChunk.envmap_pars_vertex,b.ShaderChunk.color_pars_vertex,b.ShaderChunk.skinning_pars_vertex,b.ShaderChunk.morphtarget_pars_vertex,b.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",b.ShaderChunk.map_vertex,b.ShaderChunk.lightmap_vertex,b.ShaderChunk.envmap_vertex,b.ShaderChunk.color_vertex,b.ShaderChunk.skinning_vertex,b.ShaderChunk.morphtarget_vertex,b.ShaderChunk.default_vertex,b.ShaderChunk.shadowmap_vertex,
"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",b.ShaderChunk.color_pars_fragment,b.ShaderChunk.map_pars_fragment,b.ShaderChunk.lightmap_pars_fragment,b.ShaderChunk.envmap_pars_fragment,b.ShaderChunk.fog_pars_fragment,b.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",b.ShaderChunk.map_fragment,b.ShaderChunk.alphatest_fragment,b.ShaderChunk.lightmap_fragment,b.ShaderChunk.color_fragment,b.ShaderChunk.envmap_fragment,b.ShaderChunk.shadowmap_fragment,
b.ShaderChunk.linear_to_gamma_fragment,b.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.fog,b.UniformsLib.lights,b.UniformsLib.shadowmap,{ambient:{type:"c",value:new b.Color(16777215)},emissive:{type:"c",value:new b.Color(0)},wrapRGB:{type:"v3",value:new b.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",b.ShaderChunk.map_pars_vertex,b.ShaderChunk.lightmap_pars_vertex,
b.ShaderChunk.envmap_pars_vertex,b.ShaderChunk.lights_lambert_pars_vertex,b.ShaderChunk.color_pars_vertex,b.ShaderChunk.skinning_pars_vertex,b.ShaderChunk.morphtarget_pars_vertex,b.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",b.ShaderChunk.map_vertex,b.ShaderChunk.lightmap_vertex,b.ShaderChunk.envmap_vertex,b.ShaderChunk.color_vertex,b.ShaderChunk.morphnormal_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif",
b.ShaderChunk.lights_lambert_vertex,b.ShaderChunk.skinning_vertex,b.ShaderChunk.morphtarget_vertex,b.ShaderChunk.default_vertex,b.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",b.ShaderChunk.color_pars_fragment,b.ShaderChunk.map_pars_fragment,b.ShaderChunk.lightmap_pars_fragment,b.ShaderChunk.envmap_pars_fragment,b.ShaderChunk.fog_pars_fragment,b.ShaderChunk.shadowmap_pars_fragment,
"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",b.ShaderChunk.map_fragment,b.ShaderChunk.alphatest_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",b.ShaderChunk.lightmap_fragment,b.ShaderChunk.color_fragment,b.ShaderChunk.envmap_fragment,b.ShaderChunk.shadowmap_fragment,b.ShaderChunk.linear_to_gamma_fragment,b.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,
b.UniformsLib.fog,b.UniformsLib.lights,b.UniformsLib.shadowmap,{ambient:{type:"c",value:new b.Color(16777215)},emissive:{type:"c",value:new b.Color(0)},specular:{type:"c",value:new b.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new b.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",b.ShaderChunk.map_pars_vertex,b.ShaderChunk.lightmap_pars_vertex,b.ShaderChunk.envmap_pars_vertex,b.ShaderChunk.lights_phong_pars_vertex,b.ShaderChunk.color_pars_vertex,
b.ShaderChunk.skinning_pars_vertex,b.ShaderChunk.morphtarget_pars_vertex,b.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",b.ShaderChunk.map_vertex,b.ShaderChunk.lightmap_vertex,b.ShaderChunk.envmap_vertex,b.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;",b.ShaderChunk.morphnormal_vertex,"vNormal = transformedNormal;",b.ShaderChunk.lights_phong_vertex,
b.ShaderChunk.skinning_vertex,b.ShaderChunk.morphtarget_vertex,b.ShaderChunk.default_vertex,b.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",b.ShaderChunk.color_pars_fragment,b.ShaderChunk.map_pars_fragment,b.ShaderChunk.lightmap_pars_fragment,b.ShaderChunk.envmap_pars_fragment,b.ShaderChunk.fog_pars_fragment,b.ShaderChunk.lights_phong_pars_fragment,
b.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",b.ShaderChunk.map_fragment,b.ShaderChunk.alphatest_fragment,b.ShaderChunk.lights_phong_fragment,b.ShaderChunk.lightmap_fragment,b.ShaderChunk.color_fragment,b.ShaderChunk.envmap_fragment,b.ShaderChunk.shadowmap_fragment,b.ShaderChunk.linear_to_gamma_fragment,b.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:b.UniformsUtils.merge([b.UniformsLib.particle,b.UniformsLib.shadowmap]),
vertexShader:["uniform float size;\nuniform float scale;",b.ShaderChunk.color_pars_vertex,b.ShaderChunk.shadowmap_pars_vertex,"void main() {",b.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",b.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",
b.ShaderChunk.color_pars_fragment,b.ShaderChunk.map_particle_pars_fragment,b.ShaderChunk.fog_pars_fragment,b.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",b.ShaderChunk.map_particle_fragment,b.ShaderChunk.alphatest_fragment,b.ShaderChunk.color_fragment,b.ShaderChunk.shadowmap_fragment,b.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[b.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",
b.ShaderChunk.morphtarget_vertex,b.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}};b.WebGLRenderer=function(a){function d(a,b){var d=a.vertices.length,
c=b.material;if(c.attributes){if(a.__webglCustomAttributesList===void 0)a.__webglCustomAttributesList=[];for(var e in c.attributes){var f=c.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=true;var g=1;f.type==="v2"?g=2:f.type==="v3"?g=3:f.type==="v4"?g=4:f.type==="c"&&(g=3);f.size=g;f.array=new Float32Array(d*g);f.buffer=k.createBuffer();f.buffer.belongsToAttribute=e;f.needsUpdate=true}a.__webglCustomAttributesList.push(f)}}}function c(a,d){if(a.material&&!(a.material instanceof
b.MeshFaceMaterial))return a.material;if(d.materialIndex>=0)return a.geometry.materials[d.materialIndex]}function e(a){return a instanceof b.MeshBasicMaterial&&!a.envMap||a instanceof b.MeshDepthMaterial?false:a&&a.shading!==void 0&&a.shading===b.SmoothShading?b.SmoothShading:b.FlatShading}function f(a){return a.map||a.lightMap||a instanceof b.ShaderMaterial?true:false}function g(a,b,d){var c,e,f,g,h=a.vertices;g=h.length;var i=a.colors,j=i.length,l=a.__vertexArray,m=a.__colorArray,n=a.__sortArray,
o=a.verticesNeedUpdate,p=a.colorsNeedUpdate,q=a.__webglCustomAttributesList;if(d.sortParticles){xa.copy(hb);xa.multiplySelf(d.matrixWorld);for(c=0;c<g;c++){e=h[c];Pa.copy(e);xa.multiplyVector3(Pa);n[c]=[Pa.z,c]}n.sort(function(a,b){return b[0]-a[0]});for(c=0;c<g;c++){e=h[n[c][1]];f=c*3;l[f]=e.x;l[f+1]=e.y;l[f+2]=e.z}for(c=0;c<j;c++){f=c*3;e=i[n[c][1]];m[f]=e.r;m[f+1]=e.g;m[f+2]=e.b}if(q){i=0;for(j=q.length;i<j;i++){h=q[i];if(h.boundTo===void 0||h.boundTo==="vertices"){f=0;e=h.value.length;if(h.size===
1)for(c=0;c<e;c++){g=n[c][1];h.array[c]=h.value[g]}else if(h.size===2)for(c=0;c<e;c++){g=n[c][1];g=h.value[g];h.array[f]=g.x;h.array[f+1]=g.y;f=f+2}else if(h.size===3)if(h.type==="c")for(c=0;c<e;c++){g=n[c][1];g=h.value[g];h.array[f]=g.r;h.array[f+1]=g.g;h.array[f+2]=g.b;f=f+3}else for(c=0;c<e;c++){g=n[c][1];g=h.value[g];h.array[f]=g.x;h.array[f+1]=g.y;h.array[f+2]=g.z;f=f+3}else if(h.size===4)for(c=0;c<e;c++){g=n[c][1];g=h.value[g];h.array[f]=g.x;h.array[f+1]=g.y;h.array[f+2]=g.z;h.array[f+3]=g.w;
f=f+4}}}}}else{if(o)for(c=0;c<g;c++){e=h[c];f=c*3;l[f]=e.x;l[f+1]=e.y;l[f+2]=e.z}if(p)for(c=0;c<j;c++){e=i[c];f=c*3;m[f]=e.r;m[f+1]=e.g;m[f+2]=e.b}if(q){i=0;for(j=q.length;i<j;i++){h=q[i];if(h.needsUpdate&&(h.boundTo===void 0||h.boundTo==="vertices")){e=h.value.length;f=0;if(h.size===1)for(c=0;c<e;c++)h.array[c]=h.value[c];else if(h.size===2)for(c=0;c<e;c++){g=h.value[c];h.array[f]=g.x;h.array[f+1]=g.y;f=f+2}else if(h.size===3)if(h.type==="c")for(c=0;c<e;c++){g=h.value[c];h.array[f]=g.r;h.array[f+
1]=g.g;h.array[f+2]=g.b;f=f+3}else for(c=0;c<e;c++){g=h.value[c];h.array[f]=g.x;h.array[f+1]=g.y;h.array[f+2]=g.z;f=f+3}else if(h.size===4)for(c=0;c<e;c++){g=h.value[c];h.array[f]=g.x;h.array[f+1]=g.y;h.array[f+2]=g.z;h.array[f+3]=g.w;f=f+4}}}}}if(o||d.sortParticles){k.bindBuffer(k.ARRAY_BUFFER,a.__webglVertexBuffer);k.bufferData(k.ARRAY_BUFFER,l,b)}if(p||d.sortParticles){k.bindBuffer(k.ARRAY_BUFFER,a.__webglColorBuffer);k.bufferData(k.ARRAY_BUFFER,m,b)}if(q){i=0;for(j=q.length;i<j;i++){h=q[i];if(h.needsUpdate||
d.sortParticles){k.bindBuffer(k.ARRAY_BUFFER,h.buffer);k.bufferData(k.ARRAY_BUFFER,h.array,b)}}}}function h(a,b){return b.z-a.z}function i(a,b){return b[1]-a[1]}function j(a,b,d){if(a.length)for(var c=0,e=a.length;c<e;c++){ga=T=null;L=da=aa=$=pa=Oa=Y=-1;ma=true;a[c].render(b,d,bb,Ca);ga=T=null;L=da=aa=$=pa=Oa=Y=-1;ma=true}}function l(a,d,c,e,f,g,h,i){var k,j,l,m;if(d){j=a.length-1;m=d=-1}else{j=0;d=a.length;m=1}for(var n=j;n!==d;n=n+m){k=a[n];if(k.render){j=k.object;l=k.buffer;if(i)k=i;else{k=k[c];
if(!k)continue;h&&E.setBlending(k.blending,k.blendEquation,k.blendSrc,k.blendDst);E.setDepthTest(k.depthTest);E.setDepthWrite(k.depthWrite);v(k.polygonOffset,k.polygonOffsetFactor,k.polygonOffsetUnits)}E.setObjectFaces(j);l instanceof b.BufferGeometry?E.renderBufferDirect(e,f,g,k,l,j):E.renderBuffer(e,f,g,k,l,j)}}}function m(a,b,d,c,e,f,g){for(var h,i,k=0,j=a.length;k<j;k++){h=a[k];i=h.object;if(i.visible){if(g)h=g;else{h=h[b];if(!h)continue;f&&E.setBlending(h.blending,h.blendEquation,h.blendSrc,
h.blendDst);E.setDepthTest(h.depthTest);E.setDepthWrite(h.depthWrite);v(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}E.renderImmediateObject(d,c,e,h,i)}}}function p(a,b,d){a.push({buffer:b,object:d,opaque:null,transparent:null})}function n(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return true;return false}function q(a){for(var b in a.attributes)a.attributes[b].needsUpdate=false}function s(a,b){for(var d=a.length-1;d>=0;d--)a[d].object===b&&a.splice(d,1)}function o(a,
b){for(var d=a.length-1;d>=0;d--)a[d]===b&&a.splice(d,1)}function r(a,d,c,e,f){if(e.needsUpdate){e.program&&E.deallocateMaterial(e);E.initMaterial(e,d,c,f);e.needsUpdate=false}if(e.morphTargets&&!f.__webglMorphTargetInfluences)f.__webglMorphTargetInfluences=new Float32Array(E.maxMorphTargets);var g=false,h=e.program,i=h.uniforms,j=e.uniforms;if(h!==T){k.useProgram(h);T=h;g=true}if(e.id!==L){L=e.id;g=true}if(g||a!==ga){k.uniformMatrix4fv(i.projectionMatrix,false,a._projectionMatrixArray);a!==ga&&(ga=
a)}if(g){if(c&&e.fog){j.fogColor.value=c.color;if(c instanceof b.Fog){j.fogNear.value=c.near;j.fogFar.value=c.far}else if(c instanceof b.FogExp2)j.fogDensity.value=c.density}if(e instanceof b.MeshPhongMaterial||e instanceof b.MeshLambertMaterial||e.lights){if(ma){for(var l,m=0,n=0,o=0,p,q,s,r=pb,u=r.directional.colors,v=r.directional.positions,w=r.point.colors,x=r.point.positions,y=r.point.distances,G=r.spot.colors,C=r.spot.positions,I=r.spot.distances,$=r.spot.directions,J=r.spot.angles,H=r.spot.exponents,
O=0,N=0,Y=0,P=s=0,c=P=0,g=d.length;c<g;c++){l=d[c];if(!l.onlyShadow&&l.visible){p=l.color;q=l.intensity;s=l.distance;if(l instanceof b.AmbientLight)if(E.gammaInput){m=m+p.r*p.r;n=n+p.g*p.g;o=o+p.b*p.b}else{m=m+p.r;n=n+p.g;o=o+p.b}else if(l instanceof b.DirectionalLight){s=O*3;if(E.gammaInput){u[s]=p.r*p.r*q*q;u[s+1]=p.g*p.g*q*q;u[s+2]=p.b*p.b*q*q}else{u[s]=p.r*q;u[s+1]=p.g*q;u[s+2]=p.b*q}Ea.copy(l.matrixWorld.getPosition());Ea.subSelf(l.target.matrixWorld.getPosition());Ea.normalize();v[s]=Ea.x;v[s+
1]=Ea.y;v[s+2]=Ea.z;O=O+1}else if(l instanceof b.PointLight){P=N*3;if(E.gammaInput){w[P]=p.r*p.r*q*q;w[P+1]=p.g*p.g*q*q;w[P+2]=p.b*p.b*q*q}else{w[P]=p.r*q;w[P+1]=p.g*q;w[P+2]=p.b*q}p=l.matrixWorld.getPosition();x[P]=p.x;x[P+1]=p.y;x[P+2]=p.z;y[N]=s;N=N+1}else if(l instanceof b.SpotLight){P=Y*3;if(E.gammaInput){G[P]=p.r*p.r*q*q;G[P+1]=p.g*p.g*q*q;G[P+2]=p.b*p.b*q*q}else{G[P]=p.r*q;G[P+1]=p.g*q;G[P+2]=p.b*q}p=l.matrixWorld.getPosition();C[P]=p.x;C[P+1]=p.y;C[P+2]=p.z;I[Y]=s;Ea.copy(p);Ea.subSelf(l.target.matrixWorld.getPosition());
Ea.normalize();$[P]=Ea.x;$[P+1]=Ea.y;$[P+2]=Ea.z;J[Y]=Math.cos(l.angle);H[Y]=l.exponent;Y=Y+1}}}c=O*3;for(g=u.length;c<g;c++)u[c]=0;c=N*3;for(g=w.length;c<g;c++)w[c]=0;c=Y*3;for(g=G.length;c<g;c++)G[c]=0;r.directional.length=O;r.point.length=N;r.spot.length=Y;r.ambient[0]=m;r.ambient[1]=n;r.ambient[2]=o;ma=false}c=pb;j.ambientLightColor.value=c.ambient;j.directionalLightColor.value=c.directional.colors;j.directionalLightDirection.value=c.directional.positions;j.pointLightColor.value=c.point.colors;
j.pointLightPosition.value=c.point.positions;j.pointLightDistance.value=c.point.distances;j.spotLightColor.value=c.spot.colors;j.spotLightPosition.value=c.spot.positions;j.spotLightDistance.value=c.spot.distances;j.spotLightDirection.value=c.spot.directions;j.spotLightAngle.value=c.spot.angles;j.spotLightExponent.value=c.spot.exponents}if(e instanceof b.MeshBasicMaterial||e instanceof b.MeshLambertMaterial||e instanceof b.MeshPhongMaterial){j.opacity.value=e.opacity;E.gammaInput?j.diffuse.value.copyGammaToLinear(e.color):
j.diffuse.value=e.color;(j.map.texture=e.map)&&j.offsetRepeat.value.set(e.map.offset.x,e.map.offset.y,e.map.repeat.x,e.map.repeat.y);j.lightMap.texture=e.lightMap;j.envMap.texture=e.envMap;j.flipEnvMap.value=e.envMap instanceof b.WebGLRenderTargetCube?1:-1;j.reflectivity.value=e.reflectivity;j.refractionRatio.value=e.refractionRatio;j.combine.value=e.combine;j.useRefract.value=e.envMap&&e.envMap.mapping instanceof b.CubeRefractionMapping}if(e instanceof b.LineBasicMaterial){j.diffuse.value=e.color;
j.opacity.value=e.opacity}else if(e instanceof b.ParticleBasicMaterial){j.psColor.value=e.color;j.opacity.value=e.opacity;j.size.value=e.size;j.scale.value=B.height/2;j.map.texture=e.map}else if(e instanceof b.MeshPhongMaterial){j.shininess.value=e.shininess;if(E.gammaInput){j.ambient.value.copyGammaToLinear(e.ambient);j.emissive.value.copyGammaToLinear(e.emissive);j.specular.value.copyGammaToLinear(e.specular)}else{j.ambient.value=e.ambient;j.emissive.value=e.emissive;j.specular.value=e.specular}e.wrapAround&&
j.wrapRGB.value.copy(e.wrapRGB)}else if(e instanceof b.MeshLambertMaterial){if(E.gammaInput){j.ambient.value.copyGammaToLinear(e.ambient);j.emissive.value.copyGammaToLinear(e.emissive)}else{j.ambient.value=e.ambient;j.emissive.value=e.emissive}e.wrapAround&&j.wrapRGB.value.copy(e.wrapRGB)}else if(e instanceof b.MeshDepthMaterial){j.mNear.value=a.near;j.mFar.value=a.far;j.opacity.value=e.opacity}else if(e instanceof b.MeshNormalMaterial)j.opacity.value=e.opacity;if(f.receiveShadow&&!e._shadowPass&&
j.shadowMatrix){g=c=0;for(l=d.length;g<l;g++){m=d[g];if(m.castShadow&&(m instanceof b.SpotLight||m instanceof b.DirectionalLight&&!m.shadowCascade)){j.shadowMap.texture[c]=m.shadowMap;j.shadowMapSize.value[c]=m.shadowMapSize;j.shadowMatrix.value[c]=m.shadowMatrix;j.shadowDarkness.value[c]=m.shadowDarkness;j.shadowBias.value[c]=m.shadowBias;c++}}}d=e.uniformsList;j=0;for(c=d.length;j<c;j++)if(m=h.uniforms[d[j][1]]){g=d[j][0];n=g.type;l=g.value;switch(n){case "i":k.uniform1i(m,l);break;case "f":k.uniform1f(m,
l);break;case "v2":k.uniform2f(m,l.x,l.y);break;case "v3":k.uniform3f(m,l.x,l.y,l.z);break;case "v4":k.uniform4f(m,l.x,l.y,l.z,l.w);break;case "c":k.uniform3f(m,l.r,l.g,l.b);break;case "fv1":k.uniform1fv(m,l);break;case "fv":k.uniform3fv(m,l);break;case "v2v":if(!g._array)g._array=new Float32Array(2*l.length);n=0;for(o=l.length;n<o;n++){r=n*2;g._array[r]=l[n].x;g._array[r+1]=l[n].y}k.uniform2fv(m,g._array);break;case "v3v":if(!g._array)g._array=new Float32Array(3*l.length);n=0;for(o=l.length;n<o;n++){r=
n*3;g._array[r]=l[n].x;g._array[r+1]=l[n].y;g._array[r+2]=l[n].z}k.uniform3fv(m,g._array);break;case "v4v":if(!g._array)g._array=new Float32Array(4*l.length);n=0;for(o=l.length;n<o;n++){r=n*4;g._array[r]=l[n].x;g._array[r+1]=l[n].y;g._array[r+2]=l[n].z;g._array[r+3]=l[n].w}k.uniform4fv(m,g._array);break;case "m4":if(!g._array)g._array=new Float32Array(16);l.flattenToArray(g._array);k.uniformMatrix4fv(m,false,g._array);break;case "m4v":if(!g._array)g._array=new Float32Array(16*l.length);n=0;for(o=
l.length;n<o;n++)l[n].flattenToArrayOffset(g._array,n*16);k.uniformMatrix4fv(m,false,g._array);break;case "t":k.uniform1i(m,l);m=g.texture;if(!m)continue;if(m.image instanceof Array&&m.image.length===6){g=m;if(g.image.length===6)if(g.needsUpdate){if(!g.image.__webglTextureCube)g.image.__webglTextureCube=k.createTexture();k.activeTexture(k.TEXTURE0+l);k.bindTexture(k.TEXTURE_CUBE_MAP,g.image.__webglTextureCube);l=[];for(m=0;m<6;m++){n=l;o=m;if(E.autoScaleCubemaps){r=g.image[m];v=bc;if(!(r.width<=v&&
r.height<=v)){w=Math.max(r.width,r.height);u=Math.floor(r.width*v/w);v=Math.floor(r.height*v/w);w=document.createElement("canvas");w.width=u;w.height=v;w.getContext("2d").drawImage(r,0,0,r.width,r.height,0,0,u,v);r=w}}else r=g.image[m];n[o]=r}m=l[0];n=(m.width&m.width-1)===0&&(m.height&m.height-1)===0;o=D(g.format);r=D(g.type);t(k.TEXTURE_CUBE_MAP,g,n);for(m=0;m<6;m++)k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,o,o,r,l[m]);g.generateMipmaps&&n&&k.generateMipmap(k.TEXTURE_CUBE_MAP);g.needsUpdate=
false;if(g.onUpdate)g.onUpdate()}else{k.activeTexture(k.TEXTURE0+l);k.bindTexture(k.TEXTURE_CUBE_MAP,g.image.__webglTextureCube)}}else if(m instanceof b.WebGLRenderTargetCube){g=m;k.activeTexture(k.TEXTURE0+l);k.bindTexture(k.TEXTURE_CUBE_MAP,g.__webglTexture)}else E.setTexture(m,l);break;case "tv":if(!g._array){g._array=[];n=0;for(o=g.texture.length;n<o;n++)g._array[n]=l+n}k.uniform1iv(m,g._array);n=0;for(o=g.texture.length;n<o;n++)(m=g.texture[n])&&E.setTexture(m,g._array[n])}}if((e instanceof b.ShaderMaterial||
e instanceof b.MeshPhongMaterial||e.envMap)&&i.cameraPosition!==null){d=a.matrixWorld.getPosition();k.uniform3f(i.cameraPosition,d.x,d.y,d.z)}(e instanceof b.MeshPhongMaterial||e instanceof b.MeshLambertMaterial||e instanceof b.ShaderMaterial||e.skinning)&&i.viewMatrix!==null&&k.uniformMatrix4fv(i.viewMatrix,false,a._viewMatrixArray);e.skinning&&k.uniformMatrix4fv(i.boneGlobalMatrices,false,f.boneMatrices)}k.uniformMatrix4fv(i.modelViewMatrix,false,f._modelViewMatrix.elements);i.normalMatrix&&k.uniformMatrix3fv(i.normalMatrix,
false,f._normalMatrix.elements);i.objectMatrix!==null&&k.uniformMatrix4fv(i.objectMatrix,false,f.matrixWorld.elements);return h}function u(a,b){a._modelViewMatrix.multiply(b.matrixWorldInverse,a.matrixWorld);a._normalMatrix.getInverse(a._modelViewMatrix);a._normalMatrix.transpose()}function v(a,b,d){if(Ua!==a){a?k.enable(k.POLYGON_OFFSET_FILL):k.disable(k.POLYGON_OFFSET_FILL);Ua=a}if(a&&(fb!==b||gb!==d)){k.polygonOffset(b,d);fb=b;gb=d}}function x(a,b){var d;a==="fragment"?d=k.createShader(k.FRAGMENT_SHADER):
a==="vertex"&&(d=k.createShader(k.VERTEX_SHADER));k.shaderSource(d,b);k.compileShader(d);if(!k.getShaderParameter(d,k.COMPILE_STATUS)){console.error(k.getShaderInfoLog(d));console.error(b);return null}return d}function t(a,b,d){if(d){k.texParameteri(a,k.TEXTURE_WRAP_S,D(b.wrapS));k.texParameteri(a,k.TEXTURE_WRAP_T,D(b.wrapT));k.texParameteri(a,k.TEXTURE_MAG_FILTER,D(b.magFilter));k.texParameteri(a,k.TEXTURE_MIN_FILTER,D(b.minFilter))}else{k.texParameteri(a,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(a,
k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.texParameteri(a,k.TEXTURE_MAG_FILTER,G(b.magFilter));k.texParameteri(a,k.TEXTURE_MIN_FILTER,G(b.minFilter))}}function y(a,b){k.bindRenderbuffer(k.RENDERBUFFER,a);if(b.depthBuffer&&!b.stencilBuffer){k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_COMPONENT16,b.width,b.height);k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,k.RENDERBUFFER,a)}else if(b.depthBuffer&&b.stencilBuffer){k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_STENCIL,b.width,b.height);k.framebufferRenderbuffer(k.FRAMEBUFFER,
k.DEPTH_STENCIL_ATTACHMENT,k.RENDERBUFFER,a)}else k.renderbufferStorage(k.RENDERBUFFER,k.RGBA4,b.width,b.height)}function G(a){switch(a){case b.NearestFilter:case b.NearestMipMapNearestFilter:case b.NearestMipMapLinearFilter:return k.NEAREST;default:return k.LINEAR}}function D(a){switch(a){case b.RepeatWrapping:return k.REPEAT;case b.ClampToEdgeWrapping:return k.CLAMP_TO_EDGE;case b.MirroredRepeatWrapping:return k.MIRRORED_REPEAT;case b.NearestFilter:return k.NEAREST;case b.NearestMipMapNearestFilter:return k.NEAREST_MIPMAP_NEAREST;
case b.NearestMipMapLinearFilter:return k.NEAREST_MIPMAP_LINEAR;case b.LinearFilter:return k.LINEAR;case b.LinearMipMapNearestFilter:return k.LINEAR_MIPMAP_NEAREST;case b.LinearMipMapLinearFilter:return k.LINEAR_MIPMAP_LINEAR;case b.UnsignedByteType:return k.UNSIGNED_BYTE;case b.UnsignedShort4444Type:return k.UNSIGNED_SHORT_4_4_4_4;case b.UnsignedShort5551Type:return k.UNSIGNED_SHORT_5_5_5_1;case b.UnsignedShort565Type:return k.UNSIGNED_SHORT_5_6_5;case b.ByteType:return k.BYTE;case b.ShortType:return k.SHORT;
case b.UnsignedShortType:return k.UNSIGNED_SHORT;case b.IntType:return k.INT;case b.UnsignedIntType:return k.UNSIGNED_INT;case b.FloatType:return k.FLOAT;case b.AlphaFormat:return k.ALPHA;case b.RGBFormat:return k.RGB;case b.RGBAFormat:return k.RGBA;case b.LuminanceFormat:return k.LUMINANCE;case b.LuminanceAlphaFormat:return k.LUMINANCE_ALPHA;case b.AddEquation:return k.FUNC_ADD;case b.SubtractEquation:return k.FUNC_SUBTRACT;case b.ReverseSubtractEquation:return k.FUNC_REVERSE_SUBTRACT;case b.ZeroFactor:return k.ZERO;
case b.OneFactor:return k.ONE;case b.SrcColorFactor:return k.SRC_COLOR;case b.OneMinusSrcColorFactor:return k.ONE_MINUS_SRC_COLOR;case b.SrcAlphaFactor:return k.SRC_ALPHA;case b.OneMinusSrcAlphaFactor:return k.ONE_MINUS_SRC_ALPHA;case b.DstAlphaFactor:return k.DST_ALPHA;case b.OneMinusDstAlphaFactor:return k.ONE_MINUS_DST_ALPHA;case b.DstColorFactor:return k.DST_COLOR;case b.OneMinusDstColorFactor:return k.ONE_MINUS_DST_COLOR;case b.SrcAlphaSaturateFactor:return k.SRC_ALPHA_SATURATE}return 0}console.log("THREE.WebGLRenderer",
b.REVISION);var a=a||{},B=a.canvas!==void 0?a.canvas:document.createElement("canvas"),w=a.precision!==void 0?a.precision:"highp",I=a.alpha!==void 0?a.alpha:true,J=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:true,O=a.antialias!==void 0?a.antialias:false,S=a.stencil!==void 0?a.stencil:true,Z=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:false,C=a.clearColor!==void 0?new b.Color(a.clearColor):new b.Color(0),H=a.clearAlpha!==void 0?a.clearAlpha:0,R=a.maxLights!==void 0?a.maxLights:4;
this.domElement=B;this.context=null;this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=true;this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=false;this.shadowMapCullFrontFaces=this.shadowMapSoft=this.shadowMapAutoUpdate=true;this.shadowMapCascade=this.shadowMapDebug=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.renderPluginsPre=[];this.renderPluginsPost=
[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var E=this,k,Q=[],N=0,T=null,ba=null,L=-1,da=null,ga=null,P=0,$=-1,aa=-1,Y=-1,ia=-1,Ta=-1,Ma=-1,Oa=-1,pa=-1,Ua=null,fb=null,gb=null,$a=null,Mb=0,nb=0,kb=0,ob=0,bb=0,Ca=0,za=new b.Frustum,hb=new b.Matrix4,xa=new b.Matrix4,Pa=new b.Vector4,Ea=new b.Vector3,ma=true,pb={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,
colors:[],positions:[],distances:[],directions:[],angles:[],exponents:[]}};k=function(){var a;try{if(!(a=B.getContext("experimental-webgl",{alpha:I,premultipliedAlpha:J,antialias:O,stencil:S,preserveDrawingBuffer:Z})))throw"Error creating WebGL context.";}catch(b){console.error(b)}a.getExtension("OES_texture_float")||console.log("THREE.WebGLRenderer: Float textures not supported.");return a}();k.clearColor(0,0,0,1);k.clearDepth(1);k.clearStencil(0);k.enable(k.DEPTH_TEST);k.depthFunc(k.LEQUAL);k.frontFace(k.CCW);
k.cullFace(k.BACK);k.enable(k.CULL_FACE);k.enable(k.BLEND);k.blendEquation(k.FUNC_ADD);k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA);k.clearColor(C.r,C.g,C.b,H);this.context=k;var ab=k.getParameter(k.MAX_VERTEX_TEXTURE_IMAGE_UNITS);k.getParameter(k.MAX_TEXTURE_SIZE);var bc=k.getParameter(k.MAX_CUBE_MAP_TEXTURE_SIZE);this.getContext=function(){return k};this.supportsVertexTextures=function(){return ab>0};this.setSize=function(a,b){B.width=a;B.height=b;this.setViewport(0,0,B.width,B.height)};this.setViewport=
function(a,b,d,c){Mb=a;nb=b;kb=d;ob=c;k.viewport(Mb,nb,kb,ob)};this.setScissor=function(a,b,d,c){k.scissor(a,b,d,c)};this.enableScissorTest=function(a){a?k.enable(k.SCISSOR_TEST):k.disable(k.SCISSOR_TEST)};this.setClearColorHex=function(a,b){C.setHex(a);H=b;k.clearColor(C.r,C.g,C.b,H)};this.setClearColor=function(a,b){C.copy(a);H=b;k.clearColor(C.r,C.g,C.b,H)};this.getClearColor=function(){return C};this.getClearAlpha=function(){return H};this.clear=function(a,b,d){var c=0;if(a===void 0||a)c=c|k.COLOR_BUFFER_BIT;
if(b===void 0||b)c=c|k.DEPTH_BUFFER_BIT;if(d===void 0||d)c=c|k.STENCIL_BUFFER_BIT;k.clear(c)};this.clearTarget=function(a,b,d,c){this.setRenderTarget(a);this.clear(b,d,c)};this.addPostPlugin=function(a){a.init(this);this.renderPluginsPost.push(a)};this.addPrePlugin=function(a){a.init(this);this.renderPluginsPre.push(a)};this.deallocateObject=function(a){if(a.__webglInit){a.__webglInit=false;delete a._modelViewMatrix;delete a._normalMatrix;delete a._normalMatrixArray;delete a._modelViewMatrixArray;
delete a._objectMatrixArray;if(a instanceof b.Mesh)for(var d in a.geometry.geometryGroups){var c=a.geometry.geometryGroups[d];k.deleteBuffer(c.__webglVertexBuffer);k.deleteBuffer(c.__webglNormalBuffer);k.deleteBuffer(c.__webglTangentBuffer);k.deleteBuffer(c.__webglColorBuffer);k.deleteBuffer(c.__webglUVBuffer);k.deleteBuffer(c.__webglUV2Buffer);k.deleteBuffer(c.__webglSkinVertexABuffer);k.deleteBuffer(c.__webglSkinVertexBBuffer);k.deleteBuffer(c.__webglSkinIndicesBuffer);k.deleteBuffer(c.__webglSkinWeightsBuffer);
k.deleteBuffer(c.__webglFaceBuffer);k.deleteBuffer(c.__webglLineBuffer);var e=void 0,f=void 0;if(c.numMorphTargets){e=0;for(f=c.numMorphTargets;e<f;e++)k.deleteBuffer(c.__webglMorphTargetsBuffers[e])}if(c.numMorphNormals){e=0;for(f=c.numMorphNormals;e<f;e++)k.deleteBuffer(c.__webglMorphNormalsBuffers[e])}if(c.__webglCustomAttributesList){e=void 0;for(e in c.__webglCustomAttributesList)k.deleteBuffer(c.__webglCustomAttributesList[e].buffer)}E.info.memory.geometries--}else if(a instanceof b.Ribbon){a=
a.geometry;k.deleteBuffer(a.__webglVertexBuffer);k.deleteBuffer(a.__webglColorBuffer);E.info.memory.geometries--}else if(a instanceof b.Line){a=a.geometry;k.deleteBuffer(a.__webglVertexBuffer);k.deleteBuffer(a.__webglColorBuffer);E.info.memory.geometries--}else if(a instanceof b.ParticleSystem){a=a.geometry;k.deleteBuffer(a.__webglVertexBuffer);k.deleteBuffer(a.__webglColorBuffer);E.info.memory.geometries--}}};this.deallocateTexture=function(a){if(a.__webglInit){a.__webglInit=false;k.deleteTexture(a.__webglTexture);
E.info.memory.textures--}};this.deallocateRenderTarget=function(a){if(a&&a.__webglTexture){k.deleteTexture(a.__webglTexture);if(a instanceof b.WebGLRenderTargetCube)for(var d=0;d<6;d++){k.deleteFramebuffer(a.__webglFramebuffer[d]);k.deleteRenderbuffer(a.__webglRenderbuffer[d])}else{k.deleteFramebuffer(a.__webglFramebuffer);k.deleteRenderbuffer(a.__webglRenderbuffer)}}};this.deallocateMaterial=function(a){var b=a.program;if(b){a.program=void 0;var d,c,e=false,a=0;for(d=Q.length;a<d;a++){c=Q[a];if(c.program===
b){c.usedTimes--;c.usedTimes===0&&(e=true);break}}if(e){e=[];a=0;for(d=Q.length;a<d;a++){c=Q[a];c.program!==b&&e.push(c)}Q=e;k.deleteProgram(b);E.info.memory.programs--}}};this.updateShadowMap=function(a,b){T=null;L=da=pa=Oa=Y=-1;ma=true;aa=$=-1;this.shadowMapPlugin.update(a,b)};this.renderBufferImmediate=function(a,d,c){if(a.hasPositions&&!a.__webglVertexBuffer)a.__webglVertexBuffer=k.createBuffer();if(a.hasNormals&&!a.__webglNormalBuffer)a.__webglNormalBuffer=k.createBuffer();if(a.hasUvs&&!a.__webglUvBuffer)a.__webglUvBuffer=
k.createBuffer();if(a.hasColors&&!a.__webglColorBuffer)a.__webglColorBuffer=k.createBuffer();if(a.hasPositions){k.bindBuffer(k.ARRAY_BUFFER,a.__webglVertexBuffer);k.bufferData(k.ARRAY_BUFFER,a.positionArray,k.DYNAMIC_DRAW);k.enableVertexAttribArray(d.attributes.position);k.vertexAttribPointer(d.attributes.position,3,k.FLOAT,false,0,0)}if(a.hasNormals){k.bindBuffer(k.ARRAY_BUFFER,a.__webglNormalBuffer);if(c.shading===b.FlatShading){var e,f,g,h,i,j,l,m,n,o,p,q=a.count*3;for(p=0;p<q;p=p+9){o=a.normalArray;
e=o[p];f=o[p+1];g=o[p+2];h=o[p+3];j=o[p+4];m=o[p+5];i=o[p+6];l=o[p+7];n=o[p+8];e=(e+h+i)/3;f=(f+j+l)/3;g=(g+m+n)/3;o[p]=e;o[p+1]=f;o[p+2]=g;o[p+3]=e;o[p+4]=f;o[p+5]=g;o[p+6]=e;o[p+7]=f;o[p+8]=g}}k.bufferData(k.ARRAY_BUFFER,a.normalArray,k.DYNAMIC_DRAW);k.enableVertexAttribArray(d.attributes.normal);k.vertexAttribPointer(d.attributes.normal,3,k.FLOAT,false,0,0)}if(a.hasUvs&&c.map){k.bindBuffer(k.ARRAY_BUFFER,a.__webglUvBuffer);k.bufferData(k.ARRAY_BUFFER,a.uvArray,k.DYNAMIC_DRAW);k.enableVertexAttribArray(d.attributes.uv);
k.vertexAttribPointer(d.attributes.uv,2,k.FLOAT,false,0,0)}if(a.hasColors&&c.vertexColors!==b.NoColors){k.bindBuffer(k.ARRAY_BUFFER,a.__webglColorBuffer);k.bufferData(k.ARRAY_BUFFER,a.colorArray,k.DYNAMIC_DRAW);k.enableVertexAttribArray(d.attributes.color);k.vertexAttribPointer(d.attributes.color,3,k.FLOAT,false,0,0)}k.drawArrays(k.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,d,c,e,f,g){if(e.visible!==false){c=r(a,d,c,e,g);a=c.attributes;d=false;e=f.id*16777215+c.id*2+(e.wireframe?
1:0);if(e!==da){da=e;d=true}if(g instanceof b.Mesh){g=f.offsets;e=0;for(c=g.length;e<c;++e){if(d){var h=f.vertexPositionBuffer.itemSize;k.bindBuffer(k.ARRAY_BUFFER,f.vertexPositionBuffer);k.vertexAttribPointer(a.position,h,k.FLOAT,false,0,g[e].index*h*4);if(a.normal>=0&&f.vertexNormalBuffer){h=f.vertexNormalBuffer.itemSize;k.bindBuffer(k.ARRAY_BUFFER,f.vertexNormalBuffer);k.vertexAttribPointer(a.normal,h,k.FLOAT,false,0,g[e].index*h*4)}if(a.uv>=0&&f.vertexUvBuffer)if(f.vertexUvBuffer){h=f.vertexUvBuffer.itemSize;
k.bindBuffer(k.ARRAY_BUFFER,f.vertexUvBuffer);k.vertexAttribPointer(a.uv,h,k.FLOAT,false,0,g[e].index*h*4);k.enableVertexAttribArray(a.uv)}else k.disableVertexAttribArray(a.uv);if(a.color>=0&&f.vertexColorBuffer){h=f.vertexColorBuffer.itemSize;k.bindBuffer(k.ARRAY_BUFFER,f.vertexColorBuffer);k.vertexAttribPointer(a.color,h,k.FLOAT,false,0,g[e].index*h*4)}k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,f.vertexIndexBuffer)}k.drawElements(k.TRIANGLES,g[e].count,k.UNSIGNED_SHORT,g[e].start*2);E.info.render.calls++;
E.info.render.vertices=E.info.render.vertices+g[e].count;E.info.render.faces=E.info.render.faces+g[e].count/3}}}};this.renderBuffer=function(a,d,c,e,f,g){if(e.visible!==false){var h,j,c=r(a,d,c,e,g),d=c.attributes,a=false,c=f.id*16777215+c.id*2+(e.wireframe?1:0);if(c!==da){da=c;a=true}if(!e.morphTargets&&d.position>=0){if(a){k.bindBuffer(k.ARRAY_BUFFER,f.__webglVertexBuffer);k.vertexAttribPointer(d.position,3,k.FLOAT,false,0,0)}}else if(g.morphTargetBase){c=e.program.attributes;if(g.morphTargetBase!==
-1){k.bindBuffer(k.ARRAY_BUFFER,f.__webglMorphTargetsBuffers[g.morphTargetBase]);k.vertexAttribPointer(c.position,3,k.FLOAT,false,0,0)}else if(c.position>=0){k.bindBuffer(k.ARRAY_BUFFER,f.__webglVertexBuffer);k.vertexAttribPointer(c.position,3,k.FLOAT,false,0,0)}if(g.morphTargetForcedOrder.length){var l=0;j=g.morphTargetForcedOrder;for(h=g.morphTargetInfluences;l<e.numSupportedMorphTargets&&l<j.length;){k.bindBuffer(k.ARRAY_BUFFER,f.__webglMorphTargetsBuffers[j[l]]);k.vertexAttribPointer(c["morphTarget"+
l],3,k.FLOAT,false,0,0);if(e.morphNormals){k.bindBuffer(k.ARRAY_BUFFER,f.__webglMorphNormalsBuffers[j[l]]);k.vertexAttribPointer(c["morphNormal"+l],3,k.FLOAT,false,0,0)}g.__webglMorphTargetInfluences[l]=h[j[l]];l++}}else{j=[];h=g.morphTargetInfluences;var m,n=h.length;for(m=0;m<n;m++){l=h[m];l>0&&j.push([m,l])}if(j.length>e.numSupportedMorphTargets){j.sort(i);j.length=e.numSupportedMorphTargets}else j.length>e.numSupportedMorphNormals?j.sort(i):j.length===0&&j.push([0,0]);for(l=0;l<e.numSupportedMorphTargets;){if(j[l]){m=
j[l][0];k.bindBuffer(k.ARRAY_BUFFER,f.__webglMorphTargetsBuffers[m]);k.vertexAttribPointer(c["morphTarget"+l],3,k.FLOAT,false,0,0);if(e.morphNormals){k.bindBuffer(k.ARRAY_BUFFER,f.__webglMorphNormalsBuffers[m]);k.vertexAttribPointer(c["morphNormal"+l],3,k.FLOAT,false,0,0)}g.__webglMorphTargetInfluences[l]=h[m]}else{k.vertexAttribPointer(c["morphTarget"+l],3,k.FLOAT,false,0,0);e.morphNormals&&k.vertexAttribPointer(c["morphNormal"+l],3,k.FLOAT,false,0,0);g.__webglMorphTargetInfluences[l]=0}l++}}e.program.uniforms.morphTargetInfluences!==
null&&k.uniform1fv(e.program.uniforms.morphTargetInfluences,g.__webglMorphTargetInfluences)}if(a){if(f.__webglCustomAttributesList){h=0;for(j=f.__webglCustomAttributesList.length;h<j;h++){c=f.__webglCustomAttributesList[h];if(d[c.buffer.belongsToAttribute]>=0){k.bindBuffer(k.ARRAY_BUFFER,c.buffer);k.vertexAttribPointer(d[c.buffer.belongsToAttribute],c.size,k.FLOAT,false,0,0)}}}if(d.color>=0){k.bindBuffer(k.ARRAY_BUFFER,f.__webglColorBuffer);k.vertexAttribPointer(d.color,3,k.FLOAT,false,0,0)}if(d.normal>=
0){k.bindBuffer(k.ARRAY_BUFFER,f.__webglNormalBuffer);k.vertexAttribPointer(d.normal,3,k.FLOAT,false,0,0)}if(d.tangent>=0){k.bindBuffer(k.ARRAY_BUFFER,f.__webglTangentBuffer);k.vertexAttribPointer(d.tangent,4,k.FLOAT,false,0,0)}if(d.uv>=0)if(f.__webglUVBuffer){k.bindBuffer(k.ARRAY_BUFFER,f.__webglUVBuffer);k.vertexAttribPointer(d.uv,2,k.FLOAT,false,0,0);k.enableVertexAttribArray(d.uv)}else k.disableVertexAttribArray(d.uv);if(d.uv2>=0)if(f.__webglUV2Buffer){k.bindBuffer(k.ARRAY_BUFFER,f.__webglUV2Buffer);
k.vertexAttribPointer(d.uv2,2,k.FLOAT,false,0,0);k.enableVertexAttribArray(d.uv2)}else k.disableVertexAttribArray(d.uv2);if(e.skinning&&d.skinVertexA>=0&&d.skinVertexB>=0&&d.skinIndex>=0&&d.skinWeight>=0){k.bindBuffer(k.ARRAY_BUFFER,f.__webglSkinVertexABuffer);k.vertexAttribPointer(d.skinVertexA,4,k.FLOAT,false,0,0);k.bindBuffer(k.ARRAY_BUFFER,f.__webglSkinVertexBBuffer);k.vertexAttribPointer(d.skinVertexB,4,k.FLOAT,false,0,0);k.bindBuffer(k.ARRAY_BUFFER,f.__webglSkinIndicesBuffer);k.vertexAttribPointer(d.skinIndex,
4,k.FLOAT,false,0,0);k.bindBuffer(k.ARRAY_BUFFER,f.__webglSkinWeightsBuffer);k.vertexAttribPointer(d.skinWeight,4,k.FLOAT,false,0,0)}}if(g instanceof b.Mesh){if(e.wireframe){e=e.wireframeLinewidth;if(e!==$a){k.lineWidth(e);$a=e}a&&k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer);k.drawElements(k.LINES,f.__webglLineCount,k.UNSIGNED_SHORT,0)}else{a&&k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer);k.drawElements(k.TRIANGLES,f.__webglFaceCount,k.UNSIGNED_SHORT,0)}E.info.render.calls++;
E.info.render.vertices=E.info.render.vertices+f.__webglFaceCount;E.info.render.faces=E.info.render.faces+f.__webglFaceCount/3}else if(g instanceof b.Line){g=g.type===b.LineStrip?k.LINE_STRIP:k.LINES;e=e.linewidth;if(e!==$a){k.lineWidth(e);$a=e}k.drawArrays(g,0,f.__webglLineCount);E.info.render.calls++}else if(g instanceof b.ParticleSystem){k.drawArrays(k.POINTS,0,f.__webglParticleCount);E.info.render.calls++;E.info.render.points=E.info.render.points+f.__webglParticleCount}else if(g instanceof b.Ribbon){k.drawArrays(k.TRIANGLE_STRIP,
0,f.__webglVertexCount);E.info.render.calls++}}};this.render=function(a,d,c,e){var f,g,i,n,o=a.__lights,p=a.fog;L=-1;ma=true;if(d.parent===void 0){console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it...");a.add(d)}this.autoUpdateScene&&a.updateMatrixWorld();if(!d._viewMatrixArray)d._viewMatrixArray=new Float32Array(16);if(!d._projectionMatrixArray)d._projectionMatrixArray=new Float32Array(16);d.matrixWorldInverse.getInverse(d.matrixWorld);d.matrixWorldInverse.flattenToArray(d._viewMatrixArray);
d.projectionMatrix.flattenToArray(d._projectionMatrixArray);hb.multiply(d.projectionMatrix,d.matrixWorldInverse);za.setFromMatrix(hb);this.autoUpdateObjects&&this.initWebGLObjects(a);j(this.renderPluginsPre,a,d);E.info.render.calls=0;E.info.render.vertices=0;E.info.render.faces=0;E.info.render.points=0;this.setRenderTarget(c);(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);n=a.__webglObjects;e=0;for(f=n.length;e<f;e++){g=n[e];i=g.object;g.render=false;
if(i.visible&&(!(i instanceof b.Mesh||i instanceof b.ParticleSystem)||!i.frustumCulled||za.contains(i))){u(i,d);var q=g,s=q.object,r=q.buffer,t=void 0,t=t=void 0,t=s.material;if(t instanceof b.MeshFaceMaterial){t=r.materialIndex;if(t>=0){t=s.geometry.materials[t];if(t.transparent){q.transparent=t;q.opaque=null}else{q.opaque=t;q.transparent=null}}}else if(t)if(t.transparent){q.transparent=t;q.opaque=null}else{q.opaque=t;q.transparent=null}g.render=true;if(this.sortObjects)if(i.renderDepth)g.z=i.renderDepth;
else{Pa.copy(i.matrixWorld.getPosition());hb.multiplyVector3(Pa);g.z=Pa.z}}}this.sortObjects&&n.sort(h);n=a.__webglObjectsImmediate;e=0;for(f=n.length;e<f;e++){g=n[e];i=g.object;if(i.visible){u(i,d);i=g.object.material;if(i.transparent){g.transparent=i;g.opaque=null}else{g.opaque=i;g.transparent=null}}}if(a.overrideMaterial){e=a.overrideMaterial;this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst);this.setDepthTest(e.depthTest);this.setDepthWrite(e.depthWrite);v(e.polygonOffset,e.polygonOffsetFactor,
e.polygonOffsetUnits);l(a.__webglObjects,false,"",d,o,p,true,e);m(a.__webglObjectsImmediate,"",d,o,p,false,e)}else{this.setBlending(b.NormalBlending);l(a.__webglObjects,true,"opaque",d,o,p,false);m(a.__webglObjectsImmediate,"opaque",d,o,p,false);l(a.__webglObjects,false,"transparent",d,o,p,true);m(a.__webglObjectsImmediate,"transparent",d,o,p,true)}j(this.renderPluginsPost,a,d);if(c&&c.generateMipmaps&&c.minFilter!==b.NearestFilter&&c.minFilter!==b.LinearFilter)if(c instanceof b.WebGLRenderTargetCube){k.bindTexture(k.TEXTURE_CUBE_MAP,
c.__webglTexture);k.generateMipmap(k.TEXTURE_CUBE_MAP);k.bindTexture(k.TEXTURE_CUBE_MAP,null)}else{k.bindTexture(k.TEXTURE_2D,c.__webglTexture);k.generateMipmap(k.TEXTURE_2D);k.bindTexture(k.TEXTURE_2D,null)}this.setDepthTest(true);this.setDepthWrite(true)};this.renderImmediateObject=function(a,b,d,c,e){var f=r(a,b,d,c,e);da=-1;E.setObjectFaces(e);e.immediateRenderCallback?e.immediateRenderCallback(f,k,za):e.render(function(a){E.renderBufferImmediate(a,f,c)})};this.initWebGLObjects=function(a){if(!a.__webglObjects){a.__webglObjects=
[];a.__webglObjectsImmediate=[];a.__webglSprites=[];a.__webglFlares=[]}for(;a.__objectsAdded.length;){var h=a.__objectsAdded[0],i=a,j=void 0,l=void 0,m=void 0;if(!h.__webglInit){h.__webglInit=true;h._modelViewMatrix=new b.Matrix4;h._normalMatrix=new b.Matrix3;if(h instanceof b.Mesh){l=h.geometry;if(l instanceof b.Geometry){if(l.geometryGroups===void 0){var r=l,t=void 0,u=void 0,w=void 0,v=void 0,x=void 0,y=void 0,B=void 0,G={},D=r.morphTargets.length,C=r.morphNormals.length;r.geometryGroups={};t=
0;for(u=r.faces.length;t<u;t++){w=r.faces[t];v=w.materialIndex;y=v!==void 0?v:-1;G[y]===void 0&&(G[y]={hash:y,counter:0});B=G[y].hash+"_"+G[y].counter;r.geometryGroups[B]===void 0&&(r.geometryGroups[B]={faces3:[],faces4:[],materialIndex:v,vertices:0,numMorphTargets:D,numMorphNormals:C});x=w instanceof b.Face3?3:4;if(r.geometryGroups[B].vertices+x>65535){G[y].counter=G[y].counter+1;B=G[y].hash+"_"+G[y].counter;r.geometryGroups[B]===void 0&&(r.geometryGroups[B]={faces3:[],faces4:[],materialIndex:v,
vertices:0,numMorphTargets:D,numMorphNormals:C})}w instanceof b.Face3?r.geometryGroups[B].faces3.push(t):r.geometryGroups[B].faces4.push(t);r.geometryGroups[B].vertices=r.geometryGroups[B].vertices+x}r.geometryGroupsList=[];var I=void 0;for(I in r.geometryGroups){r.geometryGroups[I].id=P++;r.geometryGroupsList.push(r.geometryGroups[I])}}for(j in l.geometryGroups){m=l.geometryGroups[j];if(!m.__webglVertexBuffer){var L=m;L.__webglVertexBuffer=k.createBuffer();L.__webglNormalBuffer=k.createBuffer();
L.__webglTangentBuffer=k.createBuffer();L.__webglColorBuffer=k.createBuffer();L.__webglUVBuffer=k.createBuffer();L.__webglUV2Buffer=k.createBuffer();L.__webglSkinVertexABuffer=k.createBuffer();L.__webglSkinVertexBBuffer=k.createBuffer();L.__webglSkinIndicesBuffer=k.createBuffer();L.__webglSkinWeightsBuffer=k.createBuffer();L.__webglFaceBuffer=k.createBuffer();L.__webglLineBuffer=k.createBuffer();var $=void 0,J=void 0;if(L.numMorphTargets){L.__webglMorphTargetsBuffers=[];$=0;for(J=L.numMorphTargets;$<
J;$++)L.__webglMorphTargetsBuffers.push(k.createBuffer())}if(L.numMorphNormals){L.__webglMorphNormalsBuffers=[];$=0;for(J=L.numMorphNormals;$<J;$++)L.__webglMorphNormalsBuffers.push(k.createBuffer())}E.info.memory.geometries++;var H=m,O=h,Y=O.geometry,N=H.faces3,aa=H.faces4,T=N.length*3+aa.length*4,R=N.length*1+aa.length*2,S=N.length*3+aa.length*4,Q=c(O,H),ba=f(Q),Z=e(Q),ga=Q.vertexColors?Q.vertexColors:false;H.__vertexArray=new Float32Array(T*3);if(Z)H.__normalArray=new Float32Array(T*3);if(Y.hasTangents)H.__tangentArray=
new Float32Array(T*4);if(ga)H.__colorArray=new Float32Array(T*3);if(ba){if(Y.faceUvs.length>0||Y.faceVertexUvs.length>0)H.__uvArray=new Float32Array(T*2);if(Y.faceUvs.length>1||Y.faceVertexUvs.length>1)H.__uv2Array=new Float32Array(T*2)}if(O.geometry.skinWeights.length&&O.geometry.skinIndices.length){H.__skinVertexAArray=new Float32Array(T*4);H.__skinVertexBArray=new Float32Array(T*4);H.__skinIndexArray=new Float32Array(T*4);H.__skinWeightArray=new Float32Array(T*4)}H.__faceArray=new Uint16Array(R*
3);H.__lineArray=new Uint16Array(S*2);var da=void 0,ia=void 0;if(H.numMorphTargets){H.__morphTargetsArrays=[];da=0;for(ia=H.numMorphTargets;da<ia;da++)H.__morphTargetsArrays.push(new Float32Array(T*3))}if(H.numMorphNormals){H.__morphNormalsArrays=[];da=0;for(ia=H.numMorphNormals;da<ia;da++)H.__morphNormalsArrays.push(new Float32Array(T*3))}H.__webglFaceCount=R*3;H.__webglLineCount=S*2;if(Q.attributes){if(H.__webglCustomAttributesList===void 0)H.__webglCustomAttributesList=[];var Oa=void 0;for(Oa in Q.attributes){var Ta=
Q.attributes[Oa],pa={},ma;for(ma in Ta)pa[ma]=Ta[ma];if(!pa.__webglInitialized||pa.createUniqueBuffers){pa.__webglInitialized=true;var Ma=1;pa.type==="v2"?Ma=2:pa.type==="v3"?Ma=3:pa.type==="v4"?Ma=4:pa.type==="c"&&(Ma=3);pa.size=Ma;pa.array=new Float32Array(T*Ma);pa.buffer=k.createBuffer();pa.buffer.belongsToAttribute=Oa;Ta.needsUpdate=true;pa.__original=Ta}H.__webglCustomAttributesList.push(pa)}}H.__inittedArrays=true;l.verticesNeedUpdate=true;l.morphTargetsNeedUpdate=true;l.elementsNeedUpdate=
true;l.uvsNeedUpdate=true;l.normalsNeedUpdate=true;l.tangetsNeedUpdate=true;l.colorsNeedUpdate=true}}}}else if(h instanceof b.Ribbon){l=h.geometry;if(!l.__webglVertexBuffer){var Ua=l;Ua.__webglVertexBuffer=k.createBuffer();Ua.__webglColorBuffer=k.createBuffer();E.info.memory.geometries++;var xa=l,za=xa.vertices.length;xa.__vertexArray=new Float32Array(za*3);xa.__colorArray=new Float32Array(za*3);xa.__webglVertexCount=za;l.verticesNeedUpdate=true;l.colorsNeedUpdate=true}}else if(h instanceof b.Line){l=
h.geometry;if(!l.__webglVertexBuffer){var Ea=l;Ea.__webglVertexBuffer=k.createBuffer();Ea.__webglColorBuffer=k.createBuffer();E.info.memory.geometries++;var Ca=l,fb=h,Pa=Ca.vertices.length;Ca.__vertexArray=new Float32Array(Pa*3);Ca.__colorArray=new Float32Array(Pa*3);Ca.__webglLineCount=Pa;d(Ca,fb);l.verticesNeedUpdate=true;l.colorsNeedUpdate=true}}else if(h instanceof b.ParticleSystem){l=h.geometry;if(!l.__webglVertexBuffer){var bb=l;bb.__webglVertexBuffer=k.createBuffer();bb.__webglColorBuffer=
k.createBuffer();E.info.geometries++;var $a=l,Mb=h,nb=$a.vertices.length;$a.__vertexArray=new Float32Array(nb*3);$a.__colorArray=new Float32Array(nb*3);$a.__sortArray=[];$a.__webglParticleCount=nb;d($a,Mb);l.verticesNeedUpdate=true;l.colorsNeedUpdate=true}}}if(!h.__webglActive){if(h instanceof b.Mesh){l=h.geometry;if(l instanceof b.BufferGeometry)p(i.__webglObjects,l,h);else for(j in l.geometryGroups){m=l.geometryGroups[j];p(i.__webglObjects,m,h)}}else if(h instanceof b.Ribbon||h instanceof b.Line||
h instanceof b.ParticleSystem){l=h.geometry;p(i.__webglObjects,l,h)}else h instanceof b.ImmediateRenderObject||h.immediateRenderCallback?i.__webglObjectsImmediate.push({object:h,opaque:null,transparent:null}):h instanceof b.Sprite?i.__webglSprites.push(h):h instanceof b.LensFlare&&i.__webglFlares.push(h);h.__webglActive=true}a.__objectsAdded.splice(0,1)}for(;a.__objectsRemoved.length;){var cb=a.__objectsRemoved[0],kb=a;cb instanceof b.Mesh||cb instanceof b.ParticleSystem||cb instanceof b.Ribbon||
cb instanceof b.Line?s(kb.__webglObjects,cb):cb instanceof b.Sprite?o(kb.__webglSprites,cb):cb instanceof b.LensFlare?o(kb.__webglFlares,cb):(cb instanceof b.ImmediateRenderObject||cb.immediateRenderCallback)&&s(kb.__webglObjectsImmediate,cb);cb.__webglActive=false;a.__objectsRemoved.splice(0,1)}for(var hb=0,pb=a.__webglObjects.length;hb<pb;hb++){var lb=a.__webglObjects[hb].object,ha=lb.geometry,ab=void 0,gb=void 0,Va=void 0;if(lb instanceof b.Mesh)if(ha instanceof b.BufferGeometry){ha.verticesNeedUpdate=
false;ha.elementsNeedUpdate=false;ha.uvsNeedUpdate=false;ha.normalsNeedUpdate=false;ha.colorsNeedUpdate=false}else{for(var ob=0,bc=ha.geometryGroupsList.length;ob<bc;ob++){ab=ha.geometryGroupsList[ob];Va=c(lb,ab);gb=Va.attributes&&n(Va);if(ha.verticesNeedUpdate||ha.morphTargetsNeedUpdate||ha.elementsNeedUpdate||ha.uvsNeedUpdate||ha.normalsNeedUpdate||ha.colorsNeedUpdate||ha.tangetsNeedUpdate||gb){var ea=ab,nd=lb,Xa=k.DYNAMIC_DRAW,od=!ha.dynamic,dc=Va;if(ea.__inittedArrays){var cd=e(dc),Tc=dc.vertexColors?
dc.vertexColors:false,dd=f(dc),Fc=cd===b.SmoothShading,F=void 0,U=void 0,jb=void 0,M=void 0,kc=void 0,Pb=void 0,mb=void 0,Gc=void 0,Hb=void 0,lc=void 0,mc=void 0,V=void 0,W=void 0,X=void 0,na=void 0,qb=void 0,rb=void 0,sb=void 0,rc=void 0,tb=void 0,ub=void 0,vb=void 0,sc=void 0,wb=void 0,xb=void 0,yb=void 0,tc=void 0,zb=void 0,Ab=void 0,Bb=void 0,uc=void 0,Cb=void 0,Db=void 0,Eb=void 0,vc=void 0,Qb=void 0,Rb=void 0,Sb=void 0,Hc=void 0,Tb=void 0,Ub=void 0,Vb=void 0,Ic=void 0,ja=void 0,ed=void 0,Wb=
void 0,nc=void 0,oc=void 0,Ha=void 0,fd=void 0,Fa=void 0,Ga=void 0,Xb=void 0,Ib=void 0,ya=0,Da=0,Jb=0,Kb=0,db=0,Na=0,oa=0,Qa=0,Aa=0,K=0,ca=0,A=0,Ya=void 0,Ia=ea.__vertexArray,wc=ea.__uvArray,xc=ea.__uv2Array,eb=ea.__normalArray,ra=ea.__tangentArray,Ja=ea.__colorArray,sa=ea.__skinVertexAArray,ta=ea.__skinVertexBArray,ua=ea.__skinIndexArray,va=ea.__skinWeightArray,Uc=ea.__morphTargetsArrays,Vc=ea.__morphNormalsArrays,Wc=ea.__webglCustomAttributesList,z=void 0,Fb=ea.__faceArray,Za=ea.__lineArray,Ra=
nd.geometry,pd=Ra.elementsNeedUpdate,gd=Ra.uvsNeedUpdate,qd=Ra.normalsNeedUpdate,rd=Ra.tangetsNeedUpdate,sd=Ra.colorsNeedUpdate,td=Ra.morphTargetsNeedUpdate,ec=Ra.vertices,ka=ea.faces3,la=ea.faces4,Ba=Ra.faces,Xc=Ra.faceVertexUvs[0],Yc=Ra.faceVertexUvs[1],fc=Ra.skinVerticesA,gc=Ra.skinVerticesB,hc=Ra.skinIndices,Yb=Ra.skinWeights,Zb=Ra.morphTargets,Jc=Ra.morphNormals;if(Ra.verticesNeedUpdate){F=0;for(U=ka.length;F<U;F++){M=Ba[ka[F]];V=ec[M.a];W=ec[M.b];X=ec[M.c];Ia[Da]=V.x;Ia[Da+1]=V.y;Ia[Da+2]=V.z;
Ia[Da+3]=W.x;Ia[Da+4]=W.y;Ia[Da+5]=W.z;Ia[Da+6]=X.x;Ia[Da+7]=X.y;Ia[Da+8]=X.z;Da=Da+9}F=0;for(U=la.length;F<U;F++){M=Ba[la[F]];V=ec[M.a];W=ec[M.b];X=ec[M.c];na=ec[M.d];Ia[Da]=V.x;Ia[Da+1]=V.y;Ia[Da+2]=V.z;Ia[Da+3]=W.x;Ia[Da+4]=W.y;Ia[Da+5]=W.z;Ia[Da+6]=X.x;Ia[Da+7]=X.y;Ia[Da+8]=X.z;Ia[Da+9]=na.x;Ia[Da+10]=na.y;Ia[Da+11]=na.z;Da=Da+12}k.bindBuffer(k.ARRAY_BUFFER,ea.__webglVertexBuffer);k.bufferData(k.ARRAY_BUFFER,Ia,Xa)}if(td){Ha=0;for(fd=Zb.length;Ha<fd;Ha++){F=ca=0;for(U=ka.length;F<U;F++){Xb=ka[F];
M=Ba[Xb];V=Zb[Ha].vertices[M.a];W=Zb[Ha].vertices[M.b];X=Zb[Ha].vertices[M.c];Fa=Uc[Ha];Fa[ca]=V.x;Fa[ca+1]=V.y;Fa[ca+2]=V.z;Fa[ca+3]=W.x;Fa[ca+4]=W.y;Fa[ca+5]=W.z;Fa[ca+6]=X.x;Fa[ca+7]=X.y;Fa[ca+8]=X.z;if(dc.morphNormals){if(Fc){Ib=Jc[Ha].vertexNormals[Xb];tb=Ib.a;ub=Ib.b;vb=Ib.c}else vb=ub=tb=Jc[Ha].faceNormals[Xb];Ga=Vc[Ha];Ga[ca]=tb.x;Ga[ca+1]=tb.y;Ga[ca+2]=tb.z;Ga[ca+3]=ub.x;Ga[ca+4]=ub.y;Ga[ca+5]=ub.z;Ga[ca+6]=vb.x;Ga[ca+7]=vb.y;Ga[ca+8]=vb.z}ca=ca+9}F=0;for(U=la.length;F<U;F++){Xb=la[F];M=
Ba[Xb];V=Zb[Ha].vertices[M.a];W=Zb[Ha].vertices[M.b];X=Zb[Ha].vertices[M.c];na=Zb[Ha].vertices[M.d];Fa=Uc[Ha];Fa[ca]=V.x;Fa[ca+1]=V.y;Fa[ca+2]=V.z;Fa[ca+3]=W.x;Fa[ca+4]=W.y;Fa[ca+5]=W.z;Fa[ca+6]=X.x;Fa[ca+7]=X.y;Fa[ca+8]=X.z;Fa[ca+9]=na.x;Fa[ca+10]=na.y;Fa[ca+11]=na.z;if(dc.morphNormals){if(Fc){Ib=Jc[Ha].vertexNormals[Xb];tb=Ib.a;ub=Ib.b;vb=Ib.c;sc=Ib.d}else sc=vb=ub=tb=Jc[Ha].faceNormals[Xb];Ga=Vc[Ha];Ga[ca]=tb.x;Ga[ca+1]=tb.y;Ga[ca+2]=tb.z;Ga[ca+3]=ub.x;Ga[ca+4]=ub.y;Ga[ca+5]=ub.z;Ga[ca+6]=vb.x;
Ga[ca+7]=vb.y;Ga[ca+8]=vb.z;Ga[ca+9]=sc.x;Ga[ca+10]=sc.y;Ga[ca+11]=sc.z}ca=ca+12}k.bindBuffer(k.ARRAY_BUFFER,ea.__webglMorphTargetsBuffers[Ha]);k.bufferData(k.ARRAY_BUFFER,Uc[Ha],Xa);if(dc.morphNormals){k.bindBuffer(k.ARRAY_BUFFER,ea.__webglMorphNormalsBuffers[Ha]);k.bufferData(k.ARRAY_BUFFER,Vc[Ha],Xa)}}}if(Yb.length){F=0;for(U=ka.length;F<U;F++){M=Ba[ka[F]];zb=Yb[M.a];Ab=Yb[M.b];Bb=Yb[M.c];va[K]=zb.x;va[K+1]=zb.y;va[K+2]=zb.z;va[K+3]=zb.w;va[K+4]=Ab.x;va[K+5]=Ab.y;va[K+6]=Ab.z;va[K+7]=Ab.w;va[K+
8]=Bb.x;va[K+9]=Bb.y;va[K+10]=Bb.z;va[K+11]=Bb.w;Cb=hc[M.a];Db=hc[M.b];Eb=hc[M.c];ua[K]=Cb.x;ua[K+1]=Cb.y;ua[K+2]=Cb.z;ua[K+3]=Cb.w;ua[K+4]=Db.x;ua[K+5]=Db.y;ua[K+6]=Db.z;ua[K+7]=Db.w;ua[K+8]=Eb.x;ua[K+9]=Eb.y;ua[K+10]=Eb.z;ua[K+11]=Eb.w;Qb=fc[M.a];Rb=fc[M.b];Sb=fc[M.c];sa[K]=Qb.x;sa[K+1]=Qb.y;sa[K+2]=Qb.z;sa[K+3]=1;sa[K+4]=Rb.x;sa[K+5]=Rb.y;sa[K+6]=Rb.z;sa[K+7]=1;sa[K+8]=Sb.x;sa[K+9]=Sb.y;sa[K+10]=Sb.z;sa[K+11]=1;Tb=gc[M.a];Ub=gc[M.b];Vb=gc[M.c];ta[K]=Tb.x;ta[K+1]=Tb.y;ta[K+2]=Tb.z;ta[K+3]=1;ta[K+
4]=Ub.x;ta[K+5]=Ub.y;ta[K+6]=Ub.z;ta[K+7]=1;ta[K+8]=Vb.x;ta[K+9]=Vb.y;ta[K+10]=Vb.z;ta[K+11]=1;K=K+12}F=0;for(U=la.length;F<U;F++){M=Ba[la[F]];zb=Yb[M.a];Ab=Yb[M.b];Bb=Yb[M.c];uc=Yb[M.d];va[K]=zb.x;va[K+1]=zb.y;va[K+2]=zb.z;va[K+3]=zb.w;va[K+4]=Ab.x;va[K+5]=Ab.y;va[K+6]=Ab.z;va[K+7]=Ab.w;va[K+8]=Bb.x;va[K+9]=Bb.y;va[K+10]=Bb.z;va[K+11]=Bb.w;va[K+12]=uc.x;va[K+13]=uc.y;va[K+14]=uc.z;va[K+15]=uc.w;Cb=hc[M.a];Db=hc[M.b];Eb=hc[M.c];vc=hc[M.d];ua[K]=Cb.x;ua[K+1]=Cb.y;ua[K+2]=Cb.z;ua[K+3]=Cb.w;ua[K+4]=
Db.x;ua[K+5]=Db.y;ua[K+6]=Db.z;ua[K+7]=Db.w;ua[K+8]=Eb.x;ua[K+9]=Eb.y;ua[K+10]=Eb.z;ua[K+11]=Eb.w;ua[K+12]=vc.x;ua[K+13]=vc.y;ua[K+14]=vc.z;ua[K+15]=vc.w;Qb=fc[M.a];Rb=fc[M.b];Sb=fc[M.c];Hc=fc[M.d];sa[K]=Qb.x;sa[K+1]=Qb.y;sa[K+2]=Qb.z;sa[K+3]=1;sa[K+4]=Rb.x;sa[K+5]=Rb.y;sa[K+6]=Rb.z;sa[K+7]=1;sa[K+8]=Sb.x;sa[K+9]=Sb.y;sa[K+10]=Sb.z;sa[K+11]=1;sa[K+12]=Hc.x;sa[K+13]=Hc.y;sa[K+14]=Hc.z;sa[K+15]=1;Tb=gc[M.a];Ub=gc[M.b];Vb=gc[M.c];Ic=gc[M.d];ta[K]=Tb.x;ta[K+1]=Tb.y;ta[K+2]=Tb.z;ta[K+3]=1;ta[K+4]=Ub.x;
ta[K+5]=Ub.y;ta[K+6]=Ub.z;ta[K+7]=1;ta[K+8]=Vb.x;ta[K+9]=Vb.y;ta[K+10]=Vb.z;ta[K+11]=1;ta[K+12]=Ic.x;ta[K+13]=Ic.y;ta[K+14]=Ic.z;ta[K+15]=1;K=K+16}if(K>0){k.bindBuffer(k.ARRAY_BUFFER,ea.__webglSkinVertexABuffer);k.bufferData(k.ARRAY_BUFFER,sa,Xa);k.bindBuffer(k.ARRAY_BUFFER,ea.__webglSkinVertexBBuffer);k.bufferData(k.ARRAY_BUFFER,ta,Xa);k.bindBuffer(k.ARRAY_BUFFER,ea.__webglSkinIndicesBuffer);k.bufferData(k.ARRAY_BUFFER,ua,Xa);k.bindBuffer(k.ARRAY_BUFFER,ea.__webglSkinWeightsBuffer);k.bufferData(k.ARRAY_BUFFER,
va,Xa)}}if(sd&&Tc){F=0;for(U=ka.length;F<U;F++){M=Ba[ka[F]];mb=M.vertexColors;Gc=M.color;if(mb.length===3&&Tc===b.VertexColors){wb=mb[0];xb=mb[1];yb=mb[2]}else yb=xb=wb=Gc;Ja[Aa]=wb.r;Ja[Aa+1]=wb.g;Ja[Aa+2]=wb.b;Ja[Aa+3]=xb.r;Ja[Aa+4]=xb.g;Ja[Aa+5]=xb.b;Ja[Aa+6]=yb.r;Ja[Aa+7]=yb.g;Ja[Aa+8]=yb.b;Aa=Aa+9}F=0;for(U=la.length;F<U;F++){M=Ba[la[F]];mb=M.vertexColors;Gc=M.color;if(mb.length===4&&Tc===b.VertexColors){wb=mb[0];xb=mb[1];yb=mb[2];tc=mb[3]}else tc=yb=xb=wb=Gc;Ja[Aa]=wb.r;Ja[Aa+1]=wb.g;Ja[Aa+
2]=wb.b;Ja[Aa+3]=xb.r;Ja[Aa+4]=xb.g;Ja[Aa+5]=xb.b;Ja[Aa+6]=yb.r;Ja[Aa+7]=yb.g;Ja[Aa+8]=yb.b;Ja[Aa+9]=tc.r;Ja[Aa+10]=tc.g;Ja[Aa+11]=tc.b;Aa=Aa+12}if(Aa>0){k.bindBuffer(k.ARRAY_BUFFER,ea.__webglColorBuffer);k.bufferData(k.ARRAY_BUFFER,Ja,Xa)}}if(rd&&Ra.hasTangents){F=0;for(U=ka.length;F<U;F++){M=Ba[ka[F]];Hb=M.vertexTangents;qb=Hb[0];rb=Hb[1];sb=Hb[2];ra[oa]=qb.x;ra[oa+1]=qb.y;ra[oa+2]=qb.z;ra[oa+3]=qb.w;ra[oa+4]=rb.x;ra[oa+5]=rb.y;ra[oa+6]=rb.z;ra[oa+7]=rb.w;ra[oa+8]=sb.x;ra[oa+9]=sb.y;ra[oa+10]=sb.z;
ra[oa+11]=sb.w;oa=oa+12}F=0;for(U=la.length;F<U;F++){M=Ba[la[F]];Hb=M.vertexTangents;qb=Hb[0];rb=Hb[1];sb=Hb[2];rc=Hb[3];ra[oa]=qb.x;ra[oa+1]=qb.y;ra[oa+2]=qb.z;ra[oa+3]=qb.w;ra[oa+4]=rb.x;ra[oa+5]=rb.y;ra[oa+6]=rb.z;ra[oa+7]=rb.w;ra[oa+8]=sb.x;ra[oa+9]=sb.y;ra[oa+10]=sb.z;ra[oa+11]=sb.w;ra[oa+12]=rc.x;ra[oa+13]=rc.y;ra[oa+14]=rc.z;ra[oa+15]=rc.w;oa=oa+16}k.bindBuffer(k.ARRAY_BUFFER,ea.__webglTangentBuffer);k.bufferData(k.ARRAY_BUFFER,ra,Xa)}if(qd&&cd){F=0;for(U=ka.length;F<U;F++){M=Ba[ka[F]];kc=
M.vertexNormals;Pb=M.normal;if(kc.length===3&&Fc)for(ja=0;ja<3;ja++){Wb=kc[ja];eb[Na]=Wb.x;eb[Na+1]=Wb.y;eb[Na+2]=Wb.z;Na=Na+3}else for(ja=0;ja<3;ja++){eb[Na]=Pb.x;eb[Na+1]=Pb.y;eb[Na+2]=Pb.z;Na=Na+3}}F=0;for(U=la.length;F<U;F++){M=Ba[la[F]];kc=M.vertexNormals;Pb=M.normal;if(kc.length===4&&Fc)for(ja=0;ja<4;ja++){Wb=kc[ja];eb[Na]=Wb.x;eb[Na+1]=Wb.y;eb[Na+2]=Wb.z;Na=Na+3}else for(ja=0;ja<4;ja++){eb[Na]=Pb.x;eb[Na+1]=Pb.y;eb[Na+2]=Pb.z;Na=Na+3}}k.bindBuffer(k.ARRAY_BUFFER,ea.__webglNormalBuffer);k.bufferData(k.ARRAY_BUFFER,
eb,Xa)}if(gd&&Xc&&dd){F=0;for(U=ka.length;F<U;F++){jb=ka[F];M=Ba[jb];lc=Xc[jb];if(lc!==void 0)for(ja=0;ja<3;ja++){nc=lc[ja];wc[Jb]=nc.u;wc[Jb+1]=nc.v;Jb=Jb+2}}F=0;for(U=la.length;F<U;F++){jb=la[F];M=Ba[jb];lc=Xc[jb];if(lc!==void 0)for(ja=0;ja<4;ja++){nc=lc[ja];wc[Jb]=nc.u;wc[Jb+1]=nc.v;Jb=Jb+2}}if(Jb>0){k.bindBuffer(k.ARRAY_BUFFER,ea.__webglUVBuffer);k.bufferData(k.ARRAY_BUFFER,wc,Xa)}}if(gd&&Yc&&dd){F=0;for(U=ka.length;F<U;F++){jb=ka[F];M=Ba[jb];mc=Yc[jb];if(mc!==void 0)for(ja=0;ja<3;ja++){oc=mc[ja];
xc[Kb]=oc.u;xc[Kb+1]=oc.v;Kb=Kb+2}}F=0;for(U=la.length;F<U;F++){jb=la[F];M=Ba[jb];mc=Yc[jb];if(mc!==void 0)for(ja=0;ja<4;ja++){oc=mc[ja];xc[Kb]=oc.u;xc[Kb+1]=oc.v;Kb=Kb+2}}if(Kb>0){k.bindBuffer(k.ARRAY_BUFFER,ea.__webglUV2Buffer);k.bufferData(k.ARRAY_BUFFER,xc,Xa)}}if(pd){F=0;for(U=ka.length;F<U;F++){M=Ba[ka[F]];Fb[db]=ya;Fb[db+1]=ya+1;Fb[db+2]=ya+2;db=db+3;Za[Qa]=ya;Za[Qa+1]=ya+1;Za[Qa+2]=ya;Za[Qa+3]=ya+2;Za[Qa+4]=ya+1;Za[Qa+5]=ya+2;Qa=Qa+6;ya=ya+3}F=0;for(U=la.length;F<U;F++){M=Ba[la[F]];Fb[db]=
ya;Fb[db+1]=ya+1;Fb[db+2]=ya+3;Fb[db+3]=ya+1;Fb[db+4]=ya+2;Fb[db+5]=ya+3;db=db+6;Za[Qa]=ya;Za[Qa+1]=ya+1;Za[Qa+2]=ya;Za[Qa+3]=ya+3;Za[Qa+4]=ya+1;Za[Qa+5]=ya+2;Za[Qa+6]=ya+2;Za[Qa+7]=ya+3;Qa=Qa+8;ya=ya+4}k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,ea.__webglFaceBuffer);k.bufferData(k.ELEMENT_ARRAY_BUFFER,Fb,Xa);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,ea.__webglLineBuffer);k.bufferData(k.ELEMENT_ARRAY_BUFFER,Za,Xa)}if(Wc){ja=0;for(ed=Wc.length;ja<ed;ja++){z=Wc[ja];if(z.__original.needsUpdate){A=0;if(z.size===1)if(z.boundTo===
void 0||z.boundTo==="vertices"){F=0;for(U=ka.length;F<U;F++){M=Ba[ka[F]];z.array[A]=z.value[M.a];z.array[A+1]=z.value[M.b];z.array[A+2]=z.value[M.c];A=A+3}F=0;for(U=la.length;F<U;F++){M=Ba[la[F]];z.array[A]=z.value[M.a];z.array[A+1]=z.value[M.b];z.array[A+2]=z.value[M.c];z.array[A+3]=z.value[M.d];A=A+4}}else{if(z.boundTo==="faces"){F=0;for(U=ka.length;F<U;F++){Ya=z.value[ka[F]];z.array[A]=Ya;z.array[A+1]=Ya;z.array[A+2]=Ya;A=A+3}F=0;for(U=la.length;F<U;F++){Ya=z.value[la[F]];z.array[A]=Ya;z.array[A+
1]=Ya;z.array[A+2]=Ya;z.array[A+3]=Ya;A=A+4}}}else if(z.size===2)if(z.boundTo===void 0||z.boundTo==="vertices"){F=0;for(U=ka.length;F<U;F++){M=Ba[ka[F]];V=z.value[M.a];W=z.value[M.b];X=z.value[M.c];z.array[A]=V.x;z.array[A+1]=V.y;z.array[A+2]=W.x;z.array[A+3]=W.y;z.array[A+4]=X.x;z.array[A+5]=X.y;A=A+6}F=0;for(U=la.length;F<U;F++){M=Ba[la[F]];V=z.value[M.a];W=z.value[M.b];X=z.value[M.c];na=z.value[M.d];z.array[A]=V.x;z.array[A+1]=V.y;z.array[A+2]=W.x;z.array[A+3]=W.y;z.array[A+4]=X.x;z.array[A+5]=
X.y;z.array[A+6]=na.x;z.array[A+7]=na.y;A=A+8}}else{if(z.boundTo==="faces"){F=0;for(U=ka.length;F<U;F++){X=W=V=Ya=z.value[ka[F]];z.array[A]=V.x;z.array[A+1]=V.y;z.array[A+2]=W.x;z.array[A+3]=W.y;z.array[A+4]=X.x;z.array[A+5]=X.y;A=A+6}F=0;for(U=la.length;F<U;F++){na=X=W=V=Ya=z.value[la[F]];z.array[A]=V.x;z.array[A+1]=V.y;z.array[A+2]=W.x;z.array[A+3]=W.y;z.array[A+4]=X.x;z.array[A+5]=X.y;z.array[A+6]=na.x;z.array[A+7]=na.y;A=A+8}}}else if(z.size===3){var fa;fa=z.type==="c"?["r","g","b"]:["x","y",
"z"];if(z.boundTo===void 0||z.boundTo==="vertices"){F=0;for(U=ka.length;F<U;F++){M=Ba[ka[F]];V=z.value[M.a];W=z.value[M.b];X=z.value[M.c];z.array[A]=V[fa[0]];z.array[A+1]=V[fa[1]];z.array[A+2]=V[fa[2]];z.array[A+3]=W[fa[0]];z.array[A+4]=W[fa[1]];z.array[A+5]=W[fa[2]];z.array[A+6]=X[fa[0]];z.array[A+7]=X[fa[1]];z.array[A+8]=X[fa[2]];A=A+9}F=0;for(U=la.length;F<U;F++){M=Ba[la[F]];V=z.value[M.a];W=z.value[M.b];X=z.value[M.c];na=z.value[M.d];z.array[A]=V[fa[0]];z.array[A+1]=V[fa[1]];z.array[A+2]=V[fa[2]];
z.array[A+3]=W[fa[0]];z.array[A+4]=W[fa[1]];z.array[A+5]=W[fa[2]];z.array[A+6]=X[fa[0]];z.array[A+7]=X[fa[1]];z.array[A+8]=X[fa[2]];z.array[A+9]=na[fa[0]];z.array[A+10]=na[fa[1]];z.array[A+11]=na[fa[2]];A=A+12}}else if(z.boundTo==="faces"){F=0;for(U=ka.length;F<U;F++){X=W=V=Ya=z.value[ka[F]];z.array[A]=V[fa[0]];z.array[A+1]=V[fa[1]];z.array[A+2]=V[fa[2]];z.array[A+3]=W[fa[0]];z.array[A+4]=W[fa[1]];z.array[A+5]=W[fa[2]];z.array[A+6]=X[fa[0]];z.array[A+7]=X[fa[1]];z.array[A+8]=X[fa[2]];A=A+9}F=0;for(U=
la.length;F<U;F++){na=X=W=V=Ya=z.value[la[F]];z.array[A]=V[fa[0]];z.array[A+1]=V[fa[1]];z.array[A+2]=V[fa[2]];z.array[A+3]=W[fa[0]];z.array[A+4]=W[fa[1]];z.array[A+5]=W[fa[2]];z.array[A+6]=X[fa[0]];z.array[A+7]=X[fa[1]];z.array[A+8]=X[fa[2]];z.array[A+9]=na[fa[0]];z.array[A+10]=na[fa[1]];z.array[A+11]=na[fa[2]];A=A+12}}}else if(z.size===4)if(z.boundTo===void 0||z.boundTo==="vertices"){F=0;for(U=ka.length;F<U;F++){M=Ba[ka[F]];V=z.value[M.a];W=z.value[M.b];X=z.value[M.c];z.array[A]=V.x;z.array[A+1]=
V.y;z.array[A+2]=V.z;z.array[A+3]=V.w;z.array[A+4]=W.x;z.array[A+5]=W.y;z.array[A+6]=W.z;z.array[A+7]=W.w;z.array[A+8]=X.x;z.array[A+9]=X.y;z.array[A+10]=X.z;z.array[A+11]=X.w;A=A+12}F=0;for(U=la.length;F<U;F++){M=Ba[la[F]];V=z.value[M.a];W=z.value[M.b];X=z.value[M.c];na=z.value[M.d];z.array[A]=V.x;z.array[A+1]=V.y;z.array[A+2]=V.z;z.array[A+3]=V.w;z.array[A+4]=W.x;z.array[A+5]=W.y;z.array[A+6]=W.z;z.array[A+7]=W.w;z.array[A+8]=X.x;z.array[A+9]=X.y;z.array[A+10]=X.z;z.array[A+11]=X.w;z.array[A+12]=
na.x;z.array[A+13]=na.y;z.array[A+14]=na.z;z.array[A+15]=na.w;A=A+16}}else if(z.boundTo==="faces"){F=0;for(U=ka.length;F<U;F++){X=W=V=Ya=z.value[ka[F]];z.array[A]=V.x;z.array[A+1]=V.y;z.array[A+2]=V.z;z.array[A+3]=V.w;z.array[A+4]=W.x;z.array[A+5]=W.y;z.array[A+6]=W.z;z.array[A+7]=W.w;z.array[A+8]=X.x;z.array[A+9]=X.y;z.array[A+10]=X.z;z.array[A+11]=X.w;A=A+12}F=0;for(U=la.length;F<U;F++){na=X=W=V=Ya=z.value[la[F]];z.array[A]=V.x;z.array[A+1]=V.y;z.array[A+2]=V.z;z.array[A+3]=V.w;z.array[A+4]=W.x;
z.array[A+5]=W.y;z.array[A+6]=W.z;z.array[A+7]=W.w;z.array[A+8]=X.x;z.array[A+9]=X.y;z.array[A+10]=X.z;z.array[A+11]=X.w;z.array[A+12]=na.x;z.array[A+13]=na.y;z.array[A+14]=na.z;z.array[A+15]=na.w;A=A+16}}k.bindBuffer(k.ARRAY_BUFFER,z.buffer);k.bufferData(k.ARRAY_BUFFER,z.array,Xa)}}}if(od){delete ea.__inittedArrays;delete ea.__colorArray;delete ea.__normalArray;delete ea.__tangentArray;delete ea.__uvArray;delete ea.__uv2Array;delete ea.__faceArray;delete ea.__vertexArray;delete ea.__lineArray;delete ea.__skinVertexAArray;
delete ea.__skinVertexBArray;delete ea.__skinIndexArray;delete ea.__skinWeightArray}}}}ha.verticesNeedUpdate=false;ha.morphTargetsNeedUpdate=false;ha.elementsNeedUpdate=false;ha.uvsNeedUpdate=false;ha.normalsNeedUpdate=false;ha.colorsNeedUpdate=false;ha.tangetsNeedUpdate=false;Va.attributes&&q(Va)}else if(lb instanceof b.Ribbon){if(ha.verticesNeedUpdate||ha.colorsNeedUpdate){var $b=ha,hd=k.DYNAMIC_DRAW,yc=void 0,zc=void 0,Kc=void 0,ac=void 0,Lc=void 0,id=$b.vertices,jd=$b.colors,ud=id.length,vd=jd.length,
Mc=$b.__vertexArray,Nc=$b.__colorArray,wd=$b.colorsNeedUpdate;if($b.verticesNeedUpdate){for(yc=0;yc<ud;yc++){Kc=id[yc];ac=yc*3;Mc[ac]=Kc.x;Mc[ac+1]=Kc.y;Mc[ac+2]=Kc.z}k.bindBuffer(k.ARRAY_BUFFER,$b.__webglVertexBuffer);k.bufferData(k.ARRAY_BUFFER,Mc,hd)}if(wd){for(zc=0;zc<vd;zc++){Lc=jd[zc];ac=zc*3;Nc[ac]=Lc.r;Nc[ac+1]=Lc.g;Nc[ac+2]=Lc.b}k.bindBuffer(k.ARRAY_BUFFER,$b.__webglColorBuffer);k.bufferData(k.ARRAY_BUFFER,Nc,hd)}}ha.verticesNeedUpdate=false;ha.colorsNeedUpdate=false}else if(lb instanceof
b.Line){Va=c(lb,ab);gb=Va.attributes&&n(Va);if(ha.verticesNeedUpdate||ha.colorsNeedUpdate||gb){var Lb=ha,Zc=k.DYNAMIC_DRAW,Ac=void 0,Bc=void 0,Oc=void 0,wa=void 0,Pc=void 0,kd=Lb.vertices,ld=Lb.colors,xd=kd.length,yd=ld.length,Qc=Lb.__vertexArray,Rc=Lb.__colorArray,zd=Lb.colorsNeedUpdate,$c=Lb.__webglCustomAttributesList,Sc=void 0,md=void 0,La=void 0,pc=void 0,Wa=void 0,qa=void 0;if(Lb.verticesNeedUpdate){for(Ac=0;Ac<xd;Ac++){Oc=kd[Ac];wa=Ac*3;Qc[wa]=Oc.x;Qc[wa+1]=Oc.y;Qc[wa+2]=Oc.z}k.bindBuffer(k.ARRAY_BUFFER,
Lb.__webglVertexBuffer);k.bufferData(k.ARRAY_BUFFER,Qc,Zc)}if(zd){for(Bc=0;Bc<yd;Bc++){Pc=ld[Bc];wa=Bc*3;Rc[wa]=Pc.r;Rc[wa+1]=Pc.g;Rc[wa+2]=Pc.b}k.bindBuffer(k.ARRAY_BUFFER,Lb.__webglColorBuffer);k.bufferData(k.ARRAY_BUFFER,Rc,Zc)}if($c){Sc=0;for(md=$c.length;Sc<md;Sc++){qa=$c[Sc];if(qa.needsUpdate&&(qa.boundTo===void 0||qa.boundTo==="vertices")){wa=0;pc=qa.value.length;if(qa.size===1)for(La=0;La<pc;La++)qa.array[La]=qa.value[La];else if(qa.size===2)for(La=0;La<pc;La++){Wa=qa.value[La];qa.array[wa]=
Wa.x;qa.array[wa+1]=Wa.y;wa=wa+2}else if(qa.size===3)if(qa.type==="c")for(La=0;La<pc;La++){Wa=qa.value[La];qa.array[wa]=Wa.r;qa.array[wa+1]=Wa.g;qa.array[wa+2]=Wa.b;wa=wa+3}else for(La=0;La<pc;La++){Wa=qa.value[La];qa.array[wa]=Wa.x;qa.array[wa+1]=Wa.y;qa.array[wa+2]=Wa.z;wa=wa+3}else if(qa.size===4)for(La=0;La<pc;La++){Wa=qa.value[La];qa.array[wa]=Wa.x;qa.array[wa+1]=Wa.y;qa.array[wa+2]=Wa.z;qa.array[wa+3]=Wa.w;wa=wa+4}k.bindBuffer(k.ARRAY_BUFFER,qa.buffer);k.bufferData(k.ARRAY_BUFFER,qa.array,Zc)}}}}ha.verticesNeedUpdate=
false;ha.colorsNeedUpdate=false;Va.attributes&&q(Va)}else if(lb instanceof b.ParticleSystem){Va=c(lb,ab);gb=Va.attributes&&n(Va);(ha.verticesNeedUpdate||ha.colorsNeedUpdate||lb.sortParticles||gb)&&g(ha,k.DYNAMIC_DRAW,lb);ha.verticesNeedUpdate=false;ha.colorsNeedUpdate=false;Va.attributes&&q(Va)}}};this.initMaterial=function(a,d,c,e){var f,g,h;a instanceof b.MeshDepthMaterial?h="depth":a instanceof b.MeshNormalMaterial?h="normal":a instanceof b.MeshBasicMaterial?h="basic":a instanceof b.MeshLambertMaterial?
h="lambert":a instanceof b.MeshPhongMaterial?h="phong":a instanceof b.LineBasicMaterial?h="basic":a instanceof b.ParticleBasicMaterial&&(h="particle_basic");if(h){var i=b.ShaderLib[h];a.uniforms=b.UniformsUtils.clone(i.uniforms);a.vertexShader=i.vertexShader;a.fragmentShader=i.fragmentShader}var j,l,m,n,o;j=n=o=i=0;for(l=d.length;j<l;j++){m=d[j];if(!m.onlyShadow){m instanceof b.DirectionalLight&&n++;m instanceof b.PointLight&&o++;m instanceof b.SpotLight&&i++}}if(o+i+n<=R){l=n;m=o;n=i}else{l=Math.ceil(R*
n/(o+n));n=m=R-l}var p=0,i=0;for(o=d.length;i<o;i++){j=d[i];if(j.castShadow){j instanceof b.SpotLight&&p++;j instanceof b.DirectionalLight&&!j.shadowCascade&&p++}}var q=50;if(e!==void 0&&e instanceof b.SkinnedMesh)q=e.bones.length;var s;a:{j=a.fragmentShader;o=a.vertexShader;var i=a.uniforms,d=a.attributes,c={map:!!a.map,envMap:!!a.envMap,lightMap:!!a.lightMap,vertexColors:a.vertexColors,fog:c,useFog:a.fog,sizeAttenuation:a.sizeAttenuation,skinning:a.skinning,maxBones:q,morphTargets:a.morphTargets,
morphNormals:a.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:l,maxPointLights:m,maxSpotLights:n,maxShadows:p,shadowMapEnabled:this.shadowMapEnabled&&e.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:a.alphaTest,metal:a.metal,perPixel:a.perPixel,wrapAround:a.wrapAround,doubleSided:e&&e.doubleSided},r,e=[];if(h)e.push(h);else{e.push(j);e.push(o)}for(r in c){e.push(r);
e.push(c[r])}h=e.join();r=0;for(e=Q.length;r<e;r++){l=Q[r];if(l.code===h){l.usedTimes++;s=l.program;break a}}r=k.createProgram();e=["precision "+w+" float;",ab>0?"#define VERTEX_TEXTURES":"",E.gammaInput?"#define GAMMA_INPUT":"",E.gammaOutput?"#define GAMMA_OUTPUT":"",E.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+c.maxDirLights,"#define MAX_POINT_LIGHTS "+c.maxPointLights,"#define MAX_SPOT_LIGHTS "+c.maxSpotLights,"#define MAX_SHADOWS "+c.maxShadows,"#define MAX_BONES "+
c.maxBones,c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.lightMap?"#define USE_LIGHTMAP":"",c.vertexColors?"#define USE_COLOR":"",c.skinning?"#define USE_SKINNING":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals?"#define USE_MORPHNORMALS":"",c.perPixel?"#define PHONG_PER_PIXEL":"",c.wrapAround?"#define WRAP_AROUND":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapSoft?"#define SHADOWMAP_SOFT":"",c.shadowMapDebug?"#define SHADOWMAP_DEBUG":
"",c.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
l=["precision "+w+" float;","#define MAX_DIR_LIGHTS "+c.maxDirLights,"#define MAX_POINT_LIGHTS "+c.maxPointLights,"#define MAX_SPOT_LIGHTS "+c.maxSpotLights,"#define MAX_SHADOWS "+c.maxShadows,c.alphaTest?"#define ALPHATEST "+c.alphaTest:"",E.gammaInput?"#define GAMMA_INPUT":"",E.gammaOutput?"#define GAMMA_OUTPUT":"",E.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fog instanceof b.FogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":
"",c.envMap?"#define USE_ENVMAP":"",c.lightMap?"#define USE_LIGHTMAP":"",c.vertexColors?"#define USE_COLOR":"",c.metal?"#define METAL":"",c.perPixel?"#define PHONG_PER_PIXEL":"",c.wrapAround?"#define WRAP_AROUND":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapSoft?"#define SHADOWMAP_SOFT":"",c.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",c.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");
j=x("fragment",l+j);e=x("vertex",e+o);k.attachShader(r,e);k.attachShader(r,j);k.linkProgram(r);k.getProgramParameter(r,k.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+k.getProgramParameter(r,k.VALIDATE_STATUS)+", gl error ["+k.getError()+"]");k.deleteShader(j);k.deleteShader(e);r.uniforms={};r.attributes={};var t,e=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(t in i)e.push(t);
t=e;e=0;for(i=t.length;e<i;e++){o=t[e];r.uniforms[o]=k.getUniformLocation(r,o)}e=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(t=0;t<c.maxMorphTargets;t++)e.push("morphTarget"+t);for(t=0;t<c.maxMorphNormals;t++)e.push("morphNormal"+t);for(s in d)e.push(s);s=e;t=0;for(d=s.length;t<d;t++){c=s[t];r.attributes[c]=k.getAttribLocation(r,c)}r.id=N++;Q.push({program:r,code:h,usedTimes:1});E.info.memory.programs=Q.length;s=r}a.program=s;s=a.program.attributes;
s.position>=0&&k.enableVertexAttribArray(s.position);s.color>=0&&k.enableVertexAttribArray(s.color);s.normal>=0&&k.enableVertexAttribArray(s.normal);s.tangent>=0&&k.enableVertexAttribArray(s.tangent);if(a.skinning&&s.skinVertexA>=0&&s.skinVertexB>=0&&s.skinIndex>=0&&s.skinWeight>=0){k.enableVertexAttribArray(s.skinVertexA);k.enableVertexAttribArray(s.skinVertexB);k.enableVertexAttribArray(s.skinIndex);k.enableVertexAttribArray(s.skinWeight)}if(a.attributes)for(g in a.attributes)s[g]!==void 0&&s[g]>=
0&&k.enableVertexAttribArray(s[g]);if(a.morphTargets){a.numSupportedMorphTargets=0;d="morphTarget";for(g=0;g<this.maxMorphTargets;g++){t=d+g;if(s[t]>=0){k.enableVertexAttribArray(s[t]);a.numSupportedMorphTargets++}}}if(a.morphNormals){a.numSupportedMorphNormals=0;d="morphNormal";for(g=0;g<this.maxMorphNormals;g++){t=d+g;if(s[t]>=0){k.enableVertexAttribArray(s[t]);a.numSupportedMorphNormals++}}}a.uniformsList=[];for(f in a.uniforms)a.uniformsList.push([a.uniforms[f],f])};this.setFaceCulling=function(a,
b){if(a){!b||b==="ccw"?k.frontFace(k.CCW):k.frontFace(k.CW);a==="back"?k.cullFace(k.BACK):a==="front"?k.cullFace(k.FRONT):k.cullFace(k.FRONT_AND_BACK);k.enable(k.CULL_FACE)}else k.disable(k.CULL_FACE)};this.setObjectFaces=function(a){if($!==a.doubleSided){a.doubleSided?k.disable(k.CULL_FACE):k.enable(k.CULL_FACE);$=a.doubleSided}if(aa!==a.flipSided){a.flipSided?k.frontFace(k.CW):k.frontFace(k.CCW);aa=a.flipSided}};this.setDepthTest=function(a){if(Oa!==a){a?k.enable(k.DEPTH_TEST):k.disable(k.DEPTH_TEST);
Oa=a}};this.setDepthWrite=function(a){if(pa!==a){k.depthMask(a);pa=a}};this.setBlending=function(a,c,d,e){if(a!==Y){switch(a){case b.NoBlending:k.disable(k.BLEND);break;case b.AdditiveBlending:k.enable(k.BLEND);k.blendEquation(k.FUNC_ADD);k.blendFunc(k.SRC_ALPHA,k.ONE);break;case b.SubtractiveBlending:k.enable(k.BLEND);k.blendEquation(k.FUNC_ADD);k.blendFunc(k.ZERO,k.ONE_MINUS_SRC_COLOR);break;case b.MultiplyBlending:k.enable(k.BLEND);k.blendEquation(k.FUNC_ADD);k.blendFunc(k.ZERO,k.SRC_COLOR);break;
case b.CustomBlending:k.enable(k.BLEND);break;default:k.enable(k.BLEND);k.blendEquationSeparate(k.FUNC_ADD,k.FUNC_ADD);k.blendFuncSeparate(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA,k.ONE,k.ONE_MINUS_SRC_ALPHA)}Y=a}if(a===b.CustomBlending){if(c!==ia){k.blendEquation(D(c));ia=c}if(d!==Ta||e!==Ma){k.blendFunc(D(d),D(e));Ta=d;Ma=e}}else Ma=Ta=ia=null};this.setTexture=function(a,c){if(a.needsUpdate){if(!a.__webglInit){a.__webglInit=true;a.__webglTexture=k.createTexture();E.info.memory.textures++}k.activeTexture(k.TEXTURE0+
c);k.bindTexture(k.TEXTURE_2D,a.__webglTexture);k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);var d=a.image,e=(d.width&d.width-1)===0&&(d.height&d.height-1)===0,f=D(a.format),g=D(a.type);t(k.TEXTURE_2D,a,e);a instanceof b.DataTexture?k.texImage2D(k.TEXTURE_2D,0,f,d.width,d.height,0,f,g,d.data):k.texImage2D(k.TEXTURE_2D,0,f,f,g,a.image);a.generateMipmaps&&e&&k.generateMipmap(k.TEXTURE_2D);a.needsUpdate=false;if(a.onUpdate)a.onUpdate()}else{k.activeTexture(k.TEXTURE0+c);k.bindTexture(k.TEXTURE_2D,
a.__webglTexture)}};this.setRenderTarget=function(a){var c=a instanceof b.WebGLRenderTargetCube;if(a&&!a.__webglFramebuffer){if(a.depthBuffer===void 0)a.depthBuffer=true;if(a.stencilBuffer===void 0)a.stencilBuffer=true;a.__webglTexture=k.createTexture();var d=(a.width&a.width-1)===0&&(a.height&a.height-1)===0,e=D(a.format),f=D(a.type);if(c){a.__webglFramebuffer=[];a.__webglRenderbuffer=[];k.bindTexture(k.TEXTURE_CUBE_MAP,a.__webglTexture);t(k.TEXTURE_CUBE_MAP,a,d);for(var g=0;g<6;g++){a.__webglFramebuffer[g]=
k.createFramebuffer();a.__webglRenderbuffer[g]=k.createRenderbuffer();k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,e,a.width,a.height,0,e,f,null);var h=a,i=k.TEXTURE_CUBE_MAP_POSITIVE_X+g;k.bindFramebuffer(k.FRAMEBUFFER,a.__webglFramebuffer[g]);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,i,h.__webglTexture,0);y(a.__webglRenderbuffer[g],a)}d&&k.generateMipmap(k.TEXTURE_CUBE_MAP)}else{a.__webglFramebuffer=k.createFramebuffer();a.__webglRenderbuffer=k.createRenderbuffer();k.bindTexture(k.TEXTURE_2D,
a.__webglTexture);t(k.TEXTURE_2D,a,d);k.texImage2D(k.TEXTURE_2D,0,e,a.width,a.height,0,e,f,null);e=k.TEXTURE_2D;k.bindFramebuffer(k.FRAMEBUFFER,a.__webglFramebuffer);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,e,a.__webglTexture,0);y(a.__webglRenderbuffer,a);d&&k.generateMipmap(k.TEXTURE_2D)}c?k.bindTexture(k.TEXTURE_CUBE_MAP,null):k.bindTexture(k.TEXTURE_2D,null);k.bindRenderbuffer(k.RENDERBUFFER,null);k.bindFramebuffer(k.FRAMEBUFFER,null)}if(a){c=c?a.__webglFramebuffer[a.activeCubeFace]:
a.__webglFramebuffer;d=a.width;a=a.height;f=e=0}else{c=null;d=kb;a=ob;e=Mb;f=nb}if(c!==ba){k.bindFramebuffer(k.FRAMEBUFFER,c);k.viewport(e,f,d,a);ba=c}bb=d;Ca=a};this.shadowMapPlugin=new b.ShadowMapPlugin;this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new b.SpritePlugin);this.addPostPlugin(new b.LensFlarePlugin)};b.WebGLRenderTarget=function(a,d,c){this.width=a;this.height=d;c=c||{};this.wrapS=c.wrapS!==void 0?c.wrapS:b.ClampToEdgeWrapping;this.wrapT=c.wrapT!==void 0?c.wrapT:b.ClampToEdgeWrapping;
this.magFilter=c.magFilter!==void 0?c.magFilter:b.LinearFilter;this.minFilter=c.minFilter!==void 0?c.minFilter:b.LinearMipMapLinearFilter;this.offset=new b.Vector2(0,0);this.repeat=new b.Vector2(1,1);this.format=c.format!==void 0?c.format:b.RGBAFormat;this.type=c.type!==void 0?c.type:b.UnsignedByteType;this.depthBuffer=c.depthBuffer!==void 0?c.depthBuffer:true;this.stencilBuffer=c.stencilBuffer!==void 0?c.stencilBuffer:true;this.generateMipmaps=true};b.WebGLRenderTarget.prototype.clone=function(){var a=
new b.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;return a};b.WebGLRenderTargetCube=function(a,d,c){b.WebGLRenderTarget.call(this,a,d,c);this.activeCubeFace=0};b.WebGLRenderTargetCube.prototype=Object.create(b.WebGLRenderTarget.prototype);b.RenderableVertex=
function(){this.positionWorld=new b.Vector3;this.positionScreen=new b.Vector4;this.visible=true};b.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};b.RenderableFace3=function(){this.v1=new b.RenderableVertex;this.v2=new b.RenderableVertex;this.v3=new b.RenderableVertex;this.centroidWorld=new b.Vector3;this.centroidScreen=new b.Vector3;this.normalWorld=new b.Vector3;this.vertexNormalsWorld=[new b.Vector3,new b.Vector3,
new b.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};b.RenderableFace4=function(){this.v1=new b.RenderableVertex;this.v2=new b.RenderableVertex;this.v3=new b.RenderableVertex;this.v4=new b.RenderableVertex;this.centroidWorld=new b.Vector3;this.centroidScreen=new b.Vector3;this.normalWorld=new b.Vector3;this.vertexNormalsWorld=[new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};b.RenderableObject=function(){this.z=
this.object=null};b.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new b.Vector2;this.material=null};b.RenderableLine=function(){this.z=null;this.v1=new b.RenderableVertex;this.v2=new b.RenderableVertex;this.material=null};b.ColorUtils={adjustHSV:function(a,d,c,e){var f=b.ColorUtils.__hsv;b.ColorUtils.rgbToHsv(a,f);f.h=b.Math.clamp(f.h+d,0,1);f.s=b.Math.clamp(f.s+c,0,1);f.v=b.Math.clamp(f.v+e,0,1);a.setHSV(f.h,f.s,f.v)},rgbToHsv:function(a,b){var c=a.r,e=a.g,f=a.b,
g=Math.max(Math.max(c,e),f),h=Math.min(Math.min(c,e),f);if(h===g)h=c=0;else{var i=g-h,h=i/g,c=(c===g?(e-f)/i:e===g?2+(f-c)/i:4+(c-e)/i)/6;c<0&&(c=c+1);c>1&&(c=c-1)}b===void 0&&(b={h:0,s:0,v:0});b.h=c;b.s=h;b.v=g;return b}};b.ColorUtils.__hsv={h:0,s:0,v:0};b.GeometryUtils={merge:function(a,d){for(var c,e,f=a.vertices.length,g=d instanceof b.Mesh?d.geometry:d,h=a.vertices,i=g.vertices,j=a.faces,l=g.faces,m=a.faceVertexUvs[0],p=g.faceVertexUvs[0],n={},q=0;q<a.materials.length;q++)n[a.materials[q].id]=
q;if(d instanceof b.Mesh){d.matrixAutoUpdate&&d.updateMatrix();c=d.matrix;e=new b.Matrix4;e.extractRotation(c,d.scale)}for(var q=0,s=i.length;q<s;q++){var o=i[q].clone();c&&c.multiplyVector3(o);h.push(o)}q=0;for(s=l.length;q<s;q++){var h=l[q],r,u,v=h.vertexNormals,x=h.vertexColors;h instanceof b.Face3?r=new b.Face3(h.a+f,h.b+f,h.c+f):h instanceof b.Face4&&(r=new b.Face4(h.a+f,h.b+f,h.c+f,h.d+f));r.normal.copy(h.normal);e&&e.multiplyVector3(r.normal);i=0;for(o=v.length;i<o;i++){u=v[i].clone();e&&e.multiplyVector3(u);
r.vertexNormals.push(u)}r.color.copy(h.color);i=0;for(o=x.length;i<o;i++){u=x[i];r.vertexColors.push(u.clone())}if(h.materialIndex!==void 0){i=g.materials[h.materialIndex];o=i.id;x=n[o];if(x===void 0){x=a.materials.length;n[o]=x;a.materials.push(i)}r.materialIndex=x}r.centroid.copy(h.centroid);c&&c.multiplyVector3(r.centroid);j.push(r)}q=0;for(s=p.length;q<s;q++){c=p[q];e=[];i=0;for(o=c.length;i<o;i++)e.push(new b.UV(c[i].u,c[i].v));m.push(e)}},clone:function(a){var d=new b.Geometry,c,e=a.vertices,
f=a.faces,g=a.faceVertexUvs[0];if(a.materials)d.materials=a.materials.slice();a=0;for(c=e.length;a<c;a++)d.vertices.push(e[a].clone());a=0;for(c=f.length;a<c;a++)d.faces.push(f[a].clone());a=0;for(c=g.length;a<c;a++){for(var e=g[a],f=[],h=0,i=e.length;h<i;h++)f.push(new b.UV(e[h].u,e[h].v));d.faceVertexUvs[0].push(f)}return d},randomPointInTriangle:function(a,d,c){var e,f,g,h=new b.Vector3,i=b.GeometryUtils.__v1;e=b.GeometryUtils.random();f=b.GeometryUtils.random();if(e+f>1){e=1-e;f=1-f}g=1-e-f;h.copy(a);
h.multiplyScalar(e);i.copy(d);i.multiplyScalar(f);h.addSelf(i);i.copy(c);i.multiplyScalar(g);h.addSelf(i);return h},randomPointInFace:function(a,d,c){var e,f,g;if(a instanceof b.Face3){e=d.vertices[a.a];f=d.vertices[a.b];g=d.vertices[a.c];return b.GeometryUtils.randomPointInTriangle(e,f,g)}if(a instanceof b.Face4){e=d.vertices[a.a];f=d.vertices[a.b];g=d.vertices[a.c];var d=d.vertices[a.d],h;if(c)if(a._area1&&a._area2){c=a._area1;h=a._area2}else{c=b.GeometryUtils.triangleArea(e,f,d);h=b.GeometryUtils.triangleArea(f,
g,d);a._area1=c;a._area2=h}else{c=b.GeometryUtils.triangleArea(e,f,d);h=b.GeometryUtils.triangleArea(f,g,d)}return b.GeometryUtils.random()*(c+h)<c?b.GeometryUtils.randomPointInTriangle(e,f,d):b.GeometryUtils.randomPointInTriangle(f,g,d)}},randomPointsInGeometry:function(a,d){function c(a){function b(c,d){if(d<c)return c;var e=c+Math.floor((d-c)/2);return l[e]>a?b(c,e-1):l[e]<a?b(e+1,d):e}return b(0,l.length-1)}var e,f,g=a.faces,h=a.vertices,i=g.length,j=0,l=[],m,p,n,q;for(f=0;f<i;f++){e=g[f];if(e instanceof
b.Face3){m=h[e.a];p=h[e.b];n=h[e.c];e._area=b.GeometryUtils.triangleArea(m,p,n)}else if(e instanceof b.Face4){m=h[e.a];p=h[e.b];n=h[e.c];q=h[e.d];e._area1=b.GeometryUtils.triangleArea(m,p,q);e._area2=b.GeometryUtils.triangleArea(p,n,q);e._area=e._area1+e._area2}j=j+e._area;l[f]=j}e=[];for(f=0;f<d;f++){h=b.GeometryUtils.random()*j;h=c(h);e[f]=b.GeometryUtils.randomPointInFace(g[h],a,true)}return e},triangleArea:function(a,d,c){var e,f=b.GeometryUtils.__v1;f.sub(a,d);e=f.length();f.sub(a,c);a=f.length();
f.sub(d,c);c=f.length();d=0.5*(e+a+c);return Math.sqrt(d*(d-e)*(d-a)*(d-c))},center:function(a){a.computeBoundingBox();var d=a.boundingBox,c=new b.Vector3;c.add(d.min,d.max);c.multiplyScalar(-0.5);a.applyMatrix((new b.Matrix4).makeTranslation(c.x,c.y,c.z));a.computeBoundingBox();return c},normalizeUVs:function(a){for(var a=a.faceVertexUvs[0],b=0,c=a.length;b<c;b++)for(var e=a[b],f=0,g=e.length;f<g;f++){if(e[f].u!==1)e[f].u=e[f].u-Math.floor(e[f].u);if(e[f].v!==1)e[f].v=e[f].v-Math.floor(e[f].v)}},
triangulateQuads:function(a){var d,c,e,f,g=[],h=[],i=[];d=0;for(c=a.faceUvs.length;d<c;d++)h[d]=[];d=0;for(c=a.faceVertexUvs.length;d<c;d++)i[d]=[];d=0;for(c=a.faces.length;d<c;d++){e=a.faces[d];if(e instanceof b.Face4){f=e.a;var j=e.b,l=e.c,m=e.d,p=new b.Face3,n=new b.Face3;p.color.copy(e.color);n.color.copy(e.color);p.materialIndex=e.materialIndex;n.materialIndex=e.materialIndex;p.a=f;p.b=j;p.c=m;n.a=j;n.b=l;n.c=m;if(e.vertexColors.length===4){p.vertexColors[0]=e.vertexColors[0].clone();p.vertexColors[1]=
e.vertexColors[1].clone();p.vertexColors[2]=e.vertexColors[3].clone();n.vertexColors[0]=e.vertexColors[1].clone();n.vertexColors[1]=e.vertexColors[2].clone();n.vertexColors[2]=e.vertexColors[3].clone()}g.push(p,n);e=0;for(f=a.faceVertexUvs.length;e<f;e++)if(a.faceVertexUvs[e].length){p=a.faceVertexUvs[e][d];j=p[1];l=p[2];m=p[3];p=[p[0].clone(),j.clone(),m.clone()];j=[j.clone(),l.clone(),m.clone()];i[e].push(p,j)}e=0;for(f=a.faceUvs.length;e<f;e++)if(a.faceUvs[e].length){j=a.faceUvs[e][d];h[e].push(j,
j)}}else{g.push(e);e=0;for(f=a.faceUvs.length;e<f;e++)h[e].push(a.faceUvs[e]);e=0;for(f=a.faceVertexUvs.length;e<f;e++)i[e].push(a.faceVertexUvs[e])}}a.faces=g;a.faceUvs=h;a.faceVertexUvs=i;a.computeCentroids();a.computeFaceNormals();a.computeVertexNormals();a.hasTangents&&a.computeTangents()},explode:function(a){for(var d=[],c=0,e=a.faces.length;c<e;c++){var f=d.length,g=a.faces[c];if(g instanceof b.Face4){var h=g.a,i=g.b,j=g.c,h=a.vertices[h],i=a.vertices[i],j=a.vertices[j],l=a.vertices[g.d];d.push(h.clone());
d.push(i.clone());d.push(j.clone());d.push(l.clone());g.a=f;g.b=f+1;g.c=f+2;g.d=f+3}else{h=g.a;i=g.b;j=g.c;h=a.vertices[h];i=a.vertices[i];j=a.vertices[j];d.push(h.clone());d.push(i.clone());d.push(j.clone());g.a=f;g.b=f+1;g.c=f+2}}a.vertices=d;delete a.__tmpVertices},tessellate:function(a,d){var c,e,f,g,h,i,j,l,m,p,n,q,s,o,r,u,v,x,t,y=[],G=[];c=0;for(e=a.faceVertexUvs.length;c<e;c++)G[c]=[];c=0;for(e=a.faces.length;c<e;c++){f=a.faces[c];if(f instanceof b.Face3){g=f.a;h=f.b;i=f.c;l=a.vertices[g];
m=a.vertices[h];p=a.vertices[i];q=l.distanceTo(m);s=m.distanceTo(p);n=l.distanceTo(p);if(q>d||s>d||n>d){j=a.vertices.length;x=f.clone();t=f.clone();if(q>=s&&q>=n){l=l.clone();l.lerpSelf(m,0.5);x.a=g;x.b=j;x.c=i;t.a=j;t.b=h;t.c=i;if(f.vertexNormals.length===3){g=f.vertexNormals[0].clone();g.lerpSelf(f.vertexNormals[1],0.5);x.vertexNormals[1].copy(g);t.vertexNormals[0].copy(g)}if(f.vertexColors.length===3){g=f.vertexColors[0].clone();g.lerpSelf(f.vertexColors[1],0.5);x.vertexColors[1].copy(g);t.vertexColors[0].copy(g)}f=
0}else if(s>=q&&s>=n){l=m.clone();l.lerpSelf(p,0.5);x.a=g;x.b=h;x.c=j;t.a=j;t.b=i;t.c=g;if(f.vertexNormals.length===3){g=f.vertexNormals[1].clone();g.lerpSelf(f.vertexNormals[2],0.5);x.vertexNormals[2].copy(g);t.vertexNormals[0].copy(g);t.vertexNormals[1].copy(f.vertexNormals[2]);t.vertexNormals[2].copy(f.vertexNormals[0])}if(f.vertexColors.length===3){g=f.vertexColors[1].clone();g.lerpSelf(f.vertexColors[2],0.5);x.vertexColors[2].copy(g);t.vertexColors[0].copy(g);t.vertexColors[1].copy(f.vertexColors[2]);
t.vertexColors[2].copy(f.vertexColors[0])}f=1}else{l=l.clone();l.lerpSelf(p,0.5);x.a=g;x.b=h;x.c=j;t.a=j;t.b=h;t.c=i;if(f.vertexNormals.length===3){g=f.vertexNormals[0].clone();g.lerpSelf(f.vertexNormals[2],0.5);x.vertexNormals[2].copy(g);t.vertexNormals[0].copy(g)}if(f.vertexColors.length===3){g=f.vertexColors[0].clone();g.lerpSelf(f.vertexColors[2],0.5);x.vertexColors[2].copy(g);t.vertexColors[0].copy(g)}f=2}y.push(x,t);a.vertices.push(l);g=0;for(h=a.faceVertexUvs.length;g<h;g++)if(a.faceVertexUvs[g].length){l=
a.faceVertexUvs[g][c];t=l[0];i=l[1];x=l[2];if(f===0){m=t.clone();m.lerpSelf(i,0.5);l=[t.clone(),m.clone(),x.clone()];i=[m.clone(),i.clone(),x.clone()]}else if(f===1){m=i.clone();m.lerpSelf(x,0.5);l=[t.clone(),i.clone(),m.clone()];i=[m.clone(),x.clone(),t.clone()]}else{m=t.clone();m.lerpSelf(x,0.5);l=[t.clone(),i.clone(),m.clone()];i=[m.clone(),i.clone(),x.clone()]}G[g].push(l,i)}}else{y.push(f);g=0;for(h=a.faceVertexUvs.length;g<h;g++)G[g].push(a.faceVertexUvs[g][c])}}else{g=f.a;h=f.b;i=f.c;j=f.d;
l=a.vertices[g];m=a.vertices[h];p=a.vertices[i];n=a.vertices[j];q=l.distanceTo(m);s=m.distanceTo(p);o=p.distanceTo(n);r=l.distanceTo(n);if(q>d||s>d||o>d||r>d){u=a.vertices.length;v=a.vertices.length+1;x=f.clone();t=f.clone();if(q>=s&&q>=o&&q>=r||o>=s&&o>=q&&o>=r){q=l.clone();q.lerpSelf(m,0.5);m=p.clone();m.lerpSelf(n,0.5);x.a=g;x.b=u;x.c=v;x.d=j;t.a=u;t.b=h;t.c=i;t.d=v;if(f.vertexNormals.length===4){g=f.vertexNormals[0].clone();g.lerpSelf(f.vertexNormals[1],0.5);h=f.vertexNormals[2].clone();h.lerpSelf(f.vertexNormals[3],
0.5);x.vertexNormals[1].copy(g);x.vertexNormals[2].copy(h);t.vertexNormals[0].copy(g);t.vertexNormals[3].copy(h)}if(f.vertexColors.length===4){g=f.vertexColors[0].clone();g.lerpSelf(f.vertexColors[1],0.5);h=f.vertexColors[2].clone();h.lerpSelf(f.vertexColors[3],0.5);x.vertexColors[1].copy(g);x.vertexColors[2].copy(h);t.vertexColors[0].copy(g);t.vertexColors[3].copy(h)}f=0}else{q=m.clone();q.lerpSelf(p,0.5);m=n.clone();m.lerpSelf(l,0.5);x.a=g;x.b=h;x.c=u;x.d=v;t.a=v;t.b=u;t.c=i;t.d=j;if(f.vertexNormals.length===
4){g=f.vertexNormals[1].clone();g.lerpSelf(f.vertexNormals[2],0.5);h=f.vertexNormals[3].clone();h.lerpSelf(f.vertexNormals[0],0.5);x.vertexNormals[2].copy(g);x.vertexNormals[3].copy(h);t.vertexNormals[0].copy(h);t.vertexNormals[1].copy(g)}if(f.vertexColors.length===4){g=f.vertexColors[1].clone();g.lerpSelf(f.vertexColors[2],0.5);h=f.vertexColors[3].clone();h.lerpSelf(f.vertexColors[0],0.5);x.vertexColors[2].copy(g);x.vertexColors[3].copy(h);t.vertexColors[0].copy(h);t.vertexColors[1].copy(g)}f=1}y.push(x,
t);a.vertices.push(q,m);g=0;for(h=a.faceVertexUvs.length;g<h;g++)if(a.faceVertexUvs[g].length){l=a.faceVertexUvs[g][c];t=l[0];i=l[1];x=l[2];l=l[3];if(f===0){m=t.clone();m.lerpSelf(i,0.5);p=x.clone();p.lerpSelf(l,0.5);t=[t.clone(),m.clone(),p.clone(),l.clone()];i=[m.clone(),i.clone(),x.clone(),p.clone()]}else{m=i.clone();m.lerpSelf(x,0.5);p=l.clone();p.lerpSelf(t,0.5);t=[t.clone(),i.clone(),m.clone(),p.clone()];i=[p.clone(),m.clone(),x.clone(),l.clone()]}G[g].push(t,i)}}else{y.push(f);g=0;for(h=a.faceVertexUvs.length;g<
h;g++)G[g].push(a.faceVertexUvs[g][c])}}}a.faces=y;a.faceVertexUvs=G}};b.GeometryUtils.random=b.Math.random16;b.GeometryUtils.__v1=new b.Vector3;b.ImageUtils={crossOrigin:"anonymous",loadTexture:function(a,d,c,e){var f=new b.Texture(void 0,d),d=new b.ImageLoader;d.addEventListener("load",function(a){f.image=a.content;f.needsUpdate=true;c&&c(f)});d.addEventListener("error",function(a){e&&e(a.message)});d.crossOrigin=this.crossOrigin;d.load(a);return f},loadTextureCube:function(a,d,c){var e,f=[],g=
new b.Texture(f,d),d=f.loadCount=0;for(e=a.length;d<e;++d){f[d]=new Image;f[d].onload=function(){f.loadCount=f.loadCount+1;if(f.loadCount===6){g.needsUpdate=true;c&&c()}};f[d].crossOrigin=this.crossOrigin;f[d].src=a[d]}return g},getNormalMap:function(a,b){var c=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]},b=b|1,e=a.width,f=a.height,g=document.createElement("canvas");g.width=e;g.height=f;var h=g.getContext("2d");h.drawImage(a,0,0);for(var i=h.getImageData(0,
0,e,f).data,j=h.createImageData(e,f),l=j.data,m=0;m<e;m++)for(var p=0;p<f;p++){var n=p-1<0?0:p-1,q=p+1>f-1?f-1:p+1,s=m-1<0?0:m-1,o=m+1>e-1?e-1:m+1,r=[],u=[0,0,i[(p*e+m)*4]/255*b];r.push([-1,0,i[(p*e+s)*4]/255*b]);r.push([-1,-1,i[(n*e+s)*4]/255*b]);r.push([0,-1,i[(n*e+m)*4]/255*b]);r.push([1,-1,i[(n*e+o)*4]/255*b]);r.push([1,0,i[(p*e+o)*4]/255*b]);r.push([1,1,i[(q*e+o)*4]/255*b]);r.push([0,1,i[(q*e+m)*4]/255*b]);r.push([-1,1,i[(q*e+s)*4]/255*b]);n=[];s=r.length;for(q=0;q<s;q++){var o=r[q],v=r[(q+1)%
s],o=[o[0]-u[0],o[1]-u[1],o[2]-u[2]],v=[v[0]-u[0],v[1]-u[1],v[2]-u[2]];n.push(c([o[1]*v[2]-o[2]*v[1],o[2]*v[0]-o[0]*v[2],o[0]*v[1]-o[1]*v[0]]))}r=[0,0,0];for(q=0;q<n.length;q++){r[0]=r[0]+n[q][0];r[1]=r[1]+n[q][1];r[2]=r[2]+n[q][2]}r[0]=r[0]/n.length;r[1]=r[1]/n.length;r[2]=r[2]/n.length;u=(p*e+m)*4;l[u]=(r[0]+1)/2*255|0;l[u+1]=(r[1]+1)/2*255|0;l[u+2]=r[2]*255|0;l[u+3]=255}h.putImageData(j,0,0);return g},generateDataTexture:function(a,d,c){for(var e=a*d,f=new Uint8Array(3*e),g=Math.floor(c.r*255),
h=Math.floor(c.g*255),c=Math.floor(c.b*255),i=0;i<e;i++){f[i*3]=g;f[i*3+1]=h;f[i*3+2]=c}a=new b.DataTexture(f,a,d,b.RGBFormat);a.needsUpdate=true;return a}};b.SceneUtils={showHierarchy:function(a,d){b.SceneUtils.traverseHierarchy(a,function(a){a.visible=d})},traverseHierarchy:function(a,d){var c,e,f=a.children.length;for(e=0;e<f;e++){c=a.children[e];d(c);b.SceneUtils.traverseHierarchy(c,d)}},createMultiMaterialObject:function(a,d){var c,e=d.length,f=new b.Object3D;for(c=0;c<e;c++){var g=new b.Mesh(a,
d[c]);f.add(g)}return f},cloneObject:function(a){var d;if(a instanceof b.MorphAnimMesh){d=new b.MorphAnimMesh(a.geometry,a.material);d.duration=a.duration;d.mirroredLoop=a.mirroredLoop;d.time=a.time;d.lastKeyframe=a.lastKeyframe;d.currentKeyframe=a.currentKeyframe;d.direction=a.direction;d.directionBackwards=a.directionBackwards}else if(a instanceof b.SkinnedMesh)d=new b.SkinnedMesh(a.geometry,a.material);else if(a instanceof b.Mesh)d=new b.Mesh(a.geometry,a.material);else if(a instanceof b.Line)d=
new b.Line(a.geometry,a.material,a.type);else if(a instanceof b.Ribbon)d=new b.Ribbon(a.geometry,a.material);else if(a instanceof b.ParticleSystem){d=new b.ParticleSystem(a.geometry,a.material);d.sortParticles=a.sortParticles}else if(a instanceof b.Particle)d=new b.Particle(a.material);else if(a instanceof b.Sprite){d=new b.Sprite({});d.color.copy(a.color);d.map=a.map;d.blending=a.blending;d.useScreenCoordinates=a.useScreenCoordinates;d.mergeWith3D=a.mergeWith3D;d.affectedByDistance=a.affectedByDistance;
d.scaleByViewport=a.scaleByViewport;d.alignment=a.alignment;d.rotation3d.copy(a.rotation3d);d.rotation=a.rotation;d.opacity=a.opacity;d.uvOffset.copy(a.uvOffset);d.uvScale.copy(a.uvScale)}else a instanceof b.LOD?d=new b.LOD:a instanceof b.Object3D&&(d=new b.Object3D);d.name=a.name;d.parent=a.parent;d.up.copy(a.up);d.position.copy(a.position);d.rotation instanceof b.Vector3&&d.rotation.copy(a.rotation);d.eulerOrder=a.eulerOrder;d.scale.copy(a.scale);d.dynamic=a.dynamic;d.doubleSided=a.doubleSided;
d.flipSided=a.flipSided;d.renderDepth=a.renderDepth;d.rotationAutoUpdate=a.rotationAutoUpdate;d.matrix.copy(a.matrix);d.matrixWorld.copy(a.matrixWorld);d.matrixRotationWorld.copy(a.matrixRotationWorld);d.matrixAutoUpdate=a.matrixAutoUpdate;d.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;d.quaternion.copy(a.quaternion);d.useQuaternion=a.useQuaternion;d.boundRadius=a.boundRadius;d.boundRadiusScale=a.boundRadiusScale;d.visible=a.visible;d.castShadow=a.castShadow;d.receiveShadow=a.receiveShadow;d.frustumCulled=
a.frustumCulled;for(var c=0;c<a.children.length;c++){var e=b.SceneUtils.cloneObject(a.children[c]);d.children[c]=e;e.parent=d}if(a instanceof b.LOD)for(c=0;c<a.LODs.length;c++)d.LODs[c]={visibleAtDistance:a.LODs[c].visibleAtDistance,object3D:d.children[c]};return d},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,d,c){var e=new b.Matrix4;e.getInverse(c.matrixWorld);a.applyMatrix(e);d.remove(a);c.add(a)}};b.WebGLRenderer&&(b.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",
value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},
normal:{uniforms:b.UniformsUtils.merge([b.UniformsLib.fog,b.UniformsLib.lights,b.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",
value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new b.Color(16777215)},uSpecularColor:{type:"c",value:new b.Color(1118481)},uAmbientColor:{type:"c",value:new b.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:0.5},uOffset:{type:"v2",value:new b.Vector2(0,0)},uRepeat:{type:"v2",value:new b.Vector2(1,1)},wrapRGB:{type:"v3",value:new b.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;",
b.ShaderChunk.shadowmap_pars_fragment,b.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nfloat pointDistance = vPointLight[ i ].w;\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",
b.ShaderChunk.shadowmap_fragment,b.ShaderChunk.linear_to_gamma_fragment,b.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",
b.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( normalize( vNormal.xyz ) * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",
b.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}});
b.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(a){var b=a.familyName.toLowerCase();this.faces[b]=this.faces[b]||{};this.faces[b][a.cssFontWeight]=this.faces[b][a.cssFontWeight]||{};this.faces[b][a.cssFontWeight][a.cssFontStyle]=a;return this.faces[b][a.cssFontWeight][a.cssFontStyle]=a},drawText:function(a){for(var d=this.getFace(),c=this.size/d.resolution,e=0,f=
(""+a).split(""),g=f.length,h=[],a=0;a<g;a++){var i=new b.Path,i=this.extractGlyphPoints(f[a],d,c,e,i),e=e+i.offset;h.push(i.path)}return{paths:h,offset:e/2}},extractGlyphPoints:function(a,d,c,e,f){var g=[],h,i,j,l,m,p,n,q,s,o,r,u=d.glyphs[a]||d.glyphs["?"];if(u){if(u.o){d=u._cachedOutline||(u._cachedOutline=u.o.split(" "));l=d.length;for(a=0;a<l;){j=d[a++];switch(j){case "m":j=d[a++]*c+e;m=d[a++]*c;f.moveTo(j,m);break;case "l":j=d[a++]*c+e;m=d[a++]*c;f.lineTo(j,m);break;case "q":j=d[a++]*c+e;m=d[a++]*
c;q=d[a++]*c+e;s=d[a++]*c;f.quadraticCurveTo(q,s,j,m);if(h=g[g.length-1]){p=h.x;n=h.y;h=1;for(i=this.divisions;h<=i;h++){var v=h/i;b.Shape.Utils.b2(v,p,q,j);b.Shape.Utils.b2(v,n,s,m)}}break;case "b":j=d[a++]*c+e;m=d[a++]*c;q=d[a++]*c+e;s=d[a++]*-c;o=d[a++]*c+e;r=d[a++]*-c;f.bezierCurveTo(j,m,q,s,o,r);if(h=g[g.length-1]){p=h.x;n=h.y;h=1;for(i=this.divisions;h<=i;h++){v=h/i;b.Shape.Utils.b3(v,p,q,o,j);b.Shape.Utils.b3(v,n,s,r,m)}}}}}return{offset:u.ha*c,path:f}}}};b.FontUtils.generateShapes=function(a,
d){var d=d||{},c=d.curveSegments!==void 0?d.curveSegments:4,e=d.font!==void 0?d.font:"helvetiker",f=d.weight!==void 0?d.weight:"normal",g=d.style!==void 0?d.style:"normal";b.FontUtils.size=d.size!==void 0?d.size:100;b.FontUtils.divisions=c;b.FontUtils.face=e;b.FontUtils.weight=f;b.FontUtils.style=g;c=b.FontUtils.drawText(a).paths;e=[];f=0;for(g=c.length;f<g;f++)Array.prototype.push.apply(e,c[f].toShapes());return e};(function(a){var b=function(a){for(var b=a.length,d=0,g=b-1,h=0;h<b;g=h++)d=d+(a[g].x*
a[h].y-a[h].x*a[g].y);return d*0.5};a.Triangulate=function(a,e){var f=a.length;if(f<3)return null;var g=[],h=[],i=[],j,l,m;if(b(a)>0)for(l=0;l<f;l++)h[l]=l;else for(l=0;l<f;l++)h[l]=f-1-l;var p=2*f;for(l=f-1;f>2;){if(p--<=0){console.log("Warning, unable to triangulate polygon!");break}j=l;f<=j&&(j=0);l=j+1;f<=l&&(l=0);m=l+1;f<=m&&(m=0);var n;a:{n=a;var q=j,s=l,o=m,r=f,u=h,v=void 0,x=void 0,t=void 0,y=void 0,G=void 0,D=void 0,B=void 0,w=void 0,I=void 0,x=n[u[q]].x,t=n[u[q]].y,y=n[u[s]].x,G=n[u[s]].y,
D=n[u[o]].x,B=n[u[o]].y;if(1.0E-10>(y-x)*(B-t)-(G-t)*(D-x))n=false;else{for(v=0;v<r;v++)if(!(v==q||v==s||v==o)){var w=n[u[v]].x,I=n[u[v]].y,J=void 0,O=void 0,S=void 0,Z=void 0,C=void 0,H=void 0,R=void 0,E=void 0,k=void 0,Q=void 0,N=void 0,T=void 0,J=S=C=void 0,J=D-y,O=B-G,S=x-D,Z=t-B,C=y-x,H=G-t,R=w-x,E=I-t,k=w-y,Q=I-G,N=w-D,T=I-B,J=J*Q-O*k,C=C*E-H*R,S=S*T-Z*N;if(J>=0&&S>=0&&C>=0){n=false;break a}}n=true}}if(n){g.push([a[h[j]],a[h[l]],a[h[m]]]);i.push([h[j],h[l],h[m]]);j=l;for(m=l+1;m<f;j++,m++)h[j]=
h[m];f--;p=2*f}}return e?i:g};a.Triangulate.area=b;return a})(b.FontUtils);self._typeface_js={faces:b.FontUtils.faces,loadFace:b.FontUtils.loadFace};b.BufferGeometry=function(){this.id=b.GeometryCount++;this.vertexColorArray=this.vertexUvArray=this.vertexNormalArray=this.vertexPositionArray=this.vertexIndexArray=this.vertexColorBuffer=this.vertexUvBuffer=this.vertexNormalBuffer=this.vertexPositionBuffer=this.vertexIndexBuffer=null;this.dynamic=false;this.boundingSphere=this.boundingBox=null;this.morphTargets=
[]};b.BufferGeometry.prototype={constructor:b.BufferGeometry,computeBoundingBox:function(){},computeBoundingSphere:function(){}};b.Curve=function(){};b.Curve.prototype.getPoint=function(){console.log("Warning, getPoint() not implemented!");return null};b.Curve.prototype.getPointAt=function(a){return this.getPoint(this.getUtoTmapping(a))};b.Curve.prototype.getPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c};b.Curve.prototype.getSpacedPoints=function(a){a||
(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c};b.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]};b.Curve.prototype.getLengths=function(a){a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=false;var b=[],c,e=this.getPoint(0),f,g=0;b.push(0);for(f=1;f<=a;f++){c=this.getPoint(f/a);g=g+c.distanceTo(e);b.push(g);
e=c}return this.cacheArcLengths=b};b.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};b.Curve.prototype.getUtoTmapping=function(a,b){var c=this.getLengths(),e=0,f=c.length,g;g=b?b:a*c[f-1];for(var h=0,i=f-1,j;h<=i;){e=Math.floor(h+(i-h)/2);j=c[e]-g;if(j<0)h=e+1;else if(j>0)i=e-1;else{i=e;break}}e=i;if(c[e]==g)return e/(f-1);h=c[e];return c=(e+(g-h)/(c[e+1]-h))/(f-1)};b.Curve.prototype.getNormalVector=function(a){a=this.getTangent(a);return new b.Vector2(-a.y,a.x)};
b.Curve.prototype.getTangent=function(a){var b=a-1.0E-4,a=a+1.0E-4;b<0&&(b=0);a>1&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().subSelf(b).normalize()};b.Curve.prototype.getTangentAt=function(a){return this.getTangent(this.getUtoTmapping(a))};b.LineCurve=function(a,b){this.v1=a;this.v2=b};b.LineCurve.prototype=Object.create(b.Curve.prototype);b.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().subSelf(this.v1);b.multiplyScalar(a).addSelf(this.v1);return b};b.LineCurve.prototype.getPointAt=
function(a){return this.getPoint(a)};b.LineCurve.prototype.getTangent=function(){return this.v2.clone().subSelf(this.v1).normalize()};b.QuadraticBezierCurve=function(a,b,c){this.v0=a;this.v1=b;this.v2=c};b.QuadraticBezierCurve.prototype=Object.create(b.Curve.prototype);b.QuadraticBezierCurve.prototype.getPoint=function(a){var d;d=b.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x);a=b.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y);return new b.Vector2(d,a)};b.QuadraticBezierCurve.prototype.getTangent=
function(a){var d;d=b.Curve.Utils.tangentQuadraticBezier(a,this.v0.x,this.v1.x,this.v2.x);a=b.Curve.Utils.tangentQuadraticBezier(a,this.v0.y,this.v1.y,this.v2.y);d=new b.Vector2(d,a);d.normalize();return d};b.CubicBezierCurve=function(a,b,c,e){this.v0=a;this.v1=b;this.v2=c;this.v3=e};b.CubicBezierCurve.prototype=Object.create(b.Curve.prototype);b.CubicBezierCurve.prototype.getPoint=function(a){var d;d=b.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=b.Shape.Utils.b3(a,this.v0.y,this.v1.y,
this.v2.y,this.v3.y);return new b.Vector2(d,a)};b.CubicBezierCurve.prototype.getTangent=function(a){var d;d=b.Curve.Utils.tangentCubicBezier(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=b.Curve.Utils.tangentCubicBezier(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);d=new b.Vector2(d,a);d.normalize();return d};b.SplineCurve=function(a){this.points=a==void 0?[]:a};b.SplineCurve.prototype=Object.create(b.Curve.prototype);b.SplineCurve.prototype.getPoint=function(a){var d=new b.Vector2,c=[],e=this.points,
f;f=(e.length-1)*a;a=Math.floor(f);f=f-a;c[0]=a==0?a:a-1;c[1]=a;c[2]=a>e.length-2?e.length-1:a+1;c[3]=a>e.length-3?e.length-1:a+2;d.x=b.Curve.Utils.interpolate(e[c[0]].x,e[c[1]].x,e[c[2]].x,e[c[3]].x,f);d.y=b.Curve.Utils.interpolate(e[c[0]].y,e[c[1]].y,e[c[2]].y,e[c[3]].y,f);return d};b.EllipseCurve=function(a,b,c,e,f,g,h){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=e;this.aStartAngle=f;this.aEndAngle=g;this.aClockwise=h};b.EllipseCurve.prototype=Object.create(b.Curve.prototype);b.EllipseCurve.prototype.getPoint=
function(a){var d=this.aEndAngle-this.aStartAngle;this.aClockwise||(a=1-a);d=this.aStartAngle+a*d;a=this.aX+this.xRadius*Math.cos(d);d=this.aY+this.yRadius*Math.sin(d);return new b.Vector2(a,d)};b.ArcCurve=function(a,d,c,e,f,g){b.EllipseCurve.call(this,a,d,c,c,e,f,g)};b.ArcCurve.prototype=Object.create(b.EllipseCurve.prototype);b.Curve.Utils={tangentQuadraticBezier:function(a,b,c,e){return 2*(1-a)*(c-b)+2*a*(e-c)},tangentCubicBezier:function(a,b,c,e,f){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*
(1-a)+6*a*e*(1-a)-3*a*a*e+3*a*a*f},tangentSpline:function(a){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,e,f){var a=(c-a)*0.5,e=(e-b)*0.5,g=f*f;return(2*b-2*c+a+e)*f*g+(-3*b+3*c-2*a-e)*g+a*f+b}};b.Curve.create=function(a,d){a.prototype=Object.create(b.Curve.prototype);a.prototype.getPoint=d;return a};b.LineCurve3=b.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){var d=new b.Vector3;d.sub(this.v2,this.v1);d.multiplyScalar(a);d.addSelf(this.v1);return d});
b.QuadraticBezierCurve3=b.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var d,c;d=b.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x);c=b.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y);a=b.Shape.Utils.b2(a,this.v0.z,this.v1.z,this.v2.z);return new b.Vector3(d,c,a)});b.CubicBezierCurve3=b.Curve.create(function(a,b,c,e){this.v0=a;this.v1=b;this.v2=c;this.v3=e},function(a){var d,c;d=b.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c=b.Shape.Utils.b3(a,this.v0.y,this.v1.y,
this.v2.y,this.v3.y);a=b.Shape.Utils.b3(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new b.Vector3(d,c,a)});b.SplineCurve3=b.Curve.create(function(a){this.points=a==void 0?[]:a},function(a){var d=new b.Vector3,c=[],e=this.points,f,a=(e.length-1)*a;f=Math.floor(a);a=a-f;c[0]=f==0?f:f-1;c[1]=f;c[2]=f>e.length-2?e.length-1:f+1;c[3]=f>e.length-3?e.length-1:f+2;f=e[c[0]];var g=e[c[1]],h=e[c[2]],c=e[c[3]];d.x=b.Curve.Utils.interpolate(f.x,g.x,h.x,c.x,a);d.y=b.Curve.Utils.interpolate(f.y,g.y,h.y,c.y,
a);d.z=b.Curve.Utils.interpolate(f.z,g.z,h.z,c.z,a);return d});b.ClosedSplineCurve3=b.Curve.create(function(a){this.points=a==void 0?[]:a},function(a){var d=new b.Vector3,c=[],e=this.points,f;f=(e.length-0)*a;a=Math.floor(f);f=f-a;a=a+(a>0?0:(Math.floor(Math.abs(a)/e.length)+1)*e.length);c[0]=(a-1)%e.length;c[1]=a%e.length;c[2]=(a+1)%e.length;c[3]=(a+2)%e.length;d.x=b.Curve.Utils.interpolate(e[c[0]].x,e[c[1]].x,e[c[2]].x,e[c[3]].x,f);d.y=b.Curve.Utils.interpolate(e[c[0]].y,e[c[1]].y,e[c[2]].y,e[c[3]].y,
f);d.z=b.Curve.Utils.interpolate(e[c[0]].z,e[c[1]].z,e[c[2]].z,e[c[3]].z,f);return d});b.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};b.CurvePath.prototype=Object.create(b.Curve.prototype);b.CurvePath.prototype.add=function(a){this.curves.push(a)};b.CurvePath.prototype.checkConnection=function(){};b.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0),d=this.curves[this.curves.length-1].getPoint(1);a.equals(d)||this.curves.push(new b.LineCurve(d,a))};
b.CurvePath.prototype.getPoint=function(a){for(var b=a*this.getLength(),c=this.getCurveLengths(),a=0;a<c.length;){if(c[a]>=b){b=c[a]-b;a=this.curves[a];b=1-b/a.getLength();return a.getPointAt(b)}a++}return null};b.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};b.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var a=[],b=0,c,e=this.curves.length;for(c=0;c<e;c++){b=
b+this.curves[c].getLength();a.push(b)}return this.cacheLengths=a};b.CurvePath.prototype.getBoundingBox=function(){var a=this.getPoints(),d,c,e,f;d=c=Number.NEGATIVE_INFINITY;e=f=Number.POSITIVE_INFINITY;var g,h,i,j;j=new b.Vector2;h=0;for(i=a.length;h<i;h++){g=a[h];if(g.x>d)d=g.x;else if(g.x<e)e=g.x;if(g.y>c)c=g.y;else if(g.y<f)f=g.y;j.addSelf(g.x,g.y)}return{minX:e,minY:f,maxX:d,maxY:c,centroid:j.divideScalar(i)}};b.CurvePath.prototype.createPointsGeometry=function(a){return this.createGeometry(this.getPoints(a,
true))};b.CurvePath.prototype.createSpacedPointsGeometry=function(a){return this.createGeometry(this.getSpacedPoints(a,true))};b.CurvePath.prototype.createGeometry=function(a){for(var d=new b.Geometry,c=0;c<a.length;c++)d.vertices.push(new b.Vector3(a[c].x,a[c].y,0));return d};b.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)};b.CurvePath.prototype.getTransformedPoints=function(a,b){var c=this.getPoints(a),e,f;if(!b)b=this.bends;e=0;for(f=b.length;e<f;e++)c=this.getWrapPoints(c,b[e]);
return c};b.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c=this.getSpacedPoints(a),e,f;if(!b)b=this.bends;e=0;for(f=b.length;e<f;e++)c=this.getWrapPoints(c,b[e]);return c};b.CurvePath.prototype.getWrapPoints=function(a,b){var c=this.getBoundingBox(),e,f,g,h,i,j;e=0;for(f=a.length;e<f;e++){g=a[e];h=g.x;i=g.y;j=h/c.maxX;j=b.getUtoTmapping(j,h);h=b.getPoint(j);i=b.getNormalVector(j).multiplyScalar(i);g.x=h.x+i.x;g.y=h.y+i.y}return a};b.Gyroscope=function(){b.Object3D.call(this)};
b.Gyroscope.prototype=Object.create(b.Object3D.prototype);b.Gyroscope.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a){if(this.parent){this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld);this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject);this.matrixWorld.compose(this.translationWorld,this.rotationObject,
this.scaleWorld)}else this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false;a=true}for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)};b.Gyroscope.prototype.translationWorld=new b.Vector3;b.Gyroscope.prototype.translationObject=new b.Vector3;b.Gyroscope.prototype.rotationWorld=new b.Quaternion;b.Gyroscope.prototype.rotationObject=new b.Quaternion;b.Gyroscope.prototype.scaleWorld=new b.Vector3;b.Gyroscope.prototype.scaleObject=new b.Vector3;b.Path=function(a){b.CurvePath.call(this);
this.actions=[];a&&this.fromPoints(a)};b.Path.prototype=Object.create(b.CurvePath.prototype);b.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};b.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)};b.Path.prototype.moveTo=function(a,d){var c=Array.prototype.slice.call(arguments);this.actions.push({action:b.PathActions.MOVE_TO,
args:c})};b.Path.prototype.lineTo=function(a,d){var c=Array.prototype.slice.call(arguments),e=this.actions[this.actions.length-1].args;this.curves.push(new b.LineCurve(new b.Vector2(e[e.length-2],e[e.length-1]),new b.Vector2(a,d)));this.actions.push({action:b.PathActions.LINE_TO,args:c})};b.Path.prototype.quadraticCurveTo=function(a,d,c,e){var f=Array.prototype.slice.call(arguments),g=this.actions[this.actions.length-1].args;this.curves.push(new b.QuadraticBezierCurve(new b.Vector2(g[g.length-2],
g[g.length-1]),new b.Vector2(a,d),new b.Vector2(c,e)));this.actions.push({action:b.PathActions.QUADRATIC_CURVE_TO,args:f})};b.Path.prototype.bezierCurveTo=function(a,d,c,e,f,g){var h=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args;this.curves.push(new b.CubicBezierCurve(new b.Vector2(i[i.length-2],i[i.length-1]),new b.Vector2(a,d),new b.Vector2(c,e),new b.Vector2(f,g)));this.actions.push({action:b.PathActions.BEZIER_CURVE_TO,args:h})};b.Path.prototype.splineThru=function(a){var d=
Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,c=[new b.Vector2(c[c.length-2],c[c.length-1])];Array.prototype.push.apply(c,a);this.curves.push(new b.SplineCurve(c));this.actions.push({action:b.PathActions.CSPLINE_THRU,args:d})};b.Path.prototype.ellipse=function(a,b,c,e,f,g,h){var i=this.actions[this.actions.length-1];this.absellipse(i.x+a,i.y+b,c,e,f,g,h)};b.Path.prototype.arc=function(a,b,c,e,f,g){var h=this.actions[this.actions.length-1];this.absarc(h.x+a,h.y+b,
c,e,f,g)};b.Path.prototype.absellipse=function(a,d,c,e,f,g,h){var i=Array.prototype.slice.call(arguments),j=new b.EllipseCurve(a,d,c,e,f,g,h);this.curves.push(j);j=j.getPoint(h?1:0);i.push(j.x);i.push(j.y);this.actions.push({action:b.PathActions.ELLIPSE,args:i})};b.Path.prototype.absarc=function(a,b,c,e,f,g){this.absellipse(a,b,c,c,e,f,g)};b.Path.prototype.getSpacedPoints=function(a){a||(a=40);for(var b=[],c=0;c<a;c++)b.push(this.getPoint(c/a));return b};b.Path.prototype.getPoints=function(a,d){if(this.useSpacedPoints){console.log("tata");
return this.getSpacedPoints(a,d)}var a=a||12,c=[],e,f,g,h,i,j,l,m,p,n,q,s,o;e=0;for(f=this.actions.length;e<f;e++){g=this.actions[e];h=g.action;g=g.args;switch(h){case b.PathActions.MOVE_TO:c.push(new b.Vector2(g[0],g[1]));break;case b.PathActions.LINE_TO:c.push(new b.Vector2(g[0],g[1]));break;case b.PathActions.QUADRATIC_CURVE_TO:i=g[2];j=g[3];p=g[0];n=g[1];if(c.length>0){h=c[c.length-1];q=h.x;s=h.y}else{h=this.actions[e-1].args;q=h[h.length-2];s=h[h.length-1]}for(g=1;g<=a;g++){o=g/a;h=b.Shape.Utils.b2(o,
q,p,i);o=b.Shape.Utils.b2(o,s,n,j);c.push(new b.Vector2(h,o))}break;case b.PathActions.BEZIER_CURVE_TO:i=g[4];j=g[5];p=g[0];n=g[1];l=g[2];m=g[3];if(c.length>0){h=c[c.length-1];q=h.x;s=h.y}else{h=this.actions[e-1].args;q=h[h.length-2];s=h[h.length-1]}for(g=1;g<=a;g++){o=g/a;h=b.Shape.Utils.b3(o,q,p,l,i);o=b.Shape.Utils.b3(o,s,n,m,j);c.push(new b.Vector2(h,o))}break;case b.PathActions.CSPLINE_THRU:h=this.actions[e-1].args;o=[new b.Vector2(h[h.length-2],h[h.length-1])];h=a*g[0].length;o=o.concat(g[0]);
o=new b.SplineCurve(o);for(g=1;g<=h;g++)c.push(o.getPointAt(g/h));break;case b.PathActions.ARC:i=g[0];j=g[1];n=g[2];l=g[3];h=g[4];p=!!g[5];q=h-l;s=a*2;for(g=1;g<=s;g++){o=g/s;p||(o=1-o);o=l+o*q;h=i+n*Math.cos(o);o=j+n*Math.sin(o);c.push(new b.Vector2(h,o))}break;case b.PathActions.ELLIPSE:i=g[0];j=g[1];n=g[2];m=g[3];l=g[4];h=g[5];p=!!g[6];q=h-l;s=a*2;for(g=1;g<=s;g++){o=g/s;p||(o=1-o);o=l+o*q;h=i+n*Math.cos(o);o=j+m*Math.sin(o);c.push(new b.Vector2(h,o))}}}e=c[c.length-1];Math.abs(e.x-c[0].x)<1.0E-10&&
Math.abs(e.y-c[0].y)<1.0E-10&&c.splice(c.length-1,1);d&&c.push(c[0]);return c};b.Path.prototype.toShapes=function(){var a,d,c,e,f=[],g=new b.Path;a=0;for(d=this.actions.length;a<d;a++){c=this.actions[a];e=c.args;c=c.action;if(c==b.PathActions.MOVE_TO&&g.actions.length!=0){f.push(g);g=new b.Path}g[c].apply(g,e)}g.actions.length!=0&&f.push(g);if(f.length==0)return[];var h;e=[];a=!b.Shape.Utils.isClockWise(f[0].getPoints());if(f.length==1){g=f[0];h=new b.Shape;h.actions=g.actions;h.curves=g.curves;e.push(h);
return e}if(a){h=new b.Shape;a=0;for(d=f.length;a<d;a++){g=f[a];if(b.Shape.Utils.isClockWise(g.getPoints())){h.actions=g.actions;h.curves=g.curves;e.push(h);h=new b.Shape}else h.holes.push(g)}}else{a=0;for(d=f.length;a<d;a++){g=f[a];if(b.Shape.Utils.isClockWise(g.getPoints())){h&&e.push(h);h=new b.Shape;h.actions=g.actions;h.curves=g.curves}else h.holes.push(g)}e.push(h)}return e};b.Shape=function(){b.Path.apply(this,arguments);this.holes=[]};b.Shape.prototype=Object.create(b.Path.prototype);b.Shape.prototype.extrude=
function(a){return new b.ExtrudeGeometry(this,a)};b.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,e=[];for(b=0;b<c;b++)e[b]=this.holes[b].getTransformedPoints(a,this.bends);return e};b.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,e=[];for(b=0;b<c;b++)e[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends);return e};b.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}};b.Shape.prototype.extractPoints=
function(a){return this.useSpacedPoints?this.extractAllSpacedPoints(a):this.extractAllPoints(a)};b.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}};b.Shape.Utils={removeHoles:function(a,d){var c=a.concat(),e=c.concat(),f,g,h,i,j,l,m,p,n,q,s=[];for(j=0;j<d.length;j++){l=d[j];Array.prototype.push.apply(e,l);g=Number.POSITIVE_INFINITY;for(f=0;f<l.length;f++){n=l[f];q=[];for(p=0;p<c.length;p++){m=c[p];m=n.distanceToSquared(m);
q.push(m);if(m<g){g=m;h=f;i=p}}}f=i-1>=0?i-1:c.length-1;g=h-1>=0?h-1:l.length-1;var o=[l[h],c[i],c[f]];p=b.FontUtils.Triangulate.area(o);var r=[l[h],l[g],c[i]];n=b.FontUtils.Triangulate.area(r);q=i;m=h;i=i+1;h=h+-1;i<0&&(i=i+c.length);i=i%c.length;h<0&&(h=h+l.length);h=h%l.length;f=i-1>=0?i-1:c.length-1;g=h-1>=0?h-1:l.length-1;o=[l[h],c[i],c[f]];o=b.FontUtils.Triangulate.area(o);r=[l[h],l[g],c[i]];r=b.FontUtils.Triangulate.area(r);if(p+n>o+r){i=q;h=m;i<0&&(i=i+c.length);i=i%c.length;h<0&&(h=h+l.length);
h=h%l.length;f=i-1>=0?i-1:c.length-1;g=h-1>=0?h-1:l.length-1}p=c.slice(0,i);n=c.slice(i);q=l.slice(h);m=l.slice(0,h);g=[l[h],l[g],c[i]];s.push([l[h],c[i],c[f]]);s.push(g);c=p.concat(q).concat(m).concat(n)}return{shape:c,isolatedPts:s,allpoints:e}},triangulateShape:function(a,d){var c=b.Shape.Utils.removeHoles(a,d),e=c.allpoints,f=c.isolatedPts,c=b.FontUtils.Triangulate(c.shape,false),g,h,i,j,l={};g=0;for(h=e.length;g<h;g++){j=e[g].x+":"+e[g].y;l[j]!==void 0&&console.log("Duplicate point",j);l[j]=
g}g=0;for(h=c.length;g<h;g++){i=c[g];for(e=0;e<3;e++){j=i[e].x+":"+i[e].y;j=l[j];j!==void 0&&(i[e]=j)}}g=0;for(h=f.length;g<h;g++){i=f[g];for(e=0;e<3;e++){j=i[e].x+":"+i[e].y;j=l[j];j!==void 0&&(i[e]=j)}}return c.concat(f)},isClockWise:function(a){return b.FontUtils.Triangulate.area(a)<0},b2p0:function(a,b){var c=1-a;return c*c*b},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,b,c,e){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,e)},b3p0:function(a,b){var c=
1-a;return c*c*c*b},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b},b3p2:function(a,b){return 3*(1-a)*a*a*b},b3p3:function(a,b){return a*a*a*b},b3:function(a,b,c,e,f){return this.b3p0(a,b)+this.b3p1(a,c)+this.b3p2(a,e)+this.b3p3(a,f)}};b.AnimationHandler=function(){var a=[],d={},c={update:function(b){for(var c=0;c<a.length;c++)a[c].update(b)},addToUpdate:function(b){a.indexOf(b)===-1&&a.push(b)},removeFromUpdate:function(b){b=a.indexOf(b);b!==-1&&a.splice(b,1)},add:function(a){d[a.name]!==void 0&&
console.log("THREE.AnimationHandler.add: Warning! "+a.name+" already exists in library. Overwriting.");d[a.name]=a;if(a.initialized!==true){for(var c=0;c<a.hierarchy.length;c++){for(var e=0;e<a.hierarchy[c].keys.length;e++){if(a.hierarchy[c].keys[e].time<0)a.hierarchy[c].keys[e].time=0;if(a.hierarchy[c].keys[e].rot!==void 0&&!(a.hierarchy[c].keys[e].rot instanceof b.Quaternion)){var i=a.hierarchy[c].keys[e].rot;a.hierarchy[c].keys[e].rot=new b.Quaternion(i[0],i[1],i[2],i[3])}}if(a.hierarchy[c].keys.length&&
a.hierarchy[c].keys[0].morphTargets!==void 0){i={};for(e=0;e<a.hierarchy[c].keys.length;e++)for(var j=0;j<a.hierarchy[c].keys[e].morphTargets.length;j++){var l=a.hierarchy[c].keys[e].morphTargets[j];i[l]=-1}a.hierarchy[c].usedMorphTargets=i;for(e=0;e<a.hierarchy[c].keys.length;e++){var m={};for(l in i){for(j=0;j<a.hierarchy[c].keys[e].morphTargets.length;j++)if(a.hierarchy[c].keys[e].morphTargets[j]===l){m[l]=a.hierarchy[c].keys[e].morphTargetsInfluences[j];break}j===a.hierarchy[c].keys[e].morphTargets.length&&
(m[l]=0)}a.hierarchy[c].keys[e].morphTargetsInfluences=m}}for(e=1;e<a.hierarchy[c].keys.length;e++)if(a.hierarchy[c].keys[e].time===a.hierarchy[c].keys[e-1].time){a.hierarchy[c].keys.splice(e,1);e--}for(e=0;e<a.hierarchy[c].keys.length;e++)a.hierarchy[c].keys[e].index=e}e=parseInt(a.length*a.fps,10);a.JIT={};a.JIT.hierarchy=[];for(c=0;c<a.hierarchy.length;c++)a.JIT.hierarchy.push(Array(e));a.initialized=true}},get:function(a){if(typeof a==="string"){if(d[a])return d[a];console.log("THREE.AnimationHandler.get: Couldn't find animation "+
a);return null}},parse:function(a){var c=[];if(a instanceof b.SkinnedMesh)for(var d=0;d<a.bones.length;d++)c.push(a.bones[d]);else e(a,c);return c}},e=function(a,b){b.push(a);for(var c=0;c<a.children.length;c++)e(a.children[c],b)};c.LINEAR=0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();b.Animation=function(a,d,c,e){this.root=a;this.data=b.AnimationHandler.get(d);this.hierarchy=b.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=this.isPaused=true;this.interpolationType=
c!==void 0?c:b.AnimationHandler.LINEAR;this.JITCompile=e!==void 0?e:true;this.points=[];this.target=new b.Vector3};b.Animation.prototype.play=function(a,d){if(!this.isPlaying){this.isPlaying=true;this.loop=a!==void 0?a:true;this.currentTime=d!==void 0?d:0;var c,e=this.hierarchy.length,f;for(c=0;c<e;c++){f=this.hierarchy[c];if(this.interpolationType!==b.AnimationHandler.CATMULLROM_FORWARD)f.useQuaternion=true;f.matrixAutoUpdate=true;if(f.animationCache===void 0){f.animationCache={};f.animationCache.prevKey=
{pos:0,rot:0,scl:0};f.animationCache.nextKey={pos:0,rot:0,scl:0};f.animationCache.originalMatrix=f instanceof b.Bone?f.skinMatrix:f.matrix}var g=f.animationCache.prevKey;f=f.animationCache.nextKey;g.pos=this.data.hierarchy[c].keys[0];g.rot=this.data.hierarchy[c].keys[0];g.scl=this.data.hierarchy[c].keys[0];f.pos=this.getNextKeyWith("pos",c,1);f.rot=this.getNextKeyWith("rot",c,1);f.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=false;b.AnimationHandler.addToUpdate(this)};b.Animation.prototype.pause=
function(){this.isPaused?b.AnimationHandler.addToUpdate(this):b.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};b.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=false;b.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.hierarchy.length;a++)if(this.hierarchy[a].animationCache!==void 0){this.hierarchy[a]instanceof b.Bone?this.hierarchy[a].skinMatrix=this.hierarchy[a].animationCache.originalMatrix:this.hierarchy[a].matrix=this.hierarchy[a].animationCache.originalMatrix;
delete this.hierarchy[a].animationCache}};b.Animation.prototype.update=function(a){if(this.isPlaying){var d=["pos","rot","scl"],c,e,f,g,h,i,j,l,m=this.data.JIT.hierarchy,p,n;n=this.currentTime=this.currentTime+a*this.timeScale;p=this.currentTime=this.currentTime%this.data.length;l=parseInt(Math.min(p*this.data.fps,this.data.length*this.data.fps),10);for(var q=0,s=this.hierarchy.length;q<s;q++){a=this.hierarchy[q];j=a.animationCache;if(this.JITCompile&&m[q][l]!==void 0)if(a instanceof b.Bone){a.skinMatrix=
m[q][l];a.matrixAutoUpdate=false;a.matrixWorldNeedsUpdate=false}else{a.matrix=m[q][l];a.matrixAutoUpdate=false;a.matrixWorldNeedsUpdate=true}else{if(this.JITCompile)a instanceof b.Bone?a.skinMatrix=a.animationCache.originalMatrix:a.matrix=a.animationCache.originalMatrix;for(var o=0;o<3;o++){c=d[o];h=j.prevKey[c];i=j.nextKey[c];if(i.time<=n){if(p<n)if(this.loop){h=this.data.hierarchy[q].keys[0];for(i=this.getNextKeyWith(c,q,1);i.time<p;){h=i;i=this.getNextKeyWith(c,q,i.index+1)}}else{this.stop();return}else{do{h=
i;i=this.getNextKeyWith(c,q,i.index+1)}while(i.time<p)}j.prevKey[c]=h;j.nextKey[c]=i}a.matrixAutoUpdate=true;a.matrixWorldNeedsUpdate=true;e=(p-h.time)/(i.time-h.time);f=h[c];g=i[c];if(e<0||e>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+e+" on bone "+q);e=e<0?0:1}if(c==="pos"){c=a.position;if(this.interpolationType===b.AnimationHandler.LINEAR){c.x=f[0]+(g[0]-f[0])*e;c.y=f[1]+(g[1]-f[1])*e;c.z=f[2]+(g[2]-f[2])*e}else if(this.interpolationType===b.AnimationHandler.CATMULLROM||
this.interpolationType===b.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=this.getPrevKeyWith("pos",q,h.index-1).pos;this.points[1]=f;this.points[2]=g;this.points[3]=this.getNextKeyWith("pos",q,i.index+1).pos;e=e*0.33+0.33;f=this.interpolateCatmullRom(this.points,e);c.x=f[0];c.y=f[1];c.z=f[2];if(this.interpolationType===b.AnimationHandler.CATMULLROM_FORWARD){e=this.interpolateCatmullRom(this.points,e*1.01);this.target.set(e[0],e[1],e[2]);this.target.subSelf(c);this.target.y=0;this.target.normalize();
e=Math.atan2(this.target.x,this.target.z);a.rotation.set(0,e,0)}}}else if(c==="rot")b.Quaternion.slerp(f,g,a.quaternion,e);else if(c==="scl"){c=a.scale;c.x=f[0]+(g[0]-f[0])*e;c.y=f[1]+(g[1]-f[1])*e;c.z=f[2]+(g[2]-f[2])*e}}}}if(this.JITCompile&&m[0][l]===void 0){this.hierarchy[0].updateMatrixWorld(true);for(q=0;q<this.hierarchy.length;q++)m[q][l]=this.hierarchy[q]instanceof b.Bone?this.hierarchy[q].skinMatrix.clone():this.hierarchy[q].matrix.clone()}}};b.Animation.prototype.interpolateCatmullRom=function(a,
b){var c=[],e=[],f,g,h,i,j,l;f=(a.length-1)*b;g=Math.floor(f);f=f-g;c[0]=g===0?g:g-1;c[1]=g;c[2]=g>a.length-2?g:g+1;c[3]=g>a.length-3?g:g+2;g=a[c[0]];i=a[c[1]];j=a[c[2]];l=a[c[3]];c=f*f;h=f*c;e[0]=this.interpolate(g[0],i[0],j[0],l[0],f,c,h);e[1]=this.interpolate(g[1],i[1],j[1],l[1],f,c,h);e[2]=this.interpolate(g[2],i[2],j[2],l[2],f,c,h);return e};b.Animation.prototype.interpolate=function(a,b,c,e,f,g,h){a=(c-a)*0.5;e=(e-b)*0.5;return(2*(b-c)+a+e)*h+(-3*(b-c)-2*a-e)*g+a*f+b};b.Animation.prototype.getNextKeyWith=
function(a,d,c){for(var e=this.data.hierarchy[d].keys,c=this.interpolationType===b.AnimationHandler.CATMULLROM||this.interpolationType===b.AnimationHandler.CATMULLROM_FORWARD?c<e.length-1?c:e.length-1:c%e.length;c<e.length;c++)if(e[c][a]!==void 0)return e[c];return this.data.hierarchy[d].keys[0]};b.Animation.prototype.getPrevKeyWith=function(a,d,c){for(var e=this.data.hierarchy[d].keys,c=this.interpolationType===b.AnimationHandler.CATMULLROM||this.interpolationType===b.AnimationHandler.CATMULLROM_FORWARD?
c>0?c:0:c>=0?c:c+e.length;c>=0;c--)if(e[c][a]!==void 0)return e[c];return this.data.hierarchy[d].keys[e.length-1]};b.KeyFrameAnimation=function(a,d,c){this.root=a;this.data=b.AnimationHandler.get(d);this.hierarchy=b.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=0.0010;this.isPlaying=false;this.loop=this.isPaused=true;this.JITCompile=c!==void 0?c:true;a=0;for(d=this.hierarchy.length;a<d;a++){var c=this.data.hierarchy[a].sids,e=this.hierarchy[a];if(this.data.hierarchy[a].keys.length&&
c){for(var f=0;f<c.length;f++){var g=c[f],h=this.getNextKeyWith(g,a,0);h&&h.apply(g)}e.matrixAutoUpdate=false;this.data.hierarchy[a].node.updateMatrix();e.matrixWorldNeedsUpdate=true}}};b.KeyFrameAnimation.prototype.play=function(a,d){if(!this.isPlaying){this.isPlaying=true;this.loop=a!==void 0?a:true;this.currentTime=d!==void 0?d:0;this.startTimeMs=d;this.startTime=1E7;this.endTime=-this.startTime;var c,e=this.hierarchy.length,f,g;for(c=0;c<e;c++){f=this.hierarchy[c];g=this.data.hierarchy[c];f.useQuaternion=
true;if(g.animationCache===void 0){g.animationCache={};g.animationCache.prevKey=null;g.animationCache.nextKey=null;g.animationCache.originalMatrix=f instanceof b.Bone?f.skinMatrix:f.matrix}f=this.data.hierarchy[c].keys;if(f.length){g.animationCache.prevKey=f[0];g.animationCache.nextKey=f[1];this.startTime=Math.min(f[0].time,this.startTime);this.endTime=Math.max(f[f.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;b.AnimationHandler.addToUpdate(this)};b.KeyFrameAnimation.prototype.pause=
function(){this.isPaused?b.AnimationHandler.addToUpdate(this):b.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};b.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=false;b.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.data.hierarchy.length;a++){var d=this.hierarchy[a],c=this.data.hierarchy[a];if(c.animationCache!==void 0){var e=c.animationCache.originalMatrix;if(d instanceof b.Bone){e.copy(d.skinMatrix);d.skinMatrix=e}else{e.copy(d.matrix);
d.matrix=e}delete c.animationCache}}};b.KeyFrameAnimation.prototype.update=function(a){if(this.isPlaying){var d,c,e,f,g=this.data.JIT.hierarchy,h,i,j;i=this.currentTime=this.currentTime+a*this.timeScale;h=this.currentTime=this.currentTime%this.data.length;if(h<this.startTimeMs)h=this.currentTime=this.startTimeMs+h;f=parseInt(Math.min(h*this.data.fps,this.data.length*this.data.fps),10);if((j=h<i)&&!this.loop){for(var a=0,l=this.hierarchy.length;a<l;a++){var m=this.data.hierarchy[a].keys,g=this.data.hierarchy[a].sids;
e=m.length-1;f=this.hierarchy[a];if(m.length){for(m=0;m<g.length;m++){h=g[m];(i=this.getPrevKeyWith(h,a,e))&&i.apply(h)}this.data.hierarchy[a].node.updateMatrix();f.matrixWorldNeedsUpdate=true}}this.stop()}else if(!(h<this.startTime)){a=0;for(l=this.hierarchy.length;a<l;a++){e=this.hierarchy[a];d=this.data.hierarchy[a];var m=d.keys,p=d.animationCache;if(this.JITCompile&&g[a][f]!==void 0)if(e instanceof b.Bone){e.skinMatrix=g[a][f];e.matrixWorldNeedsUpdate=false}else{e.matrix=g[a][f];e.matrixWorldNeedsUpdate=
true}else if(m.length){if(this.JITCompile&&p)e instanceof b.Bone?e.skinMatrix=p.originalMatrix:e.matrix=p.originalMatrix;d=p.prevKey;c=p.nextKey;if(d&&c){if(c.time<=i){if(j&&this.loop){d=m[0];for(c=m[1];c.time<h;){d=c;c=m[d.index+1]}}else if(!j)for(var n=m.length-1;c.time<h&&c.index!==n;){d=c;c=m[d.index+1]}p.prevKey=d;p.nextKey=c}c.time>=h?d.interpolate(c,h):d.interpolate(c,c.time)}this.data.hierarchy[a].node.updateMatrix();e.matrixWorldNeedsUpdate=true}}if(this.JITCompile&&g[0][f]===void 0){this.hierarchy[0].updateMatrixWorld(true);
for(a=0;a<this.hierarchy.length;a++)g[a][f]=this.hierarchy[a]instanceof b.Bone?this.hierarchy[a].skinMatrix.clone():this.hierarchy[a].matrix.clone()}}}};b.KeyFrameAnimation.prototype.getNextKeyWith=function(a,b,c){b=this.data.hierarchy[b].keys;for(c=c%b.length;c<b.length;c++)if(b[c].hasTarget(a))return b[c];return b[0]};b.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,b,c){b=this.data.hierarchy[b].keys;for(c=c>=0?c:c+b.length;c>=0;c--)if(b[c].hasTarget(a))return b[c];return b[b.length-1]};
b.CubeCamera=function(a,d,c){b.Object3D.call(this);var e=new b.PerspectiveCamera(90,1,a,d);e.up.set(0,-1,0);e.lookAt(new b.Vector3(1,0,0));this.add(e);var f=new b.PerspectiveCamera(90,1,a,d);f.up.set(0,-1,0);f.lookAt(new b.Vector3(-1,0,0));this.add(f);var g=new b.PerspectiveCamera(90,1,a,d);g.up.set(0,0,1);g.lookAt(new b.Vector3(0,1,0));this.add(g);var h=new b.PerspectiveCamera(90,1,a,d);h.up.set(0,0,-1);h.lookAt(new b.Vector3(0,-1,0));this.add(h);var i=new b.PerspectiveCamera(90,1,a,d);i.up.set(0,
-1,0);i.lookAt(new b.Vector3(0,0,1));this.add(i);var j=new b.PerspectiveCamera(90,1,a,d);j.up.set(0,-1,0);j.lookAt(new b.Vector3(0,0,-1));this.add(j);this.renderTarget=new b.WebGLRenderTargetCube(c,c,{format:b.RGBFormat,magFilter:b.LinearFilter,minFilter:b.LinearFilter});this.updateCubeMap=function(a,b){var c=this.renderTarget,d=c.generateMipmaps;c.generateMipmaps=false;c.activeCubeFace=0;a.render(b,e,c);c.activeCubeFace=1;a.render(b,f,c);c.activeCubeFace=2;a.render(b,g,c);c.activeCubeFace=3;a.render(b,
h,c);c.activeCubeFace=4;a.render(b,i,c);c.generateMipmaps=d;c.activeCubeFace=5;a.render(b,j,c)}};b.CubeCamera.prototype=Object.create(b.Object3D.prototype);b.CombinedCamera=function(a,d,c,e,f,g,h){b.Camera.call(this);this.fov=c;this.left=-a/2;this.right=a/2;this.top=d/2;this.bottom=-d/2;this.cameraO=new b.OrthographicCamera(a/-2,a/2,d/2,d/-2,g,h);this.cameraP=new b.PerspectiveCamera(c,a/d,e,f);this.zoom=1;this.toPerspective()};b.CombinedCamera.prototype=Object.create(b.Camera.prototype);b.CombinedCamera.prototype.toPerspective=
function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=true;this.inOrthographicMode=false};b.CombinedCamera.prototype.toOrthographic=function(){var a=this.cameraP.aspect,b=(this.cameraP.near+this.cameraP.far)/2,b=Math.tan(this.fov/2)*b,a=2*b*a/2,b=b/this.zoom,a=a/this.zoom;this.cameraO.left=-a;this.cameraO.right=a;this.cameraO.top=b;this.cameraO.bottom=
-b;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=false;this.inOrthographicMode=true};b.CombinedCamera.prototype.setSize=function(a,b){this.cameraP.aspect=a/b;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2};b.CombinedCamera.prototype.setFov=function(a){this.fov=a;this.inPerspectiveMode?this.toPerspective():this.toOrthographic()};b.CombinedCamera.prototype.updateProjectionMatrix=
function(){if(this.inPerspectiveMode)this.toPerspective();else{this.toPerspective();this.toOrthographic()}};b.CombinedCamera.prototype.setLens=function(a,b){var c=2*Math.atan((b!==void 0?b:24)/(a*2))*(180/Math.PI);this.setFov(c);return c};b.CombinedCamera.prototype.setZoom=function(a){this.zoom=a;this.inPerspectiveMode?this.toPerspective():this.toOrthographic()};b.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};b.CombinedCamera.prototype.toBackView=
function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false};b.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};b.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};b.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=
false};b.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};b.FirstPersonControls=function(a,d){function c(a,b){return function(){b.apply(a,arguments)}}this.object=a;this.target=new b.Vector3(0,0,0);this.domElement=d!==void 0?d:document;this.movementSpeed=1;this.lookSpeed=0.0050;this.noFly=false;this.lookVertical=true;this.autoForward=false;this.activeLook=true;this.heightSpeed=false;this.heightCoef=1;this.heightMin=
0;this.constrainVertical=false;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=false;this.viewHalfY=this.viewHalfX=0;this.domElement!==document&&this.domElement.setAttribute("tabindex",-1);this.handleResize=function(){if(this.domElement===document){this.viewHalfX=window.innerWidth/2;this.viewHalfY=window.innerHeight/2}else{this.viewHalfX=
this.domElement.offsetWidth/2;this.viewHalfY=this.domElement.offsetHeight/2}};this.onMouseDown=function(a){this.domElement!==document&&this.domElement.focus();a.preventDefault();a.stopPropagation();if(this.activeLook)switch(a.button){case 0:this.moveForward=true;break;case 2:this.moveBackward=true}this.mouseDragOn=true};this.onMouseUp=function(a){a.preventDefault();a.stopPropagation();if(this.activeLook)switch(a.button){case 0:this.moveForward=false;break;case 2:this.moveBackward=false}this.mouseDragOn=
false};this.onMouseMove=function(a){if(this.domElement===document){this.mouseX=a.pageX-this.viewHalfX;this.mouseY=a.pageY-this.viewHalfY}else{this.mouseX=a.pageX-this.domElement.offsetLeft-this.viewHalfX;this.mouseY=a.pageY-this.domElement.offsetTop-this.viewHalfY}};this.onKeyDown=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=true;break;case 37:case 65:this.moveLeft=true;break;case 40:case 83:this.moveBackward=true;break;case 39:case 68:this.moveRight=true;break;case 82:this.moveUp=
true;break;case 70:this.moveDown=true;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=false;break;case 37:case 65:this.moveLeft=false;break;case 40:case 83:this.moveBackward=false;break;case 39:case 68:this.moveRight=false;break;case 82:this.moveUp=false;break;case 70:this.moveDown=false}};this.update=function(a){var c=0;if(!this.freeze){if(this.heightSpeed){c=b.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;
this.autoSpeedFactor=a*c*this.heightCoef}else this.autoSpeedFactor=0;c=a*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(c+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(c);this.moveLeft&&this.object.translateX(-c);this.moveRight&&this.object.translateX(c);this.moveUp&&this.object.translateY(c);this.moveDown&&this.object.translateY(-c);a=a*this.lookSpeed;this.activeLook||(a=0);this.lon=this.lon+this.mouseX*a;if(this.lookVertical)this.lat=
this.lat-this.mouseY*a;this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;var c=this.target,d=this.object.position;c.x=d.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=d.y+100*Math.cos(this.phi);c.z=d.z+100*Math.sin(this.phi)*Math.sin(this.theta);c=1;this.constrainVertical&&(c=Math.PI/(this.verticalMax-this.verticalMin));this.lon=this.lon+this.mouseX*a;if(this.lookVertical)this.lat=this.lat-this.mouseY*a*c;this.lat=Math.max(-85,Math.min(85,
this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=b.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax);c=this.target;d=this.object.position;c.x=d.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=d.y+100*Math.cos(this.phi);c.z=d.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(c)}};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},false);this.domElement.addEventListener("mousemove",
c(this,this.onMouseMove),false);this.domElement.addEventListener("mousedown",c(this,this.onMouseDown),false);this.domElement.addEventListener("mouseup",c(this,this.onMouseUp),false);this.domElement.addEventListener("keydown",c(this,this.onKeyDown),false);this.domElement.addEventListener("keyup",c(this,this.onKeyUp),false);this.handleResize()};b.PathControls=function(a,d){function c(a){return(a=a*2)<1?0.5*a*a:-0.5*(--a*(a-2)-1)}function e(a,b){return function(){b.apply(a,arguments)}}function f(a,c,
d,e){var f={name:d,fps:0.6,length:e,hierarchy:[]},g,h=c.getControlPointsArray(),i=c.getLength(),r=h.length,u=0;g=r-1;c={parent:-1,keys:[]};c.keys[0]={time:0,pos:h[0],rot:[0,0,0,1],scl:[1,1,1]};c.keys[g]={time:e,pos:h[g],rot:[0,0,0,1],scl:[1,1,1]};for(g=1;g<r-1;g++){u=e*i.chunks[g]/i.total;c.keys[g]={time:u,pos:h[g]}}f.hierarchy[0]=c;b.AnimationHandler.add(f);return new b.Animation(a,d,b.AnimationHandler.CATMULLROM_FORWARD,false)}function g(a,c){var d,e,f=new b.Geometry;for(d=0;d<a.points.length*c;d++){e=
d/(a.points.length*c);e=a.getPoint(e);f.vertices[d]=new b.Vector3(e.x,e.y,e.z)}return f}this.object=a;this.domElement=d!==void 0?d:document;this.id="PathControls"+b.PathControlsIdCounter++;this.duration=1E4;this.waypoints=[];this.useConstantSpeed=true;this.resamplingCoef=50;this.debugPath=new b.Object3D;this.debugDummy=new b.Object3D;this.animationParent=new b.Object3D;this.lookSpeed=0.0050;this.lookHorizontal=this.lookVertical=true;this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};
this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.target=new b.Object3D;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;var h=Math.PI*2,i=Math.PI/180;this.viewHalfY=this.viewHalfX=0;this.domElement!==document&&this.domElement.setAttribute("tabindex",-1);this.handleResize=function(){if(this.domElement===document){this.viewHalfX=window.innerWidth/2;this.viewHalfY=window.innerHeight/2}else{this.viewHalfX=this.domElement.offsetWidth/2;this.viewHalfY=this.domElement.offsetHeight/
2}};this.update=function(a){var d;if(this.lookHorizontal)this.lon=this.lon+this.mouseX*this.lookSpeed*a;if(this.lookVertical)this.lat=this.lat-this.mouseY*this.lookSpeed*a;this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*i;this.theta=this.lon*i;a=this.phi%h;this.phi=a>=0?a:a+h;d=this.verticalAngleMap.srcRange;a=this.verticalAngleMap.dstRange;d=b.Math.mapLinear(this.phi,d[0],d[1],a[0],a[1]);var e=a[1]-a[0];this.phi=c((d-a[0])/e)*e+a[0];
d=this.horizontalAngleMap.srcRange;a=this.horizontalAngleMap.dstRange;d=b.Math.mapLinear(this.theta,d[0],d[1],a[0],a[1]);e=a[1]-a[0];this.theta=c((d-a[0])/e)*e+a[0];a=this.target.position;a.x=100*Math.sin(this.phi)*Math.cos(this.theta);a.y=100*Math.cos(this.phi);a.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(this.target.position)};this.onMouseMove=function(a){if(this.domElement===document){this.mouseX=a.pageX-this.viewHalfX;this.mouseY=a.pageY-this.viewHalfY}else{this.mouseX=a.pageX-
this.domElement.offsetLeft-this.viewHalfX;this.mouseY=a.pageY-this.domElement.offsetTop-this.viewHalfY}};this.init=function(){this.spline=new b.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var a=new b.MeshLambertMaterial({color:30719}),c=new b.MeshLambertMaterial({color:65280}),d=new b.CubeGeometry(10,10,20),h=new b.CubeGeometry(2,2,10);this.animationParent=new b.Mesh(d,a);a=new b.Mesh(h,
c);a.position.set(0,10,0);this.animation=f(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.object);this.animationParent.add(this.target);this.animationParent.add(a)}else{this.animation=f(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.target);this.animationParent.add(this.object)}if(this.createDebugPath){var a=this.debugPath,c=this.spline,h=g(c,10),d=g(c,10),i=new b.LineBasicMaterial({color:16711680,linewidth:3}),h=new b.Line(h,
i),d=new b.ParticleSystem(d,new b.ParticleBasicMaterial({color:16755200,size:3}));h.scale.set(1,1,1);a.add(h);d.scale.set(1,1,1);a.add(d);for(var h=new b.SphereGeometry(1,16,8),i=new b.MeshBasicMaterial({color:65280}),q=0;q<c.points.length;q++){d=new b.Mesh(h,i);d.position.copy(c.points[q]);a.add(d)}}this.domElement.addEventListener("mousemove",e(this,this.onMouseMove),false)};this.handleResize()};b.PathControlsIdCounter=0;b.FlyControls=function(a,d){function c(a,b){return function(){b.apply(a,arguments)}}
this.object=a;this.domElement=d!==void 0?d:document;d&&this.domElement.setAttribute("tabindex",-1);this.movementSpeed=1;this.rollSpeed=0.0050;this.autoForward=this.dragToLook=false;this.object.useQuaternion=true;this.tmpQuaternion=new b.Quaternion;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new b.Vector3(0,0,0);this.rotationVector=new b.Vector3(0,0,0);this.handleEvent=function(a){if(typeof this[a.type]==
"function")this[a.type](a)};this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=
1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=
0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(a){this.domElement!==document&&this.domElement.focus();a.preventDefault();a.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(a.button){case 0:this.object.moveForward=true;break;case 2:this.object.moveBackward=true}};this.mousemove=function(a){if(!this.dragToLook||
this.mouseStatus>0){var b=this.getContainerDimensions(),c=b.size[0]/2,d=b.size[1]/2;this.moveState.yawLeft=-(a.pageX-b.offset[0]-c)/c;this.moveState.pitchDown=(a.pageY-b.offset[1]-d)/d;this.updateRotationVector()}};this.mouseup=function(a){a.preventDefault();a.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(a.button){case 0:this.moveForward=false;break;case 2:this.moveBackward=false}this.updateRotationVector()};this.update=function(a){var b=
a*this.movementSpeed,a=a*this.rollSpeed;this.object.translateX(this.moveVector.x*b);this.object.translateY(this.moveVector.y*b);this.object.translateZ(this.moveVector.z*b);this.tmpQuaternion.set(this.rotationVector.x*a,this.rotationVector.y*a,this.rotationVector.z*a,1).normalize();this.object.quaternion.multiplySelf(this.tmpQuaternion);this.object.matrix.setPosition(this.object.position);this.object.matrix.setRotationFromQuaternion(this.object.quaternion);this.object.matrixWorldNeedsUpdate=true};
this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-a+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};
this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",c(this,this.mousemove),false);this.domElement.addEventListener("mousedown",c(this,this.mousedown),false);this.domElement.addEventListener("mouseup",c(this,this.mouseup),false);this.domElement.addEventListener("keydown",
c(this,this.keydown),false);this.domElement.addEventListener("keyup",c(this,this.keyup),false);this.updateMovementVector();this.updateRotationVector()};b.RollControls=function(a,d){this.object=a;this.domElement=d!==void 0?d:document;this.mouseLook=true;this.autoForward=false;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.object.matrixAutoUpdate=false;this.forward=new b.Vector3(0,0,1);this.roll=0;var c=new b.Vector3,e=new b.Vector3,f=new b.Vector3,g=new b.Matrix4,
h=false,i=1,j=0,l=0,m=0,p=0,n=0,q=0,s=0;this.handleResize=function(){q=window.innerWidth/2;s=window.innerHeight/2};this.update=function(a){if(this.mouseLook){var b=a*this.lookSpeed;this.rotateHorizontally(b*p);this.rotateVertically(b*n)}b=a*this.movementSpeed;this.object.translateZ(-b*(j>0||this.autoForward&&!(j<0)?1:j));this.object.translateX(b*l);this.object.translateY(b*m);if(h)this.roll=this.roll+this.rollSpeed*a*i;if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];
this.forward.normalize()}else if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}f.copy(this.forward);e.set(0,1,0);c.cross(e,f).normalize();e.cross(f,c).normalize();this.object.matrix.elements[0]=c.x;this.object.matrix.elements[4]=e.x;this.object.matrix.elements[8]=f.x;this.object.matrix.elements[1]=c.y;this.object.matrix.elements[5]=e.y;this.object.matrix.elements[9]=f.y;this.object.matrix.elements[2]=c.z;this.object.matrix.elements[6]=
e.z;this.object.matrix.elements[10]=f.z;g.identity();g.elements[0]=Math.cos(this.roll);g.elements[4]=-Math.sin(this.roll);g.elements[1]=Math.sin(this.roll);g.elements[5]=Math.cos(this.roll);this.object.matrix.multiplySelf(g);this.object.matrixWorldNeedsUpdate=true;this.object.matrix.elements[12]=this.object.position.x;this.object.matrix.elements[13]=this.object.position.y;this.object.matrix.elements[14]=this.object.position.z};this.translateX=function(a){this.object.position.x=this.object.position.x+
this.object.matrix.elements[0]*a;this.object.position.y=this.object.position.y+this.object.matrix.elements[1]*a;this.object.position.z=this.object.position.z+this.object.matrix.elements[2]*a};this.translateY=function(a){this.object.position.x=this.object.position.x+this.object.matrix.elements[4]*a;this.object.position.y=this.object.position.y+this.object.matrix.elements[5]*a;this.object.position.z=this.object.position.z+this.object.matrix.elements[6]*a};this.translateZ=function(a){this.object.position.x=
this.object.position.x-this.object.matrix.elements[8]*a;this.object.position.y=this.object.position.y-this.object.matrix.elements[9]*a;this.object.position.z=this.object.position.z-this.object.matrix.elements[10]*a};this.rotateHorizontally=function(a){c.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]);c.multiplyScalar(a);this.forward.subSelf(c);this.forward.normalize()};this.rotateVertically=function(a){e.set(this.object.matrix.elements[4],this.object.matrix.elements[5],
this.object.matrix.elements[6]);e.multiplyScalar(a);this.forward.addSelf(e);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},false);this.domElement.addEventListener("mousemove",function(a){p=(a.clientX-q)/window.innerWidth;n=(a.clientY-s)/window.innerHeight},false);this.domElement.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();switch(a.button){case 0:j=1;break;case 2:j=-1}},false);this.domElement.addEventListener("mouseup",
function(a){a.preventDefault();a.stopPropagation();switch(a.button){case 0:j=0;break;case 2:j=0}},false);this.domElement.addEventListener("keydown",function(a){switch(a.keyCode){case 38:case 87:j=1;break;case 37:case 65:l=-1;break;case 40:case 83:j=-1;break;case 39:case 68:l=1;break;case 81:h=true;i=1;break;case 69:h=true;i=-1;break;case 82:m=1;break;case 70:m=-1}},false);this.domElement.addEventListener("keyup",function(a){switch(a.keyCode){case 38:case 87:j=0;break;case 37:case 65:l=0;break;case 40:case 83:j=
0;break;case 39:case 68:l=0;break;case 81:h=false;break;case 69:h=false;break;case 82:m=0;break;case 70:m=0}},false);this.handleResize()};b.TrackballControls=function(a,d){b.EventTarget.call(this);var c=this;this.object=a;this.domElement=d!==void 0?d:document;this.enabled=true;this.screen={width:0,height:0,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=false;
this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new b.Vector3;var e=new b.Vector3,f=false,g=-1,h=new b.Vector3,i=new b.Vector3,j=new b.Vector3,l=new b.Vector2,m=new b.Vector2,p=new b.Vector2,n=new b.Vector2,q={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth;this.screen.height=window.innerHeight;this.screen.offsetLeft=0;this.screen.offsetTop=0;this.radius=(this.screen.width+this.screen.height)/4};this.handleEvent=
function(a){if(typeof this[a.type]=="function")this[a.type](a)};this.getMouseOnScreen=function(a,d){return new b.Vector2((a-c.screen.offsetLeft)/c.radius*0.5,(d-c.screen.offsetTop)/c.radius*0.5)};this.getMouseProjectionOnBall=function(a,d){var e=new b.Vector3((a-c.screen.width*0.5-c.screen.offsetLeft)/c.radius,(c.screen.height*0.5+c.screen.offsetTop-d)/c.radius,0),f=e.length();f>1?e.normalize():e.z=Math.sqrt(1-f*f);h.copy(c.object.position).subSelf(c.target);f=c.object.up.clone().setLength(e.y);f.addSelf(c.object.up.clone().crossSelf(h).setLength(e.x));
f.addSelf(h.setLength(e.z));return f};this.rotateCamera=function(){var a=Math.acos(i.dot(j)/i.length()/j.length());if(a){var d=(new b.Vector3).cross(i,j).normalize(),e=new b.Quaternion,a=a*c.rotateSpeed;e.setFromAxisAngle(d,-a);e.multiplyVector3(h);e.multiplyVector3(c.object.up);e.multiplyVector3(j);if(c.staticMoving)i=j;else{e.setFromAxisAngle(d,a*(c.dynamicDampingFactor-1));e.multiplyVector3(i)}}};this.zoomCamera=function(){var a=1+(m.y-l.y)*c.zoomSpeed;if(a!==1&&a>0){h.multiplyScalar(a);c.staticMoving?
l=m:l.y=l.y+(m.y-l.y)*this.dynamicDampingFactor}};this.panCamera=function(){var a=n.clone().subSelf(p);if(a.lengthSq()){a.multiplyScalar(h.length()*c.panSpeed);var b=h.clone().crossSelf(c.object.up).setLength(a.x);b.addSelf(c.object.up.clone().setLength(a.y));c.object.position.addSelf(b);c.target.addSelf(b);c.staticMoving?p=n:p.addSelf(a.sub(n,p).multiplyScalar(c.dynamicDampingFactor))}};this.checkDistances=function(){if(!c.noZoom||!c.noPan){c.object.position.lengthSq()>c.maxDistance*c.maxDistance&&
c.object.position.setLength(c.maxDistance);h.lengthSq()<c.minDistance*c.minDistance&&c.object.position.add(c.target,h.setLength(c.minDistance))}};this.update=function(){h.copy(c.object.position).subSelf(c.target);c.noRotate||c.rotateCamera();c.noZoom||c.zoomCamera();c.noPan||c.panCamera();c.object.position.add(c.target,h);c.checkDistances();c.object.lookAt(c.target);if(e.distanceToSquared(c.object.position)>0){c.dispatchEvent(q);e.copy(c.object.position)}};this.domElement.addEventListener("contextmenu",
function(a){a.preventDefault()},false);this.domElement.addEventListener("mousemove",function(a){if(c.enabled){if(f){i=j=c.getMouseProjectionOnBall(a.clientX,a.clientY);l=m=c.getMouseOnScreen(a.clientX,a.clientY);p=n=c.getMouseOnScreen(a.clientX,a.clientY);f=false}g!==-1&&(g===0&&!c.noRotate?j=c.getMouseProjectionOnBall(a.clientX,a.clientY):g===1&&!c.noZoom?m=c.getMouseOnScreen(a.clientX,a.clientY):g===2&&!c.noPan&&(n=c.getMouseOnScreen(a.clientX,a.clientY)))}},false);this.domElement.addEventListener("mousedown",
function(a){if(c.enabled){a.preventDefault();a.stopPropagation();if(g===-1){g=a.button;g===0&&!c.noRotate?i=j=c.getMouseProjectionOnBall(a.clientX,a.clientY):g===1&&!c.noZoom?l=m=c.getMouseOnScreen(a.clientX,a.clientY):this.noPan||(p=n=c.getMouseOnScreen(a.clientX,a.clientY))}}},false);this.domElement.addEventListener("mouseup",function(a){if(c.enabled){a.preventDefault();a.stopPropagation();g=-1}},false);window.addEventListener("keydown",function(a){if(c.enabled&&g===-1){a.keyCode===c.keys[0]&&!c.noRotate?
g=0:a.keyCode===c.keys[1]&&!c.noZoom?g=1:a.keyCode===c.keys[2]&&!c.noPan&&(g=2);g!==-1&&(f=true)}},false);window.addEventListener("keyup",function(){c.enabled&&g!==-1&&(g=-1)},false);this.handleResize()};b.OrbitControls=function(a,d){var c,e,f;function g(){return 2*Math.PI/60/60*j.autoRotateSpeed}function h(a){a.preventDefault();if(t===c){p.set(a.clientX,a.clientY);n.sub(p,m);j.rotateLeft(2*Math.PI*n.x/l*j.userRotateSpeed);j.rotateUp(2*Math.PI*n.y/l*j.userRotateSpeed);m.copy(p)}else if(t===e){s.set(a.clientX,
a.clientY);o.sub(s,q);o.y>0?j.zoomIn():j.zoomOut();q.copy(s)}}function i(){if(j.userRotate){document.removeEventListener("mousemove",h,false);document.removeEventListener("mouseup",i,false);t=f}}b.EventTarget.call(this);this.object=a;this.domElement=d!==void 0?d:document;this.center=new b.Vector3;this.userZoom=true;this.userZoomSpeed=1;this.userRotate=true;this.userRotateSpeed=1;this.autoRotate=false;this.autoRotateSpeed=2;var j=this,l=1800,m=new b.Vector2,p=new b.Vector2,n=new b.Vector2,q=new b.Vector2,
s=new b.Vector2,o=new b.Vector2,r=0,u=0,v=1,x=new b.Vector3;f=-1;c=0;e=1;var t=f,y={type:"change"};this.rotateLeft=function(a){a===void 0&&(a=g());u=u-a};this.rotateRight=function(a){a===void 0&&(a=g());u=u+a};this.rotateUp=function(a){a===void 0&&(a=g());r=r-a};this.rotateDown=function(a){a===void 0&&(a=g());r=r+a};this.zoomIn=function(a){a===void 0&&(a=Math.pow(0.95,j.userZoomSpeed));v=v/a};this.zoomOut=function(a){a===void 0&&(a=Math.pow(0.95,j.userZoomSpeed));v=v*a};this.update=function(){var a=
this.object.position,b=a.clone().subSelf(this.center),c=Math.atan2(b.x,b.z),d=Math.atan2(Math.sqrt(b.x*b.x+b.z*b.z),b.y);this.autoRotate&&this.rotateLeft(g());var c=c+u,d=d+r,d=Math.max(1.0E-6,Math.min(Math.PI-1.0E-6,d)),e=b.length();b.x=e*Math.sin(d)*Math.sin(c);b.y=e*Math.cos(d);b.z=e*Math.sin(d)*Math.cos(c);b.multiplyScalar(v);a.copy(this.center).addSelf(b);this.object.lookAt(this.center);r=u=0;v=1;if(x.distanceTo(this.object.position)>0){this.dispatchEvent(y);x.copy(this.object.position)}};this.domElement.addEventListener("contextmenu",
function(a){a.preventDefault()},false);this.domElement.addEventListener("mousedown",function(a){if(j.userRotate){a.preventDefault();if(a.button===0||a.button===2){t=c;m.set(a.clientX,a.clientY)}else if(a.button===1){t=e;q.set(a.clientX,a.clientY)}document.addEventListener("mousemove",h,false);document.addEventListener("mouseup",i,false)}},false);this.domElement.addEventListener("mousewheel",function(a){j.userZoom&&(a.wheelDelta>0?j.zoomOut():j.zoomIn())},false)};b.CubeGeometry=function(a,d,c,e,f,
g,h,i){function j(a,c,d,h,i,j,m,n){var o,p=e||1,q=f||1,s=i/2,r=j/2,u=l.vertices.length;if(a==="x"&&c==="y"||a==="y"&&c==="x")o="z";else if(a==="x"&&c==="z"||a==="z"&&c==="x"){o="y";q=g||1}else if(a==="z"&&c==="y"||a==="y"&&c==="z"){o="x";p=g||1}var v=p+1,k=q+1,x=i/p,N=j/q,T=new b.Vector3;T[o]=m>0?1:-1;for(i=0;i<k;i++)for(j=0;j<v;j++){var ba=new b.Vector3;ba[a]=(j*x-s)*d;ba[c]=(i*N-r)*h;ba[o]=m;l.vertices.push(ba)}for(i=0;i<q;i++)for(j=0;j<p;j++){a=new b.Face4(j+v*i+u,j+v*(i+1)+u,j+1+v*(i+1)+u,j+1+
v*i+u);a.normal.copy(T);a.vertexNormals.push(T.clone(),T.clone(),T.clone(),T.clone());a.materialIndex=n;l.faces.push(a);l.faceVertexUvs[0].push([new b.UV(j/p,i/q),new b.UV(j/p,(i+1)/q),new b.UV((j+1)/p,(i+1)/q),new b.UV((j+1)/p,i/q)])}}b.Geometry.call(this);var l=this,m=a/2,p=d/2,n=c/2,q,s,o,r,u,v;if(h!==void 0){if(h instanceof Array)this.materials=h;else{this.materials=[];for(q=0;q<6;q++)this.materials.push(h)}q=0;r=1;s=2;u=3;o=4;v=5}else this.materials=[];this.sides={px:true,nx:true,py:true,ny:true,
pz:true,nz:true};if(i!=void 0)for(var x in i)this.sides[x]!==void 0&&(this.sides[x]=i[x]);this.sides.px&&j("z","y",-1,-1,c,d,m,q);this.sides.nx&&j("z","y",1,-1,c,d,-m,r);this.sides.py&&j("x","z",1,1,a,c,p,s);this.sides.ny&&j("x","z",1,-1,a,c,-p,u);this.sides.pz&&j("x","y",1,-1,a,d,n,o);this.sides.nz&&j("x","y",-1,-1,a,d,-n,v);this.computeCentroids();this.mergeVertices()};b.CubeGeometry.prototype=Object.create(b.Geometry.prototype);b.CylinderGeometry=function(a,d,c,e,f,g){b.Geometry.call(this);var a=
a!==void 0?a:20,d=d!==void 0?d:20,c=c!==void 0?c:100,h=c/2,e=e||8,f=f||1,i,j,l=[],m=[];for(j=0;j<=f;j++){var p=[],n=[],q=j/f,s=q*(d-a)+a;for(i=0;i<=e;i++){var o=i/e,r=new b.Vector3;r.x=s*Math.sin(o*Math.PI*2);r.y=-q*c+h;r.z=s*Math.cos(o*Math.PI*2);this.vertices.push(r);p.push(this.vertices.length-1);n.push(new b.UV(o,q))}l.push(p);m.push(n)}c=(d-a)/c;for(i=0;i<e;i++){if(a!==0){p=this.vertices[l[0][i]].clone();n=this.vertices[l[0][i+1]].clone()}else{p=this.vertices[l[1][i]].clone();n=this.vertices[l[1][i+
1]].clone()}p.setY(Math.sqrt(p.x*p.x+p.z*p.z)*c).normalize();n.setY(Math.sqrt(n.x*n.x+n.z*n.z)*c).normalize();for(j=0;j<f;j++){var q=l[j][i],s=l[j+1][i],o=l[j+1][i+1],r=l[j][i+1],u=p.clone(),v=p.clone(),x=n.clone(),t=n.clone(),y=m[j][i].clone(),G=m[j+1][i].clone(),D=m[j+1][i+1].clone(),B=m[j][i+1].clone();this.faces.push(new b.Face4(q,s,o,r,[u,v,x,t]));this.faceVertexUvs[0].push([y,G,D,B])}}if(!g&&a>0){this.vertices.push(new b.Vector3(0,h,0));for(i=0;i<e;i++){q=l[0][i];s=l[0][i+1];o=this.vertices.length-
1;u=new b.Vector3(0,1,0);v=new b.Vector3(0,1,0);x=new b.Vector3(0,1,0);y=m[0][i].clone();G=m[0][i+1].clone();D=new b.UV(G.u,0);this.faces.push(new b.Face3(q,s,o,[u,v,x]));this.faceVertexUvs[0].push([y,G,D])}}if(!g&&d>0){this.vertices.push(new b.Vector3(0,-h,0));for(i=0;i<e;i++){q=l[j][i+1];s=l[j][i];o=this.vertices.length-1;u=new b.Vector3(0,-1,0);v=new b.Vector3(0,-1,0);x=new b.Vector3(0,-1,0);y=m[j][i+1].clone();G=m[j][i].clone();D=new b.UV(G.u,1);this.faces.push(new b.Face3(q,s,o,[u,v,x]));this.faceVertexUvs[0].push([y,
G,D])}}this.computeCentroids();this.computeFaceNormals()};b.CylinderGeometry.prototype=Object.create(b.Geometry.prototype);b.ExtrudeGeometry=function(a,d){if(typeof a!=="undefined"){b.Geometry.call(this);a=a instanceof Array?a:[a];this.shapebb=a[a.length-1].getBoundingBox();this.addShapeList(a,d);this.computeCentroids();this.computeFaceNormals()}};b.ExtrudeGeometry.prototype=Object.create(b.Geometry.prototype);b.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,e=0;e<c;e++)this.addShape(a[e],
b)};b.ExtrudeGeometry.prototype.addShape=function(a,d){function c(a,b,c){b||console.log("die");return b.clone().multiplyScalar(c).addSelf(a)}function e(a,c,d){var e=b.ExtrudeGeometry.__v1,f=b.ExtrudeGeometry.__v2,g=b.ExtrudeGeometry.__v3,h=b.ExtrudeGeometry.__v4,i=b.ExtrudeGeometry.__v5,j=b.ExtrudeGeometry.__v6;e.set(a.x-c.x,a.y-c.y);f.set(a.x-d.x,a.y-d.y);e=e.normalize();f=f.normalize();g.set(-e.y,e.x);h.set(f.y,-f.x);i.copy(a).addSelf(g);j.copy(a).addSelf(h);if(i.equals(j))return h.clone();i.copy(c).addSelf(g);
j.copy(d).addSelf(h);g=e.dot(h);h=j.subSelf(i).dot(h);if(g===0){console.log("Either infinite or no solutions!");h===0?console.log("Its finite solutions."):console.log("Too bad, no solutions.")}h=h/g;if(h<0){c=Math.atan2(c.y-a.y,c.x-a.x);a=Math.atan2(d.y-a.y,d.x-a.x);c>a&&(a=a+Math.PI*2);d=(c+a)/2;a=-Math.cos(d);d=-Math.sin(d);return new b.Vector2(a,d)}return e.multiplyScalar(h).addSelf(i).subSelf(a).clone()}function f(c,e){var f,g;for(L=c.length;--L>=0;){f=L;g=L-1;g<0&&(g=c.length-1);for(var h=0,
i=n+m*2,h=0;h<i;h++){var j=N*h,l=N*(h+1),k=e+f+j,j=e+g+j,o=e+g+l,l=e+f+l,p=c,q=h,s=i,r=f,t=g,k=k+O,j=j+O,o=o+O,l=l+O;J.faces.push(new b.Face4(k,j,o,l,null,null,v));k=x.generateSideWallUV(J,a,p,d,k,j,o,l,q,s,r,t);J.faceVertexUvs[0].push(k)}}}function g(a,c,d){J.vertices.push(new b.Vector3(a,c,d))}function h(c,e,f,g){c=c+O;e=e+O;f=f+O;J.faces.push(new b.Face3(c,e,f,null,null,u));c=g?x.generateBottomUV(J,a,d,c,e,f):x.generateTopUV(J,a,d,c,e,f);J.faceVertexUvs[0].push(c)}var i=d.amount!==void 0?d.amount:
100,j=d.bevelThickness!==void 0?d.bevelThickness:6,l=d.bevelSize!==void 0?d.bevelSize:j-2,m=d.bevelSegments!==void 0?d.bevelSegments:3,p=d.bevelEnabled!==void 0?d.bevelEnabled:true,n=d.steps!==void 0?d.steps:1,q=d.bendPath,s=d.extrudePath,o,r=false,u=d.material,v=d.extrudeMaterial,x=d.UVGenerator!==void 0?d.UVGenerator:b.ExtrudeGeometry.WorldUVGenerator,t,y,G,D;if(s){o=s.getSpacedPoints(n);r=true;p=false;t=d.frames!==void 0?d.frames:new b.TubeGeometry.FrenetFrames(s,n,false);y=new b.Vector3;G=new b.Vector3;
D=new b.Vector3}if(!p)l=j=m=0;var B,w,I,J=this,O=this.vertices.length;q&&a.addWrapPath(q);var s=a.extractPoints(),q=s.shape,S=s.holes;if(s=!b.Shape.Utils.isClockWise(q)){q=q.reverse();w=0;for(I=S.length;w<I;w++){B=S[w];b.Shape.Utils.isClockWise(B)&&(S[w]=B.reverse())}s=false}var Z=b.Shape.Utils.triangulateShape(q,S),C=q;w=0;for(I=S.length;w<I;w++){B=S[w];q=q.concat(B)}var H,R,E,k,Q,N=q.length,T,ba=Z.length,s=[],L=0;E=C.length;H=E-1;for(R=L+1;L<E;L++,H++,R++){H===E&&(H=0);R===E&&(R=0);s[L]=e(C[L],
C[H],C[R])}var da=[],ga,P=s.concat();w=0;for(I=S.length;w<I;w++){B=S[w];ga=[];L=0;E=B.length;H=E-1;for(R=L+1;L<E;L++,H++,R++){H===E&&(H=0);R===E&&(R=0);ga[L]=e(B[L],B[H],B[R])}da.push(ga);P=P.concat(ga)}for(H=0;H<m;H++){E=H/m;k=j*(1-E);R=l*Math.sin(E*Math.PI/2);L=0;for(E=C.length;L<E;L++){Q=c(C[L],s[L],R);g(Q.x,Q.y,-k)}w=0;for(I=S.length;w<I;w++){B=S[w];ga=da[w];L=0;for(E=B.length;L<E;L++){Q=c(B[L],ga[L],R);g(Q.x,Q.y,-k)}}}R=l;for(L=0;L<N;L++){Q=p?c(q[L],P[L],R):q[L];if(r){G.copy(t.normals[0]).multiplyScalar(Q.x);
y.copy(t.binormals[0]).multiplyScalar(Q.y);D.copy(o[0]).addSelf(G).addSelf(y);g(D.x,D.y,D.z)}else g(Q.x,Q.y,0)}for(E=1;E<=n;E++)for(L=0;L<N;L++){Q=p?c(q[L],P[L],R):q[L];if(r){G.copy(t.normals[E]).multiplyScalar(Q.x);y.copy(t.binormals[E]).multiplyScalar(Q.y);D.copy(o[E]).addSelf(G).addSelf(y);g(D.x,D.y,D.z)}else g(Q.x,Q.y,i/n*E)}for(H=m-1;H>=0;H--){E=H/m;k=j*(1-E);R=l*Math.sin(E*Math.PI/2);L=0;for(E=C.length;L<E;L++){Q=c(C[L],s[L],R);g(Q.x,Q.y,i+k)}w=0;for(I=S.length;w<I;w++){B=S[w];ga=da[w];L=0;
for(E=B.length;L<E;L++){Q=c(B[L],ga[L],R);r?g(Q.x,Q.y+o[n-1].y,o[n-1].x+k):g(Q.x,Q.y,i+k)}}}(function(){if(p){var a;a=N*0;for(L=0;L<ba;L++){T=Z[L];h(T[2]+a,T[1]+a,T[0]+a,true)}a=n+m*2;a=N*a;for(L=0;L<ba;L++){T=Z[L];h(T[0]+a,T[1]+a,T[2]+a,false)}}else{for(L=0;L<ba;L++){T=Z[L];h(T[2],T[1],T[0],true)}for(L=0;L<ba;L++){T=Z[L];h(T[0]+N*n,T[1]+N*n,T[2]+N*n,false)}}})();(function(){var a=0;f(C,a);a=a+C.length;w=0;for(I=S.length;w<I;w++){B=S[w];f(B,a);a=a+B.length}})()};b.ExtrudeGeometry.WorldUVGenerator=
{generateTopUV:function(a,d,c,e,f,g){d=a.vertices[f].x;f=a.vertices[f].y;c=a.vertices[g].x;g=a.vertices[g].y;return[new b.UV(a.vertices[e].x,1-a.vertices[e].y),new b.UV(d,1-f),new b.UV(c,1-g)]},generateBottomUV:function(a,b,c,e,f,g){return this.generateTopUV(a,b,c,e,f,g)},generateSideWallUV:function(a,d,c,e,f,g,h,i){var d=a.vertices[f].x,c=a.vertices[f].y,f=a.vertices[f].z,e=a.vertices[g].x,j=a.vertices[g].y,g=a.vertices[g].z,l=a.vertices[h].x,m=a.vertices[h].y,h=a.vertices[h].z,p=a.vertices[i].x,
n=a.vertices[i].y,a=a.vertices[i].z;return Math.abs(c-j)<0.01?[new b.UV(d,f),new b.UV(e,g),new b.UV(l,h),new b.UV(p,a)]:[new b.UV(c,f),new b.UV(j,g),new b.UV(m,h),new b.UV(n,a)]}};b.ExtrudeGeometry.__v1=new b.Vector2;b.ExtrudeGeometry.__v2=new b.Vector2;b.ExtrudeGeometry.__v3=new b.Vector2;b.ExtrudeGeometry.__v4=new b.Vector2;b.ExtrudeGeometry.__v5=new b.Vector2;b.ExtrudeGeometry.__v6=new b.Vector2;b.LatheGeometry=function(a,d,c){b.Geometry.call(this);for(var d=d||12,c=c||2*Math.PI,e=[],f=(new b.Matrix4).makeRotationZ(c/
d),g=0;g<a.length;g++){e[g]=a[g].clone();this.vertices.push(e[g])}for(var h=d+1,c=0;c<h;c++)for(g=0;g<e.length;g++){e[g]=f.multiplyVector3(e[g].clone());this.vertices.push(e[g])}for(c=0;c<d;c++){e=0;for(f=a.length;e<f-1;e++){this.faces.push(new b.Face4(c*f+e,(c+1)%h*f+e,(c+1)%h*f+(e+1)%f,c*f+(e+1)%f));this.faceVertexUvs[0].push([new b.UV(1-c/d,e/f),new b.UV(1-(c+1)/d,e/f),new b.UV(1-(c+1)/d,(e+1)/f),new b.UV(1-c/d,(e+1)/f)])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};
b.LatheGeometry.prototype=Object.create(b.Geometry.prototype);b.PlaneGeometry=function(a,d,c,e){b.Geometry.call(this);for(var f=a/2,g=d/2,c=c||1,e=e||1,h=c+1,i=e+1,j=a/c,l=d/e,m=new b.Vector3(0,1,0),a=0;a<i;a++)for(d=0;d<h;d++)this.vertices.push(new b.Vector3(d*j-f,0,a*l-g));for(a=0;a<e;a++)for(d=0;d<c;d++){f=new b.Face4(d+h*a,d+h*(a+1),d+1+h*(a+1),d+1+h*a);f.normal.copy(m);f.vertexNormals.push(m.clone(),m.clone(),m.clone(),m.clone());this.faces.push(f);this.faceVertexUvs[0].push([new b.UV(d/c,a/
e),new b.UV(d/c,(a+1)/e),new b.UV((d+1)/c,(a+1)/e),new b.UV((d+1)/c,a/e)])}this.computeCentroids()};b.PlaneGeometry.prototype=Object.create(b.Geometry.prototype);b.SphereGeometry=function(a,d,c,e,f,g,h){b.Geometry.call(this);var a=a||50,e=e!==void 0?e:0,f=f!==void 0?f:Math.PI*2,g=g!==void 0?g:0,h=h!==void 0?h:Math.PI,d=Math.max(3,Math.floor(d)||8),c=Math.max(2,Math.floor(c)||6),i,j,l=[],m=[];for(j=0;j<=c;j++){var p=[],n=[];for(i=0;i<=d;i++){var q=i/d,s=j/c,o=new b.Vector3;o.x=-a*Math.cos(e+q*f)*Math.sin(g+
s*h);o.y=a*Math.cos(g+s*h);o.z=a*Math.sin(e+q*f)*Math.sin(g+s*h);this.vertices.push(o);p.push(this.vertices.length-1);n.push(new b.UV(q,s))}l.push(p);m.push(n)}for(j=0;j<c;j++)for(i=0;i<d;i++){var e=l[j][i+1],f=l[j][i],g=l[j+1][i],h=l[j+1][i+1],p=this.vertices[e].clone().normalize(),n=this.vertices[f].clone().normalize(),q=this.vertices[g].clone().normalize(),s=this.vertices[h].clone().normalize(),o=m[j][i+1].clone(),r=m[j][i].clone(),u=m[j+1][i].clone(),v=m[j+1][i+1].clone();if(Math.abs(this.vertices[e].y)==
a){this.faces.push(new b.Face3(e,g,h,[p,q,s]));this.faceVertexUvs[0].push([o,u,v])}else if(Math.abs(this.vertices[g].y)==a){this.faces.push(new b.Face3(e,f,g,[p,n,q]));this.faceVertexUvs[0].push([o,r,u])}else{this.faces.push(new b.Face4(e,f,g,h,[p,n,q,s]));this.faceVertexUvs[0].push([o,r,u,v])}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:a}};b.SphereGeometry.prototype=Object.create(b.Geometry.prototype);b.TextGeometry=function(a,d){var c=b.FontUtils.generateShapes(a,
d);d.amount=d.height!==void 0?d.height:50;if(d.bevelThickness===void 0)d.bevelThickness=10;if(d.bevelSize===void 0)d.bevelSize=8;if(d.bevelEnabled===void 0)d.bevelEnabled=false;if(d.bend){var e=c[c.length-1].getBoundingBox().maxX;d.bendPath=new b.QuadraticBezierCurve(new b.Vector2(0,0),new b.Vector2(e/2,120),new b.Vector2(e,0))}b.ExtrudeGeometry.call(this,c,d)};b.TextGeometry.prototype=Object.create(b.ExtrudeGeometry.prototype);b.TorusGeometry=function(a,d,c,e,f){b.Geometry.call(this);this.radius=
a||100;this.tube=d||40;this.segmentsR=c||8;this.segmentsT=e||6;this.arc=f||Math.PI*2;f=new b.Vector3;a=[];d=[];for(c=0;c<=this.segmentsR;c++)for(e=0;e<=this.segmentsT;e++){var g=e/this.segmentsT*this.arc,h=c/this.segmentsR*Math.PI*2;f.x=this.radius*Math.cos(g);f.y=this.radius*Math.sin(g);var i=new b.Vector3;i.x=(this.radius+this.tube*Math.cos(h))*Math.cos(g);i.y=(this.radius+this.tube*Math.cos(h))*Math.sin(g);i.z=this.tube*Math.sin(h);this.vertices.push(i);a.push(new b.UV(e/this.segmentsT,1-c/this.segmentsR));
d.push(i.clone().subSelf(f).normalize())}for(c=1;c<=this.segmentsR;c++)for(e=1;e<=this.segmentsT;e++){var f=(this.segmentsT+1)*c+e-1,g=(this.segmentsT+1)*(c-1)+e-1,h=(this.segmentsT+1)*(c-1)+e,i=(this.segmentsT+1)*c+e,j=new b.Face4(f,g,h,i,[d[f],d[g],d[h],d[i]]);j.normal.addSelf(d[f]);j.normal.addSelf(d[g]);j.normal.addSelf(d[h]);j.normal.addSelf(d[i]);j.normal.normalize();this.faces.push(j);this.faceVertexUvs[0].push([a[f].clone(),a[g].clone(),a[h].clone(),a[i].clone()])}this.computeCentroids()};
b.TorusGeometry.prototype=Object.create(b.Geometry.prototype);b.TorusKnotGeometry=function(a,d,c,e,f,g,h){function i(a,c,d,e,f,g){var h=Math.cos(a);Math.cos(c);c=Math.sin(a);a=d/e*a;d=Math.cos(a);h=f*(2+d)*0.5*h;c=f*(2+d)*c*0.5;f=g*f*Math.sin(a)*0.5;return new b.Vector3(h,c,f)}b.Geometry.call(this);this.radius=a||200;this.tube=d||40;this.segmentsR=c||64;this.segmentsT=e||8;this.p=f||2;this.q=g||3;this.heightScale=h||1;this.grid=Array(this.segmentsR);c=new b.Vector3;e=new b.Vector3;f=new b.Vector3;
for(a=0;a<this.segmentsR;++a){this.grid[a]=Array(this.segmentsT);for(d=0;d<this.segmentsT;++d){var j=a/this.segmentsR*2*this.p*Math.PI,h=d/this.segmentsT*2*Math.PI,g=i(j,h,this.q,this.p,this.radius,this.heightScale),j=i(j+0.01,h,this.q,this.p,this.radius,this.heightScale);c.sub(j,g);e.add(j,g);f.cross(c,e);e.cross(f,c);f.normalize();e.normalize();j=-this.tube*Math.cos(h);h=this.tube*Math.sin(h);g.x=g.x+(j*e.x+h*f.x);g.y=g.y+(j*e.y+h*f.y);g.z=g.z+(j*e.z+h*f.z);this.grid[a][d]=this.vertices.push(new b.Vector3(g.x,
g.y,g.z))-1}}for(a=0;a<this.segmentsR;++a)for(d=0;d<this.segmentsT;++d){var f=(a+1)%this.segmentsR,g=(d+1)%this.segmentsT,c=this.grid[a][d],e=this.grid[f][d],f=this.grid[f][g],g=this.grid[a][g],h=new b.UV(a/this.segmentsR,d/this.segmentsT),j=new b.UV((a+1)/this.segmentsR,d/this.segmentsT),l=new b.UV((a+1)/this.segmentsR,(d+1)/this.segmentsT),m=new b.UV(a/this.segmentsR,(d+1)/this.segmentsT);this.faces.push(new b.Face4(c,e,f,g));this.faceVertexUvs[0].push([h,j,l,m])}this.computeCentroids();this.computeFaceNormals();
this.computeVertexNormals()};b.TorusKnotGeometry.prototype=Object.create(b.Geometry.prototype);b.TubeGeometry=function(a,d,c,e,f,g){b.Geometry.call(this);this.path=a;this.segments=d||64;this.radius=c||1;this.segmentsRadius=e||8;this.closed=f||false;if(g)this.debug=new b.Object3D;this.grid=[];var h,i,g=this.segments+1,j,l,m,p=new b.Vector3,n,q,s,d=new b.TubeGeometry.FrenetFrames(a,d,f);n=d.tangents;q=d.normals;s=d.binormals;this.tangents=n;this.normals=q;this.binormals=s;for(d=0;d<g;d++){this.grid[d]=
[];e=d/(g-1);m=a.getPointAt(e);e=n[d];h=q[d];i=s[d];if(this.debug){this.debug.add(new b.ArrowHelper(e,m,c,255));this.debug.add(new b.ArrowHelper(h,m,c,16711680));this.debug.add(new b.ArrowHelper(i,m,c,65280))}for(e=0;e<this.segmentsRadius;e++){j=e/this.segmentsRadius*2*Math.PI;l=-this.radius*Math.cos(j);j=this.radius*Math.sin(j);p.copy(m);p.x=p.x+(l*h.x+j*i.x);p.y=p.y+(l*h.y+j*i.y);p.z=p.z+(l*h.z+j*i.z);this.grid[d][e]=this.vertices.push(new b.Vector3(p.x,p.y,p.z))-1}}for(d=0;d<this.segments;d++)for(e=
0;e<this.segmentsRadius;e++){g=f?(d+1)%this.segments:d+1;p=(e+1)%this.segmentsRadius;a=this.grid[d][e];c=this.grid[g][e];g=this.grid[g][p];p=this.grid[d][p];n=new b.UV(d/this.segments,e/this.segmentsRadius);q=new b.UV((d+1)/this.segments,e/this.segmentsRadius);s=new b.UV((d+1)/this.segments,(e+1)/this.segmentsRadius);h=new b.UV(d/this.segments,(e+1)/this.segmentsRadius);this.faces.push(new b.Face4(a,c,g,p));this.faceVertexUvs[0].push([n,q,s,h])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};
b.TubeGeometry.prototype=Object.create(b.Geometry.prototype);b.TubeGeometry.FrenetFrames=function(a,d,c){new b.Vector3;var e=new b.Vector3;new b.Vector3;var f=[],g=[],h=[],i=new b.Vector3,j=new b.Matrix4,d=d+1,l,m,p;this.tangents=f;this.normals=g;this.binormals=h;for(l=0;l<d;l++){m=l/(d-1);f[l]=a.getTangentAt(m);f[l].normalize()}g[0]=new b.Vector3;h[0]=new b.Vector3;a=Number.MAX_VALUE;l=Math.abs(f[0].x);m=Math.abs(f[0].y);p=Math.abs(f[0].z);if(l<=a){a=l;e.set(1,0,0)}if(m<=a){a=m;e.set(0,1,0)}p<=a&&
e.set(0,0,1);i.cross(f[0],e).normalize();g[0].cross(f[0],i);h[0].cross(f[0],g[0]);for(l=1;l<d;l++){g[l]=g[l-1].clone();h[l]=h[l-1].clone();i.cross(f[l-1],f[l]);if(i.length()>1.0E-4){i.normalize();e=Math.acos(f[l-1].dot(f[l]));j.makeRotationAxis(i,e).multiplyVector3(g[l])}h[l].cross(f[l],g[l])}if(c){e=Math.acos(g[0].dot(g[d-1]));e=e/(d-1);f[0].dot(i.cross(g[0],g[d-1]))>0&&(e=-e);for(l=1;l<d;l++){j.makeRotationAxis(f[l],e*l).multiplyVector3(g[l]);h[l].cross(f[l],g[l])}}};b.PolyhedronGeometry=function(a,
d,c,e){function f(a){var c=a.normalize().clone();c.index=j.vertices.push(c)-1;var d=Math.atan2(a.z,-a.x)/2/Math.PI+0.5,a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+0.5;c.uv=new b.UV(d,a);return c}function g(a,c,d,e){if(e<1){e=new b.Face3(a.index,c.index,d.index,[a.clone(),c.clone(),d.clone()]);e.centroid.addSelf(a).addSelf(c).addSelf(d).divideScalar(3);e.normal=e.centroid.clone().normalize();j.faces.push(e);e=Math.atan2(e.centroid.z,-e.centroid.x);j.faceVertexUvs[0].push([i(a.uv,a,e),i(c.uv,
c,e),i(d.uv,d,e)])}else{e=e-1;g(a,h(a,c),h(a,d),e);g(h(a,c),c,h(c,d),e);g(h(a,d),h(c,d),d,e);g(h(a,c),h(c,d),h(a,d),e)}}function h(a,c){p[a.index]||(p[a.index]=[]);p[c.index]||(p[c.index]=[]);var d=p[a.index][c.index];d===void 0&&(p[a.index][c.index]=p[c.index][a.index]=d=f((new b.Vector3).add(a,c).divideScalar(2)));return d}function i(a,c,d){d<0&&a.u===1&&(a=new b.UV(a.u-1,a.v));c.x===0&&c.z===0&&(a=new b.UV(d/2/Math.PI+0.5,a.v));return a}b.Geometry.call(this);for(var c=c||1,e=e||0,j=this,l=0,m=
a.length;l<m;l++)f(new b.Vector3(a[l][0],a[l][1],a[l][2]));for(var p=[],a=this.vertices,l=0,m=d.length;l<m;l++)g(a[d[l][0]],a[d[l][1]],a[d[l][2]],e);this.mergeVertices();l=0;for(m=this.vertices.length;l<m;l++)this.vertices[l].multiplyScalar(c);this.computeCentroids();this.boundingSphere={radius:c}};b.PolyhedronGeometry.prototype=Object.create(b.Geometry.prototype);b.IcosahedronGeometry=function(a,d){var c=(1+Math.sqrt(5))/2;b.PolyhedronGeometry.call(this,[[-1,c,0],[1,c,0],[-1,-c,0],[1,-c,0],[0,-1,
c],[0,1,c],[0,-1,-c],[0,1,-c],[c,0,-1],[c,0,1],[-c,0,-1],[-c,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],a,d)};b.IcosahedronGeometry.prototype=Object.create(b.Geometry.prototype);b.OctahedronGeometry=function(a,d){b.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],a,d)};
b.OctahedronGeometry.prototype=Object.create(b.Geometry.prototype);b.TetrahedronGeometry=function(a,d){b.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],a,d)};b.TetrahedronGeometry.prototype=Object.create(b.Geometry.prototype);b.ParametricGeometry=function(a,d,c,e){b.Geometry.call(this);var f=this.vertices,g=this.faces,h=this.faceVertexUvs[0],e=e===void 0?false:e,i,j,l,m,p=d+1;for(i=0;i<=c;i++){m=i/c;for(j=0;j<=d;j++){l=j/d;l=a(l,m);f.push(l)}}var n,
q,s,o;for(i=0;i<c;i++)for(j=0;j<d;j++){a=i*p+j;f=i*p+j+1;m=(i+1)*p+j;l=(i+1)*p+j+1;n=new b.UV(j/d,i/c);q=new b.UV((j+1)/d,i/c);s=new b.UV(j/d,(i+1)/c);o=new b.UV((j+1)/d,(i+1)/c);if(e){g.push(new b.Face3(a,f,m));g.push(new b.Face3(f,l,m));h.push([n,q,s]);h.push([q,o,s])}else{g.push(new b.Face4(a,f,l,m));h.push([n,q,o,s])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};b.ParametricGeometry.prototype=Object.create(b.Geometry.prototype);b.ConvexGeometry=function(a){function d(d){var e=
a[d].clone(),g=e.length();e.x=e.x+g*c();e.y=e.y+g*c();e.z=e.z+g*c();for(var g=[],h=0;h<f.length;){var i=f[h],j=e,l=a[i[0]],u;u=l;var v=a[i[1]],x=a[i[2]],t=new b.Vector3,y=new b.Vector3;t.sub(x,v);y.sub(u,v);t.crossSelf(y);t.isZero()||t.normalize();u=t;l=u.dot(l);if(u.dot(j)>=l){for(j=0;j<3;j++){l=[i[j],i[(j+1)%3]];u=true;for(v=0;v<g.length;v++)if(g[v][0]===l[1]&&g[v][1]===l[0]){g[v]=g[g.length-1];g.pop();u=false;break}u&&g.push(l)}f[h]=f[f.length-1];f.pop()}else h++}for(v=0;v<g.length;v++)f.push([g[v][0],
g[v][1],d])}function c(){return(Math.random()-0.5)*2.0E-6}function e(a){var c=a.length();return new b.UV(a.x/c,a.y/c)}b.Geometry.call(this);for(var f=[[0,1,2],[0,2,1]],g=3;g<a.length;g++)d(g);for(var h=0,i=Array(a.length),g=0;g<f.length;g++)for(var j=f[g],l=0;l<3;l++){if(i[j[l]]===void 0){i[j[l]]=h++;this.vertices.push(a[j[l]])}j[l]=i[j[l]]}for(g=0;g<f.length;g++)this.faces.push(new b.Face3(f[g][0],f[g][1],f[g][2]));for(g=0;g<this.faces.length;g++){j=this.faces[g];this.faceVertexUvs[0].push([e(this.vertices[j.a]),
e(this.vertices[j.b]),e(this.vertices[j.c])])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};b.ConvexGeometry.prototype=Object.create(b.Geometry.prototype);b.AxisHelper=function(){b.Object3D.call(this);var a=new b.Geometry;a.vertices.push(new b.Vector3);a.vertices.push(new b.Vector3(0,100,0));var d=new b.CylinderGeometry(0,5,25,5,1),c;c=new b.Line(a,new b.LineBasicMaterial({color:16711680}));c.rotation.z=-Math.PI/2;this.add(c);c=new b.Mesh(d,new b.MeshBasicMaterial({color:16711680}));
c.position.x=100;c.rotation.z=-Math.PI/2;this.add(c);c=new b.Line(a,new b.LineBasicMaterial({color:65280}));this.add(c);c=new b.Mesh(d,new b.MeshBasicMaterial({color:65280}));c.position.y=100;this.add(c);c=new b.Line(a,new b.LineBasicMaterial({color:255}));c.rotation.x=Math.PI/2;this.add(c);c=new b.Mesh(d,new b.MeshBasicMaterial({color:255}));c.position.z=100;c.rotation.x=Math.PI/2;this.add(c)};b.AxisHelper.prototype=Object.create(b.Object3D.prototype);b.ArrowHelper=function(a,d,c,e){b.Object3D.call(this);
e===void 0&&(e=16776960);c===void 0&&(c=20);var f=new b.Geometry;f.vertices.push(new b.Vector3(0,0,0));f.vertices.push(new b.Vector3(0,1,0));this.line=new b.Line(f,new b.LineBasicMaterial({color:e}));this.add(this.line);f=new b.CylinderGeometry(0,0.05,0.25,5,1);this.cone=new b.Mesh(f,new b.MeshBasicMaterial({color:e}));this.cone.position.set(0,1,0);this.add(this.cone);if(d instanceof b.Vector3)this.position=d;this.setDirection(a);this.setLength(c)};b.ArrowHelper.prototype=Object.create(b.Object3D.prototype);
b.ArrowHelper.prototype.setDirection=function(a){var d=(new b.Vector3(0,1,0)).crossSelf(a),a=Math.acos((new b.Vector3(0,1,0)).dot(a.clone().normalize()));this.matrix=(new b.Matrix4).makeRotationAxis(d.normalize(),a);this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)};b.ArrowHelper.prototype.setLength=function(a){this.scale.set(a,a,a)};b.ArrowHelper.prototype.setColor=function(a){this.line.material.color.setHex(a);this.cone.material.color.setHex(a)};b.CameraHelper=function(a){function d(a,
b,d){c(a,d);c(b,d)}function c(a,c){e.lineGeometry.vertices.push(new b.Vector3);e.lineGeometry.colors.push(new b.Color(c));e.pointMap[a]===void 0&&(e.pointMap[a]=[]);e.pointMap[a].push(e.lineGeometry.vertices.length-1)}b.Object3D.call(this);var e=this;this.lineGeometry=new b.Geometry;this.lineMaterial=new b.LineBasicMaterial({color:16777215,vertexColors:b.FaceColors});this.pointMap={};d("n1","n2",16755200);d("n2","n4",16755200);d("n4","n3",16755200);d("n3","n1",16755200);d("f1","f2",16755200);d("f2",
"f4",16755200);d("f4","f3",16755200);d("f3","f1",16755200);d("n1","f1",16755200);d("n2","f2",16755200);d("n3","f3",16755200);d("n4","f4",16755200);d("p","n1",16711680);d("p","n2",16711680);d("p","n3",16711680);d("p","n4",16711680);d("u1","u2",43775);d("u2","u3",43775);d("u3","u1",43775);d("c","t",16777215);d("p","c",3355443);d("cn1","cn2",3355443);d("cn3","cn4",3355443);d("cf1","cf2",3355443);d("cf3","cf4",3355443);this.camera=a;this.update(a);this.lines=new b.Line(this.lineGeometry,this.lineMaterial,
b.LinePieces);this.add(this.lines)};b.CameraHelper.prototype=Object.create(b.Object3D.prototype);b.CameraHelper.prototype.update=function(){function a(a,e,f,g){b.CameraHelper.__v.set(e,f,g);b.CameraHelper.__projector.unprojectVector(b.CameraHelper.__v,b.CameraHelper.__c);a=d.pointMap[a];if(a!==void 0){e=0;for(f=a.length;e<f;e++)d.lineGeometry.vertices[a[e]].copy(b.CameraHelper.__v)}}var d=this;b.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",
-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",0.7,1.1,-1);a("u2",-0.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);this.lineGeometry.verticesNeedUpdate=true};b.CameraHelper.__projector=new b.Projector;b.CameraHelper.__v=new b.Vector3;b.CameraHelper.__c=new b.Camera;b.SubdivisionModifier=function(a){this.subdivisions=
a===void 0?1:a;this.useOldVertexColors=false;this.supportUVs=true;this.debug=false};b.SubdivisionModifier.prototype.modify=function(a){for(var b=this.subdivisions;b-- >0;)this.smooth(a)};b.SubdivisionModifier.prototype.smooth=function(a){function d(){n.debug&&console.log.apply(console,arguments)}function c(){console&&console.log.apply(console,arguments)}function e(a,c,e,f,h,i,j){var l=new b.Face4(a,c,e,f,null,h.color,h.materialIndex);if(n.useOldVertexColors){l.vertexColors=[];for(var k,o,q,r=0;r<
4;r++){q=i[r];k=new b.Color;k.setRGB(0,0,0);for(var s=0;s<q.length;s++){o=h.vertexColors[q[s]-1];k.r=k.r+o.r;k.g=k.g+o.g;k.b=k.b+o.b}k.r=k.r/q.length;k.g=k.g/q.length;k.b=k.b/q.length;l.vertexColors[r]=k}}m.push(l);if(n.supportUVs){h=[g(a,""),g(c,j),g(e,j),g(f,j)];h[0]?h[1]?h[2]?h[3]?p.push(h):d("d :( ",f+":"+j):d("c :( ",e+":"+j):d("b :( ",c+":"+j):d("a :( ",a+":"+j)}}function f(a,b){return Math.min(a,b)+"_"+Math.max(a,b)}function g(a,b){var e=a+":"+b,f=v[e];if(!f){a>=x&&a<x+s.length?d("face pt"):
d("edge pt");c("warning, UV not found for",e);return null}return f}function h(a,b,d){var e=a+":"+b;e in v?c("dup vertexNo",a,"oldFaceNo",b,"value",d,"key",e,v[e]):v[e]=d}function i(a,b){S[a]===void 0&&(S[a]=[]);S[a].push(b)}function j(a,b,c){Z[a]===void 0&&(Z[a]={});Z[a][b]=c}var l=[],m=[],p=[],n=this,q=a.vertices,s=a.faces,l=q.concat(),o=[],r={},u={},v={},x=q.length,t,y,G,D,B,w=a.faceVertexUvs[0],I;d("originalFaces, uvs, originalVerticesLength",s.length,w.length,x);if(n.supportUVs){t=0;for(y=w.length;t<
y;t++){G=0;for(D=w[t].length;G<D;G++){I=s[t]["abcd".charAt(G)];h(I,t,w[t][G])}}}if(w.length==0)n.supportUVs=false;t=0;for(B in v)t++;if(!t){n.supportUVs=false;d("no uvs")}d("-- Original Faces + Vertices UVs completed",v,"vs",w.length);t=0;for(y=s.length;t<y;t++){B=s[t];o.push(B.centroid);l.push(B.centroid);if(n.supportUVs){w=new b.UV;if(B instanceof b.Face3){w.u=g(B.a,t).u+g(B.b,t).u+g(B.c,t).u;w.v=g(B.a,t).v+g(B.b,t).v+g(B.c,t).v;w.u=w.u/3;w.v=w.v/3}else if(B instanceof b.Face4){w.u=g(B.a,t).u+g(B.b,
t).u+g(B.c,t).u+g(B.d,t).u;w.v=g(B.a,t).v+g(B.b,t).v+g(B.c,t).v+g(B.d,t).v;w.u=w.u/4;w.v=w.v/4}h(x+t,"",w)}}d("-- added UVs for new Faces",v);y=function(a){function c(a,b){i[a]===void 0&&(i[a]=[]);i[a].push(b)}var d,e,g,h,i={};d=0;for(e=a.faces.length;d<e;d++){g=a.faces[d];if(g instanceof b.Face3){h=f(g.a,g.b);c(h,d);h=f(g.b,g.c);c(h,d);h=f(g.c,g.a);c(h,d)}else if(g instanceof b.Face4){h=f(g.a,g.b);c(h,d);h=f(g.b,g.c);c(h,d);h=f(g.c,g.d);c(h,d);h=f(g.d,g.a);c(h,d)}}return i}(a);I=0;var J,O,S={},Z=
{};for(t in y){w=y[t];J=t.split("_");O=J[0];J=J[1];i(O,[O,J]);i(J,[O,J]);G=0;for(D=w.length;G<D;G++){B=w[G];j(O,B,t);j(J,B,t)}w.length<2&&(u[t]=true)}d("vertexEdgeMap",S,"vertexFaceMap",Z);for(t in y){w=y[t];B=w[0];D=w[1];J=t.split("_");O=J[0];J=J[1];w=new b.Vector3;if(u[t]){w.addSelf(q[O]);w.addSelf(q[J]);w.multiplyScalar(0.5)}else{w.addSelf(o[B]);w.addSelf(o[D]);w.addSelf(q[O]);w.addSelf(q[J]);w.multiplyScalar(0.25)}r[t]=x+s.length+I;l.push(w);I++;if(n.supportUVs){w=new b.UV;w.u=g(O,B).u+g(J,B).u;
w.v=g(O,B).v+g(J,B).v;w.u=w.u/2;w.v=w.v/2;h(r[t],B,w);if(!u[t]){w=new b.UV;w.u=g(O,D).u+g(J,D).u;w.v=g(O,D).v+g(J,D).v;w.u=w.u/2;w.v=w.v/2;h(r[t],D,w)}}}d("-- Step 2 done");var C,H;D=["123","12","2","23"];J=["123","23","3","31"];var R=["123","31","1","12"],E=["1234","12","2","23"],k=["1234","23","3","34"],Q=["1234","34","4","41"],N=["1234","41","1","12"];t=0;for(y=o.length;t<y;t++){B=s[t];w=x+t;if(B instanceof b.Face3){I=f(B.a,B.b);O=f(B.b,B.c);C=f(B.c,B.a);e(w,r[I],B.b,r[O],B,D,t);e(w,r[O],B.c,r[C],
B,J,t);e(w,r[C],B.a,r[I],B,R,t)}else if(B instanceof b.Face4){I=f(B.a,B.b);O=f(B.b,B.c);C=f(B.c,B.d);H=f(B.d,B.a);e(w,r[I],B.b,r[O],B,E,t);e(w,r[O],B.c,r[C],B,k,t);e(w,r[C],B.d,r[H],B,Q,t);e(w,r[H],B.a,r[I],B,N,t)}else d("face should be a face!",B)}r=new b.Vector3;B=new b.Vector3;t=0;for(y=q.length;t<y;t++)if(S[t]!==void 0){r.set(0,0,0);B.set(0,0,0);O=new b.Vector3(0,0,0);w=0;for(G in Z[t]){r.addSelf(o[G]);w++}D=0;I=S[t].length;for(G=0;G<I;G++)u[f(S[t][G][0],S[t][G][1])]&&D++;if(D!=2){r.divideScalar(w);
for(G=0;G<I;G++){w=S[t][G];w=q[w[0]].clone().addSelf(q[w[1]]).divideScalar(2);B.addSelf(w)}B.divideScalar(I);O.addSelf(q[t]);O.multiplyScalar(I-3);O.addSelf(r);O.addSelf(B.multiplyScalar(2));O.divideScalar(I);l[t]=O}}a.vertices=l;a.faces=m;a.faceVertexUvs[0]=p;delete a.__tmpVertices;a.computeCentroids();a.computeFaceNormals();a.computeVertexNormals()};b.ImmediateRenderObject=function(){b.Object3D.call(this);this.render=function(){}};b.ImmediateRenderObject.prototype=Object.create(b.Object3D.prototype);
b.LensFlare=function(a,d,c,e,f){b.Object3D.call(this);this.lensFlares=[];this.positionScreen=new b.Vector3;this.customUpdateCallback=void 0;a!==void 0&&this.add(a,d,c,e,f)};b.LensFlare.prototype=Object.create(b.Object3D.prototype);b.LensFlare.prototype.add=function(a,d,c,e,f,g){d===void 0&&(d=-1);c===void 0&&(c=0);g===void 0&&(g=1);f===void 0&&(f=new b.Color(16777215));if(e===void 0)e=b.NormalBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:d,distance:c,x:0,y:0,z:0,scale:1,
rotation:1,opacity:g,color:f,blending:e})};b.LensFlare.prototype.updateLensFlares=function(){var a,b=this.lensFlares.length,c,e=-this.positionScreen.x*2,f=-this.positionScreen.y*2;for(a=0;a<b;a++){c=this.lensFlares[a];c.x=this.positionScreen.x+e*c.distance;c.y=this.positionScreen.y+f*c.distance;c.wantedRotation=c.x*Math.PI*0.25;c.rotation=c.rotation+(c.wantedRotation-c.rotation)*0.25}};b.MorphBlendMesh=function(a,d){b.Mesh.call(this,a,d);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;
this.createAnimation("__default",0,c-1,c/1);this.setAnimationWeight("__default",1)};b.MorphBlendMesh.prototype=Object.create(b.Mesh.prototype);b.MorphBlendMesh.prototype.createAnimation=function(a,b,c,e){b={startFrame:b,endFrame:c,length:c-b+1,fps:e,duration:(c-b)/e,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[a]=b;this.animationsList.push(b)};b.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b=
/([a-z]+)(\d+)/,c,e={},f=this.geometry,g=0,h=f.morphTargets.length;g<h;g++){var i=f.morphTargets[g].name.match(b);if(i&&i.length>1){var j=i[1];e[j]||(e[j]={start:Infinity,end:-Infinity});i=e[j];if(g<i.start)i.start=g;if(g>i.end)i.end=g;c||(c=j)}}for(j in e){i=e[j];this.createAnimation(j,i.start,i.end,a)}this.firstAnimation=c};b.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a]){a.direction=1;a.directionBackwards=false}};b.MorphBlendMesh.prototype.setAnimationDirectionBackward=
function(a){if(a=this.animationsMap[a]){a.direction=-1;a.directionBackwards=true}};b.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];if(c){c.fps=b;c.duration=(c.end-c.start)/c.fps}};b.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];if(c){c.duration=b;c.fps=(c.end-c.start)/c.duration}};b.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];if(c)c.weight=b};b.MorphBlendMesh.prototype.setAnimationTime=
function(a,b){var c=this.animationsMap[a];if(c)c.time=b};b.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};b.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};b.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];if(b){b.time=0;b.active=true}else console.warn("animation["+a+"] undefined")};b.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=
this.animationsMap[a])a.active=false};b.MorphBlendMesh.prototype.update=function(a){for(var d=0,c=this.animationsList.length;d<c;d++){var e=this.animationsList[d];if(e.active){var f=e.duration/e.length;e.time=e.time+e.direction*a;if(e.mirroredLoop){if(e.time>e.duration||e.time<0){e.direction=e.direction*-1;if(e.time>e.duration){e.time=e.duration;e.directionBackwards=true}if(e.time<0){e.time=0;e.directionBackwards=false}}}else{e.time=e.time%e.duration;if(e.time<0)e.time=e.time+e.duration}var g=e.startFrame+
b.Math.clamp(Math.floor(e.time/f),0,e.length-1),h=e.weight;if(g!==e.currentFrame){this.morphTargetInfluences[e.lastFrame]=0;this.morphTargetInfluences[e.currentFrame]=1*h;this.morphTargetInfluences[g]=0;e.lastFrame=e.currentFrame;e.currentFrame=g}f=e.time%f/f;e.directionBackwards&&(f=1-f);this.morphTargetInfluences[e.currentFrame]=f*h;this.morphTargetInfluences[e.lastFrame]=(1-f)*h}}};b.LensFlarePlugin=function(){function a(a){var b=d.createProgram(),c=d.createShader(d.FRAGMENT_SHADER),e=d.createShader(d.VERTEX_SHADER);
d.shaderSource(c,a.fragmentShader);d.shaderSource(e,a.vertexShader);d.compileShader(c);d.compileShader(e);d.attachShader(b,c);d.attachShader(b,e);d.linkProgram(b);return b}var d,c,e,f,g,h,i,j,l,m,p,n,q;this.init=function(s){d=s.context;c=s;e=new Float32Array(16);f=new Uint16Array(6);s=0;e[s++]=-1;e[s++]=-1;e[s++]=0;e[s++]=0;e[s++]=1;e[s++]=-1;e[s++]=1;e[s++]=0;e[s++]=1;e[s++]=1;e[s++]=1;e[s++]=1;e[s++]=-1;e[s++]=1;e[s++]=0;e[s++]=1;s=0;f[s++]=0;f[s++]=1;f[s++]=2;f[s++]=0;f[s++]=2;f[s++]=3;g=d.createBuffer();
h=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,g);d.bufferData(d.ARRAY_BUFFER,e,d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,h);d.bufferData(d.ELEMENT_ARRAY_BUFFER,f,d.STATIC_DRAW);i=d.createTexture();j=d.createTexture();d.bindTexture(d.TEXTURE_2D,i);d.texImage2D(d.TEXTURE_2D,0,d.RGB,16,16,0,d.RGB,d.UNSIGNED_BYTE,null);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,
d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.bindTexture(d.TEXTURE_2D,j);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,16,16,0,d.RGBA,d.UNSIGNED_BYTE,null);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);if(d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){l=false;m=a(b.ShaderFlares.lensFlare)}else{l=
true;m=a(b.ShaderFlares.lensFlareVertexTexture)}p={};n={};p.vertex=d.getAttribLocation(m,"position");p.uv=d.getAttribLocation(m,"uv");n.renderType=d.getUniformLocation(m,"renderType");n.map=d.getUniformLocation(m,"map");n.occlusionMap=d.getUniformLocation(m,"occlusionMap");n.opacity=d.getUniformLocation(m,"opacity");n.color=d.getUniformLocation(m,"color");n.scale=d.getUniformLocation(m,"scale");n.rotation=d.getUniformLocation(m,"rotation");n.screenPosition=d.getUniformLocation(m,"screenPosition");
q=false};this.render=function(a,e,f,u){var a=a.__webglFlares,v=a.length;if(v){var x=new b.Vector3,t=u/f,y=f*0.5,G=u*0.5,D=16/u,B=new b.Vector2(D*t,D),w=new b.Vector3(1,1,0),I=new b.Vector2(1,1),J=n,D=p;d.useProgram(m);if(!q){d.enableVertexAttribArray(p.vertex);d.enableVertexAttribArray(p.uv);q=true}d.uniform1i(J.occlusionMap,0);d.uniform1i(J.map,1);d.bindBuffer(d.ARRAY_BUFFER,g);d.vertexAttribPointer(D.vertex,2,d.FLOAT,false,16,0);d.vertexAttribPointer(D.uv,2,d.FLOAT,false,16,8);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
h);d.disable(d.CULL_FACE);d.depthMask(false);var O,S,Z,C,H;for(O=0;O<v;O++){D=16/u;B.set(D*t,D);C=a[O];x.set(C.matrixWorld.elements[12],C.matrixWorld.elements[13],C.matrixWorld.elements[14]);e.matrixWorldInverse.multiplyVector3(x);e.projectionMatrix.multiplyVector3(x);w.copy(x);I.x=w.x*y+y;I.y=w.y*G+G;if(l||I.x>0&&I.x<f&&I.y>0&&I.y<u){d.activeTexture(d.TEXTURE1);d.bindTexture(d.TEXTURE_2D,i);d.copyTexImage2D(d.TEXTURE_2D,0,d.RGB,I.x-8,I.y-8,16,16,0);d.uniform1i(J.renderType,0);d.uniform2f(J.scale,
B.x,B.y);d.uniform3f(J.screenPosition,w.x,w.y,w.z);d.disable(d.BLEND);d.enable(d.DEPTH_TEST);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0);d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,j);d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,I.x-8,I.y-8,16,16,0);d.uniform1i(J.renderType,1);d.disable(d.DEPTH_TEST);d.activeTexture(d.TEXTURE1);d.bindTexture(d.TEXTURE_2D,i);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0);C.positionScreen.copy(w);C.customUpdateCallback?C.customUpdateCallback(C):C.updateLensFlares();
d.uniform1i(J.renderType,2);d.enable(d.BLEND);S=0;for(Z=C.lensFlares.length;S<Z;S++){H=C.lensFlares[S];if(H.opacity>0.0010&&H.scale>0.0010){w.x=H.x;w.y=H.y;w.z=H.z;D=H.size*H.scale/u;B.x=D*t;B.y=D;d.uniform3f(J.screenPosition,w.x,w.y,w.z);d.uniform2f(J.scale,B.x,B.y);d.uniform1f(J.rotation,H.rotation);d.uniform1f(J.opacity,H.opacity);d.uniform3f(J.color,H.color.r,H.color.g,H.color.b);c.setBlending(H.blending,H.blendEquation,H.blendSrc,H.blendDst);c.setTexture(H.texture,1);d.drawElements(d.TRIANGLES,
6,d.UNSIGNED_SHORT,0)}}}}d.enable(d.CULL_FACE);d.enable(d.DEPTH_TEST);d.depthMask(true)}}};b.ShadowMapPlugin=function(){var a,d,c,e,f=new b.Frustum,g=new b.Matrix4,h=new b.Vector3,i=new b.Vector3;this.init=function(f){a=f.context;d=f;var f=b.ShaderLib.depthRGBA,g=b.UniformsUtils.clone(f.uniforms);c=new b.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:g});e=new b.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:g,morphTargets:true});
c._shadowPass=true;e._shadowPass=true};this.render=function(a,b){d.shadowMapEnabled&&d.shadowMapAutoUpdate&&this.update(a,b)};this.update=function(j,l){var m,p,n,q,s,o,r,u,v,x=[];q=0;a.clearColor(1,1,1,1);a.disable(a.BLEND);a.enable(a.CULL_FACE);d.shadowMapCullFrontFaces?a.cullFace(a.FRONT):a.cullFace(a.BACK);d.setDepthTest(true);m=0;for(p=j.__lights.length;m<p;m++){n=j.__lights[m];if(n.castShadow)if(n instanceof b.DirectionalLight&&n.shadowCascade)for(s=0;s<n.shadowCascadeCount;s++){var t;if(n.shadowCascadeArray[s])t=
n.shadowCascadeArray[s];else{v=n;r=s;t=new b.DirectionalLight;t.isVirtual=true;t.onlyShadow=true;t.castShadow=true;t.shadowCameraNear=v.shadowCameraNear;t.shadowCameraFar=v.shadowCameraFar;t.shadowCameraLeft=v.shadowCameraLeft;t.shadowCameraRight=v.shadowCameraRight;t.shadowCameraBottom=v.shadowCameraBottom;t.shadowCameraTop=v.shadowCameraTop;t.shadowCameraVisible=v.shadowCameraVisible;t.shadowDarkness=v.shadowDarkness;t.shadowBias=v.shadowCascadeBias[r];t.shadowMapWidth=v.shadowCascadeWidth[r];t.shadowMapHeight=
v.shadowCascadeHeight[r];t.pointsWorld=[];t.pointsFrustum=[];u=t.pointsWorld;o=t.pointsFrustum;for(var y=0;y<8;y++){u[y]=new b.Vector3;o[y]=new b.Vector3}u=v.shadowCascadeNearZ[r];v=v.shadowCascadeFarZ[r];o[0].set(-1,-1,u);o[1].set(1,-1,u);o[2].set(-1,1,u);o[3].set(1,1,u);o[4].set(-1,-1,v);o[5].set(1,-1,v);o[6].set(-1,1,v);o[7].set(1,1,v);t.originalCamera=l;o=new b.Gyroscope;o.position=n.shadowCascadeOffset;o.add(t);o.add(t.target);l.add(o);n.shadowCascadeArray[s]=t;console.log("Created virtualLight",
t)}r=n;u=s;v=r.shadowCascadeArray[u];v.position.copy(r.position);v.target.position.copy(r.target.position);v.lookAt(v.target);v.shadowCameraVisible=r.shadowCameraVisible;v.shadowDarkness=r.shadowDarkness;v.shadowBias=r.shadowCascadeBias[u];o=r.shadowCascadeNearZ[u];r=r.shadowCascadeFarZ[u];v=v.pointsFrustum;v[0].z=o;v[1].z=o;v[2].z=o;v[3].z=o;v[4].z=r;v[5].z=r;v[6].z=r;v[7].z=r;x[q]=t;q++}else{x[q]=n;q++}}m=0;for(p=x.length;m<p;m++){n=x[m];if(!n.shadowMap){n.shadowMap=new b.WebGLRenderTarget(n.shadowMapWidth,
n.shadowMapHeight,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat});n.shadowMapSize=new b.Vector2(n.shadowMapWidth,n.shadowMapHeight);n.shadowMatrix=new b.Matrix4}if(!n.shadowCamera){if(n instanceof b.SpotLight)n.shadowCamera=new b.PerspectiveCamera(n.shadowCameraFov,n.shadowMapWidth/n.shadowMapHeight,n.shadowCameraNear,n.shadowCameraFar);else if(n instanceof b.DirectionalLight)n.shadowCamera=new b.OrthographicCamera(n.shadowCameraLeft,n.shadowCameraRight,n.shadowCameraTop,
n.shadowCameraBottom,n.shadowCameraNear,n.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}j.add(n.shadowCamera);d.autoUpdateScene&&j.updateMatrixWorld()}if(n.shadowCameraVisible&&!n.cameraHelper){n.cameraHelper=new b.CameraHelper(n.shadowCamera);n.shadowCamera.add(n.cameraHelper)}if(n.isVirtual&&t.originalCamera==l){s=l;q=n.shadowCamera;o=n.pointsFrustum;v=n.pointsWorld;h.set(Infinity,Infinity,Infinity);i.set(-Infinity,-Infinity,-Infinity);for(r=0;r<8;r++){u=v[r];
u.copy(o[r]);b.ShadowMapPlugin.__projector.unprojectVector(u,s);q.matrixWorldInverse.multiplyVector3(u);if(u.x<h.x)h.x=u.x;if(u.x>i.x)i.x=u.x;if(u.y<h.y)h.y=u.y;if(u.y>i.y)i.y=u.y;if(u.z<h.z)h.z=u.z;if(u.z>i.z)i.z=u.z}q.left=h.x;q.right=i.x;q.top=i.y;q.bottom=h.y;q.updateProjectionMatrix()}q=n.shadowMap;o=n.shadowMatrix;s=n.shadowCamera;s.position.copy(n.matrixWorld.getPosition());s.lookAt(n.target.matrixWorld.getPosition());s.updateMatrixWorld();s.matrixWorldInverse.getInverse(s.matrixWorld);if(n.cameraHelper)n.cameraHelper.lines.visible=
n.shadowCameraVisible;n.shadowCameraVisible&&n.cameraHelper.update();o.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);o.multiplySelf(s.projectionMatrix);o.multiplySelf(s.matrixWorldInverse);if(!s._viewMatrixArray)s._viewMatrixArray=new Float32Array(16);if(!s._projectionMatrixArray)s._projectionMatrixArray=new Float32Array(16);s.matrixWorldInverse.flattenToArray(s._viewMatrixArray);s.projectionMatrix.flattenToArray(s._projectionMatrixArray);g.multiply(s.projectionMatrix,s.matrixWorldInverse);f.setFromMatrix(g);
d.setRenderTarget(q);d.clear();v=j.__webglObjects;n=0;for(q=v.length;n<q;n++){r=v[n];o=r.object;r.render=false;if(o.visible&&o.castShadow&&(!(o instanceof b.Mesh)||!o.frustumCulled||f.contains(o))){o._modelViewMatrix.multiply(s.matrixWorldInverse,o.matrixWorld);r.render=true}}n=0;for(q=v.length;n<q;n++){r=v[n];if(r.render){o=r.object;r=r.buffer;u=o.customDepthMaterial?o.customDepthMaterial:o.geometry.morphTargets.length?e:c;r instanceof b.BufferGeometry?d.renderBufferDirect(s,j.__lights,null,u,r,
o):d.renderBuffer(s,j.__lights,null,u,r,o)}}v=j.__webglObjectsImmediate;n=0;for(q=v.length;n<q;n++){r=v[n];o=r.object;if(o.visible&&o.castShadow){o._modelViewMatrix.multiply(s.matrixWorldInverse,o.matrixWorld);d.renderImmediateObject(s,j.__lights,null,c,o)}}}m=d.getClearColor();p=d.getClearAlpha();a.clearColor(m.r,m.g,m.b,p);a.enable(a.BLEND);d.shadowMapCullFrontFaces&&a.cullFace(a.BACK)}};b.ShadowMapPlugin.__projector=new b.Projector;b.SpritePlugin=function(){function a(a,b){return b.z-a.z}var d,
c,e,f,g,h,i,j,l,m;this.init=function(a){d=a.context;c=a;e=new Float32Array(16);f=new Uint16Array(6);a=0;e[a++]=-1;e[a++]=-1;e[a++]=0;e[a++]=1;e[a++]=1;e[a++]=-1;e[a++]=1;e[a++]=1;e[a++]=1;e[a++]=1;e[a++]=1;e[a++]=0;e[a++]=-1;e[a++]=1;e[a++]=0;a=e[a++]=0;f[a++]=0;f[a++]=1;f[a++]=2;f[a++]=0;f[a++]=2;f[a++]=3;g=d.createBuffer();h=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,g);d.bufferData(d.ARRAY_BUFFER,e,d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,h);d.bufferData(d.ELEMENT_ARRAY_BUFFER,f,d.STATIC_DRAW);
var a=b.ShaderSprite.sprite,n=d.createProgram(),q=d.createShader(d.FRAGMENT_SHADER),s=d.createShader(d.VERTEX_SHADER);d.shaderSource(q,a.fragmentShader);d.shaderSource(s,a.vertexShader);d.compileShader(q);d.compileShader(s);d.attachShader(n,q);d.attachShader(n,s);d.linkProgram(n);i=n;j={};l={};j.position=d.getAttribLocation(i,"position");j.uv=d.getAttribLocation(i,"uv");l.uvOffset=d.getUniformLocation(i,"uvOffset");l.uvScale=d.getUniformLocation(i,"uvScale");l.rotation=d.getUniformLocation(i,"rotation");
l.scale=d.getUniformLocation(i,"scale");l.alignment=d.getUniformLocation(i,"alignment");l.color=d.getUniformLocation(i,"color");l.map=d.getUniformLocation(i,"map");l.opacity=d.getUniformLocation(i,"opacity");l.useScreenCoordinates=d.getUniformLocation(i,"useScreenCoordinates");l.affectedByDistance=d.getUniformLocation(i,"affectedByDistance");l.screenPosition=d.getUniformLocation(i,"screenPosition");l.modelViewMatrix=d.getUniformLocation(i,"modelViewMatrix");l.projectionMatrix=d.getUniformLocation(i,
"projectionMatrix");m=false};this.render=function(b,e,f,s){var b=b.__webglSprites,o=b.length;if(o){var r=j,u=l,v=s/f,f=f*0.5,x=s*0.5,t=true;d.useProgram(i);if(!m){d.enableVertexAttribArray(r.position);d.enableVertexAttribArray(r.uv);m=true}d.disable(d.CULL_FACE);d.enable(d.BLEND);d.depthMask(true);d.bindBuffer(d.ARRAY_BUFFER,g);d.vertexAttribPointer(r.position,2,d.FLOAT,false,16,0);d.vertexAttribPointer(r.uv,2,d.FLOAT,false,16,8);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,h);d.uniformMatrix4fv(u.projectionMatrix,
false,e._projectionMatrixArray);d.activeTexture(d.TEXTURE0);d.uniform1i(u.map,0);for(var y,G=[],r=0;r<o;r++){y=b[r];if(y.visible&&y.opacity!==0)if(y.useScreenCoordinates)y.z=-y.position.z;else{y._modelViewMatrix.multiply(e.matrixWorldInverse,y.matrixWorld);y.z=-y._modelViewMatrix.elements[14]}}b.sort(a);for(r=0;r<o;r++){y=b[r];if(y.visible&&y.opacity!==0&&y.map&&y.map.image&&y.map.image.width){if(y.useScreenCoordinates){d.uniform1i(u.useScreenCoordinates,1);d.uniform3f(u.screenPosition,(y.position.x-
f)/f,(x-y.position.y)/x,Math.max(0,Math.min(1,y.position.z)))}else{d.uniform1i(u.useScreenCoordinates,0);d.uniform1i(u.affectedByDistance,y.affectedByDistance?1:0);d.uniformMatrix4fv(u.modelViewMatrix,false,y._modelViewMatrix.elements)}e=y.map.image.width/(y.scaleByViewport?s:1);G[0]=e*v*y.scale.x;G[1]=e*y.scale.y;d.uniform2f(u.uvScale,y.uvScale.x,y.uvScale.y);d.uniform2f(u.uvOffset,y.uvOffset.x,y.uvOffset.y);d.uniform2f(u.alignment,y.alignment.x,y.alignment.y);d.uniform1f(u.opacity,y.opacity);d.uniform3f(u.color,
y.color.r,y.color.g,y.color.b);d.uniform1f(u.rotation,y.rotation);d.uniform2fv(u.scale,G);if(y.mergeWith3D&&!t){d.enable(d.DEPTH_TEST);t=true}else if(!y.mergeWith3D&&t){d.disable(d.DEPTH_TEST);t=false}c.setBlending(y.blending,y.blendEquation,y.blendSrc,y.blendDst);c.setTexture(y.map,0);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0)}}d.enable(d.CULL_FACE);d.enable(d.DEPTH_TEST);d.depthMask(true)}}};b.DepthPassPlugin=function(){this.enabled=false;this.renderTarget=null;var a,d,c,e,f=new b.Frustum,
g=new b.Matrix4;this.init=function(f){a=f.context;d=f;var f=b.ShaderLib.depthRGBA,g=b.UniformsUtils.clone(f.uniforms);c=new b.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:g});e=new b.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:g,morphTargets:true});c._shadowPass=true;e._shadowPass=true};this.render=function(a,b){this.enabled&&this.update(a,b)};this.update=function(h,i){var j,l,m,p,n,q;a.clearColor(1,1,1,1);a.disable(a.BLEND);
d.setDepthTest(true);d.autoUpdateScene&&h.updateMatrixWorld();if(!i._viewMatrixArray)i._viewMatrixArray=new Float32Array(16);if(!i._projectionMatrixArray)i._projectionMatrixArray=new Float32Array(16);i.matrixWorldInverse.getInverse(i.matrixWorld);i.matrixWorldInverse.flattenToArray(i._viewMatrixArray);i.projectionMatrix.flattenToArray(i._projectionMatrixArray);g.multiply(i.projectionMatrix,i.matrixWorldInverse);f.setFromMatrix(g);d.setRenderTarget(this.renderTarget);d.clear();q=h.__webglObjects;j=
0;for(l=q.length;j<l;j++){m=q[j];n=m.object;m.render=false;if(n.visible&&(!(n instanceof b.Mesh)||!n.frustumCulled||f.contains(n))){n._modelViewMatrix.multiply(i.matrixWorldInverse,n.matrixWorld);m.render=true}}j=0;for(l=q.length;j<l;j++){m=q[j];if(m.render){n=m.object;m=m.buffer;d.setObjectFaces(n);p=n.customDepthMaterial?n.customDepthMaterial:n.geometry.morphTargets.length?e:c;m instanceof b.BufferGeometry?d.renderBufferDirect(i,h.__lights,null,p,m,n):d.renderBuffer(i,h.__lights,null,p,m,n)}}q=
h.__webglObjectsImmediate;j=0;for(l=q.length;j<l;j++){m=q[j];n=m.object;if(n.visible&&n.castShadow){n._modelViewMatrix.multiply(i.matrixWorldInverse,n.matrixWorld);d.renderImmediateObject(i,h.__lights,null,c,n)}}j=d.getClearColor();l=d.getClearAlpha();a.clearColor(j.r,j.g,j.b,l);a.enable(a.BLEND)}};b.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}};
b.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"}};return b});
